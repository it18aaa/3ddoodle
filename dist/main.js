!function(i){var r={};function n(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}n.m=i,n.c=r,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,i){"use strict";i.r(t);
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function n(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var l=function(){return(l=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function o(e,t,i,r){var n,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;0<=a;a--)(n=e[a])&&(s=(o<3?n(s):3<o?n(t,i,s):n(t,i))||s);return 3<o&&s&&Object.defineProperty(t,i,s),s}var s=(u.Eval=function(e,t){return"true"===(e=e.match(/\([^\(\)]*\)/g)?e.replace(/\([^\(\)]*\)/g,function(e){return e=e.slice(1,e.length-1),u._HandleParenthesisContent(e,t)}):u._HandleParenthesisContent(e,t))||"false"!==e&&u.Eval(e,t)},u._HandleParenthesisContent=function(e,t){t=t||function(e){return"true"===e};var i=e.split("||");for(var r in i)if(i.hasOwnProperty(r)){var n=u._SimplifyNegation(i[r].trim()),o=n.split("&&");if(1<o.length)for(var s=0;s<o.length;++s){var a,h=u._SimplifyNegation(o[s].trim());if(!(a="true"!==h&&"false"!==h?"!"===h[0]?!t(h.substring(1)):t(h):"true"===h)){n="false";break}}if(a||"true"===n){a=!0;break}a="true"!==n&&"false"!==n?"!"===n[0]?!t(n.substring(1)):t(n):"true"===n}return a?"true":"false"},u._SimplifyNegation=function(e){return"!true"===(e=(e=e.replace(/^[\s!]+/,function(e){return(e=e.replace(/[\s]/g,function(){return""})).length%2?"!":""})).trim())?e="false":"!false"===e&&(e="true"),e},u);function u(){}var _=(a.EnableFor=function(t){t._tags=t._tags||{},t.hasTags=function(){return a.HasTags(t)},t.addTags=function(e){return a.AddTagsTo(t,e)},t.removeTags=function(e){return a.RemoveTagsFrom(t,e)},t.matchesTagsQuery=function(e){return a.MatchesQuery(t,e)}},a.DisableFor=function(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery},a.HasTags=function(e){if(!e._tags)return!1;var t=e._tags;for(var i in t)if(t.hasOwnProperty(i))return!0;return!1},a.GetTags=function(e,t){if(void 0===t&&(t=!0),!e._tags)return null;if(t){var i=[];for(var r in e._tags)e._tags.hasOwnProperty(r)&&!0===e._tags[r]&&i.push(r);return i.join(" ")}return e._tags},a.AddTagsTo=function(r,e){e&&"string"==typeof e&&e.split(" ").forEach(function(e,t,i){a._AddTagTo(r,e)})},a._AddTagTo=function(e,t){""!==(t=t.trim())&&"true"!==t&&"false"!==t&&(t.match(/[\s]/)||t.match(/^([!]|([|]|[&]){2})/)||(a.EnableFor(e),e._tags[t]=!0))},a.RemoveTagsFrom=function(e,t){if(a.HasTags(e)){var i=t.split(" ");for(var r in i)a._RemoveTagFrom(e,i[r])}},a._RemoveTagFrom=function(e,t){delete e._tags[t]},a.MatchesQuery=function(t,e){return void 0===e||(""===e?a.HasTags(t):s.Eval(e,function(e){return a.HasTags(t)&&t._tags[e]}))},a);function a(){}var c=(h.WithinEpsilon=function(e,t,i){void 0===i&&(i=1401298e-51);var r=e-t;return-i<=r&&r<=i},h.ToHex=function(e){var t=e.toString(16);return e<=15?("0"+t).toUpperCase():t.toUpperCase()},h.Sign=function(e){return 0==(e=+e)||isNaN(e)?e:0<e?1:-1},h.Clamp=function(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=1),Math.min(i,Math.max(t,e))},h.Log2=function(e){return Math.log(e)*Math.LOG2E},h.Repeat=function(e,t){return e-Math.floor(e/t)*t},h.Normalize=function(e,t,i){return(e-t)/(i-t)},h.Denormalize=function(e,t,i){return e*(i-t)+t},h.DeltaAngle=function(e,t){var i=h.Repeat(t-e,360);return 180<i&&(i-=360),i},h.PingPong=function(e,t){var i=h.Repeat(e,2*t);return t-Math.abs(i-t)},h.SmoothStep=function(e,t,i){var r=h.Clamp(i);return t*(r=-2*r*r*r+3*r*r)+e*(1-r)},h.MoveTowards=function(e,t,i){return Math.abs(t-e)<=i?t:e+h.Sign(t-e)*i},h.MoveTowardsAngle=function(e,t,i){var r=h.DeltaAngle(e,t);return-i<r&&r<i?t:h.MoveTowards(e,t=e+r,i)},h.Lerp=function(e,t,i){return e+(t-e)*i},h.LerpAngle=function(e,t,i){var r=h.Repeat(t-e,360);return 180<r&&(r-=360),e+r*h.Clamp(i)},h.InverseLerp=function(e,t,i){return e!=t?h.Clamp((i-e)/(t-e)):0},h.Hermite=function(e,t,i,r,n){var o=n*n,s=n*o;return e*(2*s-3*o+1)+i*(-2*s+3*o)+t*(s-2*o+n)+r*(s-o)},h.RandomRange=function(e,t){return e===t?e:Math.random()*(t-e)+e},h.RangeToPercent=function(e,t,i){return(e-t)/(i-t)},h.PercentToRange=function(e,t,i){return(i-t)*e+t},h.NormalizeRadians=function(e){return e-=h.TwoPi*Math.floor((e+Math.PI)/h.TwoPi)},h.TwoPi=2*Math.PI,h);function h(){}var d=1/2.2,f=2.2,C=.001,p=(g.BuildArray=function(e,t){for(var i=[],r=0;r<e;++r)i.push(t());return i},g);function g(){}var m=(v.GetClass=function(e){return this.RegisteredTypes&&this.RegisteredTypes[e]?this.RegisteredTypes[e]:null},v.RegisteredTypes={},v);function v(){}var H=(y.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},y.prototype.getClassName=function(){return"Vector2"},y.prototype.getHashCode=function(){return 397*(0|this.x)^(0|this.y)},y.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,this},y.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},y.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this},y.prototype.copyFromFloats=function(e,t){return this.x=e,this.y=t,this},y.prototype.set=function(e,t){return this.copyFromFloats(e,t)},y.prototype.add=function(e){return new y(this.x+e.x,this.y+e.y)},y.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,this},y.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this},y.prototype.addVector3=function(e){return new y(this.x+e.x,this.y+e.y)},y.prototype.subtract=function(e){return new y(this.x-e.x,this.y-e.y)},y.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,this},y.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this},y.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this},y.prototype.multiply=function(e){return new y(this.x*e.x,this.y*e.y)},y.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,this},y.prototype.multiplyByFloats=function(e,t){return new y(this.x*e,this.y*t)},y.prototype.divide=function(e){return new y(this.x/e.x,this.y/e.y)},y.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,this},y.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},y.prototype.negate=function(){return new y(-this.x,-this.y)},y.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this},y.prototype.negateToRef=function(e){return e.copyFromFloats(-1*this.x,-1*this.y)},y.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this},y.prototype.scale=function(e){var t=new y(0,0);return this.scaleToRef(e,t),t},y.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,this},y.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,this},y.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y},y.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=C),e&&c.WithinEpsilon(this.x,e.x,t)&&c.WithinEpsilon(this.y,e.y,t)},y.prototype.floor=function(){return new y(Math.floor(this.x),Math.floor(this.y))},y.prototype.fract=function(){return new y(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},y.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},y.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},y.prototype.normalize=function(){var e=this.length();return 0===e||(this.x/=e,this.y/=e),this},y.prototype.clone=function(){return new y(this.x,this.y)},y.Zero=function(){return new y(0,0)},y.One=function(){return new y(1,1)},y.FromArray=function(e,t){return void 0===t&&(t=0),new y(e[t],e[t+1])},y.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1]},y.CatmullRom=function(e,t,i,r,n){var o=n*n,s=n*o;return new y(.5*(2*t.x+(-e.x+i.x)*n+(2*e.x-5*t.x+4*i.x-r.x)*o+(-e.x+3*t.x-3*i.x+r.x)*s),.5*(2*t.y+(-e.y+i.y)*n+(2*e.y-5*t.y+4*i.y-r.y)*o+(-e.y+3*t.y-3*i.y+r.y)*s))},y.Clamp=function(e,t,i){var r=e.x;r=(r=r>i.x?i.x:r)<t.x?t.x:r;var n=e.y;return new y(r,n=(n=n>i.y?i.y:n)<t.y?t.y:n)},y.Hermite=function(e,t,i,r,n){var o=n*n,s=n*o,a=2*s-3*o+1,h=-2*s+3*o,l=s-2*o+n,u=s-o;return new y(e.x*a+i.x*h+t.x*l+r.x*u,e.y*a+i.y*h+t.y*l+r.y*u)},y.Lerp=function(e,t,i){return new y(e.x+(t.x-e.x)*i,e.y+(t.y-e.y)*i)},y.Dot=function(e,t){return e.x*t.x+e.y*t.y},y.Normalize=function(e){var t=e.clone();return t.normalize(),t},y.Minimize=function(e,t){return new y(e.x<t.x?e.x:t.x,e.y<t.y?e.y:t.y)},y.Maximize=function(e,t){return new y(e.x>t.x?e.x:t.x,e.y>t.y?e.y:t.y)},y.Transform=function(e,t){var i=y.Zero();return y.TransformToRef(e,t,i),i},y.TransformToRef=function(e,t,i){var r=t.m,n=e.x*r[0]+e.y*r[4]+r[12],o=e.x*r[1]+e.y*r[5]+r[13];i.x=n,i.y=o},y.PointInTriangle=function(e,t,i,r){var n=.5*(-i.y*r.x+t.y*(-i.x+r.x)+t.x*(i.y-r.y)+i.x*r.y),o=n<0?-1:1,s=(t.y*r.x-t.x*r.y+(r.y-t.y)*e.x+(t.x-r.x)*e.y)*o,a=(t.x*i.y-t.y*i.x+(t.y-i.y)*e.x+(i.x-t.x)*e.y)*o;return 0<s&&0<a&&s+a<2*n*o},y.Distance=function(e,t){return Math.sqrt(y.DistanceSquared(e,t))},y.DistanceSquared=function(e,t){var i=e.x-t.x,r=e.y-t.y;return i*i+r*r},y.Center=function(e,t){var i=e.add(t);return i.scaleInPlace(.5),i},y.DistanceOfPointFromSegment=function(e,t,i){var r=y.DistanceSquared(t,i);if(0===r)return y.Distance(e,t);var n=i.subtract(t),o=Math.max(0,Math.min(1,y.Dot(e.subtract(t),n)/r)),s=t.add(n.multiplyByFloats(o,o));return y.Distance(e,s)},y);function y(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.x=e,this.y=t}var te=(b.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},b.prototype.getClassName=function(){return"Vector3"},b.prototype.getHashCode=function(){var e=0|this.x;return e=397*(e=397*e^(0|this.y))^(0|this.z)},b.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},b.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,this},b.prototype.toQuaternion=function(){return x.RotationYawPitchRoll(this.y,this.x,this.z)},b.prototype.addInPlace=function(e){return this.addInPlaceFromFloats(e.x,e.y,e.z)},b.prototype.addInPlaceFromFloats=function(e,t,i){return this.x+=e,this.y+=t,this.z+=i,this},b.prototype.add=function(e){return new b(this.x+e.x,this.y+e.y,this.z+e.z)},b.prototype.addToRef=function(e,t){return t.copyFromFloats(this.x+e.x,this.y+e.y,this.z+e.z)},b.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},b.prototype.subtract=function(e){return new b(this.x-e.x,this.y-e.y,this.z-e.z)},b.prototype.subtractToRef=function(e,t){return this.subtractFromFloatsToRef(e.x,e.y,e.z,t)},b.prototype.subtractFromFloats=function(e,t,i){return new b(this.x-e,this.y-t,this.z-i)},b.prototype.subtractFromFloatsToRef=function(e,t,i,r){return r.copyFromFloats(this.x-e,this.y-t,this.z-i)},b.prototype.negate=function(){return new b(-this.x,-this.y,-this.z)},b.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},b.prototype.negateToRef=function(e){return e.copyFromFloats(-1*this.x,-1*this.y,-1*this.z)},b.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this},b.prototype.scale=function(e){return new b(this.x*e,this.y*e,this.z*e)},b.prototype.scaleToRef=function(e,t){return t.copyFromFloats(this.x*e,this.y*e,this.z*e)},b.prototype.scaleAndAddToRef=function(e,t){return t.addInPlaceFromFloats(this.x*e,this.y*e,this.z*e)},b.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z},b.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=C),e&&c.WithinEpsilon(this.x,e.x,t)&&c.WithinEpsilon(this.y,e.y,t)&&c.WithinEpsilon(this.z,e.z,t)},b.prototype.equalsToFloats=function(e,t,i){return this.x===e&&this.y===t&&this.z===i},b.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},b.prototype.multiply=function(e){return this.multiplyByFloats(e.x,e.y,e.z)},b.prototype.multiplyToRef=function(e,t){return t.copyFromFloats(this.x*e.x,this.y*e.y,this.z*e.z)},b.prototype.multiplyByFloats=function(e,t,i){return new b(this.x*e,this.y*t,this.z*i)},b.prototype.divide=function(e){return new b(this.x/e.x,this.y/e.y,this.z/e.z)},b.prototype.divideToRef=function(e,t){return t.copyFromFloats(this.x/e.x,this.y/e.y,this.z/e.z)},b.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},b.prototype.minimizeInPlace=function(e){return this.minimizeInPlaceFromFloats(e.x,e.y,e.z)},b.prototype.maximizeInPlace=function(e){return this.maximizeInPlaceFromFloats(e.x,e.y,e.z)},b.prototype.minimizeInPlaceFromFloats=function(e,t,i){return e<this.x&&(this.x=e),t<this.y&&(this.y=t),i<this.z&&(this.z=i),this},b.prototype.maximizeInPlaceFromFloats=function(e,t,i){return e>this.x&&(this.x=e),t>this.y&&(this.y=t),i>this.z&&(this.z=i),this},b.prototype.isNonUniformWithinEpsilon=function(e){var t=Math.abs(this.x),i=Math.abs(this.y);if(!c.WithinEpsilon(t,i,e))return!0;var r=Math.abs(this.z);return!c.WithinEpsilon(t,r,e)||!c.WithinEpsilon(i,r,e)},Object.defineProperty(b.prototype,"isNonUniform",{get:function(){var e=Math.abs(this.x),t=Math.abs(this.y);if(e!==t)return!0;var i=Math.abs(this.z);return e!==i||t!==i},enumerable:!0,configurable:!0}),b.prototype.floor=function(){return new b(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))},b.prototype.fract=function(){return new b(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z))},b.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},b.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},b.prototype.normalize=function(){return this.normalizeFromLength(this.length())},b.prototype.reorderInPlace=function(i){var r=this;return"xyz"===(i=i.toLowerCase())||(A.Vector3[0].copyFrom(this),["x","y","z"].forEach(function(e,t){r[e]=A.Vector3[0][i[t]]})),this},b.prototype.rotateByQuaternionToRef=function(e,t){return e.toRotationMatrix(A.Matrix[0]),b.TransformCoordinatesToRef(this,A.Matrix[0],t),t},b.prototype.rotateByQuaternionAroundPointToRef=function(e,t,i){return this.subtractToRef(t,A.Vector3[0]),A.Vector3[0].rotateByQuaternionToRef(e,A.Vector3[0]),t.addToRef(A.Vector3[0],i),i},b.prototype.cross=function(e){return b.Cross(this,e)},b.prototype.normalizeFromLength=function(e){return 0===e||1===e?this:this.scaleInPlace(1/e)},b.prototype.normalizeToNew=function(){var e=new b(0,0,0);return this.normalizeToRef(e),e},b.prototype.normalizeToRef=function(e){var t=this.length();return 0===t||1===t?e.copyFromFloats(this.x,this.y,this.z):this.scaleToRef(1/t,e)},b.prototype.clone=function(){return new b(this.x,this.y,this.z)},b.prototype.copyFrom=function(e){return this.copyFromFloats(e.x,e.y,e.z)},b.prototype.copyFromFloats=function(e,t,i){return this.x=e,this.y=t,this.z=i,this},b.prototype.set=function(e,t,i){return this.copyFromFloats(e,t,i)},b.prototype.setAll=function(e){return this.x=this.y=this.z=e,this},b.GetClipFactor=function(e,t,i,r){var n=b.Dot(e,i)-r;return n/(n-(b.Dot(t,i)-r))},b.GetAngleBetweenVectors=function(e,t,i){var r=e.normalizeToRef(A.Vector3[1]),n=t.normalizeToRef(A.Vector3[2]),o=b.Dot(r,n),s=A.Vector3[3];return b.CrossToRef(r,n,s),0<b.Dot(s,i)?Math.acos(o):-Math.acos(o)},b.FromArray=function(e,t){return void 0===t&&(t=0),new b(e[t],e[t+1],e[t+2])},b.FromFloatArray=function(e,t){return b.FromArray(e,t)},b.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1],i.z=e[t+2]},b.FromFloatArrayToRef=function(e,t,i){return b.FromArrayToRef(e,t,i)},b.FromFloatsToRef=function(e,t,i,r){r.copyFromFloats(e,t,i)},b.Zero=function(){return new b(0,0,0)},b.One=function(){return new b(1,1,1)},b.Up=function(){return new b(0,1,0)},Object.defineProperty(b,"UpReadOnly",{get:function(){return b._UpReadOnly},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ZeroReadOnly",{get:function(){return b._ZeroReadOnly},enumerable:!0,configurable:!0}),b.Down=function(){return new b(0,-1,0)},b.Forward=function(){return new b(0,0,1)},b.Backward=function(){return new b(0,0,-1)},b.Right=function(){return new b(1,0,0)},b.Left=function(){return new b(-1,0,0)},b.TransformCoordinates=function(e,t){var i=b.Zero();return b.TransformCoordinatesToRef(e,t,i),i},b.TransformCoordinatesToRef=function(e,t,i){b.TransformCoordinatesFromFloatsToRef(e.x,e.y,e.z,t,i)},b.TransformCoordinatesFromFloatsToRef=function(e,t,i,r,n){var o=r.m,s=e*o[0]+t*o[4]+i*o[8]+o[12],a=e*o[1]+t*o[5]+i*o[9]+o[13],h=e*o[2]+t*o[6]+i*o[10]+o[14],l=1/(e*o[3]+t*o[7]+i*o[11]+o[15]);n.x=s*l,n.y=a*l,n.z=h*l},b.TransformNormal=function(e,t){var i=b.Zero();return b.TransformNormalToRef(e,t,i),i},b.TransformNormalToRef=function(e,t,i){this.TransformNormalFromFloatsToRef(e.x,e.y,e.z,t,i)},b.TransformNormalFromFloatsToRef=function(e,t,i,r,n){var o=r.m;n.x=e*o[0]+t*o[4]+i*o[8],n.y=e*o[1]+t*o[5]+i*o[9],n.z=e*o[2]+t*o[6]+i*o[10]},b.CatmullRom=function(e,t,i,r,n){var o=n*n,s=n*o;return new b(.5*(2*t.x+(-e.x+i.x)*n+(2*e.x-5*t.x+4*i.x-r.x)*o+(-e.x+3*t.x-3*i.x+r.x)*s),.5*(2*t.y+(-e.y+i.y)*n+(2*e.y-5*t.y+4*i.y-r.y)*o+(-e.y+3*t.y-3*i.y+r.y)*s),.5*(2*t.z+(-e.z+i.z)*n+(2*e.z-5*t.z+4*i.z-r.z)*o+(-e.z+3*t.z-3*i.z+r.z)*s))},b.Clamp=function(e,t,i){var r=new b;return b.ClampToRef(e,t,i,r),r},b.ClampToRef=function(e,t,i,r){var n=e.x;n=(n=n>i.x?i.x:n)<t.x?t.x:n;var o=e.y;o=(o=o>i.y?i.y:o)<t.y?t.y:o;var s=e.z;s=(s=s>i.z?i.z:s)<t.z?t.z:s,r.copyFromFloats(n,o,s)},b.CheckExtends=function(e,t,i){t.minimizeInPlace(e),i.maximizeInPlace(e)},b.Hermite=function(e,t,i,r,n){var o=n*n,s=n*o,a=2*s-3*o+1,h=-2*s+3*o,l=s-2*o+n,u=s-o;return new b(e.x*a+i.x*h+t.x*l+r.x*u,e.y*a+i.y*h+t.y*l+r.y*u,e.z*a+i.z*h+t.z*l+r.z*u)},b.Lerp=function(e,t,i){var r=new b(0,0,0);return b.LerpToRef(e,t,i,r),r},b.LerpToRef=function(e,t,i,r){r.x=e.x+(t.x-e.x)*i,r.y=e.y+(t.y-e.y)*i,r.z=e.z+(t.z-e.z)*i},b.Dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},b.Cross=function(e,t){var i=b.Zero();return b.CrossToRef(e,t,i),i},b.CrossToRef=function(e,t,i){var r=e.y*t.z-e.z*t.y,n=e.z*t.x-e.x*t.z,o=e.x*t.y-e.y*t.x;i.copyFromFloats(r,n,o)},b.Normalize=function(e){var t=b.Zero();return b.NormalizeToRef(e,t),t},b.NormalizeToRef=function(e,t){e.normalizeToRef(t)},b.Project=function(e,t,i,r){var n=r.width,o=r.height,s=r.x,a=r.y,h=A.Matrix[1];W.FromValuesToRef(n/2,0,0,0,0,-o/2,0,0,0,0,.5,0,s+n/2,o/2+a,.5,1,h);var l=A.Matrix[0];return t.multiplyToRef(i,l),l.multiplyToRef(h,l),b.TransformCoordinates(e,l)},b._UnprojectFromInvertedMatrixToRef=function(e,t,i){b.TransformCoordinatesToRef(e,t,i);var r=t.m,n=e.x*r[3]+e.y*r[7]+e.z*r[11]+r[15];c.WithinEpsilon(n,1)&&i.scaleInPlace(1/n)},b.UnprojectFromTransform=function(e,t,i,r,n){var o=A.Matrix[0];r.multiplyToRef(n,o),o.invert(),e.x=e.x/t*2-1,e.y=-(e.y/i*2-1);var s=new b;return b._UnprojectFromInvertedMatrixToRef(e,o,s),s},b.Unproject=function(e,t,i,r,n,o){var s=b.Zero();return b.UnprojectToRef(e,t,i,r,n,o,s),s},b.UnprojectToRef=function(e,t,i,r,n,o,s){b.UnprojectFloatsToRef(e.x,e.y,e.z,t,i,r,n,o,s)},b.UnprojectFloatsToRef=function(e,t,i,r,n,o,s,a,h){var l=A.Matrix[0];o.multiplyToRef(s,l),l.multiplyToRef(a,l),l.invert();var u=A.Vector3[0];u.x=e/r*2-1,u.y=-(t/n*2-1),u.z=2*i-1,b._UnprojectFromInvertedMatrixToRef(u,l,h)},b.Minimize=function(e,t){var i=e.clone();return i.minimizeInPlace(t),i},b.Maximize=function(e,t){var i=e.clone();return i.maximizeInPlace(t),i},b.Distance=function(e,t){return Math.sqrt(b.DistanceSquared(e,t))},b.DistanceSquared=function(e,t){var i=e.x-t.x,r=e.y-t.y,n=e.z-t.z;return i*i+r*r+n*n},b.Center=function(e,t){var i=e.add(t);return i.scaleInPlace(.5),i},b.RotationFromAxis=function(e,t,i){var r=b.Zero();return b.RotationFromAxisToRef(e,t,i,r),r},b.RotationFromAxisToRef=function(e,t,i,r){var n=A.Quaternion[0];x.RotationQuaternionFromAxisToRef(e,t,i,n),n.toEulerAnglesToRef(r)},b._UpReadOnly=b.Up(),b._ZeroReadOnly=b.Zero(),b);function b(e,t,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),this.x=e,this.y=t,this.z=i}var j=(T.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},T.prototype.getClassName=function(){return"Vector4"},T.prototype.getHashCode=function(){var e=0|this.x;return e=397*(e=397*(e=397*e^(0|this.y))^(0|this.z))^(0|this.w)},T.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},T.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,this},T.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},T.prototype.add=function(e){return new T(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)},T.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,t.w=this.w+e.w,this},T.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},T.prototype.subtract=function(e){return new T(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)},T.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,t.w=this.w-e.w,this},T.prototype.subtractFromFloats=function(e,t,i,r){return new T(this.x-e,this.y-t,this.z-i,this.w-r)},T.prototype.subtractFromFloatsToRef=function(e,t,i,r,n){return n.x=this.x-e,n.y=this.y-t,n.z=this.z-i,n.w=this.w-r,this},T.prototype.negate=function(){return new T(-this.x,-this.y,-this.z,-this.w)},T.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},T.prototype.negateToRef=function(e){return e.copyFromFloats(-1*this.x,-1*this.y,-1*this.z,-1*this.w)},T.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},T.prototype.scale=function(e){return new T(this.x*e,this.y*e,this.z*e,this.w*e)},T.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e,this},T.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,t.z+=this.z*e,t.w+=this.w*e,this},T.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},T.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=C),e&&c.WithinEpsilon(this.x,e.x,t)&&c.WithinEpsilon(this.y,e.y,t)&&c.WithinEpsilon(this.z,e.z,t)&&c.WithinEpsilon(this.w,e.w,t)},T.prototype.equalsToFloats=function(e,t,i,r){return this.x===e&&this.y===t&&this.z===i&&this.w===r},T.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},T.prototype.multiply=function(e){return new T(this.x*e.x,this.y*e.y,this.z*e.z,this.w*e.w)},T.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z,t.w=this.w*e.w,this},T.prototype.multiplyByFloats=function(e,t,i,r){return new T(this.x*e,this.y*t,this.z*i,this.w*r)},T.prototype.divide=function(e){return new T(this.x/e.x,this.y/e.y,this.z/e.z,this.w/e.w)},T.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z,t.w=this.w/e.w,this},T.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},T.prototype.minimizeInPlace=function(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),e.w<this.w&&(this.w=e.w),this},T.prototype.maximizeInPlace=function(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),e.w>this.w&&(this.w=e.w),this},T.prototype.floor=function(){return new T(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},T.prototype.fract=function(){return new T(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},T.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},T.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},T.prototype.normalize=function(){var e=this.length();return 0===e?this:this.scaleInPlace(1/e)},T.prototype.toVector3=function(){return new te(this.x,this.y,this.z)},T.prototype.clone=function(){return new T(this.x,this.y,this.z,this.w)},T.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},T.prototype.copyFromFloats=function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},T.prototype.set=function(e,t,i,r){return this.copyFromFloats(e,t,i,r)},T.prototype.setAll=function(e){return this.x=this.y=this.z=this.w=e,this},T.FromArray=function(e,t){return new T(e[t=t||0],e[t+1],e[t+2],e[t+3])},T.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1],i.z=e[t+2],i.w=e[t+3]},T.FromFloatArrayToRef=function(e,t,i){T.FromArrayToRef(e,t,i)},T.FromFloatsToRef=function(e,t,i,r,n){n.x=e,n.y=t,n.z=i,n.w=r},T.Zero=function(){return new T(0,0,0,0)},T.One=function(){return new T(1,1,1,1)},T.Normalize=function(e){var t=T.Zero();return T.NormalizeToRef(e,t),t},T.NormalizeToRef=function(e,t){t.copyFrom(e),t.normalize()},T.Minimize=function(e,t){var i=e.clone();return i.minimizeInPlace(t),i},T.Maximize=function(e,t){var i=e.clone();return i.maximizeInPlace(t),i},T.Distance=function(e,t){return Math.sqrt(T.DistanceSquared(e,t))},T.DistanceSquared=function(e,t){var i=e.x-t.x,r=e.y-t.y,n=e.z-t.z,o=e.w-t.w;return i*i+r*r+n*n+o*o},T.Center=function(e,t){var i=e.add(t);return i.scaleInPlace(.5),i},T.TransformNormal=function(e,t){var i=T.Zero();return T.TransformNormalToRef(e,t,i),i},T.TransformNormalToRef=function(e,t,i){var r=t.m,n=e.x*r[0]+e.y*r[4]+e.z*r[8],o=e.x*r[1]+e.y*r[5]+e.z*r[9],s=e.x*r[2]+e.y*r[6]+e.z*r[10];i.x=n,i.y=o,i.z=s,i.w=e.w},T.TransformNormalFromFloatsToRef=function(e,t,i,r,n,o){var s=n.m;o.x=e*s[0]+t*s[4]+i*s[8],o.y=e*s[1]+t*s[5]+i*s[9],o.z=e*s[2]+t*s[6]+i*s[10],o.w=r},T.FromVector3=function(e,t){return void 0===t&&(t=0),new T(e.x,e.y,e.z,t)},T);function T(e,t,i,r){this.x=e,this.y=t,this.z=i,this.w=r}var x=(E.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},E.prototype.getClassName=function(){return"Quaternion"},E.prototype.getHashCode=function(){var e=0|this.x;return e=397*(e=397*(e=397*e^(0|this.y))^(0|this.z))^(0|this.w)},E.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},E.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},E.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=C),e&&c.WithinEpsilon(this.x,e.x,t)&&c.WithinEpsilon(this.y,e.y,t)&&c.WithinEpsilon(this.z,e.z,t)&&c.WithinEpsilon(this.w,e.w,t)},E.prototype.clone=function(){return new E(this.x,this.y,this.z,this.w)},E.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},E.prototype.copyFromFloats=function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},E.prototype.set=function(e,t,i,r){return this.copyFromFloats(e,t,i,r)},E.prototype.add=function(e){return new E(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)},E.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},E.prototype.subtract=function(e){return new E(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)},E.prototype.scale=function(e){return new E(this.x*e,this.y*e,this.z*e,this.w*e)},E.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e,this},E.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},E.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,t.z+=this.z*e,t.w+=this.w*e,this},E.prototype.multiply=function(e){var t=new E(0,0,0,1);return this.multiplyToRef(e,t),t},E.prototype.multiplyToRef=function(e,t){var i=this.x*e.w+this.y*e.z-this.z*e.y+this.w*e.x,r=-this.x*e.z+this.y*e.w+this.z*e.x+this.w*e.y,n=this.x*e.y-this.y*e.x+this.z*e.w+this.w*e.z,o=-this.x*e.x-this.y*e.y-this.z*e.z+this.w*e.w;return t.copyFromFloats(i,r,n,o),this},E.prototype.multiplyInPlace=function(e){return this.multiplyToRef(e,this),this},E.prototype.conjugateToRef=function(e){return e.copyFromFloats(-this.x,-this.y,-this.z,this.w),this},E.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},E.prototype.conjugate=function(){return new E(-this.x,-this.y,-this.z,this.w)},E.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},E.prototype.normalize=function(){var e=this.length();if(0===e)return this;var t=1/e;return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},E.prototype.toEulerAngles=function(e){void 0===e&&(e="YZX");var t=te.Zero();return this.toEulerAnglesToRef(t),t},E.prototype.toEulerAnglesToRef=function(e){var t=this.z,i=this.x,r=this.y,n=this.w,o=n*n,s=t*t,a=i*i,h=r*r,l=r*t-i*n;return l<-.4999999?(e.y=2*Math.atan2(r,n),e.x=Math.PI/2,e.z=0):.4999999<l?(e.y=2*Math.atan2(r,n),e.x=-Math.PI/2,e.z=0):(e.z=Math.atan2(2*(i*r+t*n),-s-a+h+o),e.x=Math.asin(-2*(t*r-i*n)),e.y=Math.atan2(2*(t*i+r*n),s-a-h+o)),this},E.prototype.toRotationMatrix=function(e){return W.FromQuaternionToRef(this,e),this},E.prototype.fromRotationMatrix=function(e){return E.FromRotationMatrixToRef(e,this),this},E.FromRotationMatrix=function(e){var t=new E;return E.FromRotationMatrixToRef(e,t),t},E.FromRotationMatrixToRef=function(e,t){var i,r=e.m,n=r[0],o=r[4],s=r[8],a=r[1],h=r[5],l=r[9],u=r[2],c=r[6],d=r[10],f=n+h+d;0<f?(i=.5/Math.sqrt(f+1),t.w=.25/i,t.x=(c-l)*i,t.y=(s-u)*i,t.z=(a-o)*i):h<n&&d<n?(i=2*Math.sqrt(1+n-h-d),t.w=(c-l)/i,t.x=.25*i,t.y=(o+a)/i,t.z=(s+u)/i):d<h?(i=2*Math.sqrt(1+h-n-d),t.w=(s-u)/i,t.x=(o+a)/i,t.y=.25*i,t.z=(l+c)/i):(i=2*Math.sqrt(1+d-n-h),t.w=(a-o)/i,t.x=(s+u)/i,t.y=(l+c)/i,t.z=.25*i)},E.Dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},E.AreClose=function(e,t){return 0<=E.Dot(e,t)},E.Zero=function(){return new E(0,0,0,0)},E.Inverse=function(e){return new E(-e.x,-e.y,-e.z,e.w)},E.InverseToRef=function(e,t){return t.set(-e.x,-e.y,-e.z,e.w),t},E.Identity=function(){return new E(0,0,0,1)},E.IsIdentity=function(e){return e&&0===e.x&&0===e.y&&0===e.z&&1===e.w},E.RotationAxis=function(e,t){return E.RotationAxisToRef(e,t,new E)},E.RotationAxisToRef=function(e,t,i){var r=Math.sin(t/2);return e.normalize(),i.w=Math.cos(t/2),i.x=e.x*r,i.y=e.y*r,i.z=e.z*r,i},E.FromArray=function(e,t){return new E(e[t=t||0],e[t+1],e[t+2],e[t+3])},E.FromEulerAngles=function(e,t,i){var r=new E;return E.RotationYawPitchRollToRef(t,e,i,r),r},E.FromEulerAnglesToRef=function(e,t,i,r){return E.RotationYawPitchRollToRef(t,e,i,r),r},E.FromEulerVector=function(e){var t=new E;return E.RotationYawPitchRollToRef(e.y,e.x,e.z,t),t},E.FromEulerVectorToRef=function(e,t){return E.RotationYawPitchRollToRef(e.y,e.x,e.z,t),t},E.RotationYawPitchRoll=function(e,t,i){var r=new E;return E.RotationYawPitchRollToRef(e,t,i,r),r},E.RotationYawPitchRollToRef=function(e,t,i,r){var n=.5*i,o=.5*t,s=.5*e,a=Math.sin(n),h=Math.cos(n),l=Math.sin(o),u=Math.cos(o),c=Math.sin(s),d=Math.cos(s);r.x=d*l*h+c*u*a,r.y=c*u*h-d*l*a,r.z=d*u*a-c*l*h,r.w=d*u*h+c*l*a},E.RotationAlphaBetaGamma=function(e,t,i){var r=new E;return E.RotationAlphaBetaGammaToRef(e,t,i,r),r},E.RotationAlphaBetaGammaToRef=function(e,t,i,r){var n=.5*(i+e),o=.5*(i-e),s=.5*t;r.x=Math.cos(o)*Math.sin(s),r.y=Math.sin(o)*Math.sin(s),r.z=Math.sin(n)*Math.cos(s),r.w=Math.cos(n)*Math.cos(s)},E.RotationQuaternionFromAxis=function(e,t,i){var r=new E(0,0,0,0);return E.RotationQuaternionFromAxisToRef(e,t,i,r),r},E.RotationQuaternionFromAxisToRef=function(e,t,i,r){var n=A.Matrix[0];W.FromXYZAxesToRef(e.normalize(),t.normalize(),i.normalize(),n),E.FromRotationMatrixToRef(n,r)},E.Slerp=function(e,t,i){var r=E.Identity();return E.SlerpToRef(e,t,i,r),r},E.SlerpToRef=function(e,t,i,r){var n,o,s,a,h=e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w,l=!1;h<0&&(l=!0,h=-h),a=.999999<h?(s=1-i,l?-i:i):(n=Math.acos(h),o=1/Math.sin(n),s=Math.sin((1-i)*n)*o,l?-Math.sin(i*n)*o:Math.sin(i*n)*o),r.x=s*e.x+a*t.x,r.y=s*e.y+a*t.y,r.z=s*e.z+a*t.z,r.w=s*e.w+a*t.w},E.Hermite=function(e,t,i,r,n){var o=n*n,s=n*o,a=2*s-3*o+1,h=-2*s+3*o,l=s-2*o+n,u=s-o;return new E(e.x*a+i.x*h+t.x*l+r.x*u,e.y*a+i.y*h+t.y*l+r.y*u,e.z*a+i.z*h+t.z*l+r.z*u,e.w*a+i.w*h+t.w*l+r.w*u)},E);function E(e,t,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=1),this.x=e,this.y=t,this.z=i,this.w=r}var W=(Object.defineProperty(G.prototype,"m",{get:function(){return this._m},enumerable:!0,configurable:!0}),G.prototype._markAsUpdated=function(){this.updateFlag=G._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},G.prototype._updateIdentityStatus=function(e,t,i,r){void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===r&&(r=!0),this.updateFlag=G._updateFlagSeed++,this._isIdentity=e,this._isIdentity3x2=e||i,this._isIdentityDirty=!this._isIdentity&&t,this._isIdentity3x2Dirty=!this._isIdentity3x2&&r},G.prototype.isIdentity=function(){var e;return this._isIdentityDirty&&(this._isIdentityDirty=!1,e=this._m,this._isIdentity=1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]),this._isIdentity},G.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]||0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2},G.prototype.determinant=function(){if(!0===this._isIdentity)return 1;var e=this._m,t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],s=e[5],a=e[6],h=e[7],l=e[8],u=e[9],c=e[10],d=e[11],f=e[12],p=e[13],_=e[14],g=e[15],m=c*g-_*d,v=u*g-p*d,y=u*_-p*c,b=l*g-f*d,T=l*_-c*f,x=l*p-f*u;return t*(s*m-a*v+h*y)+i*-(o*m-a*b+h*T)+r*(o*v-s*b+h*x)+n*-(o*y-s*T+a*x)},G.prototype.toArray=function(){return this._m},G.prototype.asArray=function(){return this._m},G.prototype.invert=function(){return this.invertToRef(this),this},G.prototype.reset=function(){return G.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},G.prototype.add=function(e){var t=new G;return this.addToRef(e,t),t},G.prototype.addToRef=function(e,t){for(var i=this._m,r=t._m,n=e.m,o=0;o<16;o++)r[o]=i[o]+n[o];return t._markAsUpdated(),this},G.prototype.addToSelf=function(e){for(var t=this._m,i=e.m,r=0;r<16;r++)t[r]+=i[r];return this._markAsUpdated(),this},G.prototype.invertToRef=function(e){if(!0===this._isIdentity)return G.IdentityToRef(e),this;var t=this._m,i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],h=t[6],l=t[7],u=t[8],c=t[9],d=t[10],f=t[11],p=t[12],_=t[13],g=t[14],m=t[15],v=d*m-g*f,y=c*m-_*f,b=c*g-_*d,T=u*m-p*f,x=u*g-d*p,E=u*_-p*c,A=+(a*v-h*y+l*b),M=-(s*v-h*T+l*x),C=+(s*y-a*T+l*E),P=-(s*b-a*x+h*E),O=i*A+r*M+n*C+o*P;if(0==O)return e.copyFrom(this),this;var S=1/O,I=h*m-g*l,R=a*m-_*l,D=a*g-_*h,w=s*m-p*l,L=s*g-p*h,F=s*_-p*a,N=h*f-d*l,B=a*f-c*l,k=a*d-c*h,U=s*f-u*l,V=s*d-u*h,z=s*c-u*a;return G.FromValuesToRef(A*S,-(r*v-n*y+o*b)*S,(r*I-n*R+o*D)*S,-(r*N-n*B+o*k)*S,M*S,(i*v-n*T+o*x)*S,-(i*I-n*w+o*L)*S,(i*N-n*U+o*V)*S,C*S,-(i*y-r*T+o*E)*S,(i*R-r*w+o*F)*S,-(i*B-r*U+o*z)*S,P*S,(i*b-r*x+n*E)*S,-(i*D-r*L+n*F)*S,(i*k-r*V+n*z)*S,e),this},G.prototype.addAtIndex=function(e,t){return this._m[e]+=t,this._markAsUpdated(),this},G.prototype.multiplyAtIndex=function(e,t){return this._m[e]*=t,this._markAsUpdated(),this},G.prototype.setTranslationFromFloats=function(e,t,i){return this._m[12]=e,this._m[13]=t,this._m[14]=i,this._markAsUpdated(),this},G.prototype.addTranslationFromFloats=function(e,t,i){return this._m[12]+=e,this._m[13]+=t,this._m[14]+=i,this._markAsUpdated(),this},G.prototype.setTranslation=function(e){return this.setTranslationFromFloats(e.x,e.y,e.z)},G.prototype.getTranslation=function(){return new te(this._m[12],this._m[13],this._m[14])},G.prototype.getTranslationToRef=function(e){return e.x=this._m[12],e.y=this._m[13],e.z=this._m[14],this},G.prototype.removeRotationAndScaling=function(){var e=this.m;return G.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e[12],e[13],e[14],e[15],this),this._updateIdentityStatus(0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]),this},G.prototype.multiply=function(e){var t=new G;return this.multiplyToRef(e,t),t},G.prototype.copyFrom=function(e){return e.copyToArray(this._m),this._updateIdentityStatus(e._isIdentity,e._isIdentityDirty,e._isIdentity3x2,e._isIdentity3x2Dirty),this},G.prototype.copyToArray=function(e,t){void 0===t&&(t=0);var i=this._m;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],this},G.prototype.multiplyToRef=function(e,t){return this._isIdentity?t.copyFrom(e):e._isIdentity?t.copyFrom(this):(this.multiplyToArray(e,t._m,0),t._markAsUpdated()),this},G.prototype.multiplyToArray=function(e,t,i){var r=this._m,n=e.m,o=r[0],s=r[1],a=r[2],h=r[3],l=r[4],u=r[5],c=r[6],d=r[7],f=r[8],p=r[9],_=r[10],g=r[11],m=r[12],v=r[13],y=r[14],b=r[15],T=n[0],x=n[1],E=n[2],A=n[3],M=n[4],C=n[5],P=n[6],O=n[7],S=n[8],I=n[9],R=n[10],D=n[11],w=n[12],L=n[13],F=n[14],N=n[15];return t[i]=o*T+s*M+a*S+h*w,t[i+1]=o*x+s*C+a*I+h*L,t[i+2]=o*E+s*P+a*R+h*F,t[i+3]=o*A+s*O+a*D+h*N,t[i+4]=l*T+u*M+c*S+d*w,t[i+5]=l*x+u*C+c*I+d*L,t[i+6]=l*E+u*P+c*R+d*F,t[i+7]=l*A+u*O+c*D+d*N,t[i+8]=f*T+p*M+_*S+g*w,t[i+9]=f*x+p*C+_*I+g*L,t[i+10]=f*E+p*P+_*R+g*F,t[i+11]=f*A+p*O+_*D+g*N,t[i+12]=m*T+v*M+y*S+b*w,t[i+13]=m*x+v*C+y*I+b*L,t[i+14]=m*E+v*P+y*R+b*F,t[i+15]=m*A+v*O+y*D+b*N,this},G.prototype.equals=function(e){if(!e)return!1;if((this._isIdentity||e._isIdentity)&&!this._isIdentityDirty&&!e._isIdentityDirty)return this._isIdentity&&e._isIdentity;var t=this.m,i=e.m;return t[0]===i[0]&&t[1]===i[1]&&t[2]===i[2]&&t[3]===i[3]&&t[4]===i[4]&&t[5]===i[5]&&t[6]===i[6]&&t[7]===i[7]&&t[8]===i[8]&&t[9]===i[9]&&t[10]===i[10]&&t[11]===i[11]&&t[12]===i[12]&&t[13]===i[13]&&t[14]===i[14]&&t[15]===i[15]},G.prototype.clone=function(){var e=new G;return e.copyFrom(this),e},G.prototype.getClassName=function(){return"Matrix"},G.prototype.getHashCode=function(){for(var e=0|this._m[0],t=1;t<16;t++)e=397*e^(0|this._m[t]);return e},G.prototype.decompose=function(e,t,i){if(this._isIdentity)return i&&i.setAll(0),e&&e.setAll(1),t&&t.copyFromFloats(0,0,0,1),!0;var r,n,o,s=this._m;return i&&i.copyFromFloats(s[12],s[13],s[14]),(e=e||A.Vector3[0]).x=Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]),e.y=Math.sqrt(s[4]*s[4]+s[5]*s[5]+s[6]*s[6]),e.z=Math.sqrt(s[8]*s[8]+s[9]*s[9]+s[10]*s[10]),this.determinant()<=0&&(e.y*=-1),0===e.x||0===e.y||0===e.z?(t&&t.copyFromFloats(0,0,0,1),!1):(t&&(r=1/e.x,n=1/e.y,o=1/e.z,G.FromValuesToRef(s[0]*r,s[1]*r,s[2]*r,0,s[4]*n,s[5]*n,s[6]*n,0,s[8]*o,s[9]*o,s[10]*o,0,0,0,0,1,A.Matrix[0]),x.FromRotationMatrixToRef(A.Matrix[0],t)),!0)},G.prototype.getRow=function(e){if(e<0||3<e)return null;var t=4*e;return new j(this._m[0+t],this._m[1+t],this._m[2+t],this._m[3+t])},G.prototype.setRow=function(e,t){return this.setRowFromFloats(e,t.x,t.y,t.z,t.w)},G.prototype.transpose=function(){return G.Transpose(this)},G.prototype.transposeToRef=function(e){return G.TransposeToRef(this,e),this},G.prototype.setRowFromFloats=function(e,t,i,r,n){if(e<0||3<e)return this;var o=4*e;return this._m[0+o]=t,this._m[1+o]=i,this._m[2+o]=r,this._m[3+o]=n,this._markAsUpdated(),this},G.prototype.scale=function(e){var t=new G;return this.scaleToRef(e,t),t},G.prototype.scaleToRef=function(e,t){for(var i=0;i<16;i++)t._m[i]=this._m[i]*e;return t._markAsUpdated(),this},G.prototype.scaleAndAddToRef=function(e,t){for(var i=0;i<16;i++)t._m[i]+=this._m[i]*e;return t._markAsUpdated(),this},G.prototype.toNormalMatrix=function(e){var t=A.Matrix[0];this.invertToRef(t),t.transposeToRef(e);var i=e._m;G.FromValuesToRef(i[0],i[1],i[2],0,i[4],i[5],i[6],0,i[8],i[9],i[10],0,0,0,0,1,e)},G.prototype.getRotationMatrix=function(){var e=new G;return this.getRotationMatrixToRef(e),e},G.prototype.getRotationMatrixToRef=function(e){var t=A.Vector3[0];if(!this.decompose(t))return G.IdentityToRef(e),this;var i=this._m,r=1/t.x,n=1/t.y,o=1/t.z;return G.FromValuesToRef(i[0]*r,i[1]*r,i[2]*r,0,i[4]*n,i[5]*n,i[6]*n,0,i[8]*o,i[9]*o,i[10]*o,0,0,0,0,1,e),this},G.prototype.toggleModelMatrixHandInPlace=function(){var e=this._m;e[2]*=-1,e[6]*=-1,e[8]*=-1,e[9]*=-1,e[14]*=-1,this._markAsUpdated()},G.prototype.toggleProjectionMatrixHandInPlace=function(){var e=this._m;e[8]*=-1,e[9]*=-1,e[10]*=-1,e[11]*=-1,this._markAsUpdated()},G.FromArray=function(e,t){void 0===t&&(t=0);var i=new G;return G.FromArrayToRef(e,t,i),i},G.FromArrayToRef=function(e,t,i){for(var r=0;r<16;r++)i._m[r]=e[r+t];i._markAsUpdated()},G.FromFloat32ArrayToRefScaled=function(e,t,i,r){for(var n=0;n<16;n++)r._m[n]=e[n+t]*i;r._markAsUpdated()},Object.defineProperty(G,"IdentityReadOnly",{get:function(){return G._identityReadOnly},enumerable:!0,configurable:!0}),G.FromValuesToRef=function(e,t,i,r,n,o,s,a,h,l,u,c,d,f,p,_,g){var m=g._m;m[0]=e,m[1]=t,m[2]=i,m[3]=r,m[4]=n,m[5]=o,m[6]=s,m[7]=a,m[8]=h,m[9]=l,m[10]=u,m[11]=c,m[12]=d,m[13]=f,m[14]=p,m[15]=_,g._markAsUpdated()},G.FromValues=function(e,t,i,r,n,o,s,a,h,l,u,c,d,f,p,_){var g=new G,m=g._m;return m[0]=e,m[1]=t,m[2]=i,m[3]=r,m[4]=n,m[5]=o,m[6]=s,m[7]=a,m[8]=h,m[9]=l,m[10]=u,m[11]=c,m[12]=d,m[13]=f,m[14]=p,m[15]=_,g._markAsUpdated(),g},G.Compose=function(e,t,i){var r=new G;return G.ComposeToRef(e,t,i,r),r},G.ComposeToRef=function(e,t,i,r){var n=r._m,o=t.x,s=t.y,a=t.z,h=t.w,l=o+o,u=s+s,c=a+a,d=o*l,f=o*u,p=o*c,_=s*u,g=s*c,m=a*c,v=h*l,y=h*u,b=h*c,T=e.x,x=e.y,E=e.z;n[0]=(1-(_+m))*T,n[1]=(f+b)*T,n[2]=(p-y)*T,n[3]=0,n[4]=(f-b)*x,n[5]=(1-(d+m))*x,n[6]=(g+v)*x,n[7]=0,n[8]=(p+y)*E,n[9]=(g-v)*E,n[10]=(1-(d+_))*E,n[11]=0,n[12]=i.x,n[13]=i.y,n[14]=i.z,n[15]=1,r._markAsUpdated()},G.Identity=function(){var e=G.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return e._updateIdentityStatus(!0),e},G.IdentityToRef=function(e){G.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,e),e._updateIdentityStatus(!0)},G.Zero=function(){var e=G.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return e._updateIdentityStatus(!1),e},G.RotationX=function(e){var t=new G;return G.RotationXToRef(e,t),t},G.Invert=function(e){var t=new G;return e.invertToRef(t),t},G.RotationXToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);G.FromValuesToRef(1,0,0,0,0,r,i,0,0,-i,r,0,0,0,0,1,t),t._updateIdentityStatus(1===r&&0===i)},G.RotationY=function(e){var t=new G;return G.RotationYToRef(e,t),t},G.RotationYToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);G.FromValuesToRef(r,0,-i,0,0,1,0,0,i,0,r,0,0,0,0,1,t),t._updateIdentityStatus(1===r&&0===i)},G.RotationZ=function(e){var t=new G;return G.RotationZToRef(e,t),t},G.RotationZToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);G.FromValuesToRef(r,i,0,0,-i,r,0,0,0,0,1,0,0,0,0,1,t),t._updateIdentityStatus(1===r&&0===i)},G.RotationAxis=function(e,t){var i=new G;return G.RotationAxisToRef(e,t,i),i},G.RotationAxisToRef=function(e,t,i){var r=Math.sin(-t),n=Math.cos(-t),o=1-n;e.normalize();var s=i._m;s[0]=e.x*e.x*o+n,s[1]=e.x*e.y*o-e.z*r,s[2]=e.x*e.z*o+e.y*r,s[3]=0,s[4]=e.y*e.x*o+e.z*r,s[5]=e.y*e.y*o+n,s[6]=e.y*e.z*o-e.x*r,s[7]=0,s[8]=e.z*e.x*o-e.y*r,s[9]=e.z*e.y*o+e.x*r,s[10]=e.z*e.z*o+n,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,i._markAsUpdated()},G.RotationAlignToRef=function(e,t,i){var r=te.Cross(t,e),n=te.Dot(t,e),o=1/(1+n),s=i._m;s[0]=r.x*r.x*o+n,s[1]=r.y*r.x*o-r.z,s[2]=r.z*r.x*o+r.y,s[3]=0,s[4]=r.x*r.y*o+r.z,s[5]=r.y*r.y*o+n,s[6]=r.z*r.y*o-r.x,s[7]=0,s[8]=r.x*r.z*o-r.y,s[9]=r.y*r.z*o+r.x,s[10]=r.z*r.z*o+n,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,i._markAsUpdated()},G.RotationYawPitchRoll=function(e,t,i){var r=new G;return G.RotationYawPitchRollToRef(e,t,i,r),r},G.RotationYawPitchRollToRef=function(e,t,i,r){x.RotationYawPitchRollToRef(e,t,i,A.Quaternion[0]),A.Quaternion[0].toRotationMatrix(r)},G.Scaling=function(e,t,i){var r=new G;return G.ScalingToRef(e,t,i,r),r},G.ScalingToRef=function(e,t,i,r){G.FromValuesToRef(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1,r),r._updateIdentityStatus(1===e&&1===t&&1===i)},G.Translation=function(e,t,i){var r=new G;return G.TranslationToRef(e,t,i,r),r},G.TranslationToRef=function(e,t,i,r){G.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e,t,i,1,r),r._updateIdentityStatus(0===e&&0===t&&0===i)},G.Lerp=function(e,t,i){var r=new G;return G.LerpToRef(e,t,i,r),r},G.LerpToRef=function(e,t,i,r){for(var n=r._m,o=e.m,s=t.m,a=0;a<16;a++)n[a]=o[a]*(1-i)+s[a]*i;r._markAsUpdated()},G.DecomposeLerp=function(e,t,i){var r=new G;return G.DecomposeLerpToRef(e,t,i,r),r},G.DecomposeLerpToRef=function(e,t,i,r){var n=A.Vector3[0],o=A.Quaternion[0],s=A.Vector3[1];e.decompose(n,o,s);var a=A.Vector3[2],h=A.Quaternion[1],l=A.Vector3[3];t.decompose(a,h,l);var u=A.Vector3[4];te.LerpToRef(n,a,i,u);var c=A.Quaternion[2];x.SlerpToRef(o,h,i,c);var d=A.Vector3[5];te.LerpToRef(s,l,i,d),G.ComposeToRef(u,c,d,r)},G.LookAtLH=function(e,t,i){var r=new G;return G.LookAtLHToRef(e,t,i,r),r},G.LookAtLHToRef=function(e,t,i,r){var n=A.Vector3[0],o=A.Vector3[1],s=A.Vector3[2];t.subtractToRef(e,s),s.normalize(),te.CrossToRef(i,s,n);var a=n.lengthSquared();0===a?n.x=1:n.normalizeFromLength(Math.sqrt(a)),te.CrossToRef(s,n,o),o.normalize();var h=-te.Dot(n,e),l=-te.Dot(o,e),u=-te.Dot(s,e);G.FromValuesToRef(n.x,o.x,s.x,0,n.y,o.y,s.y,0,n.z,o.z,s.z,0,h,l,u,1,r)},G.LookAtRH=function(e,t,i){var r=new G;return G.LookAtRHToRef(e,t,i,r),r},G.LookAtRHToRef=function(e,t,i,r){var n=A.Vector3[0],o=A.Vector3[1],s=A.Vector3[2];e.subtractToRef(t,s),s.normalize(),te.CrossToRef(i,s,n);var a=n.lengthSquared();0===a?n.x=1:n.normalizeFromLength(Math.sqrt(a)),te.CrossToRef(s,n,o),o.normalize();var h=-te.Dot(n,e),l=-te.Dot(o,e),u=-te.Dot(s,e);G.FromValuesToRef(n.x,o.x,s.x,0,n.y,o.y,s.y,0,n.z,o.z,s.z,0,h,l,u,1,r)},G.OrthoLH=function(e,t,i,r){var n=new G;return G.OrthoLHToRef(e,t,i,r,n),n},G.OrthoLHToRef=function(e,t,i,r,n){var o=2/e,s=2/t,a=2/(r-i),h=-(r+i)/(r-i);G.FromValuesToRef(o,0,0,0,0,s,0,0,0,0,a,0,0,0,h,1,n),n._updateIdentityStatus(1==o&&1==s&&1==a&&0==h)},G.OrthoOffCenterLH=function(e,t,i,r,n,o){var s=new G;return G.OrthoOffCenterLHToRef(e,t,i,r,n,o,s),s},G.OrthoOffCenterLHToRef=function(e,t,i,r,n,o,s){G.FromValuesToRef(2/(t-e),0,0,0,0,2/(r-i),0,0,0,0,2/(o-n),0,(e+t)/(e-t),(r+i)/(i-r),-(o+n)/(o-n),1,s),s._markAsUpdated()},G.OrthoOffCenterRH=function(e,t,i,r,n,o){var s=new G;return G.OrthoOffCenterRHToRef(e,t,i,r,n,o,s),s},G.OrthoOffCenterRHToRef=function(e,t,i,r,n,o,s){G.OrthoOffCenterLHToRef(e,t,i,r,n,o,s),s._m[10]*=-1},G.PerspectiveLH=function(e,t,i,r){var n=new G;return G.FromValuesToRef(2*i/e,0,0,0,0,2*i/t,0,0,0,0,(r+i)/(r-i),1,0,0,-2*r*i/(r-i),0,n),n._updateIdentityStatus(!1),n},G.PerspectiveFovLH=function(e,t,i,r){var n=new G;return G.PerspectiveFovLHToRef(e,t,i,r,n),n},G.PerspectiveFovLHToRef=function(e,t,i,r,n,o){void 0===o&&(o=!0);var s=i,a=r,h=1/Math.tan(.5*e);G.FromValuesToRef(o?h/t:h,0,0,0,0,o?h:h*t,0,0,0,0,(a+s)/(a-s),1,0,0,-2*a*s/(a-s),0,n),n._updateIdentityStatus(!1)},G.PerspectiveFovReverseLHToRef=function(e,t,i,r,n,o){void 0===o&&(o=!0);var s=1/Math.tan(.5*e);G.FromValuesToRef(o?s/t:s,0,0,0,0,o?s:s*t,0,0,0,0,-i,1,0,0,1,0,n),n._updateIdentityStatus(!1)},G.PerspectiveFovRH=function(e,t,i,r){var n=new G;return G.PerspectiveFovRHToRef(e,t,i,r,n),n},G.PerspectiveFovRHToRef=function(e,t,i,r,n,o){void 0===o&&(o=!0);var s=i,a=r,h=1/Math.tan(.5*e);G.FromValuesToRef(o?h/t:h,0,0,0,0,o?h:h*t,0,0,0,0,-(a+s)/(a-s),-1,0,0,-2*a*s/(a-s),0,n),n._updateIdentityStatus(!1)},G.PerspectiveFovReverseRHToRef=function(e,t,i,r,n,o){void 0===o&&(o=!0);var s=1/Math.tan(.5*e);G.FromValuesToRef(o?s/t:s,0,0,0,0,o?s:s*t,0,0,0,0,-i,-1,0,0,-1,0,n),n._updateIdentityStatus(!1)},G.PerspectiveFovWebVRToRef=function(e,t,i,r,n){void 0===n&&(n=!1);var o=n?-1:1,s=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),h=Math.tan(e.leftDegrees*Math.PI/180),l=Math.tan(e.rightDegrees*Math.PI/180),u=2/(h+l),c=2/(s+a),d=r._m;d[0]=u,d[1]=d[2]=d[3]=d[4]=0,d[5]=c,d[6]=d[7]=0,d[8]=(h-l)*u*.5,d[9]=-(s-a)*c*.5,d[10]=-i/(t-i),d[11]=o,d[12]=d[13]=d[15]=0,d[14]=-2*i*t/(i-t),r._markAsUpdated()},G.GetFinalMatrix=function(e,t,i,r,n,o){var s=e.width,a=e.height,h=e.x,l=e.y,u=G.FromValues(s/2,0,0,0,0,-a/2,0,0,0,0,o-n,0,h+s/2,a/2+l,n,1),c=A.Matrix[0];return t.multiplyToRef(i,c),c.multiplyToRef(r,c),c.multiply(u)},G.GetAsMatrix2x2=function(e){var t=e.m;return new Float32Array([t[0],t[1],t[4],t[5]])},G.GetAsMatrix3x3=function(e){var t=e.m;return new Float32Array([t[0],t[1],t[2],t[4],t[5],t[6],t[8],t[9],t[10]])},G.Transpose=function(e){var t=new G;return G.TransposeToRef(e,t),t},G.TransposeToRef=function(e,t){var i=t._m,r=e.m;i[0]=r[0],i[1]=r[4],i[2]=r[8],i[3]=r[12],i[4]=r[1],i[5]=r[5],i[6]=r[9],i[7]=r[13],i[8]=r[2],i[9]=r[6],i[10]=r[10],i[11]=r[14],i[12]=r[3],i[13]=r[7],i[14]=r[11],i[15]=r[15],t._updateIdentityStatus(e._isIdentity,e._isIdentityDirty)},G.Reflection=function(e){var t=new G;return G.ReflectionToRef(e,t),t},G.ReflectionToRef=function(e,t){e.normalize();var i=e.normal.x,r=e.normal.y,n=e.normal.z,o=-2*i,s=-2*r,a=-2*n;G.FromValuesToRef(o*i+1,s*i,a*i,0,o*r,s*r+1,a*r,0,o*n,s*n,a*n+1,0,o*e.d,s*e.d,a*e.d,1,t)},G.FromXYZAxesToRef=function(e,t,i,r){G.FromValuesToRef(e.x,e.y,e.z,0,t.x,t.y,t.z,0,i.x,i.y,i.z,0,0,0,0,1,r)},G.FromQuaternionToRef=function(e,t){var i=e.x*e.x,r=e.y*e.y,n=e.z*e.z,o=e.x*e.y,s=e.z*e.w,a=e.z*e.x,h=e.y*e.w,l=e.y*e.z,u=e.x*e.w;t._m[0]=1-2*(r+n),t._m[1]=2*(o+s),t._m[2]=2*(a-h),t._m[3]=0,t._m[4]=2*(o-s),t._m[5]=1-2*(n+i),t._m[6]=2*(l+u),t._m[7]=0,t._m[8]=2*(a+h),t._m[9]=2*(l-u),t._m[10]=1-2*(r+i),t._m[11]=0,t._m[12]=0,t._m[13]=0,t._m[14]=0,t._m[15]=1,t._markAsUpdated()},G._updateFlagSeed=0,G._identityReadOnly=G.Identity(),G);function G(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,this._m=new Float32Array(16),this._updateIdentityStatus(!1)}var A=(M.Vector3=p.BuildArray(6,te.Zero),M.Matrix=p.BuildArray(2,W.Identity),M.Quaternion=p.BuildArray(3,x.Zero),M);function M(){}var P=(O.Vector2=p.BuildArray(3,H.Zero),O.Vector3=p.BuildArray(13,te.Zero),O.Vector4=p.BuildArray(3,j.Zero),O.Quaternion=p.BuildArray(2,x.Zero),O.Matrix=p.BuildArray(8,W.Identity),O);function O(){}m.RegisteredTypes["BABYLON.Vector2"]=H,m.RegisteredTypes["BABYLON.Vector3"]=te,m.RegisteredTypes["BABYLON.Vector4"]=j,m.RegisteredTypes["BABYLON.Matrix"]=W;var S=(I.WarnImport=function(e){return e+" needs to be imported before as it contains a side-effect required by your code."},I);function I(){}var Ne=(R.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},R.prototype.getClassName=function(){return"Color3"},R.prototype.getHashCode=function(){var e=255*this.r|0;return e=397*(e=397*e^(255*this.g|0))^(255*this.b|0)},R.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,this},R.prototype.toColor4=function(e){return void 0===e&&(e=1),new K(this.r,this.g,this.b,e)},R.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},R.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},R.prototype.multiply=function(e){return new R(this.r*e.r,this.g*e.g,this.b*e.b)},R.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,this},R.prototype.equals=function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b},R.prototype.equalsFloats=function(e,t,i){return this.r===e&&this.g===t&&this.b===i},R.prototype.scale=function(e){return new R(this.r*e,this.g*e,this.b*e)},R.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,this},R.prototype.scaleAndAddToRef=function(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,this},R.prototype.clampToRef=function(e,t,i){return void 0===e&&(e=0),void 0===t&&(t=1),i.r=c.Clamp(this.r,e,t),i.g=c.Clamp(this.g,e,t),i.b=c.Clamp(this.b,e,t),this},R.prototype.add=function(e){return new R(this.r+e.r,this.g+e.g,this.b+e.b)},R.prototype.addToRef=function(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,this},R.prototype.subtract=function(e){return new R(this.r-e.r,this.g-e.g,this.b-e.b)},R.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,this},R.prototype.clone=function(){return new R(this.r,this.g,this.b)},R.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},R.prototype.copyFromFloats=function(e,t,i){return this.r=e,this.g=t,this.b=i,this},R.prototype.set=function(e,t,i){return this.copyFromFloats(e,t,i)},R.prototype.toHexString=function(){var e=255*this.r|0,t=255*this.g|0,i=255*this.b|0;return"#"+c.ToHex(e)+c.ToHex(t)+c.ToHex(i)},R.prototype.toLinearSpace=function(){var e=new R;return this.toLinearSpaceToRef(e),e},R.prototype.toHSV=function(){var e=new R;return this.toHSVToRef(e),e},R.prototype.toHSVToRef=function(e){var t=this.r,i=this.g,r=this.b,n=Math.max(t,i,r),o=Math.min(t,i,r),s=0,a=0,h=n,l=n-o;0!==n&&(a=l/n),n!=o&&(n==t?(s=(i-r)/l,i<r&&(s+=6)):n==i?s=(r-t)/l+2:n==r&&(s=(t-i)/l+4),s*=60),e.r=s,e.g=a,e.b=h},R.prototype.toLinearSpaceToRef=function(e){return e.r=Math.pow(this.r,f),e.g=Math.pow(this.g,f),e.b=Math.pow(this.b,f),this},R.prototype.toGammaSpace=function(){var e=new R;return this.toGammaSpaceToRef(e),e},R.prototype.toGammaSpaceToRef=function(e){return e.r=Math.pow(this.r,d),e.g=Math.pow(this.g,d),e.b=Math.pow(this.b,d),this},R.HSVtoRGBToRef=function(e,t,i,r){var n=i*t,o=e/60,s=n*(1-Math.abs(o%2-1)),a=0,h=0,l=0;0<=o&&o<=1?(a=n,h=s):1<=o&&o<=2?(a=s,h=n):2<=o&&o<=3?(h=n,l=s):3<=o&&o<=4?(h=s,l=n):4<=o&&o<=5?(a=s,l=n):5<=o&&o<=6&&(a=n,l=s);var u=i-n;r.set(a+u,h+u,l+u)},R.FromHexString=function(e){if("#"!==e.substring(0,1)||7!==e.length)return new R(0,0,0);var t=parseInt(e.substring(1,3),16),i=parseInt(e.substring(3,5),16),r=parseInt(e.substring(5,7),16);return R.FromInts(t,i,r)},R.FromArray=function(e,t){return void 0===t&&(t=0),new R(e[t],e[t+1],e[t+2])},R.FromInts=function(e,t,i){return new R(e/255,t/255,i/255)},R.Lerp=function(e,t,i){var r=new R(0,0,0);return R.LerpToRef(e,t,i,r),r},R.LerpToRef=function(e,t,i,r){r.r=e.r+(t.r-e.r)*i,r.g=e.g+(t.g-e.g)*i,r.b=e.b+(t.b-e.b)*i},R.Red=function(){return new R(1,0,0)},R.Green=function(){return new R(0,1,0)},R.Blue=function(){return new R(0,0,1)},R.Black=function(){return new R(0,0,0)},Object.defineProperty(R,"BlackReadOnly",{get:function(){return R._BlackReadOnly},enumerable:!0,configurable:!0}),R.White=function(){return new R(1,1,1)},R.Purple=function(){return new R(.5,0,.5)},R.Magenta=function(){return new R(1,0,1)},R.Yellow=function(){return new R(1,1,0)},R.Gray=function(){return new R(.5,.5,.5)},R.Teal=function(){return new R(0,1,1)},R.Random=function(){return new R(Math.random(),Math.random(),Math.random())},R._BlackReadOnly=R.Black(),R);function R(e,t,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),this.r=e,this.g=t,this.b=i}var K=(D.prototype.addInPlace=function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this},D.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},D.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,this},D.prototype.equals=function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a},D.prototype.add=function(e){return new D(this.r+e.r,this.g+e.g,this.b+e.b,this.a+e.a)},D.prototype.subtract=function(e){return new D(this.r-e.r,this.g-e.g,this.b-e.b,this.a-e.a)},D.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a,this},D.prototype.scale=function(e){return new D(this.r*e,this.g*e,this.b*e,this.a*e)},D.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e,this},D.prototype.scaleAndAddToRef=function(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t.a+=this.a*e,this},D.prototype.clampToRef=function(e,t,i){return void 0===e&&(e=0),void 0===t&&(t=1),i.r=c.Clamp(this.r,e,t),i.g=c.Clamp(this.g,e,t),i.b=c.Clamp(this.b,e,t),i.a=c.Clamp(this.a,e,t),this},D.prototype.multiply=function(e){return new D(this.r*e.r,this.g*e.g,this.b*e.b,this.a*e.a)},D.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t.a=this.a*e.a,t},D.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},D.prototype.getClassName=function(){return"Color4"},D.prototype.getHashCode=function(){var e=255*this.r|0;return e=397*(e=397*(e=397*e^(255*this.g|0))^(255*this.b|0))^(255*this.a|0)},D.prototype.clone=function(){return new D(this.r,this.g,this.b,this.a)},D.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this},D.prototype.copyFromFloats=function(e,t,i,r){return this.r=e,this.g=t,this.b=i,this.a=r,this},D.prototype.set=function(e,t,i,r){return this.copyFromFloats(e,t,i,r)},D.prototype.toHexString=function(){var e=255*this.r|0,t=255*this.g|0,i=255*this.b|0,r=255*this.a|0;return"#"+c.ToHex(e)+c.ToHex(t)+c.ToHex(i)+c.ToHex(r)},D.prototype.toLinearSpace=function(){var e=new D;return this.toLinearSpaceToRef(e),e},D.prototype.toLinearSpaceToRef=function(e){return e.r=Math.pow(this.r,f),e.g=Math.pow(this.g,f),e.b=Math.pow(this.b,f),e.a=this.a,this},D.prototype.toGammaSpace=function(){var e=new D;return this.toGammaSpaceToRef(e),e},D.prototype.toGammaSpaceToRef=function(e){return e.r=Math.pow(this.r,d),e.g=Math.pow(this.g,d),e.b=Math.pow(this.b,d),e.a=this.a,this},D.FromHexString=function(e){if("#"!==e.substring(0,1)||9!==e.length)return new D(0,0,0,0);var t=parseInt(e.substring(1,3),16),i=parseInt(e.substring(3,5),16),r=parseInt(e.substring(5,7),16),n=parseInt(e.substring(7,9),16);return D.FromInts(t,i,r,n)},D.Lerp=function(e,t,i){var r=new D(0,0,0,0);return D.LerpToRef(e,t,i,r),r},D.LerpToRef=function(e,t,i,r){r.r=e.r+(t.r-e.r)*i,r.g=e.g+(t.g-e.g)*i,r.b=e.b+(t.b-e.b)*i,r.a=e.a+(t.a-e.a)*i},D.FromColor3=function(e,t){return void 0===t&&(t=1),new D(e.r,e.g,e.b,t)},D.FromArray=function(e,t){return void 0===t&&(t=0),new D(e[t],e[t+1],e[t+2],e[t+3])},D.FromInts=function(e,t,i,r){return new D(e/255,t/255,i/255,r/255)},D.CheckColors4=function(e,t){if(e.length!==3*t)return e;for(var i=[],r=0;r<e.length;r+=3){var n=r/3*4;i[n]=e[r],i[1+n]=e[r+1],i[2+n]=e[r+2],i[3+n]=1}return i},D);function D(e,t,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=1),this.r=e,this.g=t,this.b=i,this.a=r}var w=(L.Color3=p.BuildArray(3,Ne.Black),L.Color4=p.BuildArray(3,function(){return new K(0,0,0,0)}),L);function L(){}m.RegisteredTypes["BABYLON.Color3"]=Ne,m.RegisteredTypes["BABYLON.Color4"]=K;function F(e,t,i){var r=e();_&&_.AddTagsTo(r,t.tags);var n=k(r);for(var o in n){var s=n[o],a=t[o],h=s.type;if(null!=a&&"uniqueId"!==o)switch(h){case 0:case 6:case 11:r[o]=a;break;case 1:r[o]=i||a.isRenderTarget?a:a.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:r[o]=i?a:a.clone()}}return r}var N={},B={};function k(e){var t=e.getClassName();if(B[t])return B[t];B[t]={};for(var i=B[t],r=e,n=t;n;){var o=N[n];for(var s in o)i[s]=o[s];var a=void 0,h=!1;do{if(!(a=Object.getPrototypeOf(r)).getClassName){h=!0;break}if(a.getClassName()!==n)break;r=a}while(a);if(h)break;n=a.getClassName(),r=a}return i}function U(n,o){return function(e,t){var i,r=(i=e.getClassName(),N[i]||(N[i]={}),N[i]);r[t]||(r[t]={type:n,sourceName:o})}}function V(e,t){return void 0===t&&(t=null),r=e,void 0===(n=t)&&(n=null),function(t,e){var i=n||"_"+e;Object.defineProperty(t,e,{get:function(){return this[i]},set:function(e){this[i]!==e&&(this[i]=e,t[r].apply(this))},enumerable:!0,configurable:!0})};var r,n}function z(e){return U(0,e)}function X(e){return U(1,e)}function Y(e){return U(2,e)}function q(e){return U(3,e)}function Z(e){return U(5,e)}var Q=(J.AppendSerializedAnimations=function(e,t){if(e.animations){t.animations=[];for(var i=0;i<e.animations.length;i++){var r=e.animations[i];t.animations.push(r.serialize())}}},J.Serialize=function(e,t){t=t||{},_&&(t.tags=_.GetTags(e));var i=k(e);for(var r in i){var n=i[r],o=n.sourceName||r,s=n.type,a=e[r];if(null!=a)switch(s){case 0:t[o]=a;break;case 1:t[o]=a.serialize();break;case 2:t[o]=a.asArray();break;case 3:t[o]=a.serialize();break;case 4:case 5:t[o]=a.asArray();break;case 6:t[o]=a.id;break;case 7:t[o]=a.serialize();break;case 8:t[o]=a.asArray();break;case 9:t[o]=a.serialize();break;case 10:t[o]=a.asArray();break;case 11:t[o]=a.id;case 12:t[o]=a.asArray()}}return t},J.Parse=function(e,t,i,r){void 0===r&&(r=null);var n=e();r=r||"",_&&_.AddTagsTo(n,t.tags);var o=k(n);for(var s in o){var a=o[s],h=t[a.sourceName||s],l=a.type;if(null!=h){var u=n;switch(l){case 0:u[s]=h;break;case 1:i&&(u[s]=J._TextureParser(h,i,r));break;case 2:u[s]=Ne.FromArray(h);break;case 3:u[s]=J._FresnelParametersParser(h);break;case 4:u[s]=H.FromArray(h);break;case 5:u[s]=te.FromArray(h);break;case 6:i&&(u[s]=i.getLastMeshByID(h));break;case 7:u[s]=J._ColorCurvesParser(h);break;case 8:u[s]=K.FromArray(h);break;case 9:u[s]=J._ImageProcessingConfigurationParser(h);break;case 10:u[s]=x.FromArray(h);break;case 11:i&&(u[s]=i.getCameraByID(h));case 12:u[s]=W.FromArray(h)}}}return n},J.Clone=function(e,t){return F(e,t,!1)},J.Instanciate=function(e,t){return F(e,t,!0)},J._ImageProcessingConfigurationParser=function(e){throw S.WarnImport("ImageProcessingConfiguration")},J._FresnelParametersParser=function(e){throw S.WarnImport("FresnelParameters")},J._ColorCurvesParser=function(e){throw S.WarnImport("ColorCurves")},J._TextureParser=function(e,t,i){throw S.WarnImport("Texture")},J);function J(){}var $=(ee.prototype.push=function(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2)},ee.prototype.forEach=function(e){for(var t=0;t<this.length;t++)e(this.data[t])},ee.prototype.sort=function(e){this.data.sort(e)},ee.prototype.reset=function(){this.length=0},ee.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},ee.prototype.concat=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}},ee.prototype.indexOf=function(e){var t=this.data.indexOf(e);return t>=this.length?-1:t},ee.prototype.contains=function(e){return-1!==this.indexOf(e)},ee._GlobalId=0,ee);function ee(e){this.length=0,this.data=new Array(e),this._id=ee._GlobalId++}var ie,re=(n(ne,ie=$),ne.prototype.push=function(e){ie.prototype.push.call(this,e),e.__smartArrayFlags||(e.__smartArrayFlags={}),e.__smartArrayFlags[this._id]=this._duplicateId},ne.prototype.pushNoDuplicate=function(e){return!(e.__smartArrayFlags&&e.__smartArrayFlags[this._id]===this._duplicateId||(this.push(e),0))},ne.prototype.reset=function(){ie.prototype.reset.call(this),this._duplicateId++},ne.prototype.concatWithNoDuplicate=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++){var i=(e.data||e)[t];this.pushNoDuplicate(i)}}},ne);function ne(){var e=null!==ie&&ie.apply(this,arguments)||this;return e._duplicateId=0,e}var oe=(se.prototype.initalize=function(e,t,i,r){return void 0===t&&(t=!1),this.mask=e,this.skipNextObservers=t,this.target=i,this.currentTarget=r,this},se);function se(e,t,i,r){void 0===t&&(t=!1),this.initalize(e,t,i,r)}var ae=function(e,t,i){void 0===i&&(i=null),this.callback=e,this.mask=t,this.scope=i,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1};he.prototype.dispose=function(){if(this._observers&&this._observables)for(var e=0;e<this._observers.length;e++)this._observables[e].remove(this._observers[e]);this._observers=null,this._observables=null},he.Watch=function(e,t,i,r){void 0===i&&(i=-1),void 0===r&&(r=null);var n=new he;n._observers=new Array;for(var o=0,s=n._observables=e;o<s.length;o++){var a=s[o].add(t,i,!1,r);a&&n._observers.push(a)}return n};function he(){}var le=(Object.defineProperty(ue.prototype,"observers",{get:function(){return this._observers},enumerable:!0,configurable:!0}),ue.prototype.add=function(e,t,i,r,n){if(void 0===t&&(t=-1),void 0===i&&(i=!1),void 0===r&&(r=null),void 0===n&&(n=!1),!e)return null;var o=new ae(e,t,r);return o.unregisterOnNextCall=n,i?this._observers.unshift(o):this._observers.push(o),this._onObserverAdded&&this._onObserverAdded(o),o},ue.prototype.addOnce=function(e){return this.add(e,void 0,void 0,void 0,!0)},ue.prototype.remove=function(e){return!!e&&-1!==this._observers.indexOf(e)&&(this._deferUnregister(e),!0)},ue.prototype.removeCallback=function(e,t){for(var i=0;i<this._observers.length;i++){var r=this._observers[i];if(!(r._willBeUnregistered||r.callback!==e||t&&t!==r.scope))return this._deferUnregister(r),!0}return!1},ue.prototype._deferUnregister=function(e){var t=this;e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout(function(){t._remove(e)},0)},ue.prototype._remove=function(e){if(!e)return!1;var t=this._observers.indexOf(e);return-1!==t&&(this._observers.splice(t,1),!0)},ue.prototype.makeObserverTopPriority=function(e){this._remove(e),this._observers.unshift(e)},ue.prototype.makeObserverBottomPriority=function(e){this._remove(e),this._observers.push(e)},ue.prototype.notifyObservers=function(e,t,i,r){if(void 0===t&&(t=-1),!this._observers.length)return!0;var n=this._eventState;n.mask=t,n.target=i,n.currentTarget=r,n.skipNextObservers=!1,n.lastReturnValue=e;for(var o=0,s=this._observers;o<s.length;o++){var a=s[o];if(!a._willBeUnregistered&&(a.mask&t&&(a.scope?n.lastReturnValue=a.callback.apply(a.scope,[e,n]):n.lastReturnValue=a.callback(e,n),a.unregisterOnNextCall&&this._deferUnregister(a)),n.skipNextObservers))return!1}return!0},ue.prototype.notifyObserversWithPromise=function(i,e,t,r){var n=this;void 0===e&&(e=-1);var o=Promise.resolve(i);if(!this._observers.length)return o;var s=this._eventState;return s.mask=e,s.target=t,s.currentTarget=r,s.skipNextObservers=!1,this._observers.forEach(function(t){s.skipNextObservers||t._willBeUnregistered||t.mask&e&&(o=t.scope?o.then(function(e){return s.lastReturnValue=e,t.callback.apply(t.scope,[i,s])}):o.then(function(e){return s.lastReturnValue=e,t.callback(i,s)}),t.unregisterOnNextCall&&n._deferUnregister(t))}),o.then(function(){return i})},ue.prototype.notifyObserver=function(e,t,i){void 0===i&&(i=-1);var r=this._eventState;r.mask=i,r.skipNextObservers=!1,e.callback(t,r)},ue.prototype.hasObservers=function(){return 0<this._observers.length},ue.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},ue.prototype.clone=function(){var e=new ue;return e._observers=this._observers.slice(0),e},ue.prototype.hasSpecificMask=function(e){void 0===e&&(e=-1);for(var t=0,i=this._observers;t<i.length;t++){var r=i[t];if(r.mask&e||r.mask===e)return!0}return!1},ue);function ue(e){this._observers=new Array,this._eventState=new oe(0),e&&(this._onObserverAdded=e)}var ce=(de.IsWindowObjectExist=function(){return"undefined"!=typeof window},de.IsNavigatorAvailable=function(){return"undefined"!=typeof navigator},de.GetDOMTextContent=function(e){for(var t="",i=e.firstChild;i;)3===i.nodeType&&(t+=i.textContent),i=i.nextSibling;return t},de);function de(){}var fe=(pe._AddLogEntry=function(e){pe._LogCache=e+pe._LogCache,pe.OnNewCacheEntry&&pe.OnNewCacheEntry(e)},pe._FormatMessage=function(e){function t(e){return e<10?"0"+e:""+e}var i=new Date;return"["+t(i.getHours())+":"+t(i.getMinutes())+":"+t(i.getSeconds())+"]: "+e},pe._LogDisabled=function(e){},pe._LogEnabled=function(e){var t=pe._FormatMessage(e);console.log("BJS - "+t),pe._AddLogEntry("<div style='color:white'>"+t+"</div><br>")},pe._WarnDisabled=function(e){},pe._WarnEnabled=function(e){var t=pe._FormatMessage(e);console.warn("BJS - "+t),pe._AddLogEntry("<div style='color:orange'>"+t+"</div><br>")},pe._ErrorDisabled=function(e){},pe._ErrorEnabled=function(e){pe.errorsCount++;var t=pe._FormatMessage(e);console.error("BJS - "+t),pe._AddLogEntry("<div style='color:red'>"+t+"</div><br>")},Object.defineProperty(pe,"LogCache",{get:function(){return pe._LogCache},enumerable:!0,configurable:!0}),pe.ClearLogCache=function(){pe._LogCache="",pe.errorsCount=0},Object.defineProperty(pe,"LogLevels",{set:function(e){pe.Log=(e&pe.MessageLogLevel)===pe.MessageLogLevel?pe._LogEnabled:pe._LogDisabled,pe.Warn=(e&pe.WarningLogLevel)===pe.WarningLogLevel?pe._WarnEnabled:pe._WarnDisabled,pe.Error=(e&pe.ErrorLogLevel)===pe.ErrorLogLevel?pe._ErrorEnabled:pe._ErrorDisabled},enumerable:!0,configurable:!0}),pe.NoneLogLevel=0,pe.MessageLogLevel=1,pe.WarningLogLevel=2,pe.ErrorLogLevel=4,pe.AllLogLevel=7,pe._LogCache="",pe.errorsCount=0,pe.Log=pe._LogEnabled,pe.Warn=pe._WarnEnabled,pe.Error=pe._ErrorEnabled,pe);function pe(){}var _e=(ge.EndsWith=function(e,t){return-1!==e.indexOf(t,e.length-t.length)},ge.StartsWith=function(e,t){return 0===e.indexOf(t)},ge.Decode=function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",i=0;i<e.byteLength;i++)t+=String.fromCharCode(e[i]);return t},ge.EncodeArrayBufferToBase64=function(e){for(var t,i,r,n,o,s,a,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",u=0,c=ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e);u<c.length;)n=(t=c[u++])>>2,o=(3&t)<<4|(i=u<c.length?c[u++]:Number.NaN)>>4,s=(15&i)<<2|(r=u<c.length?c[u++]:Number.NaN)>>6,a=63&r,isNaN(i)?s=a=64:isNaN(r)&&(a=64),l+=h.charAt(n)+h.charAt(o)+h.charAt(s)+h.charAt(a);return l},ge);function ge(){}function me(e,t){return!e||e.getClassName&&"Mesh"===e.getClassName()?null:e.getClassName&&"SubMesh"===e.getClassName()?e.clone(t):e.clone?e.clone():null}var ve=(ye.DeepCopy=function(e,t,i,r){for(var n in e)if(("_"!==n[0]||r&&-1!==r.indexOf(n))&&!(_e.EndsWith(n,"Observable")||i&&-1!==i.indexOf(n))){var o=e[n],s=typeof o;if("function"!=s)try{if("object"==s)if(o instanceof Array){if(t[n]=[],0<o.length)if("object"==typeof o[0])for(var a=0;a<o.length;a++){var h=me(o[a],t);-1===t[n].indexOf(h)&&t[n].push(h)}else t[n]=o.slice(0)}else t[n]=me(o,t);else t[n]=o}catch(e){}}},ye);function ye(){}var be=(Object.defineProperty(Te,"Now",{get:function(){return ce.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()},enumerable:!0,configurable:!0}),Te);function Te(){}var xe=(Ee.prototype._injectCustomRequestHeaders=function(){for(var e in Ee.CustomRequestHeaders){var t=Ee.CustomRequestHeaders[e];t&&this._xhr.setRequestHeader(e,t)}},Object.defineProperty(Ee.prototype,"onprogress",{get:function(){return this._xhr.onprogress},set:function(e){this._xhr.onprogress=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ee.prototype,"readyState",{get:function(){return this._xhr.readyState},enumerable:!0,configurable:!0}),Object.defineProperty(Ee.prototype,"status",{get:function(){return this._xhr.status},enumerable:!0,configurable:!0}),Object.defineProperty(Ee.prototype,"statusText",{get:function(){return this._xhr.statusText},enumerable:!0,configurable:!0}),Object.defineProperty(Ee.prototype,"response",{get:function(){return this._xhr.response},enumerable:!0,configurable:!0}),Object.defineProperty(Ee.prototype,"responseURL",{get:function(){return this._xhr.responseURL},enumerable:!0,configurable:!0}),Object.defineProperty(Ee.prototype,"responseText",{get:function(){return this._xhr.responseText},enumerable:!0,configurable:!0}),Object.defineProperty(Ee.prototype,"responseType",{get:function(){return this._xhr.responseType},set:function(e){this._xhr.responseType=e},enumerable:!0,configurable:!0}),Ee.prototype.addEventListener=function(e,t,i){this._xhr.addEventListener(e,t,i)},Ee.prototype.removeEventListener=function(e,t,i){this._xhr.removeEventListener(e,t,i)},Ee.prototype.abort=function(){this._xhr.abort()},Ee.prototype.send=function(e){Ee.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(e)},Ee.prototype.open=function(e,t){for(var i=0,r=Ee.CustomRequestModifiers;i<r.length;i++)(0,r[i])(this._xhr,t);return t=(t=t.replace("file:http:","http:")).replace("file:https:","https:"),this._xhr.open(e,t,!0)},Ee.prototype.setRequestHeader=function(e,t){this._xhr.setRequestHeader(e,t)},Ee.prototype.getResponseHeader=function(e){return this._xhr.getResponseHeader(e)},Ee.CustomRequestHeaders={},Ee.CustomRequestModifiers=new Array,Ee);function Ee(){this._xhr=new XMLHttpRequest}var Ae=(Object.defineProperty(Me,"LastCreatedEngine",{get:function(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(Me,"LastCreatedScene",{get:function(){return this._LastCreatedScene},enumerable:!0,configurable:!0}),Me.Instances=new Array,Me._LastCreatedScene=null,Me.UseFallbackTexture=!0,Me.FallbackTexture="",Me);function Me(){}var Ce=(Pe.FilesToLoad={},Pe);function Pe(){}var Oe=(Se.ExponentialBackoff=function(r,n){return void 0===r&&(r=3),void 0===n&&(n=500),function(e,t,i){return 0!==t.status||r<=i||-1!==e.indexOf("file:")?-1:Math.pow(2,i)*n}},Se);function Se(){}var Ie,Re=(n(De,Ie=Error),De._setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},De);function De(){return null!==Ie&&Ie.apply(this,arguments)||this}var we=(Le.prototype.isValid=function(e){return!0},Le.prototype.process=function(t,i){var e,r,n="";return this.line&&(e=this.line,(r=i.processor)&&(r.lineProcessor&&(e=r.lineProcessor(e,i.isFragment)),r.attributeProcessor&&_e.StartsWith(this.line,"attribute")?e=r.attributeProcessor(this.line):r.varyingProcessor&&_e.StartsWith(this.line,"varying")?e=r.varyingProcessor(this.line,i.isFragment):(r.uniformProcessor||r.uniformBufferProcessor)&&_e.StartsWith(this.line,"uniform")&&(/uniform (.+) (.+)/.test(this.line)?r.uniformProcessor&&(e=r.uniformProcessor(this.line,i.isFragment)):r.uniformBufferProcessor&&(e=r.uniformBufferProcessor(this.line,i.isFragment),i.lookForClosingBracketForUniformBuffer=!0)),r.endOfUniformBufferProcessor&&i.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(i.lookForClosingBracketForUniformBuffer=!1,e=r.endOfUniformBufferProcessor(this.line,i.isFragment))),n+=e+"\r\n"),this.children.forEach(function(e){n+=e.process(t,i)}),this.additionalDefineKey&&(t[this.additionalDefineKey]=this.additionalDefineValue||"true"),n},Le);function Le(){this.children=[]}var Fe=(Object.defineProperty(Be.prototype,"currentLine",{get:function(){return this._lines[this.lineIndex]},enumerable:!0,configurable:!0}),Object.defineProperty(Be.prototype,"canRead",{get:function(){return this.lineIndex<this._lines.length-1},enumerable:!0,configurable:!0}),Object.defineProperty(Be.prototype,"lines",{set:function(e){this._lines=[];for(var t=0,i=e;t<i.length;t++){var r=i[t];if("#"!==r[0])for(var n=r.split(";"),o=0;o<n.length;o++){var s=n[o];(s=s.trim())&&this._lines.push(s+(o!==n.length-1?";":""))}else this._lines.push(r)}},enumerable:!0,configurable:!0}),Be);function Be(){}var ke,Ue=(n(Ve,ke=we),Ve.prototype.process=function(e,t){for(var i=0;i<this.children.length;i++){var r=this.children[i];if(r.isValid(e))return r.process(e,t)}return""},Ve);function Ve(){return null!==ke&&ke.apply(this,arguments)||this}var ze,We=(n(Ge,ze=we),Ge.prototype.isValid=function(e){return this.testExpression.isTrue(e)},Ge);function Ge(){return null!==ze&&ze.apply(this,arguments)||this}var Xe=(He.prototype.isTrue=function(e){return!0},He);function He(){}var je,Ke=(n(Ye,je=Xe),Ye.prototype.isTrue=function(e){var t=void 0!==e[this.define];return this.not&&(t=!t),t},Ye);function Ye(e,t){void 0===t&&(t=!1);var i=je.call(this)||this;return i.define=e,i.not=t,i}var qe,Ze=(n(Qe,qe=Xe),Qe.prototype.isTrue=function(e){return this.leftOperand.isTrue(e)||this.rightOperand.isTrue(e)},Qe);function Qe(){return null!==qe&&qe.apply(this,arguments)||this}var Je,$e=(n(et,Je=Xe),et.prototype.isTrue=function(e){return this.leftOperand.isTrue(e)&&this.rightOperand.isTrue(e)},et);function et(){return null!==Je&&Je.apply(this,arguments)||this}var tt,it=(n(rt,tt=Xe),rt.prototype.isTrue=function(e){var t=e[this.define];void 0===t&&(t=this.define);var i=!1,r=parseInt(t),n=parseInt(this.testValue);switch(this.operand){case">":i=n<r;break;case"<":i=r<n;break;case"<=":i=r<=n;break;case">=":i=n<=r;break;case"==":i=r===n}return i},rt);function rt(e,t,i){var r=tt.call(this)||this;return r.define=e,r.operand=t,r.testValue=i,r}var nt=(ot.Process=function(e,i,r){var n=this;this._ProcessIncludes(e,i,function(e){var t=n._ProcessShaderConversion(e,i);r(t)})},ot._ProcessPrecision=function(e,t){var i=t.shouldUseHighPrecisionShader;return-1===e.indexOf("precision highp float")?e=i?"precision highp float;\n"+e:"precision mediump float;\n"+e:i||(e=e.replace("precision highp float","precision mediump float")),e},ot._ExtractOperation=function(e){var t=/defined\((.+)\)/.exec(e);if(t&&t.length)return new Ke(t[1].trim(),"!"===e[0]);for(var i="",r=0,n=0,o=["==",">=","<=","<",">"];n<o.length&&(i=o[n],!(-1<(r=e.indexOf(i))));n++);if(-1===r)return new Ke(e);var s=e.substring(0,r).trim(),a=e.substring(r+i.length).trim();return new it(s,i,a)},ot._BuildSubExpression=function(e){var t=e.indexOf("||");if(-1===t){var i=e.indexOf("&&");if(-1<i){var r=new $e,n=e.substring(0,i).trim(),o=e.substring(i+2).trim();return r.leftOperand=this._BuildSubExpression(n),r.rightOperand=this._BuildSubExpression(o),r}return this._ExtractOperation(e)}var s=new Ze,n=e.substring(0,t).trim(),o=e.substring(t+2).trim();return s.leftOperand=this._BuildSubExpression(n),s.rightOperand=this._BuildSubExpression(o),s},ot._BuildExpression=function(e,t){var i=new We,r=e.substring(0,t),n=e.substring(t).trim();return i.testExpression="#ifdef"===r?new Ke(n):"#ifndef"===r?new Ke(n,!0):this._BuildSubExpression(n),i},ot._MoveCursorWithinIf=function(e,t,i){for(var r=e.currentLine;this._MoveCursor(e,i);){var n,o=(r=e.currentLine).substring(0,5).toLowerCase();if("#else"===o){var s=new we;return t.children.push(s),void this._MoveCursor(e,s)}"#elif"===o&&(n=this._BuildExpression(r,5),t.children.push(n),i=n)}},ot._MoveCursor=function(e,t){for(;e.canRead;){e.lineIndex++;var i=e.currentLine,r=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/.exec(i);if(r&&r.length)switch(r[0]){case"#ifdef":var n=new Ue;t.children.push(n);var o=this._BuildExpression(i,6);n.children.push(o),this._MoveCursorWithinIf(e,n,o);break;case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":n=new Ue,t.children.push(n),o=this._BuildExpression(i,7),n.children.push(o),this._MoveCursorWithinIf(e,n,o);break;case"#if":n=new Ue,o=this._BuildExpression(i,3),t.children.push(n),n.children.push(o),this._MoveCursorWithinIf(e,n,o)}else{var s,a=new we;a.line=i,t.children.push(a),"#"===i[0]&&"d"===i[1]&&(s=i.replace(";","").split(" "),a.additionalDefineKey=s[1],3===s.length&&(a.additionalDefineValue=s[2]))}}return!1},ot._EvaluatePreProcessors=function(e,t,i){var r=new we,n=new Fe;return n.lineIndex=-1,n.lines=e.split("\n"),this._MoveCursor(n,r),r.process(t,i)},ot._PreparePreProcessors=function(e){for(var t={},i=0,r=e.defines;i<r.length;i++){var n=r[i].replace("#define","").replace(";","").trim().split(" ");t[n[0]]=1<n.length?n[1]:""}return t.GL_ES="true",t.__VERSION__=e.version,t[e.platformName]="true",t},ot._ProcessShaderConversion=function(e,t){var i=this._ProcessPrecision(e,t);if(!t.processor)return i;if(-1!==i.indexOf("#version 3"))return i.replace("#version 300 es","");var r=t.defines,n=this._PreparePreProcessors(t);return t.processor.preProcessor&&(i=t.processor.preProcessor(i,r,t.isFragment)),i=this._EvaluatePreProcessors(i,n,t),t.processor.postProcessor&&(i=t.processor.postProcessor(i,r,t.isFragment)),i},ot._ProcessIncludes=function(e,t,i){for(var r=this,n=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,o=n.exec(e),s=new String(e);null!=o;){var a=o[1];if(-1!==a.indexOf("__decl__")&&(a=a.replace(/__decl__/,""),t.supportsUniformBuffers&&(a=(a=a.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),a+="Declaration"),!t.includesShadersStore[a]){var h=t.shadersRepository+"ShadersInclude/"+a+".fx";return void ot._FileToolsLoadFile(h,function(e){t.includesShadersStore[a]=e,r._ProcessIncludes(s,t,i)})}var l=t.includesShadersStore[a];if(o[2])for(var u=o[3].split(","),c=0;c<u.length;c+=2)var d=new RegExp(u[c],"g"),f=u[c+1],l=l.replace(d,f);if(o[4]){var p=o[5];if(-1!==p.indexOf("..")){var _=p.split(".."),g=parseInt(_[0]),m=parseInt(_[1]),v=l.slice(0);l="",isNaN(m)&&(m=t.indexParameters[_[1]]);for(var y=g;y<m;y++)t.supportsUniformBuffers||(v=v.replace(/light\{X\}.(\w*)/g,function(e,t){return t+"{X}"})),l+=v.replace(/\{X\}/g,y.toString())+"\n"}else t.supportsUniformBuffers||(l=l.replace(/light\{X\}.(\w*)/g,function(e,t){return t+"{X}"})),l=l.replace(/\{X\}/g,p)}s=s.replace(o[0],l),o=n.exec(e)}i(s)},ot._FileToolsLoadFile=function(e,t,i,r,n,o){throw S.WarnImport("FileTools")},ot);function ot(){}var st=(Object.defineProperty(at.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new le),this._onBindObservable},enumerable:!0,configurable:!0}),at.prototype._useFinalCode=function(e,t,i){var r,n;i?(r=i.vertexElement||i.vertex||i.spectorName||i,n=i.fragmentElement||i.fragment||i.spectorName||i,this._vertexSourceCode="#define SHADER_NAME vertex:"+r+"\n"+e,this._fragmentSourceCode="#define SHADER_NAME fragment:"+n+"\n"+t):(this._vertexSourceCode=e,this._fragmentSourceCode=t),this._prepareEffect()},Object.defineProperty(at.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),at.prototype.isReady=function(){try{return this._isReadyInternal()}catch(e){return!1}},at.prototype._isReadyInternal=function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady},at.prototype.getEngine=function(){return this._engine},at.prototype.getPipelineContext=function(){return this._pipelineContext},at.prototype.getAttributesNames=function(){return this._attributesNames},at.prototype.getAttributeLocation=function(e){return this._attributes[e]},at.prototype.getAttributeLocationByName=function(e){return this._attributeLocationByName[e]},at.prototype.getAttributesCount=function(){return this._attributes.length},at.prototype.getUniformIndex=function(e){return this._uniformsNames.indexOf(e)},at.prototype.getUniform=function(e){return this._uniforms[e]},at.prototype.getSamplers=function(){return this._samplerList},at.prototype.getCompilationError=function(){return this._compilationError},at.prototype.allFallbacksProcessed=function(){return this._allFallbacksProcessed},at.prototype.executeWhenCompiled=function(t){var e=this;this.isReady()?t(this):(this.onCompileObservable.add(function(e){t(e)}),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout(function(){e._checkIsReady(null)},16))},at.prototype._checkIsReady=function(t){var e=this;try{if(this._isReadyInternal())return}catch(e){return void this._processCompilationErrors(e,t)}setTimeout(function(){e._checkIsReady(t)},16)},at.prototype._loadShader=function(e,t,i,r){var n;"undefined"!=typeof HTMLElement&&e instanceof HTMLElement?r(ce.GetDOMTextContent(e)):"source:"!==e.substr(0,7)?"base64:"!==e.substr(0,7)?at.ShadersStore[e+t+"Shader"]?r(at.ShadersStore[e+t+"Shader"]):i&&at.ShadersStore[e+i+"Shader"]?r(at.ShadersStore[e+i+"Shader"]):(n="."===e[0]||"/"===e[0]||-1<e.indexOf("http")?e:at.ShadersRepository+e,this._engine._loadFile(n+"."+t.toLowerCase()+".fx",r)):r(window.atob(e.substr(7))):r(e.substr(7))},at.prototype._rebuildProgram=function(e,t,i,r){var n=this;this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=function(e,t){r&&r(t)},this.onCompiled=function(){var e=n.getEngine().scenes;if(e)for(var t=0;t<e.length;t++)e[t].markAllMaterialsAsDirty(31);n._pipelineContext._handlesSpectorRebuildCallback(i)},this._fallbacks=null,this._prepareEffect()},at.prototype._prepareEffect=function(){var n=this,o=this._attributesNames,e=this.defines;this._valueCache={};var s=this._pipelineContext;try{var a=this._engine;this._pipelineContext=a.createPipelineContext();var t=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?a._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,t,null,this._transformFeedbackVaryings):a._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,t,e,this._transformFeedbackVaryings),a._executeWhenRenderingStateIsCompiled(this._pipelineContext,function(){if(a.supportsUniformBuffers)for(var e in n._uniformBuffersNames)n.bindUniformBlock(e,n._uniformBuffersNames[e]);var t;if(a.getUniforms(n._pipelineContext,n._uniformsNames).forEach(function(e,t){n._uniforms[n._uniformsNames[t]]=e}),n._attributes=a.getAttributes(n._pipelineContext,o),o)for(var i=0;i<o.length;i++){var r=o[i];n._attributeLocationByName[r]=n._attributes[i]}for(t=0;t<n._samplerList.length;t++)null==n.getUniform(n._samplerList[t])&&(n._samplerList.splice(t,1),t--);n._samplerList.forEach(function(e,t){n._samplers[e]=t}),a.bindSamplers(n),n._compilationError="",n._isReady=!0,n.onCompiled&&n.onCompiled(n),n.onCompileObservable.notifyObservers(n),n.onCompileObservable.clear(),n._fallbacks&&n._fallbacks.unBindMesh(),s&&n.getEngine()._deletePipelineContext(s)}),this._pipelineContext.isAsync&&this._checkIsReady(s)}catch(e){this._processCompilationErrors(e,s)}},at.prototype._processCompilationErrors=function(e,t){void 0===t&&(t=null),this._compilationError=e.message;var i=this._attributesNames,r=this._fallbacks;fe.Error("Unable to compile effect:"),fe.Error("Uniforms: "+this._uniformsNames.map(function(e){return" "+e})),fe.Error("Attributes: "+i.map(function(e){return" "+e})),fe.Error("Defines:\r\n"+this.defines),fe.Error("Error: "+this._compilationError),t&&(this._pipelineContext=t,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),r?(this._pipelineContext=null,r.hasMoreFallbacks?(this._allFallbacksProcessed=!1,fe.Error("Trying next fallback."),this.defines=r.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):this._allFallbacksProcessed=!0},Object.defineProperty(at.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!0,configurable:!0}),at.prototype._bindTexture=function(e,t){this._engine._bindTexture(this._samplers[e],t)},at.prototype.setTexture=function(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t)},at.prototype.setDepthStencilTexture=function(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t)},at.prototype.setTextureArray=function(e,t){var i=e+"Ex";if(-1===this._samplerList.indexOf(i+"0")){for(var r=this._samplerList.indexOf(e),n=1;n<t.length;n++){var o=i+(n-1).toString();this._samplerList.splice(r+n,0,o)}for(var s=0,a=0,h=this._samplerList;a<h.length;a++){var l=h[a];this._samplers[l]=s,s+=1}}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t)},at.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers[e],t)},at.prototype.setTextureFromPostProcessOutput=function(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers[e],t)},at.prototype._cacheMatrix=function(e,t){var i=this._valueCache[e],r=t.updateFlag;return(void 0===i||i!==r)&&(this._valueCache[e]=r,!0)},at.prototype._cacheFloat2=function(e,t,i){var r=this._valueCache[e];if(!r||2!==r.length)return r=[t,i],this._valueCache[e]=r,!0;var n=!1;return r[0]!==t&&(r[0]=t,n=!0),r[1]!==i&&(r[1]=i,n=!0),n},at.prototype._cacheFloat3=function(e,t,i,r){var n=this._valueCache[e];if(!n||3!==n.length)return n=[t,i,r],this._valueCache[e]=n,!0;var o=!1;return n[0]!==t&&(n[0]=t,o=!0),n[1]!==i&&(n[1]=i,o=!0),n[2]!==r&&(n[2]=r,o=!0),o},at.prototype._cacheFloat4=function(e,t,i,r,n){var o=this._valueCache[e];if(!o||4!==o.length)return o=[t,i,r,n],this._valueCache[e]=o,!0;var s=!1;return o[0]!==t&&(o[0]=t,s=!0),o[1]!==i&&(o[1]=i,s=!0),o[2]!==r&&(o[2]=r,s=!0),o[3]!==n&&(o[3]=n,s=!0),s},at.prototype.bindUniformBuffer=function(e,t){var i=this._uniformBuffersNames[t];void 0!==i&&at._baseCache[i]!==e&&(at._baseCache[i]=e,this._engine.bindUniformBufferBase(e,i))},at.prototype.bindUniformBlock=function(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)},at.prototype.setInt=function(e,t){var i=this._valueCache[e];return void 0!==i&&i===t||(this._valueCache[e]=t,this._engine.setInt(this._uniforms[e],t)),this},at.prototype.setIntArray=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray(this._uniforms[e],t),this},at.prototype.setIntArray2=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray2(this._uniforms[e],t),this},at.prototype.setIntArray3=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray3(this._uniforms[e],t),this},at.prototype.setIntArray4=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray4(this._uniforms[e],t),this},at.prototype.setFloatArray=function(e,t){return this._valueCache[e]=null,this._engine.setArray(this._uniforms[e],t),this},at.prototype.setFloatArray2=function(e,t){return this._valueCache[e]=null,this._engine.setArray2(this._uniforms[e],t),this},at.prototype.setFloatArray3=function(e,t){return this._valueCache[e]=null,this._engine.setArray3(this._uniforms[e],t),this},at.prototype.setFloatArray4=function(e,t){return this._valueCache[e]=null,this._engine.setArray4(this._uniforms[e],t),this},at.prototype.setArray=function(e,t){return this._valueCache[e]=null,this._engine.setArray(this._uniforms[e],t),this},at.prototype.setArray2=function(e,t){return this._valueCache[e]=null,this._engine.setArray2(this._uniforms[e],t),this},at.prototype.setArray3=function(e,t){return this._valueCache[e]=null,this._engine.setArray3(this._uniforms[e],t),this},at.prototype.setArray4=function(e,t){return this._valueCache[e]=null,this._engine.setArray4(this._uniforms[e],t),this},at.prototype.setMatrices=function(e,t){return t&&(this._valueCache[e]=null,this._engine.setMatrices(this._uniforms[e],t)),this},at.prototype.setMatrix=function(e,t){return this._cacheMatrix(e,t)&&this._engine.setMatrices(this._uniforms[e],t.toArray()),this},at.prototype.setMatrix3x3=function(e,t){return this._valueCache[e]=null,this._engine.setMatrix3x3(this._uniforms[e],t),this},at.prototype.setMatrix2x2=function(e,t){return this._valueCache[e]=null,this._engine.setMatrix2x2(this._uniforms[e],t),this},at.prototype.setFloat=function(e,t){var i=this._valueCache[e];return void 0!==i&&i===t||(this._valueCache[e]=t,this._engine.setFloat(this._uniforms[e],t)),this},at.prototype.setBool=function(e,t){var i=this._valueCache[e];return void 0!==i&&i===t||(this._valueCache[e]=t,this._engine.setInt(this._uniforms[e],t?1:0)),this},at.prototype.setVector2=function(e,t){return this._cacheFloat2(e,t.x,t.y)&&this._engine.setFloat2(this._uniforms[e],t.x,t.y),this},at.prototype.setFloat2=function(e,t,i){return this._cacheFloat2(e,t,i)&&this._engine.setFloat2(this._uniforms[e],t,i),this},at.prototype.setVector3=function(e,t){return this._cacheFloat3(e,t.x,t.y,t.z)&&this._engine.setFloat3(this._uniforms[e],t.x,t.y,t.z),this},at.prototype.setFloat3=function(e,t,i,r){return this._cacheFloat3(e,t,i,r)&&this._engine.setFloat3(this._uniforms[e],t,i,r),this},at.prototype.setVector4=function(e,t){return this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&this._engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w),this},at.prototype.setFloat4=function(e,t,i,r,n){return this._cacheFloat4(e,t,i,r,n)&&this._engine.setFloat4(this._uniforms[e],t,i,r,n),this},at.prototype.setColor3=function(e,t){return this._cacheFloat3(e,t.r,t.g,t.b)&&this._engine.setFloat3(this._uniforms[e],t.r,t.g,t.b),this},at.prototype.setColor4=function(e,t,i){return this._cacheFloat4(e,t.r,t.g,t.b,i)&&this._engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,i),this},at.prototype.setDirectColor4=function(e,t){return this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&this._engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,t.a),this},at.prototype.dispose=function(){this._engine._releaseEffect(this)},at.RegisterShader=function(e,t,i){t&&(at.ShadersStore[e+"PixelShader"]=t),i&&(at.ShadersStore[e+"VertexShader"]=i)},at.ResetCache=function(){at._baseCache={}},at.ShadersRepository="src/Shaders/",at._uniqueIdSeed=0,at._baseCache={},at.ShadersStore={},at.IncludesShadersStore={},at);function at(i,e,t,r,n,o,s,a,h,l){var u=this;if(void 0===r&&(r=null),void 0===o&&(o=null),void 0===s&&(s=null),void 0===a&&(a=null),void 0===h&&(h=null),this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new le,this.onErrorObservable=new le,this._onBindObservable=null,this._wasPreviouslyReady=!1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._valueCache={},this.name=i,e.attributes){var c=e;if(this._engine=t,this._attributesNames=c.attributes,this._uniformsNames=c.uniformsNames.concat(c.samplers),this._samplerList=c.samplers.slice(),this.defines=c.defines,this.onError=c.onError,this.onCompiled=c.onCompiled,this._fallbacks=c.fallbacks,this._indexParameters=c.indexParameters,this._transformFeedbackVaryings=c.transformFeedbackVaryings||null,c.uniformBuffersNames)for(var d=0;d<c.uniformBuffersNames.length;d++)this._uniformBuffersNames[c.uniformBuffersNames[d]]=d}else this._engine=n,this.defines=null==o?"":o,this._uniformsNames=t.concat(r),this._samplerList=r?r.slice():[],this._attributesNames=e,this.onError=h,this.onCompiled=a,this._indexParameters=l,this._fallbacks=s;this._attributeLocationByName={},this.uniqueId=at._uniqueIdSeed++;var f=ce.IsWindowObjectExist()?this._engine.getHostDocument():null,p=i.vertexSource?"source:"+i.vertexSource:i.vertexElement?(p=f?f.getElementById(i.vertexElement):null)||i.vertexElement:i.vertex||i,_=i.fragmentSource?"source:"+i.fragmentSource:i.fragmentElement?(_=f?f.getElementById(i.fragmentElement):null)||i.fragmentElement:i.fragment||i,g={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._shaderProcessor,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:at.ShadersRepository,includesShadersStore:at.IncludesShadersStore,version:(100*this._engine.webGLVersion).toString(),platformName:2<=this._engine.webGLVersion?"WEBGL2":"WEBGL1"};this._loadShader(p,"Vertex","",function(t){u._loadShader(_,"Fragment","Pixel",function(e){nt.Process(t,g,function(t){g.isFragment=!0,nt.Process(e,g,function(e){u._useFinalCode(t,e,i)})})})})}var ht=(Object.defineProperty(lt.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!0,configurable:!0}),Object.defineProperty(lt.prototype,"zOffset",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(lt.prototype,"cullFace",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(lt.prototype,"cull",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(lt.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(lt.prototype,"depthMask",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(lt.prototype,"depthTest",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(lt.prototype,"frontFace",{get:function(){return this._frontFace},set:function(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)},enumerable:!0,configurable:!0}),lt.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1},lt.prototype.apply=function(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,0)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},lt);function lt(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,this.reset()}var ut=(Object.defineProperty(ct.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!0,configurable:!0}),Object.defineProperty(ct.prototype,"stencilFunc",{get:function(){return this._stencilFunc},set:function(e){this._stencilFunc!==e&&(this._stencilFunc=e,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(ct.prototype,"stencilFuncRef",{get:function(){return this._stencilFuncRef},set:function(e){this._stencilFuncRef!==e&&(this._stencilFuncRef=e,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(ct.prototype,"stencilFuncMask",{get:function(){return this._stencilFuncMask},set:function(e){this._stencilFuncMask!==e&&(this._stencilFuncMask=e,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(ct.prototype,"stencilOpStencilFail",{get:function(){return this._stencilOpStencilFail},set:function(e){this._stencilOpStencilFail!==e&&(this._stencilOpStencilFail=e,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(ct.prototype,"stencilOpDepthFail",{get:function(){return this._stencilOpDepthFail},set:function(e){this._stencilOpDepthFail!==e&&(this._stencilOpDepthFail=e,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(ct.prototype,"stencilOpStencilDepthPass",{get:function(){return this._stencilOpStencilDepthPass},set:function(e){this._stencilOpStencilDepthPass!==e&&(this._stencilOpStencilDepthPass=e,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(ct.prototype,"stencilMask",{get:function(){return this._stencilMask},set:function(e){this._stencilMask!==e&&(this._stencilMask=e,this._isStencilMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(ct.prototype,"stencilTest",{get:function(){return this._stencilTest},set:function(e){this._stencilTest!==e&&(this._stencilTest=e,this._isStencilTestDirty=!0)},enumerable:!0,configurable:!0}),ct.prototype.reset=function(){this._stencilTest=!1,this._stencilMask=255,this._stencilFunc=ct.ALWAYS,this._stencilFuncRef=1,this._stencilFuncMask=255,this._stencilOpStencilFail=ct.KEEP,this._stencilOpDepthFail=ct.KEEP,this._stencilOpStencilDepthPass=ct.REPLACE,this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},ct.prototype.apply=function(e){this.isDirty&&(this._isStencilTestDirty&&(this.stencilTest?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.stencilMask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.stencilFunc,this.stencilFuncRef,this.stencilFuncMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.stencilOpStencilFail,this.stencilOpDepthFail,this.stencilOpStencilDepthPass),this._isStencilOpDirty=!1))},ct.ALWAYS=519,ct.KEEP=7680,ct.REPLACE=7681,ct);function ct(){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.reset()}var dt=(Object.defineProperty(ft.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(ft.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)},enumerable:!0,configurable:!0}),ft.prototype.setAlphaBlendConstants=function(e,t,i,r){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===i&&this._blendConstants[3]===r||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=i,this._blendConstants[3]=r,this._isBlendConstantsDirty=!0)},ft.prototype.setAlphaBlendFunctionParameters=function(e,t,i,r){this._blendFunctionParameters[0]===e&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===i&&this._blendFunctionParameters[3]===r||(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=i,this._blendFunctionParameters[3]=r,this._isBlendFunctionParametersDirty=!0)},ft.prototype.setAlphaEquationParameters=function(e,t){this._blendEquationParameters[0]===e&&this._blendEquationParameters[1]===t||(this._blendEquationParameters[0]=e,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)},ft.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},ft.prototype.apply=function(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},ft);function ft(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this.reset()}var pt,_t,gt=function(){};(_t=pt=pt||{})[_t.Unknown=0]="Unknown",_t[_t.Url=1]="Url",_t[_t.Temp=2]="Temp",_t[_t.Raw=3]="Raw",_t[_t.Dynamic=4]="Dynamic",_t[_t.RenderTarget=5]="RenderTarget",_t[_t.MultiRenderTarget=6]="MultiRenderTarget",_t[_t.Cube=7]="Cube",_t[_t.CubeRaw=8]="CubeRaw",_t[_t.CubePrefiltered=9]="CubePrefiltered",_t[_t.Raw3D=10]="Raw3D",_t[_t.Raw2DArray=11]="Raw2DArray",_t[_t.Depth=12]="Depth",_t[_t.CubeRawRGBD=13]="CubeRawRGBD";var mt=(vt.prototype.getEngine=function(){return this._engine},Object.defineProperty(vt.prototype,"source",{get:function(){return this._source},enumerable:!0,configurable:!0}),vt.prototype.incrementReferences=function(){this._references++},vt.prototype.updateSize=function(e,t,i){void 0===i&&(i=1),this.width=e,this.height=t,this.depth=i,this.baseWidth=e,this.baseHeight=t,this.baseDepth=i,this._size=e*t*i},vt.prototype._rebuild=function(){var t=this;switch(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedAnisotropicFilteringLevel=null,this.source){case pt.Temp:return;case pt.Url:return void(i=this._engine.createTexture(this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,function(){i._swapAndDie(t),t.isReady=!0},null,this._buffer,void 0,this.format));case pt.Raw:return(i=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case pt.Raw3D:return(i=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case pt.Raw2DArray:return(i=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case pt.Dynamic:return(i=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this),void this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);case pt.RenderTarget:var e,i,r=new gt;return r.generateDepthBuffer=this._generateDepthBuffer,r.generateMipMaps=this.generateMipMaps,r.generateStencilBuffer=this._generateStencilBuffer,r.samplingMode=this.samplingMode,r.type=this.type,(i=this.isCube?this._engine.createRenderTargetCubeTexture(this.width,r):(e={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0},this._engine.createRenderTargetTexture(e,r)))._swapAndDie(this),void(this.isReady=!0);case pt.Depth:var n={bilinearFiltering:2!==this.samplingMode,comparisonFunction:this._comparisonFunction,generateStencil:this._generateStencilBuffer,isCube:this.isCube},o={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};return(i=this._engine.createDepthStencilTexture(o,n))._swapAndDie(this),void(this.isReady=!0);case pt.Cube:return void(i=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,function(){i._swapAndDie(t),t.isReady=!0},null,this.format,this._extension));case pt.CubeRaw:return(i=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case pt.CubeRawRGBD:return i=this._engine.createRawCubeTexture(null,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),void vt._UpdateRGBDAsync(i,this._bufferViewArrayArray,this._sphericalPolynomial,this._lodGenerationScale,this._lodGenerationOffset).then(function(){i._swapAndDie(t),t.isReady=!0});case pt.CubePrefiltered:return void((i=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,function(e){e&&e._swapAndDie(t),t.isReady=!0},null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial)}},vt.prototype._swapAndDie=function(e){e._webGLTexture=this._webGLTexture,e._isRGBD=this._isRGBD,this._framebuffer&&(e._framebuffer=this._framebuffer),this._depthStencilBuffer&&(e._depthStencilBuffer=this._depthStencilBuffer),e._depthStencilTexture=this._depthStencilTexture,this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(e._irradianceTexture&&e._irradianceTexture.dispose(),e._irradianceTexture=this._irradianceTexture);var t=this._engine.getLoadedTexturesCache(),i=t.indexOf(this);-1!==i&&t.splice(i,1),-1===(i=t.indexOf(e))&&t.push(e)},vt.prototype.dispose=function(){this._webGLTexture&&(this._references--,0===this._references&&(this._engine._releaseTexture(this),this._webGLTexture=null))},vt._UpdateRGBDAsync=function(e,t,i,r,n){throw S.WarnImport("environmentTextureTools")},vt);function vt(e,t,i){void 0===i&&(i=!1),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.samplingMode=-1,this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new le,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=pt.Unknown,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._MSAARenderBuffer=null,this._attachments=null,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._isDisabled=!1,this._compression=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._comparisonFunction=0,this._sphericalPolynomial=null,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._webGLTexture=null,this._references=1,this._engine=e,this._source=t,i||(this._webGLTexture=e._createTexture())}var yt=(bt.prototype.attributeProcessor=function(e){return e.replace("attribute","in")},bt.prototype.varyingProcessor=function(e,t){return e.replace("varying",t?"in":"out")},bt.prototype.postProcessor=function(e,t,i){var r=-1!==e.search(/#extension.+GL_EXT_draw_buffers.+require/);if(e=(e=e.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),i)e=(e=(e=(e=(e=(e=(e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(r?"":"out vec4 glFragColor;\n")+"void main(");else if(-1!==t.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+e;return e},bt);function bt(){}var Tt=(Object.defineProperty(xt.prototype,"underlyingResource",{get:function(){return null},enumerable:!0,configurable:!0}),xt);function xt(){this.references=0,this.capacity=0,this.is32Bits=!1}var Et,At=(n(Mt,Et=Tt),Object.defineProperty(Mt.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),Mt);function Mt(e){var t=Et.call(this)||this;return t._buffer=e,t}var Ct=(Object.defineProperty(Pt.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!0,configurable:!0}),Object.defineProperty(Pt.prototype,"isReady",{get:function(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))},enumerable:!0,configurable:!0}),Pt.prototype._handlesSpectorRebuildCallback=function(e){e&&this.program&&e(this.program)},Pt);function Pt(){this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null}var Ot=(St.CreateCanvas=function(e,t){if("undefined"==typeof document)return new OffscreenCanvas(e,t);var i=document.createElement("canvas");return i.width=e,i.height=t,i},St);function St(){}var It=function(){},Rt=(Object.defineProperty(Dt,"NpmPackage",{get:function(){return"babylonjs@4.1.0"},enumerable:!0,configurable:!0}),Object.defineProperty(Dt,"Version",{get:function(){return"4.1.0"},enumerable:!0,configurable:!0}),Object.defineProperty(Dt.prototype,"description",{get:function(){var e="WebGL"+this.webGLVersion;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e},enumerable:!0,configurable:!0}),Object.defineProperty(Dt,"ShadersRepository",{get:function(){return st.ShadersRepository},set:function(e){st.ShadersRepository=e},enumerable:!0,configurable:!0}),Object.defineProperty(Dt.prototype,"supportsUniformBuffers",{get:function(){return 1<this.webGLVersion&&!this.disableUniformBuffers},enumerable:!0,configurable:!0}),Object.defineProperty(Dt.prototype,"_shouldUseHighPrecisionShader",{get:function(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)},enumerable:!0,configurable:!0}),Object.defineProperty(Dt.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!0,configurable:!0}),Object.defineProperty(Dt.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(e){this._doNotHandleContextLost=e},enumerable:!0,configurable:!0}),Object.defineProperty(Dt.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(Dt.prototype,"framebufferDimensionsObject",{set:function(e){this._framebufferDimensionsObject=e},enumerable:!0,configurable:!0}),Object.defineProperty(Dt.prototype,"texturesSupported",{get:function(){return this._texturesSupported},enumerable:!0,configurable:!0}),Object.defineProperty(Dt.prototype,"textureFormatInUse",{get:function(){return this._textureFormatInUse},enumerable:!0,configurable:!0}),Object.defineProperty(Dt.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!0,configurable:!0}),Object.defineProperty(Dt.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture},enumerable:!0,configurable:!0}),Object.defineProperty(Dt.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D},enumerable:!0,configurable:!0}),Object.defineProperty(Dt.prototype,"emptyTexture2DArray",{get:function(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray},enumerable:!0,configurable:!0}),Object.defineProperty(Dt.prototype,"emptyCubeTexture",{get:function(){var e,t;return this._emptyCubeTexture||(t=[e=new Uint8Array(4),e,e,e,e,e],this._emptyCubeTexture=this.createRawCubeTexture(t,1,5,0,!1,!1,1)),this._emptyCubeTexture},enumerable:!0,configurable:!0}),Dt.prototype._rebuildInternalTextures=function(){for(var e=0,t=this._internalTexturesCache.slice();e<t.length;e++)t[e]._rebuild()},Dt.prototype._rebuildEffects=function(){for(var e in this._compiledEffects)this._compiledEffects[e]._prepareEffect();st.ResetCache()},Dt.prototype.areAllEffectsReady=function(){for(var e in this._compiledEffects)if(!this._compiledEffects[e].isReady())return!1;return!0},Dt.prototype._rebuildBuffers=function(){for(var e=0,t=this._uniformBuffers;e<t.length;e++)t[e]._rebuild()},Dt.prototype._initGLContext=function(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:1<this._webGLVersion?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile"),standardDerivatives:1<this._webGLVersion||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:1<this._webGLVersion||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:1<this._webGLVersion||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:1<this._webGLVersion&&this._gl.getExtension("EXT_color_buffer_float"),textureFloat:!!(1<this._webGLVersion||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(1<this._webGLVersion||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(1<this._webGLVersion||this._gl.getExtension("EXT_shader_texture_lod")),blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1},this._glVersion=this._gl.getParameter(this._gl.VERSION);var e,t,i,r,n,o,s=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=s&&(this._glRenderer=this._gl.getParameter(s.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(s.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._gl.HALF_FLOAT_OES=36193,34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=0<this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(1<this._webGLVersion||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),1<this._webGLVersion&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),1<this._webGLVersion)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=this._gl.getParameter(this._gl.MAX_SAMPLES);else{var a=this._gl.getExtension("WEBGL_draw_buffers");if(null!==a){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=a.drawBuffersWEBGL.bind(a),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var h=0;h<16;h++)this._gl["COLOR_ATTACHMENT"+h+"_WEBGL"]=a["COLOR_ATTACHMENT"+h+"_WEBGL"]}}1<this._webGLVersion?this._caps.depthTextureExtension=!0:null!=(e=this._gl.getExtension("WEBGL_depth_texture"))&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=e.UNSIGNED_INT_24_8_WEBGL),this.disableVertexArrayObjects?this._caps.vertexArrayObject=!1:1<this._webGLVersion?this._caps.vertexArrayObject=!0:null!=(t=this._gl.getExtension("OES_vertex_array_object"))&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=t.createVertexArrayOES.bind(t),this._gl.bindVertexArray=t.bindVertexArrayOES.bind(t),this._gl.deleteVertexArray=t.deleteVertexArrayOES.bind(t)),1<this._webGLVersion?this._caps.instancedArrays=!0:null!=(i=this._gl.getExtension("ANGLE_instanced_arrays"))?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=i.drawArraysInstancedANGLE.bind(i),this._gl.drawElementsInstanced=i.drawElementsInstancedANGLE.bind(i),this._gl.vertexAttribDivisor=i.vertexAttribDivisorANGLE.bind(i)):this._caps.instancedArrays=!1,this._caps.astc&&this.texturesSupported.push("-astc.ktx"),this._caps.s3tc&&this.texturesSupported.push("-dxt.ktx"),this._caps.pvrtc&&this.texturesSupported.push("-pvrtc.ktx"),this._caps.etc2&&this.texturesSupported.push("-etc2.ktx"),this._caps.etc1&&this.texturesSupported.push("-etc1.ktx"),this._gl.getShaderPrecisionFormat&&(r=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),n=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT),r&&n&&(this._caps.highPrecisionShaderSupported=0!==r.precision&&0!==n.precision)),1<this._webGLVersion?this._caps.blendMinMax=!0:null!=(o=this._gl.getExtension("EXT_blend_minmax"))&&(this._caps.blendMinMax=!0,this._gl.MAX=o.MAX_EXT,this._gl.MIN=o.MIN_EXT),this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var l=0;l<this._maxSimultaneousTextures;l++)this._nextFreeTextureSlots.push(l)},Object.defineProperty(Dt.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!0,configurable:!0}),Dt.prototype.getClassName=function(){return"ThinEngine"},Object.defineProperty(Dt.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!0,configurable:!0}),Dt.prototype._prepareWorkingCanvas=function(){var e;this._workingCanvas||(this._workingCanvas=Ot.CreateCanvas(1,1),(e=this._workingCanvas.getContext("2d"))&&(this._workingContext=e))},Dt.prototype.resetTextureCache=function(){for(var e in this._boundTexturesCache)this._boundTexturesCache.hasOwnProperty(e)&&(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1},Dt.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},Dt.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},Dt.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},Dt.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},Dt.prototype.getCaps=function(){return this._caps},Dt.prototype.stopRenderLoop=function(e){var t;e?0<=(t=this._activeRenderLoops.indexOf(e))&&this._activeRenderLoops.splice(t,1):this._activeRenderLoops=[]},Dt.prototype._renderLoop=function(){if(!this._contextWasLost){var e=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e){this.beginFrame();for(var t=0;t<this._activeRenderLoops.length;t++)(0,this._activeRenderLoops[t])();this.endFrame()}}0<this._activeRenderLoops.length?this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},Dt.prototype.getRenderingCanvas=function(){return this._renderingCanvas},Dt.prototype.getHostWindow=function(){return ce.IsWindowObjectExist()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null},Dt.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth},Dt.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight},Dt.prototype._queueNewFrame=function(e,t){return Dt.QueueNewFrame(e,t)},Dt.prototype.runRenderLoop=function(e){-1===this._activeRenderLoops.indexOf(e)&&(this._activeRenderLoops.push(e),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._boundRenderFunction=this._renderLoop.bind(this),this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))},Dt.prototype.clear=function(e,t,i,r){void 0===r&&(r=!1),this.applyStates();var n=0;t&&e&&(this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),n|=this._gl.COLOR_BUFFER_BIT),i&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GREATER,this._gl.clearDepth(0)):this._gl.clearDepth(1),n|=this._gl.DEPTH_BUFFER_BIT),r&&(this._gl.clearStencil(0),n|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(n)},Dt.prototype._viewport=function(e,t,i,r){e===this._viewportCached.x&&t===this._viewportCached.y&&i===this._viewportCached.z&&r===this._viewportCached.w||(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=i,this._viewportCached.w=r,this._gl.viewport(e,t,i,r))},Dt.prototype.setViewport=function(e,t,i){var r=t||this.getRenderWidth(),n=i||this.getRenderHeight(),o=e.x||0,s=e.y||0;this._cachedViewport=e,this._viewport(o*r,s*n,r*e.width,n*e.height)},Dt.prototype.beginFrame=function(){},Dt.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer()},Dt.prototype.resize=function(){var e,t=ce.IsWindowObjectExist()?(e=this._renderingCanvas?this._renderingCanvas.clientWidth:window.innerWidth,this._renderingCanvas?this._renderingCanvas.clientHeight:window.innerHeight):(e=this._renderingCanvas?this._renderingCanvas.width:100,this._renderingCanvas?this._renderingCanvas.height:100);this.setSize(e/this._hardwareScalingLevel,t/this._hardwareScalingLevel)},Dt.prototype.setSize=function(e,t){this._renderingCanvas&&(e|=0,t|=0,this._renderingCanvas.width===e&&this._renderingCanvas.height===t||(this._renderingCanvas.width=e,this._renderingCanvas.height=t))},Dt.prototype.bindFramebuffer=function(e,t,i,r,n,o,s){void 0===t&&(t=0),void 0===o&&(o=0),void 0===s&&(s=0),this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._bindUnboundFramebuffer(e._MSAAFramebuffer?e._MSAAFramebuffer:e._framebuffer);var a=this._gl;e.is2DArray?a.framebufferTextureLayer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,e._webGLTexture,o,s):e.isCube&&a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+t,e._webGLTexture,o);var h,l=e._depthStencilTexture;l&&(h=l._generateStencilBuffer?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT,e.is2DArray?a.framebufferTextureLayer(a.FRAMEBUFFER,h,l._webGLTexture,o,s):e.isCube?a.framebufferTexture2D(a.FRAMEBUFFER,h,a.TEXTURE_CUBE_MAP_POSITIVE_X+t,l._webGLTexture,o):a.framebufferTexture2D(a.FRAMEBUFFER,h,a.TEXTURE_2D,l._webGLTexture,o)),this._cachedViewport&&!n?this.setViewport(this._cachedViewport,i,r):(i||(i=e.width,o&&(i/=Math.pow(2,o))),r||(r=e.height,o&&(r/=Math.pow(2,o))),this._viewport(0,0,i,r)),this.wipeCaches()},Dt.prototype._bindUnboundFramebuffer=function(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)},Dt.prototype.unBindFramebuffer=function(e,t,i){void 0===t&&(t=!1),this._currentRenderTarget=null;var r=this._gl;e._MSAAFramebuffer&&(r.bindFramebuffer(r.READ_FRAMEBUFFER,e._MSAAFramebuffer),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,e._framebuffer),r.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,r.COLOR_BUFFER_BIT,r.NEAREST)),!e.generateMipMaps||t||e.isCube||(this._bindTextureDirectly(r.TEXTURE_2D,e,!0),r.generateMipmap(r.TEXTURE_2D),this._bindTextureDirectly(r.TEXTURE_2D,null)),i&&(e._MSAAFramebuffer&&this._bindUnboundFramebuffer(e._framebuffer),i()),this._bindUnboundFramebuffer(null)},Dt.prototype.flushFramebuffer=function(){this._gl.flush()},Dt.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},Dt.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},Dt.prototype.createVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.STATIC_DRAW)},Dt.prototype._createVertexBuffer=function(e,t){var i=this._gl.createBuffer();if(!i)throw new Error("Unable to create vertex buffer");var r=new At(i);return this.bindArrayBuffer(r),e instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),r.references=1,r},Dt.prototype.createDynamicVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.DYNAMIC_DRAW)},Dt.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},Dt.prototype.createIndexBuffer=function(e,t){var i=this._gl.createBuffer(),r=new At(i);if(!i)throw new Error("Unable to create index buffer");this.bindIndexBuffer(r);var n=this._normalizeIndexData(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,n,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),r.references=1,r.is32Bits=4===n.BYTES_PER_ELEMENT,r},Dt.prototype._normalizeIndexData=function(e){if(e instanceof Uint16Array)return e;if(this._caps.uintIndices){if(e instanceof Uint32Array)return e;for(var t=0;t<e.length;t++)if(65535<=e[t])return new Uint32Array(e);return new Uint16Array(e)}return new Uint16Array(e)},Dt.prototype.bindArrayBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ARRAY_BUFFER)},Dt.prototype.bindUniformBlock=function(e,t,i){var r=e.program,n=this._gl.getUniformBlockIndex(r,t);this._gl.uniformBlockBinding(r,n,i)},Dt.prototype.bindIndexBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)},Dt.prototype.bindBuffer=function(e,t){!this._vaoRecordInProgress&&this._currentBoundBuffer[t]===e||(this._gl.bindBuffer(t,e?e.underlyingResource:null),this._currentBoundBuffer[t]=e)},Dt.prototype.updateArrayBuffer=function(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)},Dt.prototype._vertexAttribPointer=function(e,t,i,r,n,o,s){var a=this._currentBufferPointers[t],h=!1;a.active?(a.buffer!==e&&(a.buffer=e,h=!0),a.size!==i&&(a.size=i,h=!0),a.type!==r&&(a.type=r,h=!0),a.normalized!==n&&(a.normalized=n,h=!0),a.stride!==o&&(a.stride=o,h=!0),a.offset!==s&&(a.offset=s,h=!0)):(h=!0,a.active=!0,a.index=t,a.size=i,a.type=r,a.normalized=n,a.stride=o,a.offset=s,a.buffer=e),(h||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),this._gl.vertexAttribPointer(t,i,r,n,o,s))},Dt.prototype._bindIndexBufferWithCache=function(e){null!=e&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)},Dt.prototype._bindVertexBuffersAttributes=function(e,t){var i=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var r=0;r<i.length;r++){var n=t.getAttributeLocation(r);if(0<=n){var o=e[i[r]];if(!o)continue;this._gl.enableVertexAttribArray(n),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[n]=!0);var s=o.getBuffer();s&&(this._vertexAttribPointer(s,n,o.getSize(),o.type,o.normalized,o.byteStride,o.byteOffset),o.getIsInstanced()&&(this._gl.vertexAttribDivisor(n,o.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(n),this._currentInstanceBuffers.push(s))))}}},Dt.prototype.recordVertexArrayObject=function(e,t,i){var r=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(r),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,i),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),r},Dt.prototype.bindVertexArrayObject=function(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=t&&t.is32Bits,this._mustWipeVertexAttributes=!0)},Dt.prototype.bindBuffersDirectly=function(e,t,i,r,n){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==n){this._cachedVertexBuffers=e;var o=(this._cachedEffectForVertexBuffers=n).getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var s,a=0,h=0;h<o;h++)h<i.length&&(0<=(s=n.getAttributeLocation(h))&&(this._gl.enableVertexAttribArray(s),this._vertexAttribArraysEnabled[s]=!0,this._vertexAttribPointer(e,s,i[h],this._gl.FLOAT,!1,r,a)),a+=4*i[h])}this._bindIndexBufferWithCache(t)},Dt.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},Dt.prototype.bindBuffers=function(e,t,i){this._cachedVertexBuffers===e&&this._cachedEffectForVertexBuffers===i||(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i,this._bindVertexBuffersAttributes(e,i)),this._bindIndexBufferWithCache(t)},Dt.prototype.unbindInstanceAttributes=function(){for(var e,t=0,i=this._currentInstanceLocations.length;t<i;t++){var r=this._currentInstanceBuffers[t];e!=r&&r.references&&(e=r,this.bindArrayBuffer(r));var n=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(n,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},Dt.prototype.releaseVertexArrayObject=function(e){this._gl.deleteVertexArray(e)},Dt.prototype._releaseBuffer=function(e){return e.references--,0===e.references&&(this._deleteBuffer(e),!0)},Dt.prototype._deleteBuffer=function(e){this._gl.deleteBuffer(e.underlyingResource)},Dt.prototype.updateAndBindInstancesBuffer=function(e,t,i){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),void 0!==i[0].index)this.bindInstancesBuffer(e,i,!0);else for(var r=0;r<4;r++){var n=i[r];this._vertexAttribArraysEnabled[n]||(this._gl.enableVertexAttribArray(n),this._vertexAttribArraysEnabled[n]=!0),this._vertexAttribPointer(e,n,4,this._gl.FLOAT,!1,64,16*r),this._gl.vertexAttribDivisor(n,1),this._currentInstanceLocations.push(n),this._currentInstanceBuffers.push(e)}},Dt.prototype.bindInstancesBuffer=function(e,t,i){void 0===i&&(i=!0),this.bindArrayBuffer(e);var r=0;if(i)for(var n=0;n<t.length;n++)r+=4*(o=t[n]).attributeSize;for(var o,n=0;n<t.length;n++)void 0===(o=t[n]).index&&(o.index=this._currentEffect.getAttributeLocationByName(o.attributeName)),this._vertexAttribArraysEnabled[o.index]||(this._gl.enableVertexAttribArray(o.index),this._vertexAttribArraysEnabled[o.index]=!0),this._vertexAttribPointer(e,o.index,o.attributeSize,o.attributeType||this._gl.FLOAT,o.normalized||!1,r,o.offset),this._gl.vertexAttribDivisor(o.index,void 0===o.divisor?1:o.divisor),this._currentInstanceLocations.push(o.index),this._currentInstanceBuffers.push(e)},Dt.prototype.disableInstanceAttributeByName=function(e){var t;this._currentEffect&&(t=this._currentEffect.getAttributeLocationByName(e),this.disableInstanceAttribute(t))},Dt.prototype.disableInstanceAttribute=function(e){for(var t,i=!1;-1!==(t=this._currentInstanceLocations.indexOf(e));)this._currentInstanceLocations.splice(t,1),this._currentInstanceBuffers.splice(t,1),i=!0,this._currentInstanceLocations.indexOf(e);i&&(this._gl.vertexAttribDivisor(e,0),this.disableAttributeByIndex(e))},Dt.prototype.disableAttributeByIndex=function(e){this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1},Dt.prototype.draw=function(e,t,i,r){this.drawElementsType(e?0:1,t,i,r)},Dt.prototype.drawPointClouds=function(e,t,i){this.drawArraysType(2,e,t,i)},Dt.prototype.drawUnIndexed=function(e,t,i,r){this.drawArraysType(e?0:1,t,i,r)},Dt.prototype.drawElementsType=function(e,t,i,r){this.applyStates(),this._reportDrawCall();var n=this._drawMode(e),o=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,s=this._uintIndicesCurrentlySet?4:2;r?this._gl.drawElementsInstanced(n,i,o,t*s,r):this._gl.drawElements(n,i,o,t*s)},Dt.prototype.drawArraysType=function(e,t,i,r){this.applyStates(),this._reportDrawCall();var n=this._drawMode(e);r?this._gl.drawArraysInstanced(n,t,i,r):this._gl.drawArrays(n,t,i)},Dt.prototype._drawMode=function(e){switch(e){case 0:return this._gl.TRIANGLES;case 2:return this._gl.POINTS;case 1:return this._gl.LINES;case 3:return this._gl.POINTS;case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES}},Dt.prototype._reportDrawCall=function(){},Dt.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],this._deletePipelineContext(e.getPipelineContext()))},Dt.prototype._deletePipelineContext=function(e){var t=e;t&&t.program&&(t.program.__SPECTOR_rebuildProgram=null,this._gl.deleteProgram(t.program))},Dt.prototype.createEffect=function(e,t,i,r,n,o,s,a,h){var l=(e.vertexElement||e.vertex||e)+"+"+(e.fragmentElement||e.fragment||e)+"@"+(n||t.defines);if(this._compiledEffects[l]){var u=this._compiledEffects[l];return s&&u.isReady()&&s(u),u}var c=new st(e,t,i,r,this,n,o,s,a,h);return c._key=l,this._compiledEffects[l]=c},Dt._ConcatenateShader=function(e,t,i){return void 0===i&&(i=""),i+(t?t+"\n":"")+e},Dt.prototype._compileShader=function(e,t,i,r){return this._compileRawShader(Dt._ConcatenateShader(e,i,r),t)},Dt.prototype._compileRawShader=function(e,t){var i=this._gl,r=i.createShader("vertex"===t?i.VERTEX_SHADER:i.FRAGMENT_SHADER);if(!r)throw new Error("Something went wrong while compile the shader.");return i.shaderSource(r,e),i.compileShader(r),r},Dt.prototype.createRawShaderProgram=function(e,t,i,r,n){void 0===n&&(n=null),r=r||this._gl;var o=this._compileRawShader(t,"vertex"),s=this._compileRawShader(i,"fragment");return this._createShaderProgram(e,o,s,r,n)},Dt.prototype.createShaderProgram=function(e,t,i,r,n,o){void 0===o&&(o=null),n=n||this._gl;var s=1<this._webGLVersion?"#version 300 es\n#define WEBGL2 \n":"",a=this._compileShader(t,"vertex",r,s),h=this._compileShader(i,"fragment",r,s);return this._createShaderProgram(e,a,h,n,o)},Dt.prototype.createPipelineContext=function(){var e=new Ct;return(e.engine=this)._caps.parallelShaderCompile&&(e.isParallelCompiled=!0),e},Dt.prototype._createShaderProgram=function(e,t,i,r,n){void 0===n&&(n=null);var o=r.createProgram();if(!(e.program=o))throw new Error("Unable to create program");return r.attachShader(o,t),r.attachShader(o,i),r.linkProgram(o),e.context=r,e.vertexShader=t,e.fragmentShader=i,e.isParallelCompiled||this._finalizePipelineContext(e),o},Dt.prototype._finalizePipelineContext=function(e){var t,i,r=e.context,n=e.vertexShader,o=e.fragmentShader,s=e.program;if(!r.getProgramParameter(s,r.LINK_STATUS)){if(!this._gl.getShaderParameter(n,this._gl.COMPILE_STATUS)&&(t=this._gl.getShaderInfoLog(n)))throw e.vertexCompilationError=t,new Error("VERTEX SHADER "+t);if(!this._gl.getShaderParameter(o,this._gl.COMPILE_STATUS)&&(t=this._gl.getShaderInfoLog(o)))throw e.fragmentCompilationError=t,new Error("FRAGMENT SHADER "+t);if(i=r.getProgramInfoLog(s))throw e.programLinkError=i,new Error(i)}if(this.validateShaderPrograms&&(r.validateProgram(s),!r.getProgramParameter(s,r.VALIDATE_STATUS)&&(i=r.getProgramInfoLog(s))))throw e.programValidationError=i,new Error(i);r.deleteShader(n),r.deleteShader(o),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)},Dt.prototype._preparePipelineContext=function(e,t,i,r,n,o,s){var a=e;a.program=r?this.createRawShaderProgram(a,t,i,void 0,s):this.createShaderProgram(a,t,i,o,void 0,s),a.program.__SPECTOR_rebuildProgram=n},Dt.prototype._isRenderingStateCompiled=function(e){var t=e;return!!this._gl.getProgramParameter(t.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(t),!0)},Dt.prototype._executeWhenRenderingStateIsCompiled=function(e,t){var i,r=e;r.isParallelCompiled?(i=r.onCompiled,r.onCompiled=i?function(){i(),t()}:t):t()},Dt.prototype.getUniforms=function(e,t){for(var i=new Array,r=e,n=0;n<t.length;n++)i.push(this._gl.getUniformLocation(r.program,t[n]));return i},Dt.prototype.getAttributes=function(e,t){for(var i=[],r=e,n=0;n<t.length;n++)try{i.push(this._gl.getAttribLocation(r.program,t[n]))}catch(e){i.push(-1)}return i},Dt.prototype.enableEffect=function(e){e&&e!==this._currentEffect&&(this.bindSamplers(e),(this._currentEffect=e).onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))},Dt.prototype.setInt=function(e,t){e&&this._gl.uniform1i(e,t)},Dt.prototype.setIntArray=function(e,t){e&&this._gl.uniform1iv(e,t)},Dt.prototype.setIntArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2iv(e,t)},Dt.prototype.setIntArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3iv(e,t)},Dt.prototype.setIntArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4iv(e,t)},Dt.prototype.setArray=function(e,t){e&&this._gl.uniform1fv(e,t)},Dt.prototype.setArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2fv(e,t)},Dt.prototype.setArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3fv(e,t)},Dt.prototype.setArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4fv(e,t)},Dt.prototype.setMatrices=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t)},Dt.prototype.setMatrix3x3=function(e,t){e&&this._gl.uniformMatrix3fv(e,!1,t)},Dt.prototype.setMatrix2x2=function(e,t){e&&this._gl.uniformMatrix2fv(e,!1,t)},Dt.prototype.setFloat=function(e,t){e&&this._gl.uniform1f(e,t)},Dt.prototype.setFloat2=function(e,t,i){e&&this._gl.uniform2f(e,t,i)},Dt.prototype.setFloat3=function(e,t,i,r){e&&this._gl.uniform3f(e,t,i,r)},Dt.prototype.setFloat4=function(e,t,i,r,n){e&&this._gl.uniform4f(e,t,i,r,n)},Dt.prototype.applyStates=function(){var e;this._depthCullingState.apply(this._gl),this._stencilState.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged&&(this._colorWriteChanged=!1,e=this._colorWrite,this._gl.colorMask(e,e,e,e))},Dt.prototype.setColorWrite=function(e){e!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=e)},Dt.prototype.getColorWrite=function(){return this._colorWrite},Object.defineProperty(Dt.prototype,"depthCullingState",{get:function(){return this._depthCullingState},enumerable:!0,configurable:!0}),Object.defineProperty(Dt.prototype,"alphaState",{get:function(){return this._alphaState},enumerable:!0,configurable:!0}),Object.defineProperty(Dt.prototype,"stencilState",{get:function(){return this._stencilState},enumerable:!0,configurable:!0}),Dt.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},Dt.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),e&&(this._currentProgram=null,this.resetTextureCache(),this._stencilState.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))},Dt.prototype._getSamplingParameters=function(e,t){var i=this._gl,r=i.NEAREST,n=i.NEAREST;switch(e){case 11:r=i.LINEAR,n=t?i.LINEAR_MIPMAP_NEAREST:i.LINEAR;break;case 3:r=i.LINEAR,n=t?i.LINEAR_MIPMAP_LINEAR:i.LINEAR;break;case 8:r=i.NEAREST,n=t?i.NEAREST_MIPMAP_LINEAR:i.NEAREST;break;case 4:r=i.NEAREST,n=t?i.NEAREST_MIPMAP_NEAREST:i.NEAREST;break;case 5:r=i.NEAREST,n=t?i.LINEAR_MIPMAP_NEAREST:i.LINEAR;break;case 6:r=i.NEAREST,n=t?i.LINEAR_MIPMAP_LINEAR:i.LINEAR;break;case 7:r=i.NEAREST,n=i.LINEAR;break;case 1:r=i.NEAREST,n=i.NEAREST;break;case 9:r=i.LINEAR,n=t?i.NEAREST_MIPMAP_NEAREST:i.NEAREST;break;case 10:r=i.LINEAR,n=t?i.NEAREST_MIPMAP_LINEAR:i.NEAREST;break;case 2:r=i.LINEAR,n=i.LINEAR;break;case 12:r=i.LINEAR,n=i.NEAREST}return{min:n,mag:r}},Dt.prototype._createTexture=function(){var e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e},Dt.prototype.createTexture=function(e,i,t,l,s,r,n,o,a,u,h,c){var d=this;void 0===s&&(s=3),void 0===r&&(r=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===u&&(u=null),void 0===h&&(h=null);for(var f=String(e),p="data:"===f.substr(0,5),_="blob:"===f.substr(0,5),g=p&&-1!==f.indexOf(";base64,"),m=a||new mt(this,pt.Url),v=f.lastIndexOf("."),y=h||(-1<v?f.substring(v).toLowerCase():""),b=null,T=0,x=Dt._TextureLoaders;T<x.length;T++){var E=x[T];if(E.canLoad(y)){b=E;break}}l&&l._addPendingData(m),m.url=f,m.generateMipMaps=!i,m.samplingMode=s,m.invertY=t,this._doNotHandleContextLost||(m._buffer=o);var A,M,C=null;function P(e,t){l&&l._removePendingData(m),C&&m.onLoadedObservable.remove(C),Ae.UseFallbackTexture?d.createTexture(Ae.FallbackTexture,i,m.invertY,l,s,null,n,o,m):n&&n(e||"Unknown error",t)}return r&&!a&&(C=m.onLoadedObservable.add(r)),a||this._internalTexturesCache.push(m),b?(A=function(e){b.loadData(e,m,function(e,t,i,r,n,o){o?P("TextureLoader failed to load data"):d._prepareWebGLTexture(m,l,e,t,m.invertY,!i,r,function(){return n(),!1},s)})},o?o instanceof ArrayBuffer?A(new Uint8Array(o)):ArrayBuffer.isView(o)?A(o):n&&n("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(f,function(e){return A(new Uint8Array(e))},void 0,l?l.offlineProvider:void 0,!0,function(e,t){P("Unable to load "+(e&&e.responseURL,t))})):(M=function(h){_&&!d._doNotHandleContextLost&&(m._buffer=h),d._prepareWebGLTexture(m,l,h.width,h.height,m.invertY,i,!1,function(e,t,i){var r=d._gl,n=h.width===e&&h.height===t,o=u?d._getInternalFormat(u):".jpg"===y?r.RGB:r.RGBA;if(n)return r.texImage2D(r.TEXTURE_2D,0,o,o,r.UNSIGNED_BYTE,h),!1;var s=d._caps.maxTextureSize;if(h.width>s||h.height>s||!d._supportsHardwareTextureRescaling)return d._prepareWorkingCanvas(),d._workingCanvas&&d._workingContext&&(d._workingCanvas.width=e,d._workingCanvas.height=t,d._workingContext.drawImage(h,0,0,h.width,h.height,0,0,e,t),r.texImage2D(r.TEXTURE_2D,0,o,o,r.UNSIGNED_BYTE,d._workingCanvas),m.width=e,m.height=t),!1;var a=new mt(d,pt.Temp);return d._bindTextureDirectly(r.TEXTURE_2D,a,!0),r.texImage2D(r.TEXTURE_2D,0,o,o,r.UNSIGNED_BYTE,h),d._rescaleTexture(a,m,l,o,function(){d._releaseTexture(a),d._bindTextureDirectly(r.TEXTURE_2D,m,!0),i()}),!0},s)},!p||g?o&&(o.decoding||o.close)?M(o):Dt._FileToolsLoadImage(f,M,P,l?l.offlineProvider:null,c):"string"==typeof o||o instanceof ArrayBuffer||ArrayBuffer.isView(o)||o instanceof Blob?Dt._FileToolsLoadImage(o,M,P,l?l.offlineProvider:null,c):o&&M(o)),m},Dt._FileToolsLoadImage=function(e,t,i,r,n){throw S.WarnImport("FileTools")},Dt.prototype._rescaleTexture=function(e,t,i,r,n){},Dt.prototype.createRawTexture=function(e,t,i,r,n,o,s,a,h){throw void 0===a&&(a=null),void 0===h&&(h=0),S.WarnImport("Engine.RawTexture")},Dt.prototype.createRawCubeTexture=function(e,t,i,r,n,o,s,a){throw void 0===a&&(a=null),S.WarnImport("Engine.RawTexture")},Dt.prototype.createRawTexture3D=function(e,t,i,r,n,o,s,a,h,l){throw void 0===h&&(h=null),void 0===l&&(l=0),S.WarnImport("Engine.RawTexture")},Dt.prototype.createRawTexture2DArray=function(e,t,i,r,n,o,s,a,h,l){throw void 0===h&&(h=null),void 0===l&&(l=0),S.WarnImport("Engine.RawTexture")},Dt.prototype._unpackFlipY=function(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))},Dt.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},Dt.prototype._getTextureTarget=function(e){return e.isCube?this._gl.TEXTURE_CUBE_MAP:e.is3D?this._gl.TEXTURE_3D:e.is2DArray||e.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D},Dt.prototype.updateTextureSamplingMode=function(e,t,i){void 0===i&&(i=!1);var r=this._getTextureTarget(t),n=this._getSamplingParameters(e,t.generateMipMaps||i);this._setTextureParameterInteger(r,this._gl.TEXTURE_MAG_FILTER,n.mag,t),this._setTextureParameterInteger(r,this._gl.TEXTURE_MIN_FILTER,n.min),i&&(t.generateMipMaps=!0,this._gl.generateMipmap(r)),this._bindTextureDirectly(r,null),t.samplingMode=e},Dt.prototype.updateTextureWrappingMode=function(e,t,i,r){void 0===i&&(i=null),void 0===r&&(r=null);var n=this._getTextureTarget(e);null!==t&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t),e),e._cachedWrapU=t),null!==i&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(i),e),e._cachedWrapV=i),(e.is2DArray||e.is3D)&&null!==r&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(r),e),e._cachedWrapR=r),this._bindTextureDirectly(n,null)},Dt.prototype._setupDepthStencilTexture=function(e,t,i,r,n){var o=t.width||t,s=t.height||t,a=t.layers||0;e.baseWidth=o,e.baseHeight=s,e.width=o,e.height=s,e.is2DArray=0<a,e.depth=a,e.isReady=!0,e.samples=1,e.generateMipMaps=!1,e._generateDepthBuffer=!0,e._generateStencilBuffer=i,e.samplingMode=r?2:1,e.type=0,e._comparisonFunction=n;var h=this._gl,l=this._getTextureTarget(e),u=this._getSamplingParameters(e.samplingMode,!1);h.texParameteri(l,h.TEXTURE_MAG_FILTER,u.mag),h.texParameteri(l,h.TEXTURE_MIN_FILTER,u.min),h.texParameteri(l,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(l,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),0===n?(h.texParameteri(l,h.TEXTURE_COMPARE_FUNC,515),h.texParameteri(l,h.TEXTURE_COMPARE_MODE,h.NONE)):(h.texParameteri(l,h.TEXTURE_COMPARE_FUNC,n),h.texParameteri(l,h.TEXTURE_COMPARE_MODE,h.COMPARE_REF_TO_TEXTURE))},Dt.prototype._uploadCompressedDataToTextureDirectly=function(e,t,i,r,n,o,s){void 0===o&&(o=0),void 0===s&&(s=0);var a=this._gl,h=a.TEXTURE_2D;e.isCube&&(h=a.TEXTURE_CUBE_MAP_POSITIVE_X+o),this._gl.compressedTexImage2D(h,s,t,i,r,0,n)},Dt.prototype._uploadDataToTextureDirectly=function(e,t,i,r,n,o){void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=!1);var s=this._gl,a=this._getWebGLTextureType(e.type),h=this._getInternalFormat(e.format),l=void 0===n?this._getRGBABufferInternalSizedFormat(e.type,e.format):this._getInternalFormat(n);this._unpackFlipY(e.invertY);var u=s.TEXTURE_2D;e.isCube&&(u=s.TEXTURE_CUBE_MAP_POSITIVE_X+i);var c=Math.round(Math.log(e.width)*Math.LOG2E),d=Math.round(Math.log(e.height)*Math.LOG2E),f=o?e.width:Math.pow(2,Math.max(c-r,0)),p=o?e.height:Math.pow(2,Math.max(d-r,0));s.texImage2D(u,r,l,f,p,0,h,a,t)},Dt.prototype.updateTextureData=function(e,t,i,r,n,o,s,a){void 0===s&&(s=0),void 0===a&&(a=0);var h=this._gl,l=this._getWebGLTextureType(e.type),u=this._getInternalFormat(e.format);this._unpackFlipY(e.invertY);var c=h.TEXTURE_2D;e.isCube&&(c=h.TEXTURE_CUBE_MAP_POSITIVE_X+s),h.texSubImage2D(c,a,i,r,n,o,u,l,t)},Dt.prototype._uploadArrayBufferViewToTexture=function(e,t,i,r){void 0===i&&(i=0),void 0===r&&(r=0);var n=this._gl,o=e.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D;this._bindTextureDirectly(o,e,!0),this._uploadDataToTextureDirectly(e,t,i,r),this._bindTextureDirectly(o,null,!0)},Dt.prototype._prepareWebGLTextureContinuation=function(e,t,i,r,n){var o,s=this._gl;s&&(o=this._getSamplingParameters(n,!i),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,o.mag),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,o.min),i||r||s.generateMipmap(s.TEXTURE_2D),this._bindTextureDirectly(s.TEXTURE_2D,null),t&&t._removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear())},Dt.prototype._prepareWebGLTexture=function(e,t,i,r,n,o,s,a,h){var l=this;void 0===h&&(h=3);var u=this.getCaps().maxTextureSize,c=Math.min(u,this.needPOTTextures?Dt.GetExponentOfTwo(i,u):i),d=Math.min(u,this.needPOTTextures?Dt.GetExponentOfTwo(r,u):r),f=this._gl;f&&(e._webGLTexture?(this._bindTextureDirectly(f.TEXTURE_2D,e,!0),this._unpackFlipY(void 0===n||!!n),e.baseWidth=i,e.baseHeight=r,e.width=c,e.height=d,e.isReady=!0,a(c,d,function(){l._prepareWebGLTextureContinuation(e,t,o,s,h)})||this._prepareWebGLTextureContinuation(e,t,o,s,h)):t&&t._removePendingData(e))},Dt.prototype._setupFramebufferDepthAttachments=function(e,t,i,r,n){void 0===n&&(n=1);var o=this._gl;if(e&&t)return this._getDepthStencilBuffer(i,r,n,o.DEPTH_STENCIL,o.DEPTH24_STENCIL8,o.DEPTH_STENCIL_ATTACHMENT);if(t){var s=o.DEPTH_COMPONENT16;return 1<this._webGLVersion&&(s=o.DEPTH_COMPONENT32F),this._getDepthStencilBuffer(i,r,n,s,s,o.DEPTH_ATTACHMENT)}return e?this._getDepthStencilBuffer(i,r,n,o.STENCIL_INDEX8,o.STENCIL_INDEX8,o.STENCIL_ATTACHMENT):null},Dt.prototype._releaseFramebufferObjects=function(e){var t=this._gl;e._framebuffer&&(t.deleteFramebuffer(e._framebuffer),e._framebuffer=null),e._depthStencilBuffer&&(t.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(t.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null),e._MSAARenderBuffer&&(t.deleteRenderbuffer(e._MSAARenderBuffer),e._MSAARenderBuffer=null)},Dt.prototype._releaseTexture=function(e){this._releaseFramebufferObjects(e),this._deleteTexture(e._webGLTexture),this.unbindAllTextures();var t=this._internalTexturesCache.indexOf(e);-1!==t&&this._internalTexturesCache.splice(t,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),e._irradianceTexture&&e._irradianceTexture.dispose()},Dt.prototype._deleteTexture=function(e){this._gl.deleteTexture(e)},Dt.prototype._setProgram=function(e){this._currentProgram!==e&&(this._gl.useProgram(e),this._currentProgram=e)},Dt.prototype.bindSamplers=function(e){var t=e.getPipelineContext();this._setProgram(t.program);for(var i=e.getSamplers(),r=0;r<i.length;r++){var n=e.getUniform(i[r]);n&&(this._boundUniforms[r]=n)}this._currentEffect=null},Dt.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},Dt.prototype._bindTextureDirectly=function(e,t,i,r){void 0===i&&(i=!1),void 0===r&&(r=!1);var n=!1,o=t&&-1<t._associatedChannel;return i&&o&&(this._activeChannel=t._associatedChannel),this._boundTexturesCache[this._activeChannel]!==t||r?(this._activateCurrentTexture(),t&&t.isMultiview?this._gl.bindTexture(e,t?t._colorTextureArray:null):this._gl.bindTexture(e,t?t._webGLTexture:null),(this._boundTexturesCache[this._activeChannel]=t)&&(t._associatedChannel=this._activeChannel)):i&&(n=!0,this._activateCurrentTexture()),o&&!i&&this._bindSamplerUniformToChannel(t._associatedChannel,this._activeChannel),n},Dt.prototype._bindTexture=function(e,t){void 0!==e&&(t&&(t._associatedChannel=e),this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,t))},Dt.prototype.unbindAllTextures=function(){for(var e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),1<this.webGLVersion&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))},Dt.prototype.setTexture=function(e,t,i){void 0!==e&&(t&&(this._boundUniforms[e]=t),this._setTexture(e,i))},Dt.prototype._bindSamplerUniformToChannel=function(e,t){var i=this._boundUniforms[e];i&&i._currentState!==t&&(this._gl.uniform1i(i,t),i._currentState=t)},Dt.prototype._getTextureWrapMode=function(e){switch(e){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},Dt.prototype._setTexture=function(e,t,i,r){if(void 0===i&&(i=!1),void 0===r&&(r=!1),!t)return null!=this._boundTexturesCache[e]&&(this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),1<this.webGLVersion&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(t.video)this._activeChannel=e,t.update();else if(4===t.delayLoadState)return t.delayLoad(),!1;var n=r?t.depthStencilTexture:t.isReady()?t.getInternalTexture():t.isCube?this.emptyCubeTexture:t.is3D?this.emptyTexture3D:t.is2DArray?this.emptyTexture2DArray:this.emptyTexture;!i&&n&&(n._associatedChannel=e);var o=!0;this._boundTexturesCache[e]===n&&(i||this._bindSamplerUniformToChannel(n._associatedChannel,e),o=!1),this._activeChannel=e;var s,a=this._getTextureTarget(n);return o&&this._bindTextureDirectly(a,n,i),n&&!n.isMultiview&&(n.isCube&&n._cachedCoordinatesMode!==t.coordinatesMode&&(n._cachedCoordinatesMode=t.coordinatesMode,s=3!==t.coordinatesMode&&5!==t.coordinatesMode?1:0,t.wrapU=s,t.wrapV=s),n._cachedWrapU!==t.wrapU&&(n._cachedWrapU=t.wrapU,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),n)),n._cachedWrapV!==t.wrapV&&(n._cachedWrapV=t.wrapV,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),n)),n.is3D&&n._cachedWrapR!==t.wrapR&&(n._cachedWrapR=t.wrapR,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t.wrapR),n)),this._setAnisotropicLevel(a,n,t.anisotropicFilteringLevel)),!0},Dt.prototype.setTextureArray=function(e,t,i){if(void 0!==e&&t){this._textureUnits&&this._textureUnits.length===i.length||(this._textureUnits=new Int32Array(i.length));for(var r=0;r<i.length;r++){var n=i[r].getInternalTexture();n?(this._textureUnits[r]=e+r,n._associatedChannel=e+r):this._textureUnits[r]=-1}this._gl.uniform1iv(t,this._textureUnits);for(var o=0;o<i.length;o++)this._setTexture(this._textureUnits[o],i[o],!0)}},Dt.prototype._setAnisotropicLevel=function(e,t,i){var r=this._caps.textureAnisotropicFilterExtension;11!==t.samplingMode&&3!==t.samplingMode&&2!==t.samplingMode&&(i=1),r&&t._cachedAnisotropicFilteringLevel!==i&&(this._setTextureParameterFloat(e,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i,this._caps.maxAnisotropy),t),t._cachedAnisotropicFilteringLevel=i)},Dt.prototype._setTextureParameterFloat=function(e,t,i,r){this._bindTextureDirectly(e,r,!0,!0),this._gl.texParameterf(e,t,i)},Dt.prototype._setTextureParameterInteger=function(e,t,i,r){r&&this._bindTextureDirectly(e,r,!0,!0),this._gl.texParameteri(e,t,i)},Dt.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var e=0;e<this._caps.maxVertexAttribs;e++)this.disableAttributeByIndex(e)}else for(var e=0,t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[e]||this.disableAttributeByIndex(e)},Dt.prototype.releaseEffects=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e].getPipelineContext();this._deletePipelineContext(t)}this._compiledEffects={}},Dt.prototype.dispose=function(){this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this.releaseEffects(),this.unbindAllAttributes(),this._boundUniforms=[],ce.IsWindowObjectExist()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._boundRenderFunction=null,st.ResetCache();for(var e=0,t=this._activeRequests;e<t.length;e++)t[e].abort()},Dt.prototype.attachContextLostEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)},Dt.prototype.attachContextRestoredEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)},Dt.prototype.getError=function(){return this._gl.getError()},Dt.prototype._canRenderToFloatFramebuffer=function(){return 1<this._webGLVersion?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)},Dt.prototype._canRenderToHalfFloatFramebuffer=function(){return 1<this._webGLVersion?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)},Dt.prototype._canRenderToFramebuffer=function(e){for(var t=this._gl;t.getError()!==t.NO_ERROR;);var i=!0,r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);var n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);var o,s,a,h=t.checkFramebufferStatus(t.FRAMEBUFFER);for((i=(i=i&&h===t.FRAMEBUFFER_COMPLETE)&&t.getError()===t.NO_ERROR)&&(t.clear(t.COLOR_BUFFER_BIT),i=i&&t.getError()===t.NO_ERROR),i&&(t.bindFramebuffer(t.FRAMEBUFFER,null),o=t.RGBA,s=t.UNSIGNED_BYTE,a=new Uint8Array(4),t.readPixels(0,0,1,1,o,s,a),i=i&&t.getError()===t.NO_ERROR),t.deleteTexture(r),t.deleteFramebuffer(n),t.bindFramebuffer(t.FRAMEBUFFER,null);!i&&t.getError()!==t.NO_ERROR;);return i},Dt.prototype._getWebGLTextureType=function(e){if(1===this._webGLVersion){switch(e){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(e){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},Dt.prototype._getInternalFormat=function(e){var t=this._gl.RGBA;switch(e){case 0:t=this._gl.ALPHA;break;case 1:t=this._gl.LUMINANCE;break;case 2:t=this._gl.LUMINANCE_ALPHA;break;case 6:t=this._gl.RED;break;case 7:t=this._gl.RG;break;case 4:t=this._gl.RGB;break;case 5:t=this._gl.RGBA}if(1<this._webGLVersion)switch(e){case 8:t=this._gl.RED_INTEGER;break;case 9:t=this._gl.RG_INTEGER;break;case 10:t=this._gl.RGB_INTEGER;break;case 11:t=this._gl.RGBA_INTEGER}return t},Dt.prototype._getRGBABufferInternalSizedFormat=function(e,t){if(1===this._webGLVersion){if(void 0!==t)switch(t){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return this._gl.RGB}return this._gl.RGBA}switch(e){case 3:switch(t){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(t){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return this._gl.RGB8;case 5:return this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(t){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;case 11:default:return this._gl.RGBA16I}case 5:switch(t){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;case 11:default:return this._gl.RGBA16UI}case 6:switch(t){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;case 11:default:return this._gl.RGBA32I}case 7:switch(t){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;case 11:default:return this._gl.RGBA32UI}case 1:switch(t){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;case 5:default:return this._gl.RGBA32F}case 2:switch(t){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;case 5:default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(t){case 5:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2}}return this._gl.RGBA8},Dt.prototype._getRGBAMultiSampleBufferFormat=function(e){return 1===e?this._gl.RGBA32F:2===e?this._gl.RGBA16F:this._gl.RGBA8},Dt.prototype._loadFile=function(e,t,i,r,n,o){var s=this,a=Dt._FileToolsLoadFile(e,t,i,r,n,o);return this._activeRequests.push(a),a.onCompleteObservable.add(function(e){s._activeRequests.splice(s._activeRequests.indexOf(e),1)}),a},Dt._FileToolsLoadFile=function(e,t,i,r,n,o){throw S.WarnImport("FileTools")},Dt.prototype.readPixels=function(e,t,i,r,n){void 0===n&&(n=!0);var o=n?4:3,s=n?this._gl.RGBA:this._gl.RGB,a=new Uint8Array(r*i*o);return this._gl.readPixels(e,t,i,r,s,this._gl.UNSIGNED_BYTE,a),a},Dt.isSupported=function(){if(null===this._isSupported)try{var e=Ot.CreateCanvas(1,1),t=e.getContext("webgl")||e.getContext("experimental-webgl");this._isSupported=null!=t&&!!window.WebGLRenderingContext}catch(e){this._isSupported=!1}return this._isSupported},Dt.CeilingPOT=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},Dt.FloorPOT=function(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)-(e>>1)},Dt.NearestPOT=function(e){var t=Dt.CeilingPOT(e),i=Dt.FloorPOT(e);return e-i<t-e?i:t},Dt.GetExponentOfTwo=function(e,t,i){var r;switch(void 0===i&&(i=2),i){case 1:r=Dt.FloorPOT(e);break;case 2:r=Dt.NearestPOT(e);break;case 3:default:r=Dt.CeilingPOT(e)}return Math.min(r,t)},Dt.QueueNewFrame=function(e,t){return ce.IsWindowObjectExist()?(t=t||window).requestAnimationFrame?t.requestAnimationFrame(e):t.msRequestAnimationFrame?t.msRequestAnimationFrame(e):t.webkitRequestAnimationFrame?t.webkitRequestAnimationFrame(e):t.mozRequestAnimationFrame?t.mozRequestAnimationFrame(e):t.oRequestAnimationFrame?t.oRequestAnimationFrame(e):window.setTimeout(e,16):"undefined"!=typeof requestAnimationFrame?requestAnimationFrame(e):setTimeout(e,16)},Dt.prototype.getHostDocument=function(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:document},Dt.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]}],Dt._TextureLoaders=[],Dt.CollisionsEpsilon=.001,Dt._isSupported=null,Dt);function Dt(e,t,i,r){var h=this;void 0===r&&(r=!1),this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this.useReverseDepthBuffer=!1,this.disableUniformBuffers=!1,this._uniformBuffers=new Array,this._webGLVersion=1,this._windowIsBackground=!1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this.onContextLostObservable=new le,this.onContextRestoredObservable=new le,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this.disableVertexArrayObjects=!1,this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new ht,this._stencilState=new ut,this._alphaState=new dt,this._alphaMode=1,this._alphaEquation=0,this._internalTexturesCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._activeRequests=new Array,this._texturesSupported=new Array,this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new le,this._viewportCached={x:0,y:0,z:0,w:0},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._getDepthStencilBuffer=function(e,t,i,r,n,o){var s=h._gl,a=s.createRenderbuffer();return s.bindRenderbuffer(s.RENDERBUFFER,a),1<i&&s.renderbufferStorageMultisample?s.renderbufferStorageMultisample(s.RENDERBUFFER,i,n,e,t):s.renderbufferStorage(s.RENDERBUFFER,r,e,t),s.framebufferRenderbuffer(s.FRAMEBUFFER,o,s.RENDERBUFFER,a),s.bindRenderbuffer(s.RENDERBUFFER,null),a},this._boundUniforms={};var n=null;if(e){if(i=i||{},e.getContext){if(n=e,this._renderingCanvas=n,null!=t&&(i.antialias=t),void 0===i.deterministicLockstep&&(i.deterministicLockstep=!1),void 0===i.lockstepMaxSteps&&(i.lockstepMaxSteps=4),void 0===i.timeStep&&(i.timeStep=1/60),void 0===i.preserveDrawingBuffer&&(i.preserveDrawingBuffer=!1),void 0===i.audioEngine&&(i.audioEngine=!0),void 0===i.stencil&&(i.stencil=!0),!1===i.premultipliedAlpha&&(this.premultipliedAlpha=!1),this._doNotHandleContextLost=!!i.doNotHandleContextLost,navigator&&navigator.userAgent)for(var o=navigator.userAgent,s=0,a=Dt.ExceptionList;s<a.length;s++){var l=a[s],u=l.key,c=l.targets;if(new RegExp(u).test(o)){if(l.capture&&l.captureConstraint){var d=l.capture,f=l.captureConstraint,p=new RegExp(d).exec(o);if(p&&0<p.length)if(f<=parseInt(p[p.length-1]))continue}for(var _=0,g=c;_<g.length;_++){switch(g[_]){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0}}}}if(this._doNotHandleContextLost||(this._onContextLost=function(e){e.preventDefault(),h._contextWasLost=!0,fe.Warn("WebGL context lost."),h.onContextLostObservable.notifyObservers(h)},this._onContextRestored=function(){setTimeout(function(){h._initGLContext(),h._rebuildEffects(),h._rebuildInternalTextures(),h._rebuildBuffers(),h.wipeCaches(!0),fe.Warn("WebGL context successfully restored."),h.onContextRestoredObservable.notifyObservers(h),h._contextWasLost=!1},0)},n.addEventListener("webglcontextlost",this._onContextLost,!1),n.addEventListener("webglcontextrestored",this._onContextRestored,!1),i.powerPreference="high-performance"),!i.disableWebGL2Support)try{this._gl=n.getContext("webgl2",i)||n.getContext("experimental-webgl2",i),this._gl&&(this._webGLVersion=2,this._gl.deleteQuery||(this._webGLVersion=1))}catch(e){}if(!this._gl){if(!n)throw new Error("The provided canvas is null or undefined.");try{this._gl=n.getContext("webgl",i)||n.getContext("experimental-webgl",i)}catch(e){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=e,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample&&(this._webGLVersion=2);var m=this._gl.getContextAttributes();m&&(i.stencil=m.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==i.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=i.useHighPrecisionFloats);var v=ce.IsWindowObjectExist()&&window.devicePixelRatio||1,y=i.limitDeviceRatio||v;this._hardwareScalingLevel=r?1/Math.min(y,v):1,this.resize(),this._isStencilEnable=!!i.stencil,this._initGLContext();for(var b=0;b<this._caps.maxVertexAttribs;b++)this._currentBufferPointers[b]=new It;1<this.webGLVersion&&(this._shaderProcessor=new yt),this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this._creationOptions=i,console.log("Babylon.js v"+Dt.Version+" - "+this.description)}}var wt,Lt=(n(Ft,wt=Re),Ft);function Ft(e,t){var i=wt.call(this,e)||this;return i.name="LoadFileError",Re._setPrototypeOf(i,Ft.prototype),t instanceof xe?i.request=t:i.file=t,i}var Nt,Bt=(n(kt,Nt=Re),kt);function kt(e,t){var i=Nt.call(this,e)||this;return i.request=t,i.name="RequestFileError",Re._setPrototypeOf(i,kt.prototype),i}var Ut,Vt=(n(zt,Ut=Re),zt);function zt(e,t){var i=Ut.call(this,e)||this;return i.file=t,i.name="ReadFileError",Re._setPrototypeOf(i,zt.prototype),i}var Wt,Gt,Xt=(Ht._CleanUrl=function(e){return e=e.replace(/#/gm,"%23")},Ht.SetCorsBehavior=function(e,t){var i;e&&0===e.indexOf("data:")||Ht.CorsBehavior&&("string"==typeof Ht.CorsBehavior||this.CorsBehavior instanceof String?t.crossOrigin=Ht.CorsBehavior:(i=Ht.CorsBehavior(e))&&(t.crossOrigin=i))},Ht.LoadImage=function(i,t,r,e,n){var o;void 0===n&&(n="");var s=!1;if(i instanceof ArrayBuffer||ArrayBuffer.isView(i)?"undefined"!=typeof Blob?(o=URL.createObjectURL(new Blob([i],{type:n})),s=!0):o="data:"+n+";base64,"+_e.EncodeArrayBufferToBase64(i):i instanceof Blob?(o=URL.createObjectURL(i),s=!0):(o=Ht._CleanUrl(i),o=Ht.PreprocessUrl(i)),"undefined"==typeof Image)return Ht.LoadFile(o,function(e){createImageBitmap(new Blob([e],{type:n})).then(function(e){t(e),s&&URL.revokeObjectURL(o)}).catch(function(e){r&&r("Error while trying to load image: "+i,e)})},void 0,e||void 0,!0,function(e,t){r&&r("Error while trying to load image: "+i,t)}),null;var a=new Image;Ht.SetCorsBehavior(o,a);var h=function(){a.removeEventListener("load",h),a.removeEventListener("error",l),t(a),s&&a.src&&URL.revokeObjectURL(a.src)},l=function(e){a.removeEventListener("load",h),a.removeEventListener("error",l),r&&r("Error while trying to load image: "+i,e),s&&a.src&&URL.revokeObjectURL(a.src)};function u(){a.src=o}if(a.addEventListener("load",h),a.addEventListener("error",l),"data:"!==o.substr(0,5)&&e&&e.enableTexturesOffline)e.open(function(){e&&e.loadImage(o,a)},u);else{if(-1!==o.indexOf("file:")){var c,d=decodeURIComponent(o.substring(5).toLowerCase());if(Ce.FilesToLoad[d]){try{try{c=URL.createObjectURL(Ce.FilesToLoad[d])}catch(e){c=URL.createObjectURL(Ce.FilesToLoad[d])}a.src=c,s=!0}catch(e){a.src=""}return a}}u()}return a},Ht.ReadFile=function(t,i,e,r,n){var o=new FileReader,s={onCompleteObservable:new le,abort:function(){return o.abort()}};return o.onloadend=function(e){return s.onCompleteObservable.notifyObservers(s)},n&&(o.onerror=function(e){n(new Vt("Unable to read "+t.name,t))}),o.onload=function(e){i(e.target.result)},e&&(o.onprogress=e),r?o.readAsArrayBuffer(t):o.readAsText(t),s},Ht.LoadFile=function(e,i,t,r,n,o){if(-1!==e.indexOf("file:")){var s=decodeURIComponent(e.substring(5).toLowerCase());0===s.indexOf("./")&&(s=s.substring(2));var a=Ce.FilesToLoad[s];if(a)return Ht.ReadFile(a,i,t,n,o?function(e){return o(void 0,new Lt(e.message,e.file))}:void 0)}return Ht.RequestFile(e,function(e,t){i(e,t?t.responseURL:void 0)},t,r,n,o?function(e){o(e.request,new Lt(e.message,e.request))}:void 0)},Ht.RequestFile=function(e,l,t,i,u,c,d){function r(){var s=new xe,a=null;_.abort=function(){p=!0,s.readyState!==(XMLHttpRequest.DONE||4)&&s.abort(),null!==a&&(clearTimeout(a),a=null)};var h=function(r){s.open("GET",f),d&&d(s),u&&(s.responseType="arraybuffer"),t&&s.addEventListener("progress",t);var n=function(){s.removeEventListener("loadend",n),_.onCompleteObservable.notifyObservers(_),_.onCompleteObservable.clear()};s.addEventListener("loadend",n);var o=function(){if(!p&&s.readyState===(XMLHttpRequest.DONE||4)){if(s.removeEventListener("readystatechange",o),200<=s.status&&s.status<300||0===s.status&&(!ce.IsWindowObjectExist()||Ht.IsFileURL()))return void l(u?s.response:s.responseText,s);var e=Ht.DefaultRetryStrategy;if(e){var t=e(f,s,r);if(-1!==t)return s.removeEventListener("loadend",n),s=new xe,void(a=setTimeout(function(){return h(r+1)},t))}var i=new Bt("Error status: "+s.status+" "+s.statusText+" - Unable to load "+f,s);c&&c(i)}};s.addEventListener("readystatechange",o),s.send()};h(0)}e=Ht._CleanUrl(e),e=Ht.PreprocessUrl(e);var n,f=Ht.BaseUrl+e,p=!1,_={onCompleteObservable:new le,abort:function(){return p=!0}};return i&&i.enableSceneOffline?(n=function(e){e&&400<e.status?c&&c(e):r()},i.open(function(){i&&i.loadFile(Ht.BaseUrl+e,function(e){p||l(e),_.onCompleteObservable.notifyObservers(_)},t?function(e){p||t(e)}:void 0,n,u)},n)):r(),_},Ht.IsFileURL=function(){return"file:"===location.protocol},Ht.DefaultRetryStrategy=Oe.ExponentialBackoff(),Ht.BaseUrl="",Ht.CorsBehavior="anonymous",Ht.PreprocessUrl=function(e){return e},Ht);function Ht(){}Rt._FileToolsLoadImage=Xt.LoadImage.bind(Xt),Rt._FileToolsLoadFile=Xt.LoadFile.bind(Xt),nt._FileToolsLoadFile=Xt.LoadFile.bind(Xt),(Gt=Wt=Wt||{})[Gt.Pending=0]="Pending",Gt[Gt.Fulfilled=1]="Fulfilled",Gt[Gt.Rejected=2]="Rejected";var jt=function(){this.count=0,this.target=0,this.results=[]},Kt=(Object.defineProperty(Yt.prototype,"_result",{get:function(){return this._resultValue},set:function(e){this._resultValue=e,this._parent&&void 0===this._parent._result&&(this._parent._result=e)},enumerable:!0,configurable:!0}),Yt.prototype.catch=function(e){return this.then(void 0,e)},Yt.prototype.then=function(e,t){var i=this,r=new Yt;return r._onFulfilled=e,r._onRejected=t,this._children.push(r),(r._parent=this)._state!==Wt.Pending&&setTimeout(function(){var e,t;i._state===Wt.Fulfilled||i._rejectWasConsumed?null!=(e=r._resolve(i._result))&&(void 0!==e._state?(t=e,r._children.push(t),t._parent=r,r=t):r._result=e):r._reject(i._reason)}),r},Yt.prototype._moveChildren=function(e){var t,i=this;if((t=this._children).push.apply(t,e.splice(0,e.length)),this._children.forEach(function(e){e._parent=i}),this._state===Wt.Fulfilled)for(var r=0,n=this._children;r<n.length;r++)n[r]._resolve(this._result);else if(this._state===Wt.Rejected)for(var o=0,s=this._children;o<s.length;o++)s[o]._reject(this._reason)},Yt.prototype._resolve=function(e){try{this._state=Wt.Fulfilled;var t,i=null;this._onFulfilled&&(i=this._onFulfilled(e)),null!=i&&(e=void 0!==i._state?((t=i)._parent=this,t._moveChildren(this._children),t._result):i),this._result=e;for(var r=0,n=this._children;r<n.length;r++)n[r]._resolve(e);this._children.length=0,delete this._onFulfilled,delete this._onRejected}catch(e){this._reject(e,!0)}},Yt.prototype._reject=function(t,e){if(void 0===e&&(e=!1),this._state=Wt.Rejected,this._reason=t,this._onRejected&&!e)try{this._onRejected(t),this._rejectWasConsumed=!0}catch(e){t=e}for(var i=0,r=this._children;i<r.length;i++){var n=r[i];this._rejectWasConsumed?n._resolve(null):n._reject(t)}this._children.length=0,delete this._onFulfilled,delete this._onRejected},Yt.resolve=function(e){var t=new Yt;return t._resolve(e),t},Yt._RegisterForFulfillment=function(e,t,i){e.then(function(e){return t.results[i]=e,t.count++,t.count===t.target&&t.rootPromise._resolve(t.results),null},function(e){t.rootPromise._state!==Wt.Rejected&&t.rootPromise._reject(e)})},Yt.all=function(e){var t=new Yt,i=new jt;if(i.target=e.length,i.rootPromise=t,e.length)for(var r=0;r<e.length;r++)Yt._RegisterForFulfillment(e[r],i,r);else t._resolve([]);return t},Yt.race=function(e){var t=new Yt;if(e.length)for(var i=0,r=e;i<r.length;i++)r[i].then(function(e){return t&&(t._resolve(e),t=null),null},function(e){t&&(t._reject(e),t=null)});return t},Yt);function Yt(e){var t=this;if(this._state=Wt.Pending,this._children=new Array,this._rejectWasConsumed=!1,e)try{e(function(e){t._resolve(e)},function(e){t._reject(e)})}catch(e){this._reject(e)}}var qt=(Zt.Apply=function(e){void 0===e&&(e=!1),!e&&"undefined"!=typeof Promise||(window.Promise=Kt)},Zt);function Zt(){}var Qt=(Jt.SetImmediate=function(e){ce.IsWindowObjectExist()&&window.setImmediate?window.setImmediate(e):setTimeout(e,1)},Jt);function Jt(){}var $t=(ei.Instantiate=function(e){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[e])return this.RegisteredExternalClasses[e];var t=m.GetClass(e);if(t)return t;fe.Warn(e+" not found, you may have missed an import.");for(var i=e.split("."),r=window||this,n=0,o=i.length;n<o;n++)r=r[i[n]];return"function"!=typeof r?null:r},ei.RegisteredExternalClasses={},ei);function ei(){}var ti=(ii.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},ii);function ii(){}var ri=(Object.defineProperty(ni,"BaseUrl",{get:function(){return Xt.BaseUrl},set:function(e){Xt.BaseUrl=e},enumerable:!0,configurable:!0}),Object.defineProperty(ni,"DefaultRetryStrategy",{get:function(){return Xt.DefaultRetryStrategy},set:function(e){Xt.DefaultRetryStrategy=e},enumerable:!0,configurable:!0}),Object.defineProperty(ni,"UseFallbackTexture",{get:function(){return Ae.UseFallbackTexture},set:function(e){Ae.UseFallbackTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(ni,"RegisteredExternalClasses",{get:function(){return $t.RegisteredExternalClasses},set:function(e){$t.RegisteredExternalClasses=e},enumerable:!0,configurable:!0}),Object.defineProperty(ni,"fallbackTexture",{get:function(){return Ae.FallbackTexture},set:function(e){Ae.FallbackTexture=e},enumerable:!0,configurable:!0}),ni.FetchToRef=function(e,t,i,r,n,o){var s=4*((Math.abs(e)*i%i|0)+(Math.abs(t)*r%r|0)*i);o.r=n[s]/255,o.g=n[1+s]/255,o.b=n[2+s]/255,o.a=n[3+s]/255},ni.Mix=function(e,t,i){return e*(1-i)+t*i},ni.Instantiate=function(e){return $t.Instantiate(e)},ni.Slice=function(e,t,i){return e.slice?e.slice(t,i):Array.prototype.slice.call(e,t,i)},ni.SetImmediate=function(e){Qt.SetImmediate(e)},ni.IsExponentOfTwo=function(e){for(var t=1;(t*=2)<e;);return t===e},ni.FloatRound=function(e){return Math.fround?Math.fround(e):ni._tmpFloatArray[0]=e},ni.GetFilename=function(e){var t=e.lastIndexOf("/");return t<0?e:e.substring(t+1)},ni.GetFolderPath=function(e,t){void 0===t&&(t=!1);var i=e.lastIndexOf("/");return i<0?t?e:"":e.substring(0,i+1)},ni.ToDegrees=function(e){return 180*e/Math.PI},ni.ToRadians=function(e){return e*Math.PI/180},ni.MakeArray=function(e,t){return!0===t||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:null},ni.GetPointerPrefix=function(){var e="pointer";return ce.IsWindowObjectExist()&&!window.PointerEvent&&ce.IsNavigatorAvailable()&&!navigator.pointerEnabled&&(e="mouse"),e},ni.SetCorsBehavior=function(e,t){Xt.SetCorsBehavior(e,t)},ni.CleanUrl=function(e){return e=e.replace(/#/gm,"%23")},Object.defineProperty(ni,"PreprocessUrl",{get:function(){return Xt.PreprocessUrl},set:function(e){Xt.PreprocessUrl=e},enumerable:!0,configurable:!0}),ni.LoadImage=function(e,t,i,r,n){return Xt.LoadImage(e,t,i,r,n)},ni.LoadFile=function(e,t,i,r,n,o){return Xt.LoadFile(e,t,i,r,n,o)},ni.LoadFileAsync=function(e,r){return void 0===r&&(r=!0),new Promise(function(t,i){Xt.LoadFile(e,function(e){t(e)},void 0,void 0,r,function(e,t){i(t)})})},ni.LoadScript=function(t,e,i,r){var n,o;ce.IsWindowObjectExist()&&(n=document.getElementsByTagName("head")[0],(o=document.createElement("script")).setAttribute("type","text/javascript"),o.setAttribute("src",t),r&&(o.id=r),o.onload=function(){e&&e()},o.onerror=function(e){i&&i("Unable to load script '"+t+"'",e)},n.appendChild(o))},ni.LoadScriptAsync=function(t,e){var r=this;return new Promise(function(e,i){r.LoadScript(t,function(){e()},function(e,t){i(t)})})},ni.ReadFileAsDataURL=function(e,t,i){var r=new FileReader,n={onCompleteObservable:new le,abort:function(){return r.abort()}};return r.onloadend=function(e){n.onCompleteObservable.notifyObservers(n)},r.onload=function(e){t(e.target.result)},r.onprogress=i,r.readAsDataURL(e),n},ni.ReadFile=function(e,t,i,r,n){return Xt.ReadFile(e,t,i,r,n)},ni.FileAsURL=function(e){var t=new Blob([e]);return(window.URL||window.webkitURL).createObjectURL(t)},ni.Format=function(e,t){return void 0===t&&(t=2),e.toFixed(t)},ni.DeepCopy=function(e,t,i,r){ve.DeepCopy(e,t,i,r)},ni.IsEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},ni.RegisterTopRootEvents=function(e,t){for(var i=0;i<t.length;i++){var r=t[i];e.addEventListener(r.name,r.handler,!1);try{window.parent&&window.parent.addEventListener(r.name,r.handler,!1)}catch(e){}}},ni.UnregisterTopRootEvents=function(e,t){for(var i=0;i<t.length;i++){var r=t[i];e.removeEventListener(r.name,r.handler);try{e.parent&&e.parent.removeEventListener(r.name,r.handler)}catch(e){}}},ni.DumpFramebuffer=function(e,t,i,r,n,o){void 0===n&&(n="image/png");for(var s=4*e,a=t/2,h=i.readPixels(0,0,e,t),l=0;l<a;l++)for(var u=0;u<s;u++){var c=u+l*s,d=u+(t-l-1)*s,f=h[c];h[c]=h[d],h[d]=f}ni._ScreenshotCanvas||(ni._ScreenshotCanvas=document.createElement("canvas")),ni._ScreenshotCanvas.width=e,ni._ScreenshotCanvas.height=t;var p,_=ni._ScreenshotCanvas.getContext("2d");_&&((p=_.createImageData(e,t)).data.set(h),_.putImageData(p,0,0),ni.EncodeScreenshotCanvasData(r,n,o))},ni.ToBlob=function(e,t,i){void 0===i&&(i="image/png"),e.toBlob||(e.toBlob=function(n,o,s){var a=this;setTimeout(function(){for(var e=atob(a.toDataURL(o,s).split(",")[1]),t=e.length,i=new Uint8Array(t),r=0;r<t;r++)i[r]=e.charCodeAt(r);n(new Blob([i]))})}),e.toBlob(function(e){t(e)},i)},ni.EncodeScreenshotCanvasData=function(e,t,s){void 0===t&&(t="image/png"),e?e(ni._ScreenshotCanvas.toDataURL(t)):this.ToBlob(ni._ScreenshotCanvas,function(e){if("download"in document.createElement("a")){var t,i;s||(i=((t=new Date).getFullYear()+"-"+(t.getMonth()+1)).slice(2)+"-"+t.getDate()+"_"+t.getHours()+"-"+("0"+t.getMinutes()).slice(-2),s="screenshot_"+i+".png"),ni.Download(e,s)}else{var r=URL.createObjectURL(e),n=window.open("");if(!n)return;var o=n.document.createElement("img");o.onload=function(){URL.revokeObjectURL(r)},o.src=r,n.document.body.appendChild(o)}},t)},ni.Download=function(e,t){var i,r;navigator&&navigator.msSaveBlob?navigator.msSaveBlob(e,t):(i=window.URL.createObjectURL(e),r=document.createElement("a"),document.body.appendChild(r),r.style.display="none",r.href=i,r.download=t,r.addEventListener("click",function(){r.parentElement&&r.parentElement.removeChild(r)}),r.click(),window.URL.revokeObjectURL(i))},ni.CreateScreenshot=function(e,t,i,r,n){throw void 0===n&&(n="image/png"),S.WarnImport("ScreenshotTools")},ni.CreateScreenshotAsync=function(e,t,i,r){throw void 0===r&&(r="image/png"),S.WarnImport("ScreenshotTools")},ni.CreateScreenshotUsingRenderTarget=function(e,t,i,r,n,o,s,a){throw void 0===n&&(n="image/png"),void 0===o&&(o=1),void 0===s&&(s=!1),S.WarnImport("ScreenshotTools")},ni.CreateScreenshotUsingRenderTargetAsync=function(e,t,i,r,n,o,s){throw void 0===r&&(r="image/png"),void 0===n&&(n=1),void 0===o&&(o=!1),S.WarnImport("ScreenshotTools")},ni.RandomId=function(){return ti.RandomId()},ni.IsBase64=function(e){return!(e.length<5)&&"data:"===e.substr(0,5)},ni.DecodeBase64=function(e){for(var t=atob(e.split(",")[1]),i=t.length,r=new Uint8Array(new ArrayBuffer(i)),n=0;n<i;n++)r[n]=t.charCodeAt(n);return r.buffer},ni.GetAbsoluteUrl=function(e){var t=document.createElement("a");return t.href=e,t.href},Object.defineProperty(ni,"errorsCount",{get:function(){return fe.errorsCount},enumerable:!0,configurable:!0}),ni.Log=function(e){fe.Log(e)},ni.Warn=function(e){fe.Warn(e)},ni.Error=function(e){fe.Error(e)},Object.defineProperty(ni,"LogCache",{get:function(){return fe.LogCache},enumerable:!0,configurable:!0}),ni.ClearLogCache=function(){fe.ClearLogCache()},Object.defineProperty(ni,"LogLevels",{set:function(e){fe.LogLevels=e},enumerable:!0,configurable:!0}),Object.defineProperty(ni,"PerformanceLogLevel",{set:function(e){return(e&ni.PerformanceUserMarkLogLevel)===ni.PerformanceUserMarkLogLevel?(ni.StartPerformanceCounter=ni._StartUserMark,void(ni.EndPerformanceCounter=ni._EndUserMark)):(e&ni.PerformanceConsoleLogLevel)===ni.PerformanceConsoleLogLevel?(ni.StartPerformanceCounter=ni._StartPerformanceConsole,void(ni.EndPerformanceCounter=ni._EndPerformanceConsole)):(ni.StartPerformanceCounter=ni._StartPerformanceCounterDisabled,void(ni.EndPerformanceCounter=ni._EndPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),ni._StartPerformanceCounterDisabled=function(e,t){},ni._EndPerformanceCounterDisabled=function(e,t){},ni._StartUserMark=function(e,t){if(void 0===t&&(t=!0),!ni._performance){if(!ce.IsWindowObjectExist())return;ni._performance=window.performance}t&&ni._performance.mark&&ni._performance.mark(e+"-Begin")},ni._EndUserMark=function(e,t){void 0===t&&(t=!0),t&&ni._performance.mark&&(ni._performance.mark(e+"-End"),ni._performance.measure(e,e+"-Begin",e+"-End"))},ni._StartPerformanceConsole=function(e,t){void 0===t&&(t=!0),t&&(ni._StartUserMark(e,t),console.time&&console.time(e))},ni._EndPerformanceConsole=function(e,t){void 0===t&&(t=!0),t&&(ni._EndUserMark(e,t),console.timeEnd(e))},Object.defineProperty(ni,"Now",{get:function(){return be.Now},enumerable:!0,configurable:!0}),ni.GetClassName=function(e,t){void 0===t&&(t=!1);var i=null;return i=!t&&e.getClassName?e.getClassName():(e instanceof Object&&(i=(t?e:Object.getPrototypeOf(e)).constructor.__bjsclassName__),i||typeof e)},ni.First=function(e,t){for(var i=0,r=e;i<r.length;i++){var n=r[i];if(t(n))return n}return null},ni.getFullClassName=function(e,t){void 0===t&&(t=!1);var i,r=null,n=null;return(r=!t&&e.getClassName?e.getClassName():(e instanceof Object&&(r=(i=t?e:Object.getPrototypeOf(e)).constructor.__bjsclassName__,n=i.constructor.__bjsmoduleName__),r||typeof e))?(null!=n?n+".":"")+r:null},ni.DelayAsync=function(t){return new Promise(function(e){setTimeout(function(){e()},t)})},ni.IsSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},ni.UseCustomRequestHeaders=!1,ni.CustomRequestHeaders=xe.CustomRequestHeaders,ni.CorsBehavior="anonymous",ni._tmpFloatArray=new Float32Array(1),ni.GetDOMTextContent=ce.GetDOMTextContent,ni.NoneLogLevel=fe.NoneLogLevel,ni.MessageLogLevel=fe.MessageLogLevel,ni.WarningLogLevel=fe.WarningLogLevel,ni.ErrorLogLevel=fe.ErrorLogLevel,ni.AllLogLevel=fe.AllLogLevel,ni.IsWindowObjectExist=ce.IsWindowObjectExist,ni.PerformanceNoneLogLevel=0,ni.PerformanceUserMarkLogLevel=1,ni.PerformanceConsoleLogLevel=2,ni.StartPerformanceCounter=ni._StartPerformanceCounterDisabled,ni.EndPerformanceCounter=ni._EndPerformanceCounterDisabled,ni);function ni(){}var oi=(si.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},si.prototype.breakLoop=function(){this._done=!0,this._successCallback()},si.Run=function(e,t,i,r){void 0===r&&(r=0);var n=new si(e,t,i,r);return n.executeNext(),n},si.SyncAsyncForLoop=function(r,n,o,e,s,t){return void 0===t&&(t=0),si.Run(Math.ceil(r/n),function(i){s&&s()?i.breakLoop():setTimeout(function(){for(var e=0;e<n;++e){var t=i.index*n+e;if(r<=t)break;if(o(t),s&&s()){i.breakLoop();break}}i.executeNext()},t)},e)},si);function si(e,t,i,r){void 0===r&&(r=0),this.iterations=e,this.index=r-1,this._done=!1,this._fn=t,this._successCallback=i}Ae.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",qt.Apply();var ai=(hi.prototype.copyFrom=function(e){var i=this;this.clear(),e.forEach(function(e,t){return i.add(e,t)})},hi.prototype.get=function(e){var t=this._data[e];if(void 0!==t)return t},hi.prototype.getOrAddWithFactory=function(e,t){var i=this.get(e);return void 0!==i||(i=t(e))&&this.add(e,i),i},hi.prototype.getOrAdd=function(e,t){var i=this.get(e);return void 0!==i?i:(this.add(e,t),t)},hi.prototype.contains=function(e){return void 0!==this._data[e]},hi.prototype.add=function(e,t){return void 0===this._data[e]&&(this._data[e]=t,++this._count,!0)},hi.prototype.set=function(e,t){return void 0!==this._data[e]&&(this._data[e]=t,!0)},hi.prototype.getAndRemove=function(e){var t=this.get(e);return void 0!==t?(delete this._data[e],--this._count,t):null},hi.prototype.remove=function(e){return!!this.contains(e)&&(delete this._data[e],--this._count,!0)},hi.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(hi.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),hi.prototype.forEach=function(e){for(var t in this._data)e(t,this._data[t])},hi.prototype.first=function(e){for(var t in this._data){var i=e(t,this._data[t]);if(i)return i}return null},hi);function hi(){this._count=0,this._data={}}var li,ui,ci=(di.AddNodeConstructor=function(e,t){this._NodeConstructors[e]=t},di.Construct=function(e,t,i,r){var n=this._NodeConstructors[e];return n?n(t,i,r):null},Object.defineProperty(di.prototype,"doNotSerialize",{get:function(){return!!this._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize},set:function(e){this._doNotSerialize=e},enumerable:!0,configurable:!0}),di.prototype.isDisposed=function(){return this._isDisposed},Object.defineProperty(di.prototype,"parent",{get:function(){return this._parentNode},set:function(e){var t,i;this._parentNode!==e&&(t=this._parentNode,this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children&&(-1!==(i=this._parentNode._children.indexOf(this))&&this._parentNode._children.splice(i,1),e||this._isDisposed||this._addToSceneRootNodes()),this._parentNode=e,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),t||this._removeFromSceneRootNodes()),this._syncParentEnabledState())},enumerable:!0,configurable:!0}),di.prototype._addToSceneRootNodes=function(){-1===this._sceneRootNodesIndex&&(this._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))},di.prototype._removeFromSceneRootNodes=function(){var e,t;-1!==this._sceneRootNodesIndex&&(t=(e=this._scene.rootNodes).length-1,e[this._sceneRootNodesIndex]=e[t],e[this._sceneRootNodesIndex]._sceneRootNodesIndex=this._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._sceneRootNodesIndex=-1)},Object.defineProperty(di.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!0,configurable:!0}),di.prototype.getClassName=function(){return"Node"},Object.defineProperty(di.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),di.prototype.getScene=function(){return this._scene},di.prototype.getEngine=function(){return this._scene.getEngine()},di.prototype.addBehavior=function(e,t){var i=this;return void 0===t&&(t=!1),-1!==this._behaviors.indexOf(e)||(e.init(),this._scene.isLoading&&!t?this._scene.onDataLoadedObservable.addOnce(function(){e.attach(i)}):e.attach(this),this._behaviors.push(e)),this},di.prototype.removeBehavior=function(e){var t=this._behaviors.indexOf(e);return-1===t||(this._behaviors[t].detach(),this._behaviors.splice(t,1)),this},Object.defineProperty(di.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!0,configurable:!0}),di.prototype.getBehaviorByName=function(e){for(var t=0,i=this._behaviors;t<i.length;t++){var r=i[t];if(r.name===e)return r}return null},di.prototype.getWorldMatrix=function(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix},di.prototype._getWorldMatrixDeterminant=function(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant},Object.defineProperty(di.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),di.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},di.prototype.updateCache=function(e){!e&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},di.prototype._getActionManagerForTrigger=function(e,t){return void 0===t&&(t=!0),this.parent?this.parent._getActionManagerForTrigger(e,!1):null},di.prototype._updateCache=function(e){},di.prototype._isSynchronized=function(){return!0},di.prototype._markSyncedWithParent=function(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)},di.prototype.isSynchronizedWithParent=function(){return!this._parentNode||this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()},di.prototype.isSynchronized=function(){return this._cache.parent!=this._parentNode?(this._cache.parent=this._parentNode,!1):!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()},di.prototype.isReady=function(e){return void 0===e&&(e=!1),this._isReady},di.prototype.isEnabled=function(e){return void 0===e&&(e=!0),!1===e?this._isEnabled:!!this._isEnabled&&this._isParentEnabled},di.prototype._syncParentEnabledState=function(){this._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach(function(e){e._syncParentEnabledState()})},di.prototype.setEnabled=function(e){this._isEnabled=e,this._syncParentEnabledState()},di.prototype.isDescendantOf=function(e){return!!this.parent&&(this.parent===e||this.parent.isDescendantOf(e))},di.prototype._getDescendants=function(e,t,i){if(void 0===t&&(t=!1),this._children)for(var r=0;r<this._children.length;r++){var n=this._children[r];i&&!i(n)||e.push(n),t||n._getDescendants(e,!1,i)}},di.prototype.getDescendants=function(e,t){var i=new Array;return this._getDescendants(i,e,t),i},di.prototype.getChildMeshes=function(e,t){var i=[];return this._getDescendants(i,e,function(e){return(!t||t(e))&&void 0!==e.cullingStrategy}),i},di.prototype.getChildren=function(e,t){return void 0===t&&(t=!0),this.getDescendants(t,e)},di.prototype._setReady=function(e){e!==this._isReady&&(e?(this.onReady&&this.onReady(this),this._isReady=!0):this._isReady=!1)},di.prototype.getAnimationByName=function(e){for(var t=0;t<this.animations.length;t++){var i=this.animations[t];if(i.name===e)return i}return null},di.prototype.createAnimationRange=function(e,t,i){if(!this._ranges[e]){this._ranges[e]=di._AnimationRangeFactory(e,t,i);for(var r=0,n=this.animations.length;r<n;r++)this.animations[r]&&this.animations[r].createRange(e,t,i)}},di.prototype.deleteAnimationRange=function(e,t){void 0===t&&(t=!0);for(var i=0,r=this.animations.length;i<r;i++)this.animations[i]&&this.animations[i].deleteRange(e,t);this._ranges[e]=null},di.prototype.getAnimationRange=function(e){return this._ranges[e]},di.prototype.getAnimationRanges=function(){var e,t=[];for(e in this._ranges)t.push(this._ranges[e]);return t},di.prototype.beginAnimation=function(e,t,i,r){var n=this.getAnimationRange(e);return n?this._scene.beginAnimation(this,n.from,n.to,t,i,r):null},di.prototype.serializeAnimationRanges=function(){var e=[];for(var t in this._ranges){var i,r=this._ranges[t];r&&((i={}).name=t,i.from=r.from,i.to=r.to,e.push(i))}return e},di.prototype.computeWorldMatrix=function(e){return this._worldMatrix||(this._worldMatrix=W.Identity()),this._worldMatrix},di.prototype.dispose=function(e,t){if(void 0===t&&(t=!1),this._isDisposed=!0,!e)for(var i=0,r=this.getDescendants(!0);i<r.length;i++)r[i].dispose(e,t);this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear();for(var n=0,o=this._behaviors;n<o.length;n++)o[n].detach();this._behaviors=[]},di.ParseAnimationRanges=function(e,t,i){if(t.ranges)for(var r=0;r<t.ranges.length;r++){var n=t.ranges[r];e.createAnimationRange(n.name,n.from,n.to)}},di.prototype.getHierarchyBoundingVectors=function(e,t){var i,r,n;if(void 0===e&&(e=!0),void 0===t&&(t=null),this.getScene().incrementRenderId(),this.computeWorldMatrix(!0),n=this.getBoundingInfo&&this.subMeshes?(r=(i=this.getBoundingInfo()).boundingBox.minimumWorld.clone(),i.boundingBox.maximumWorld.clone()):(r=new te(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),new te(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)),e)for(var o=0,s=this.getDescendants(!1);o<s.length;o++){var a,h,l,u=s[o];u.computeWorldMatrix(!0),t&&!t(u)||u.getBoundingInfo&&0!==u.getTotalVertices()&&(h=(a=u.getBoundingInfo().boundingBox).minimumWorld,l=a.maximumWorld,te.CheckExtends(h,r,n),te.CheckExtends(l,r,n))}return{min:r,max:n}},di._AnimationRangeFactory=function(e,t,i){throw S.WarnImport("AnimationRange")},di._NodeConstructors={},o([z()],di.prototype,"name",void 0),o([z()],di.prototype,"id",void 0),o([z()],di.prototype,"uniqueId",void 0),o([z()],di.prototype,"state",void 0),o([z()],di.prototype,"metadata",void 0),di);function di(e,t){void 0===t&&(t=null),this.state="",this.metadata=null,this.reservedDataStore=null,this._doNotSerialize=!1,this._isDisposed=!1,this.animations=new Array,this._ranges={},this.onReady=null,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=W.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._sceneRootNodesIndex=-1,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new le,this._onDisposeObserver=null,this._behaviors=new Array,this.name=e,this.id=e,this._scene=t||Ae.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache()}(ui=li=li||{})[ui.LOCAL=0]="LOCAL",ui[ui.WORLD=1]="WORLD",ui[ui.BONE=2]="BONE";var fi=(pi.X=new te(1,0,0),pi.Y=new te(0,1,0),pi.Z=new te(0,0,1),pi);function pi(){}var _i,gi=(n(mi,_i=ci),Object.defineProperty(mi.prototype,"billboardMode",{get:function(){return this._billboardMode},set:function(e){this._billboardMode!==e&&(this._billboardMode=e)},enumerable:!0,configurable:!0}),Object.defineProperty(mi.prototype,"preserveParentRotationForBillboard",{get:function(){return this._preserveParentRotationForBillboard},set:function(e){e!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=e)},enumerable:!0,configurable:!0}),Object.defineProperty(mi.prototype,"infiniteDistance",{get:function(){return this._infiniteDistance},set:function(e){this._infiniteDistance!==e&&(this._infiniteDistance=e)},enumerable:!0,configurable:!0}),mi.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(mi.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(mi.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation=e,this._rotationQuaternion=null,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(mi.prototype,"scaling",{get:function(){return this._scaling},set:function(e){this._scaling=e,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(mi.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(e){(this._rotationQuaternion=e)&&this._rotation.setAll(0),this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(mi.prototype,"forward",{get:function(){return te.Normalize(te.TransformNormal(this.getScene().useRightHandedSystem?this._forwardInverted:this._forward,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),Object.defineProperty(mi.prototype,"up",{get:function(){return te.Normalize(te.TransformNormal(this._up,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),Object.defineProperty(mi.prototype,"right",{get:function(){return te.Normalize(te.TransformNormal(this.getScene().useRightHandedSystem?this._rightInverted:this._right,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),mi.prototype.updatePoseMatrix=function(e){return this._poseMatrix?this._poseMatrix.copyFrom(e):this._poseMatrix=e.clone(),this},mi.prototype.getPoseMatrix=function(){return this._poseMatrix||(this._poseMatrix=W.Identity()),this._poseMatrix},mi.prototype._isSynchronized=function(){var e=this._cache;if(this.billboardMode!==e.billboardMode||this.billboardMode!==mi.BILLBOARDMODE_NONE)return!1;if(e.pivotMatrixUpdated)return!1;if(this.infiniteDistance)return!1;if(!e.position.equals(this._position))return!1;if(this._rotationQuaternion){if(!e.rotationQuaternion.equals(this._rotationQuaternion))return!1}else if(!e.rotation.equals(this._rotation))return!1;return!!e.scaling.equals(this._scaling)},mi.prototype._initCache=function(){_i.prototype._initCache.call(this);var e=this._cache;e.localMatrixUpdated=!1,e.position=te.Zero(),e.scaling=te.Zero(),e.rotation=te.Zero(),e.rotationQuaternion=new x(0,0,0,0),e.billboardMode=-1,e.infiniteDistance=!1},mi.prototype.markAsDirty=function(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},Object.defineProperty(mi.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),Object.defineProperty(mi.prototype,"absoluteScaling",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling},enumerable:!0,configurable:!0}),Object.defineProperty(mi.prototype,"absoluteRotationQuaternion",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion},enumerable:!0,configurable:!0}),mi.prototype.setPreTransformMatrix=function(e){return this.setPivotMatrix(e,!1)},mi.prototype.setPivotMatrix=function(e,t){return void 0===t&&(t=!0),this._pivotMatrix.copyFrom(e),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=t,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=W.Invert(this._pivotMatrix)),this},mi.prototype.getPivotMatrix=function(){return this._pivotMatrix},mi.prototype.instantiateHierarchy=function(e,t,i){void 0===e&&(e=null);var r=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0);r&&i&&i(this,r);for(var n=0,o=this.getChildTransformNodes(!0);n<o.length;n++)o[n].instantiateHierarchy(r,t,i);return r},mi.prototype.freezeWorldMatrix=function(e){return void 0===e&&(e=null),e?this._worldMatrix=e:(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this},mi.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(mi.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!0,configurable:!0}),mi.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},mi.prototype.setAbsolutePosition=function(e){if(!e)return this;var t,i,r,n;if(void 0===e.x){if(arguments.length<3)return this;t=e,i=arguments[1],r=arguments[2]}else t=e.x,i=e.y,r=e.z;return this.parent?(n=P.Matrix[0],this.parent.getWorldMatrix().invertToRef(n),te.TransformCoordinatesFromFloatsToRef(t,i,r,n,this.position)):(this.position.x=t,this.position.y=i,this.position.z=r),this},mi.prototype.setPositionWithLocalVector=function(e){return this.computeWorldMatrix(),this.position=te.TransformNormal(e,this._localMatrix),this},mi.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var e=P.Matrix[0];return this._localMatrix.invertToRef(e),te.TransformNormal(this.position,e)},mi.prototype.locallyTranslate=function(e){return this.computeWorldMatrix(!0),this.position=te.TransformCoordinates(e,this._localMatrix),this},mi.prototype.lookAt=function(e,t,i,r,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=li.LOCAL);var o,s,a,h=mi._lookAtVectorCache,l=n===li.LOCAL?this.position:this.getAbsolutePosition();return e.subtractToRef(l,h),this.setDirection(h,t,i,r),n===li.WORLD&&this.parent&&(this.rotationQuaternion?(s=P.Matrix[0],this.rotationQuaternion.toRotationMatrix(s),a=P.Matrix[1],this.parent.getWorldMatrix().getRotationMatrixToRef(a),a.invert(),s.multiplyToRef(a,s),this.rotationQuaternion.fromRotationMatrix(s)):(o=P.Quaternion[0],x.FromEulerVectorToRef(this.rotation,o),s=P.Matrix[0],o.toRotationMatrix(s),a=P.Matrix[1],this.parent.getWorldMatrix().getRotationMatrixToRef(a),a.invert(),s.multiplyToRef(a,s),o.fromRotationMatrix(s),o.toEulerAnglesToRef(this.rotation))),this},mi.prototype.getDirection=function(e){var t=te.Zero();return this.getDirectionToRef(e,t),t},mi.prototype.getDirectionToRef=function(e,t){return te.TransformNormalToRef(e,this.getWorldMatrix(),t),this},mi.prototype.setDirection=function(e,t,i,r){void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=0);var n=-Math.atan2(e.z,e.x)+Math.PI/2,o=Math.sqrt(e.x*e.x+e.z*e.z),s=-Math.atan2(e.y,o);return this.rotationQuaternion?x.RotationYawPitchRollToRef(n+t,s+i,r,this.rotationQuaternion):(this.rotation.x=s+i,this.rotation.y=n+t,this.rotation.z=r),this},mi.prototype.setPivotPoint=function(e,t){void 0===t&&(t=li.LOCAL),0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);var i,r=this.getWorldMatrix();return t==li.WORLD&&(i=P.Matrix[0],r.invertToRef(i),e=te.TransformCoordinates(e,i)),this.setPivotMatrix(W.Translation(-e.x,-e.y,-e.z),!0)},mi.prototype.getPivotPoint=function(){var e=te.Zero();return this.getPivotPointToRef(e),e},mi.prototype.getPivotPointToRef=function(e){return e.x=-this._pivotMatrix.m[12],e.y=-this._pivotMatrix.m[13],e.z=-this._pivotMatrix.m[14],this},mi.prototype.getAbsolutePivotPoint=function(){var e=te.Zero();return this.getAbsolutePivotPointToRef(e),e},mi.prototype.getAbsolutePivotPointToRef=function(e){return e.x=this._pivotMatrix.m[12],e.y=this._pivotMatrix.m[13],e.z=this._pivotMatrix.m[14],this.getPivotPointToRef(e),te.TransformCoordinatesToRef(e,this.getWorldMatrix(),e),this},mi.prototype.setParent=function(e){if(!e&&!this.parent)return this;var t,i,r=P.Quaternion[0],n=P.Vector3[0],o=P.Vector3[1];return e?(t=P.Matrix[0],i=P.Matrix[1],this.computeWorldMatrix(!0),e.computeWorldMatrix(!0),e.getWorldMatrix().invertToRef(i),this.getWorldMatrix().multiplyToRef(i,t),t.decompose(o,r,n)):(this.computeWorldMatrix(!0),this.getWorldMatrix().decompose(o,r,n)),this.rotationQuaternion?this.rotationQuaternion.copyFrom(r):r.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(o),this.position.copyFrom(n),this.parent=e,this},Object.defineProperty(mi.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!0,configurable:!0}),mi.prototype._updateNonUniformScalingState=function(e){return this._nonUniformScaling!==e&&(this._nonUniformScaling=e,!0)},mi.prototype.attachToBone=function(e,t){return this._transformToBoneReferal=t,(this.parent=e).getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},mi.prototype.detachFromBone=function(){return this.parent&&(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=null),this},mi.prototype.rotate=function(e,t,i){var r,n;return e.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),i&&i!==li.LOCAL?(this.parent&&(n=P.Matrix[0],this.parent.getWorldMatrix().invertToRef(n),e=te.TransformNormal(e,n)),(r=x.RotationAxisToRef(e,t,mi._rotationAxisCache)).multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)):(r=x.RotationAxisToRef(e,t,mi._rotationAxisCache),this.rotationQuaternion.multiplyToRef(r,this.rotationQuaternion)),this},mi.prototype.rotateAround=function(e,t,i){t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=x.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var r=P.Vector3[0],n=P.Vector3[1],o=P.Vector3[2],s=P.Quaternion[0],a=P.Matrix[0],h=P.Matrix[1],l=P.Matrix[2],u=P.Matrix[3];return e.subtractToRef(this.position,r),W.TranslationToRef(r.x,r.y,r.z,a),W.TranslationToRef(-r.x,-r.y,-r.z,h),W.RotationAxisToRef(t,i,l),h.multiplyToRef(l,u),u.multiplyToRef(a,u),u.decompose(n,s,o),this.position.addInPlace(o),s.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},mi.prototype.translate=function(e,t,i){var r,n=e.scale(t);return i&&i!==li.LOCAL?this.setAbsolutePosition(this.getAbsolutePosition().add(n)):(r=this.getPositionExpressedInLocalSpace().add(n),this.setPositionWithLocalVector(r)),this},mi.prototype.addRotation=function(e,t,i){var r;this.rotationQuaternion?r=this.rotationQuaternion:(r=P.Quaternion[1],x.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,r));var n=P.Quaternion[0];return x.RotationYawPitchRollToRef(t,e,i,n),r.multiplyInPlace(n),this.rotationQuaternion||r.toEulerAnglesToRef(this.rotation),this},mi.prototype._getEffectiveParent=function(){return this.parent},mi.prototype.computeWorldMatrix=function(e){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;var t=this.getScene().getRenderId();if(!this._isDirty&&!e&&this.isSynchronized())return this._currentRenderId=t,this._worldMatrix;var i=this.getScene().activeCamera,r=0!=(this._billboardMode&mi.BILLBOARDMODE_USE_POSITION),n=this._billboardMode!==mi.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard;n&&i&&r&&(this.lookAt(i.position),(this.billboardMode&mi.BILLBOARDMODE_X)!==mi.BILLBOARDMODE_X&&(this.rotation.x=0),(this.billboardMode&mi.BILLBOARDMODE_Y)!==mi.BILLBOARDMODE_Y&&(this.rotation.y=0),(this.billboardMode&mi.BILLBOARDMODE_Z)!==mi.BILLBOARDMODE_Z&&(this.rotation.z=0)),this._updateCache();var o=this._cache;o.pivotMatrixUpdated=!1,o.billboardMode=this.billboardMode,o.infiniteDistance=this.infiniteDistance,this._currentRenderId=t,this._childUpdateId++,this._isDirty=!1;var s,a,h=this._getEffectiveParent(),l=o.scaling,u=o.position;this._infiniteDistance&&!this.parent&&i?(s=i.getWorldMatrix(),a=new te(s.m[12],s.m[13],s.m[14]),u.copyFromFloats(this._position.x+a.x,this._position.y+a.y,this._position.z+a.z)):u.copyFrom(this._position),l.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant);var c,d,f,p,_,g,m=o.rotationQuaternion;return this._rotationQuaternion?(this.reIntegrateRotationIntoRotationQuaternion&&this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(x.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0)),m.copyFrom(this._rotationQuaternion)):(x.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,m),o.rotation.copyFrom(this._rotation)),this._usePivotMatrix?(c=P.Matrix[1],W.ScalingToRef(l.x,l.y,l.z,c),d=P.Matrix[0],m.toRotationMatrix(d),this._pivotMatrix.multiplyToRef(c,P.Matrix[4]),P.Matrix[4].multiplyToRef(d,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(u.x,u.y,u.z)):W.ComposeToRef(l,m,u,this._localMatrix),h&&h.getWorldMatrix?(e&&h.computeWorldMatrix(),n?(this._transformToBoneReferal?h.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),P.Matrix[7]):P.Matrix[7].copyFrom(h.getWorldMatrix()),f=P.Vector3[5],p=P.Vector3[6],P.Matrix[7].decompose(p,void 0,f),W.ScalingToRef(p.x,p.y,p.z,P.Matrix[7]),P.Matrix[7].setTranslation(f),this._localMatrix.multiplyToRef(P.Matrix[7],this._worldMatrix)):this._transformToBoneReferal?(this._localMatrix.multiplyToRef(h.getWorldMatrix(),P.Matrix[6]),P.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(h.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()):this._worldMatrix.copyFrom(this._localMatrix),n&&i&&this.billboardMode&&!r&&(_=P.Vector3[0],this._worldMatrix.getTranslationToRef(_),P.Matrix[1].copyFrom(i.getViewMatrix()),P.Matrix[1].setTranslationFromFloats(0,0,0),P.Matrix[1].invertToRef(P.Matrix[0]),(this.billboardMode&mi.BILLBOARDMODE_ALL)!==mi.BILLBOARDMODE_ALL&&(P.Matrix[0].decompose(void 0,P.Quaternion[0],void 0),g=P.Vector3[1],P.Quaternion[0].toEulerAnglesToRef(g),(this.billboardMode&mi.BILLBOARDMODE_X)!==mi.BILLBOARDMODE_X&&(g.x=0),(this.billboardMode&mi.BILLBOARDMODE_Y)!==mi.BILLBOARDMODE_Y&&(g.y=0),(this.billboardMode&mi.BILLBOARDMODE_Z)!==mi.BILLBOARDMODE_Z&&(g.z=0),W.RotationYawPitchRollToRef(g.y,g.x,g.z,P.Matrix[0])),this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(P.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(P.Vector3[0])),this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniform?this._updateNonUniformScalingState(!0):h&&h._nonUniformScaling?this._updateNonUniformScalingState(h._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=W.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix},mi.prototype.resetLocalMatrix=function(e){if(void 0===e&&(e=!0),this.computeWorldMatrix(),e)for(var t=this.getChildren(),i=0;i<t.length;++i){var r,n,o=t[i];o&&(o.computeWorldMatrix(),r=P.Matrix[0],o._localMatrix.multiplyToRef(this._localMatrix,r),n=P.Quaternion[0],r.decompose(o.scaling,n,o.position),o.rotationQuaternion?o.rotationQuaternion=n:n.toEulerAnglesToRef(o.rotation))}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=x.Identity()),this._worldMatrix=W.Identity()},mi.prototype._afterComputeWorldMatrix=function(){},mi.prototype.registerAfterWorldMatrixUpdate=function(e){return this.onAfterWorldMatrixUpdateObservable.add(e),this},mi.prototype.unregisterAfterWorldMatrixUpdate=function(e){return this.onAfterWorldMatrixUpdateObservable.removeCallback(e),this},mi.prototype.getPositionInCameraSpace=function(e){return void 0===e&&(e=null),e=e||this.getScene().activeCamera,te.TransformCoordinates(this.absolutePosition,e.getViewMatrix())},mi.prototype.getDistanceToCamera=function(e){return void 0===e&&(e=null),e=e||this.getScene().activeCamera,this.absolutePosition.subtract(e.globalPosition).length()},mi.prototype.clone=function(e,t,i){var r=this,n=Q.Clone(function(){return new mi(e,r.getScene())},this);if(n.name=e,n.id=e,t&&(n.parent=t),!i)for(var o=this.getDescendants(!0),s=0;s<o.length;s++){var a=o[s];a.clone&&a.clone(e+"."+a.name,n)}return n},mi.prototype.serialize=function(e){var t=Q.Serialize(this,e);return t.type=this.getClassName(),this.parent&&(t.parentId=this.parent.id),t.localMatrix=this.getPivotMatrix().asArray(),t.isEnabled=this.isEnabled(),this.parent&&(t.parentId=this.parent.id),t},mi.Parse=function(e,t,i){var r=Q.Parse(function(){return new mi(e.name,t)},e,t,i);return e.localMatrix?r.setPreTransformMatrix(W.FromArray(e.localMatrix)):e.pivotMatrix&&r.setPivotMatrix(W.FromArray(e.pivotMatrix)),r.setEnabled(e.isEnabled),e.parentId&&(r._waitingParentId=e.parentId),r},mi.prototype.getChildTransformNodes=function(e,t){var i=[];return this._getDescendants(i,e,function(e){return(!t||t(e))&&e instanceof mi}),i},mi.prototype.dispose=function(e,t){if(void 0===t&&(t=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this.onAfterWorldMatrixUpdateObservable.clear(),e)for(var i=0,r=this.getChildTransformNodes(!0);i<r.length;i++){var n=r[i];n.parent=null,n.computeWorldMatrix(!0)}_i.prototype.dispose.call(this,e,t)},mi.prototype.normalizeToUnitCube=function(e,t,i){void 0===e&&(e=!0),void 0===t&&(t=!1);var r=null,n=null;t&&(this.rotationQuaternion?(n=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(r=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));var o=this.getHierarchyBoundingVectors(e,i),s=o.max.subtract(o.min),a=Math.max(s.x,s.y,s.z);if(0===a)return this;var h=1/a;return this.scaling.scaleInPlace(h),t&&(this.rotationQuaternion&&n?this.rotationQuaternion.copyFrom(n):this.rotation&&r&&this.rotation.copyFrom(r)),this},mi.prototype._syncAbsoluteScalingAndRotation=function(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)},mi.BILLBOARDMODE_NONE=0,mi.BILLBOARDMODE_X=1,mi.BILLBOARDMODE_Y=2,mi.BILLBOARDMODE_Z=4,mi.BILLBOARDMODE_ALL=7,mi.BILLBOARDMODE_USE_POSITION=128,mi._lookAtVectorCache=new te(0,0,0),mi._rotationAxisCache=new x,o([Z("position")],mi.prototype,"_position",void 0),o([Z("rotation")],mi.prototype,"_rotation",void 0),o([U(10,"rotationQuaternion")],mi.prototype,"_rotationQuaternion",void 0),o([Z("scaling")],mi.prototype,"_scaling",void 0),o([z("billboardMode")],mi.prototype,"_billboardMode",void 0),o([z()],mi.prototype,"scalingDeterminant",void 0),o([z("infiniteDistance")],mi.prototype,"_infiniteDistance",void 0),o([z()],mi.prototype,"ignoreNonUniformScaling",void 0),o([z()],mi.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0),mi);function mi(e,t,i){void 0===t&&(t=null),void 0===i&&(i=!0);var r=_i.call(this,e,t)||this;return r._forward=new te(0,0,1),r._forwardInverted=new te(0,0,-1),r._up=new te(0,1,0),r._right=new te(1,0,0),r._rightInverted=new te(-1,0,0),r._position=te.Zero(),r._rotation=te.Zero(),r._rotationQuaternion=null,r._scaling=te.One(),r._isDirty=!1,r._transformToBoneReferal=null,r._isAbsoluteSynced=!1,r._billboardMode=mi.BILLBOARDMODE_NONE,r._preserveParentRotationForBillboard=!1,r.scalingDeterminant=1,r._infiniteDistance=!1,r.ignoreNonUniformScaling=!1,r.reIntegrateRotationIntoRotationQuaternion=!1,r._poseMatrix=null,r._localMatrix=W.Zero(),r._usePivotMatrix=!1,r._absolutePosition=te.Zero(),r._absoluteScaling=te.Zero(),r._absoluteRotationQuaternion=x.Identity(),r._pivotMatrix=W.Identity(),r._postMultiplyPivotMatrix=!1,r._isWorldMatrixFrozen=!1,r._indexInSceneTransformNodesArray=-1,r.onAfterWorldMatrixUpdateObservable=new le,r._nonUniformScaling=!1,i&&r.getScene().addTransformNode(r),r}var vi=(yi.prototype.sampleFrame=function(e){var t;void 0===e&&(e=be.Now),this._enabled&&(null!=this._lastFrameTimeMs&&(t=e-this._lastFrameTimeMs,this._rollingFrameTime.add(t)),this._lastFrameTimeMs=e)},Object.defineProperty(yi.prototype,"averageFrameTime",{get:function(){return this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(yi.prototype,"averageFrameTimeVariance",{get:function(){return this._rollingFrameTime.variance},enumerable:!0,configurable:!0}),Object.defineProperty(yi.prototype,"instantaneousFrameTime",{get:function(){return this._rollingFrameTime.history(0)},enumerable:!0,configurable:!0}),Object.defineProperty(yi.prototype,"averageFPS",{get:function(){return 1e3/this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(yi.prototype,"instantaneousFPS",{get:function(){var e=this._rollingFrameTime.history(0);return 0===e?0:1e3/e},enumerable:!0,configurable:!0}),Object.defineProperty(yi.prototype,"isSaturated",{get:function(){return this._rollingFrameTime.isSaturated()},enumerable:!0,configurable:!0}),yi.prototype.enable=function(){this._enabled=!0},yi.prototype.disable=function(){this._enabled=!1,this._lastFrameTimeMs=null},Object.defineProperty(yi.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!0,configurable:!0}),yi.prototype.reset=function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()},yi);function yi(e){void 0===e&&(e=30),this._enabled=!0,this._rollingFrameTime=new bi(e)}var bi=(Ti.prototype.add=function(e){var t,i;this.isSaturated()?(i=(t=this._samples[this._pos])-this.average,this.average-=i/(this._sampleCount-1),this._m2-=i*(t-this.average)):this._sampleCount++,i=e-this.average,this.average+=i/this._sampleCount,this._m2+=i*(e-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=e,this._pos++,this._pos%=this._samples.length},Ti.prototype.history=function(e){if(e>=this._sampleCount||e>=this._samples.length)return 0;var t=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(t-e)]},Ti.prototype.isSaturated=function(){return this._sampleCount>=this._samples.length},Ti.prototype.reset=function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0},Ti.prototype._wrapPosition=function(e){var t=this._samples.length;return(e%t+t)%t},Ti);function Ti(e){this._samples=new Array(e),this.reset()}var xi=(Object.defineProperty(Ei.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(Ei.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),Object.defineProperty(Ei.prototype,"average",{get:function(){return this._average},enumerable:!0,configurable:!0}),Object.defineProperty(Ei.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!0,configurable:!0}),Object.defineProperty(Ei.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(Ei.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!0,configurable:!0}),Object.defineProperty(Ei.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!0,configurable:!0}),Ei.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},Ei.prototype.addCount=function(e,t){Ei.Enabled&&(this._current+=e,t&&this._fetchResult())},Ei.prototype.beginMonitoring=function(){Ei.Enabled&&(this._startMonitoringTime=be.Now)},Ei.prototype.endMonitoring=function(e){var t;void 0===e&&(e=!0),Ei.Enabled&&(e&&this.fetchNewFrame(),t=be.Now,this._current=t-this._startMonitoringTime,e&&this._fetchResult())},Ei.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var e=be.Now;1e3<e-this._lastSecTime&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=e,this._lastSecAccumulated=0,this._lastSecValueCount=0)},Ei.Enabled=!0,Ei);function Ei(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}Rt.prototype.setAlphaConstants=function(e,t,i,r){this._alphaState.setAlphaBlendConstants(e,t,i,r)},Rt.prototype.setAlphaMode=function(e,t){if(void 0===t&&(t=!1),this._alphaMode!==e){switch(e){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0}t||(this.depthCullingState.depthMask=0===e),this._alphaMode=e}},Rt.prototype.getAlphaMode=function(){return this._alphaMode},Rt.prototype.setAlphaEquation=function(e){if(this._alphaEquation!==e){switch(e){case 0:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_ADD,this._gl.FUNC_ADD);break;case 1:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_SUBTRACT,this._gl.FUNC_SUBTRACT);break;case 2:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_REVERSE_SUBTRACT,this._gl.FUNC_REVERSE_SUBTRACT);break;case 3:this._alphaState.setAlphaEquationParameters(this._gl.MAX,this._gl.MAX);break;case 4:this._alphaState.setAlphaEquationParameters(this._gl.MIN,this._gl.MIN);break;case 5:this._alphaState.setAlphaEquationParameters(this._gl.MIN,this._gl.FUNC_ADD)}this._alphaEquation=e}},Rt.prototype.getAlphaEquation=function(){return this._alphaEquation};var Ai,Mi=(n(Ci,Ai=Rt),Object.defineProperty(Ci,"NpmPackage",{get:function(){return Rt.NpmPackage},enumerable:!0,configurable:!0}),Object.defineProperty(Ci,"Version",{get:function(){return Rt.Version},enumerable:!0,configurable:!0}),Object.defineProperty(Ci,"Instances",{get:function(){return Ae.Instances},enumerable:!0,configurable:!0}),Object.defineProperty(Ci,"LastCreatedEngine",{get:function(){return Ae.LastCreatedEngine},enumerable:!0,configurable:!0}),Object.defineProperty(Ci,"LastCreatedScene",{get:function(){return Ae.LastCreatedScene},enumerable:!0,configurable:!0}),Ci.MarkAllMaterialsAsDirty=function(e,t){for(var i=0;i<Ci.Instances.length;i++)for(var r=Ci.Instances[i],n=0;n<r.scenes.length;n++)r.scenes[n].markAllMaterialsAsDirty(e,t)},Ci.DefaultLoadingScreenFactory=function(e){throw S.WarnImport("LoadingScreen")},Object.defineProperty(Ci.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!!Ci._RescalePostProcessFactory},enumerable:!0,configurable:!0}),Object.defineProperty(Ci.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!0,configurable:!0}),Ci.prototype.getInputElement=function(){return this._renderingCanvas},Ci.prototype.getAspectRatio=function(e,t){void 0===t&&(t=!1);var i=e.viewport;return this.getRenderWidth(t)*i.width/(this.getRenderHeight(t)*i.height)},Ci.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},Ci.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},Ci.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},Ci.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},Ci.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},Ci.prototype.getTimeStep=function(){return 1e3*this._timeStep},Ci.prototype.generateMipMapsForCubemap=function(e,t){var i;void 0===t&&(t=!0),e.generateMipMaps&&(i=this._gl,this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,e,!0),i.generateMipmap(i.TEXTURE_CUBE_MAP),t&&this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,null))},Ci.prototype.setState=function(e,t,i,r){void 0===t&&(t=0),void 0===r&&(r=!1),this._depthCullingState.cull===e&&!i||(this._depthCullingState.cull=e);var n=this.cullBackFaces?this._gl.BACK:this._gl.FRONT;this._depthCullingState.cullFace===n&&!i||(this._depthCullingState.cullFace=n),this.setZOffset(t);var o=r?this._gl.CW:this._gl.CCW;this._depthCullingState.frontFace===o&&!i||(this._depthCullingState.frontFace=o)},Ci.prototype.setZOffset=function(e){this._depthCullingState.zOffset=e},Ci.prototype.getZOffset=function(){return this._depthCullingState.zOffset},Ci.prototype.setDepthBuffer=function(e){this._depthCullingState.depthTest=e},Ci.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},Ci.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},Ci.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},Ci.prototype.setStencilBuffer=function(e){this._stencilState.stencilTest=e},Ci.prototype.getStencilMask=function(){return this._stencilState.stencilMask},Ci.prototype.setStencilMask=function(e){this._stencilState.stencilMask=e},Ci.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},Ci.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},Ci.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},Ci.prototype.setStencilFunction=function(e){this._stencilState.stencilFunc=e},Ci.prototype.setStencilFunctionReference=function(e){this._stencilState.stencilFuncRef=e},Ci.prototype.setStencilFunctionMask=function(e){this._stencilState.stencilFuncMask=e},Ci.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},Ci.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},Ci.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},Ci.prototype.setStencilOperationFail=function(e){this._stencilState.stencilOpStencilFail=e},Ci.prototype.setStencilOperationDepthFail=function(e){this._stencilState.stencilOpDepthFail=e},Ci.prototype.setStencilOperationPass=function(e){this._stencilState.stencilOpStencilDepthPass=e},Ci.prototype.setDitheringState=function(e){e?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},Ci.prototype.setRasterizerState=function(e){e?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},Ci.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},Ci.prototype.setDepthFunction=function(e){this._depthCullingState.depthFunc=e},Ci.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},Ci.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},Ci.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},Ci.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},Ci.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},Ci.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},Ci.prototype.setDirectViewport=function(e,t,i,r){var n=this._cachedViewport;return this._cachedViewport=null,this._viewport(e,t,i,r),n},Ci.prototype.scissorClear=function(e,t,i,r,n){this.enableScissor(e,t,i,r),this.clear(n,!0,!0,!0),this.disableScissor()},Ci.prototype.enableScissor=function(e,t,i,r){var n=this._gl;n.enable(n.SCISSOR_TEST),n.scissor(e,t,i,r)},Ci.prototype.disableScissor=function(){var e=this._gl;e.disable(e.SCISSOR_TEST)},Ci.prototype._reportDrawCall=function(){this._drawCalls.addCount(1,!1)},Ci.prototype.initWebVR=function(){throw S.WarnImport("WebVRCamera")},Ci.prototype._prepareVRComponent=function(){},Ci.prototype._connectVREvents=function(e,t){},Ci.prototype._submitVRFrame=function(){},Ci.prototype.disableVR=function(){},Ci.prototype.isVRPresenting=function(){return!1},Ci.prototype._requestVRFrame=function(){},Ci.prototype._loadFileAsync=function(e,r,n){var o=this;return new Promise(function(t,i){o._loadFile(e,function(e){t(e)},void 0,r,n,function(e,t){i(t)})})},Ci.prototype.getVertexShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[0]):null},Ci.prototype.getFragmentShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[1]):null},Ci.prototype.setDepthStencilTexture=function(e,t,i){void 0!==e&&(t&&(this._boundUniforms[e]=t),i&&i.depthStencilTexture?this._setTexture(e,i,!1,!0):this._setTexture(e,null))},Ci.prototype.setTextureFromPostProcess=function(e,t){this._bindTexture(e,t?t._textures.data[t._currentRenderTextureInd]:null)},Ci.prototype.setTextureFromPostProcessOutput=function(e,t){this._bindTexture(e,t?t._outputTexture:null)},Ci.prototype._convertRGBtoRGBATextureData=function(e,t,i,r){for(var n=new(1===r?Float32Array:Uint32Array)(t*i*4),o=0;o<t;o++)for(var s=0;s<i;s++){var a=3*(s*t+o),h=4*(s*t+o);n[0+h]=e[0+a],n[1+h]=e[1+a],n[2+h]=e[2+a],n[3+h]=1}return n},Ci.prototype._rebuildBuffers=function(){for(var e=0,t=this.scenes;e<t.length;e++){var i=t[e];i.resetCachedMaterial(),i._rebuildGeometries(),i._rebuildTextures()}Ai.prototype._rebuildBuffers.call(this)},Ci.prototype._renderFrame=function(){for(var e=0;e<this._activeRenderLoops.length;e++)(0,this._activeRenderLoops[e])()},Ci.prototype._renderLoop=function(){var e;this._contextWasLost||(e=!0,!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())),0<this._activeRenderLoops.length?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?this._requestVRFrame():this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},Ci.prototype._renderViews=function(){return!1},Ci.prototype.switchFullscreen=function(e){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(e)},Ci.prototype.enterFullscreen=function(e){this.isFullscreen||(this._pointerLockRequested=e,this._renderingCanvas&&Ci._RequestFullscreen(this._renderingCanvas))},Ci.prototype.exitFullscreen=function(){this.isFullscreen&&Ci._ExitFullscreen()},Ci.prototype.enterPointerlock=function(){this._renderingCanvas&&Ci._RequestPointerlock(this._renderingCanvas)},Ci.prototype.exitPointerlock=function(){Ci._ExitPointerlock()},Ci.prototype.beginFrame=function(){this._measureFps(),this.onBeginFrameObservable.notifyObservers(this),Ai.prototype.beginFrame.call(this)},Ci.prototype.endFrame=function(){Ai.prototype.endFrame.call(this),this._submitVRFrame(),this.onEndFrameObservable.notifyObservers(this)},Ci.prototype.resize=function(){this.isVRPresenting()||Ai.prototype.resize.call(this)},Ci.prototype.setSize=function(e,t){if(this._renderingCanvas&&(Ai.prototype.setSize.call(this,e,t),this.scenes)){for(var i=0;i<this.scenes.length;i++)for(var r=this.scenes[i],n=0;n<r.cameras.length;n++)r.cameras[n]._currentRenderId=0;this.onResizeObservable.hasObservers&&this.onResizeObservable.notifyObservers(this)}},Ci.prototype.updateDynamicVertexBuffer=function(e,t,i,r){this.bindArrayBuffer(e),void 0===i&&(i=0);var n=t.length||t.byteLength;void 0===r||n<=r&&0===i?t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,new Float32Array(t)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,t):t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(t).subarray(i,i+r)):(t=t instanceof ArrayBuffer?new Uint8Array(t,i,r):new Uint8Array(t.buffer,t.byteOffset+i,r),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t)),this._resetVertexBufferBinding()},Ci.prototype._deletePipelineContext=function(e){var t=e;t&&t.program&&t.transformFeedback&&(this.deleteTransformFeedback(t.transformFeedback),t.transformFeedback=null),Ai.prototype._deletePipelineContext.call(this,e)},Ci.prototype.createShaderProgram=function(e,t,i,r,n,o){void 0===o&&(o=null),n=n||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var s=Ai.prototype.createShaderProgram.call(this,e,t,i,r,n,o);return this.onAfterShaderCompilationObservable.notifyObservers(this),s},Ci.prototype._createShaderProgram=function(e,t,i,r,n){void 0===n&&(n=null);var o,s=r.createProgram();if(!(e.program=s))throw new Error("Unable to create program");return r.attachShader(s,t),r.attachShader(s,i),1<this.webGLVersion&&n&&(o=this.createTransformFeedback(),this.bindTransformFeedback(o),this.setTranformFeedbackVaryings(s,n),e.transformFeedback=o),r.linkProgram(s),1<this.webGLVersion&&n&&this.bindTransformFeedback(null),e.context=r,e.vertexShader=t,e.fragmentShader=i,e.isParallelCompiled||this._finalizePipelineContext(e),s},Ci.prototype._releaseTexture=function(t){Ai.prototype._releaseTexture.call(this,t),this.scenes.forEach(function(e){e.postProcesses.forEach(function(e){e._outputTexture==t&&(e._outputTexture=null)}),e.cameras.forEach(function(e){e._postProcesses.forEach(function(e){e&&e._outputTexture==t&&(e._outputTexture=null)})})})},Ci.prototype._rescaleTexture=function(t,e,i,r,n){var o=this;this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);var s=this.createRenderTargetTexture({width:e.width,height:e.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&Ci._RescalePostProcessFactory&&(this._rescalePostProcess=Ci._RescalePostProcessFactory(this)),this._rescalePostProcess.getEffect().executeWhenCompiled(function(){o._rescalePostProcess.onApply=function(e){e._bindTexture("textureSampler",t)},(i||o.scenes[o.scenes.length-1]).postProcessManager.directRender([o._rescalePostProcess],s,!0),o._bindTextureDirectly(o._gl.TEXTURE_2D,e,!0),o._gl.copyTexImage2D(o._gl.TEXTURE_2D,0,r,0,0,e.width,e.height,0),o.unBindFramebuffer(s),o._releaseTexture(s),n&&n()})},Ci.prototype.getFps=function(){return this._fps},Ci.prototype.getDeltaTime=function(){return this._deltaTime},Ci.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},Ci.prototype._uploadImageToTexture=function(e,t,i,r){void 0===i&&(i=0),void 0===r&&(r=0);var n=this._gl,o=this._getWebGLTextureType(e.type),s=this._getInternalFormat(e.format),a=this._getRGBABufferInternalSizedFormat(e.type,s),h=e.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D;this._bindTextureDirectly(h,e,!0),this._unpackFlipY(e.invertY);var l=n.TEXTURE_2D;e.isCube&&(l=n.TEXTURE_CUBE_MAP_POSITIVE_X+i),n.texImage2D(l,r,a,s,o,t),this._bindTextureDirectly(h,null,!0)},Ci.prototype.updateDynamicIndexBuffer=function(e,t,i){var r;void 0===i&&(i=0),this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(e),r=t instanceof Uint16Array||t instanceof Uint32Array?t:new(e.is32Bits?Uint32Array:Uint16Array)(t),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,r,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},Ci.prototype.updateRenderTargetTextureSampleCount=function(e,t){if(this.webGLVersion<2||!e)return 1;if(e.samples===t)return t;var i=this._gl;if(t=Math.min(t,this.getCaps().maxMSAASamples),e._depthStencilBuffer&&(i.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(i.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null),e._MSAARenderBuffer&&(i.deleteRenderbuffer(e._MSAARenderBuffer),e._MSAARenderBuffer=null),1<t&&i.renderbufferStorageMultisample){var r=i.createFramebuffer();if(!r)throw new Error("Unable to create multi sampled framebuffer");e._MSAAFramebuffer=r,this._bindUnboundFramebuffer(e._MSAAFramebuffer);var n=i.createRenderbuffer();if(!n)throw new Error("Unable to create multi sampled framebuffer");i.bindRenderbuffer(i.RENDERBUFFER,n),i.renderbufferStorageMultisample(i.RENDERBUFFER,t,this._getRGBAMultiSampleBufferFormat(e.type),e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,n),e._MSAARenderBuffer=n}else this._bindUnboundFramebuffer(e._framebuffer);return e.samples=t,e._depthStencilBuffer=this._setupFramebufferDepthAttachments(e._generateStencilBuffer,e._generateDepthBuffer,e.width,e.height,t),this._bindUnboundFramebuffer(null),t},Ci.prototype.updateTextureComparisonFunction=function(e,t){var i;1!==this.webGLVersion?(i=this._gl,e.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,e,!0),0===t?(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,515),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,i.NONE)):(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,t),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),0===t?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_FUNC,515),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_MODE,i.NONE)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_FUNC,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),e._comparisonFunction=t):fe.Error("WebGL 1 does not support texture comparison.")},Ci.prototype.createInstancesBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create instance buffer");var i=new At(t);return i.capacity=e,this.bindArrayBuffer(i),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),i},Ci.prototype.deleteInstancesBuffer=function(e){this._gl.deleteBuffer(e)},Ci.prototype._clientWaitAsync=function(n,o,s){void 0===o&&(o=0),void 0===s&&(s=10);var a=this._gl;return new Promise(function(t,i){var r=function(){var e=a.clientWaitSync(n,o,0);e!=a.WAIT_FAILED?e!=a.TIMEOUT_EXPIRED?t():setTimeout(r,s):i()};r()})},Ci.prototype._readPixelsAsync=function(e,t,i,r,n,o,s){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");var a=this._gl,h=a.createBuffer();a.bindBuffer(a.PIXEL_PACK_BUFFER,h),a.bufferData(a.PIXEL_PACK_BUFFER,s.byteLength,a.STREAM_READ),a.readPixels(e,t,i,r,n,o,0),a.bindBuffer(a.PIXEL_PACK_BUFFER,null);var l=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);return l?(a.flush(),this._clientWaitAsync(l,0,10).then(function(){return a.deleteSync(l),a.bindBuffer(a.PIXEL_PACK_BUFFER,h),a.getBufferSubData(a.PIXEL_PACK_BUFFER,0,s),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),a.deleteBuffer(h),s})):null},Ci.prototype._readTexturePixels=function(e,t,i,r,n,o){void 0===r&&(r=-1),void 0===n&&(n=0),void 0===o&&(o=null);var s=this._gl;if(!this._dummyFramebuffer){var a=s.createFramebuffer();if(!a)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=a}s.bindFramebuffer(s.FRAMEBUFFER,this._dummyFramebuffer),-1<r?s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+r,e._webGLTexture,n):s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e._webGLTexture,n);var h=void 0!==e.type?this._getWebGLTextureType(e.type):s.UNSIGNED_BYTE;switch(h){case s.UNSIGNED_BYTE:o=o||new Uint8Array(4*t*i),h=s.UNSIGNED_BYTE;break;default:o=o||new Float32Array(4*t*i),h=s.FLOAT}return s.readPixels(0,0,t,i,s.RGBA,h,o),s.bindFramebuffer(s.FRAMEBUFFER,this._currentFramebuffer),o},Ci.prototype.dispose=function(){for(this.hideLoadingUI(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();1===Ci.Instances.length&&Ci.audioEngine&&Ci.audioEngine.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.disableVR(),ce.IsWindowObjectExist()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut)),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange)),Ai.prototype.dispose.call(this);var e=Ci.Instances.indexOf(this);0<=e&&Ci.Instances.splice(e,1),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()},Ci.prototype._disableTouchAction=function(){this._renderingCanvas&&this._renderingCanvas.setAttribute&&(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.msTouchAction="none")},Ci.prototype.displayLoadingUI=function(){var e;!ce.IsWindowObjectExist()||(e=this.loadingScreen)&&e.displayLoadingUI()},Ci.prototype.hideLoadingUI=function(){var e;!ce.IsWindowObjectExist()||(e=this._loadingScreen)&&e.hideLoadingUI()},Object.defineProperty(Ci.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=Ci.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(e){this._loadingScreen=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ci.prototype,"loadingUIText",{set:function(e){this.loadingScreen.loadingUIText=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ci.prototype,"loadingUIBackgroundColor",{set:function(e){this.loadingScreen.loadingUIBackgroundColor=e},enumerable:!0,configurable:!0}),Ci._RequestPointerlock=function(e){e.requestPointerLock=e.requestPointerLock||e.msRequestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,e.requestPointerLock&&e.requestPointerLock()},Ci._ExitPointerlock=function(){var e=document;document.exitPointerLock=document.exitPointerLock||e.msExitPointerLock||e.mozExitPointerLock||e.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()},Ci._RequestFullscreen=function(e){var t=e.requestFullscreen||e.msRequestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen;t&&t.call(e)},Ci._ExitFullscreen=function(){var e=document;document.exitFullscreen?document.exitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitCancelFullScreen?e.webkitCancelFullScreen():e.msCancelFullScreen&&e.msCancelFullScreen()},Ci.ALPHA_DISABLE=0,Ci.ALPHA_ADD=1,Ci.ALPHA_COMBINE=2,Ci.ALPHA_SUBTRACT=3,Ci.ALPHA_MULTIPLY=4,Ci.ALPHA_MAXIMIZED=5,Ci.ALPHA_ONEONE=6,Ci.ALPHA_PREMULTIPLIED=7,Ci.ALPHA_PREMULTIPLIED_PORTERDUFF=8,Ci.ALPHA_INTERPOLATE=9,Ci.ALPHA_SCREENMODE=10,Ci.DELAYLOADSTATE_NONE=0,Ci.DELAYLOADSTATE_LOADED=1,Ci.DELAYLOADSTATE_LOADING=2,Ci.DELAYLOADSTATE_NOTLOADED=4,Ci.NEVER=512,Ci.ALWAYS=519,Ci.LESS=513,Ci.EQUAL=514,Ci.LEQUAL=515,Ci.GREATER=516,Ci.GEQUAL=518,Ci.NOTEQUAL=517,Ci.KEEP=7680,Ci.REPLACE=7681,Ci.INCR=7682,Ci.DECR=7683,Ci.INVERT=5386,Ci.INCR_WRAP=34055,Ci.DECR_WRAP=34056,Ci.TEXTURE_CLAMP_ADDRESSMODE=0,Ci.TEXTURE_WRAP_ADDRESSMODE=1,Ci.TEXTURE_MIRROR_ADDRESSMODE=2,Ci.TEXTUREFORMAT_ALPHA=0,Ci.TEXTUREFORMAT_LUMINANCE=1,Ci.TEXTUREFORMAT_LUMINANCE_ALPHA=2,Ci.TEXTUREFORMAT_RGB=4,Ci.TEXTUREFORMAT_RGBA=5,Ci.TEXTUREFORMAT_RED=6,Ci.TEXTUREFORMAT_R=6,Ci.TEXTUREFORMAT_RG=7,Ci.TEXTUREFORMAT_RED_INTEGER=8,Ci.TEXTUREFORMAT_R_INTEGER=8,Ci.TEXTUREFORMAT_RG_INTEGER=9,Ci.TEXTUREFORMAT_RGB_INTEGER=10,Ci.TEXTUREFORMAT_RGBA_INTEGER=11,Ci.TEXTURETYPE_UNSIGNED_BYTE=0,Ci.TEXTURETYPE_UNSIGNED_INT=0,Ci.TEXTURETYPE_FLOAT=1,Ci.TEXTURETYPE_HALF_FLOAT=2,Ci.TEXTURETYPE_BYTE=3,Ci.TEXTURETYPE_SHORT=4,Ci.TEXTURETYPE_UNSIGNED_SHORT=5,Ci.TEXTURETYPE_INT=6,Ci.TEXTURETYPE_UNSIGNED_INTEGER=7,Ci.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,Ci.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,Ci.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,Ci.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,Ci.TEXTURETYPE_UNSIGNED_INT_24_8=12,Ci.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,Ci.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,Ci.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,Ci.TEXTURE_NEAREST_SAMPLINGMODE=1,Ci.TEXTURE_BILINEAR_SAMPLINGMODE=2,Ci.TEXTURE_TRILINEAR_SAMPLINGMODE=3,Ci.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,Ci.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,Ci.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,Ci.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,Ci.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,Ci.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,Ci.TEXTURE_NEAREST_LINEAR=7,Ci.TEXTURE_NEAREST_NEAREST=1,Ci.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,Ci.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,Ci.TEXTURE_LINEAR_LINEAR=2,Ci.TEXTURE_LINEAR_NEAREST=12,Ci.TEXTURE_EXPLICIT_MODE=0,Ci.TEXTURE_SPHERICAL_MODE=1,Ci.TEXTURE_PLANAR_MODE=2,Ci.TEXTURE_CUBIC_MODE=3,Ci.TEXTURE_PROJECTION_MODE=4,Ci.TEXTURE_SKYBOX_MODE=5,Ci.TEXTURE_INVCUBIC_MODE=6,Ci.TEXTURE_EQUIRECTANGULAR_MODE=7,Ci.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,Ci.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,Ci.SCALEMODE_FLOOR=1,Ci.SCALEMODE_NEAREST=2,Ci.SCALEMODE_CEILING=3,Ci._RescalePostProcessFactory=null,Ci);function Ci(e,t,i,r){void 0===r&&(r=!1);var n,o,s,a=Ai.call(this,e,t,i,r)||this;return a.enableOfflineSupport=!1,a.disableManifestCheck=!1,a.scenes=new Array,a.onNewSceneAddedObservable=new le,a.postProcesses=new Array,a.isPointerLock=!1,a.onResizeObservable=new le,a.onCanvasBlurObservable=new le,a.onCanvasFocusObservable=new le,a.onCanvasPointerOutObservable=new le,a.onBeginFrameObservable=new le,a.customAnimationFrameRequester=null,a.onEndFrameObservable=new le,a.onBeforeShaderCompilationObservable=new le,a.onAfterShaderCompilationObservable=new le,a._deterministicLockstep=!1,a._lockstepMaxSteps=4,a._timeStep=1/60,a._fps=60,a._deltaTime=0,a._drawCalls=new xi,a.canvasTabIndex=1,a.disablePerformanceMonitorInBackground=!1,a._performanceMonitor=new vi,e&&(i=a._creationOptions,Ci.Instances.push(a),e.getContext&&(n=e,a._onCanvasFocus=function(){a.onCanvasFocusObservable.notifyObservers(a)},a._onCanvasBlur=function(){a.onCanvasBlurObservable.notifyObservers(a)},n.addEventListener("focus",a._onCanvasFocus),n.addEventListener("blur",a._onCanvasBlur),a._onBlur=function(){a.disablePerformanceMonitorInBackground&&a._performanceMonitor.disable(),a._windowIsBackground=!0},a._onFocus=function(){a.disablePerformanceMonitorInBackground&&a._performanceMonitor.enable(),a._windowIsBackground=!1},a._onCanvasPointerOut=function(e){a.onCanvasPointerOutObservable.notifyObservers(e)},n.addEventListener("pointerout",a._onCanvasPointerOut),ce.IsWindowObjectExist()&&((o=a.getHostWindow()).addEventListener("blur",a._onBlur),o.addEventListener("focus",a._onFocus),s=document,a._onFullscreenChange=function(){void 0!==s.fullscreen?a.isFullscreen=s.fullscreen:void 0!==s.mozFullScreen?a.isFullscreen=s.mozFullScreen:void 0!==s.webkitIsFullScreen?a.isFullscreen=s.webkitIsFullScreen:void 0!==s.msIsFullScreen&&(a.isFullscreen=s.msIsFullScreen),a.isFullscreen&&a._pointerLockRequested&&n&&Ci._RequestPointerlock(n)},document.addEventListener("fullscreenchange",a._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",a._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",a._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",a._onFullscreenChange,!1),a._onPointerLockChange=function(){a.isPointerLock=s.mozPointerLockElement===n||s.webkitPointerLockElement===n||s.msPointerLockElement===n||s.pointerLockElement===n},document.addEventListener("pointerlockchange",a._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",a._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",a._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",a._onPointerLockChange,!1),!Ci.audioEngine&&i.audioEngine&&Ci.AudioEngineFactory&&(Ci.audioEngine=Ci.AudioEngineFactory(a.getRenderingCanvas()))),a._connectVREvents(),a.enableOfflineSupport=void 0!==Ci.OfflineProviderFactory,i.doNotHandleTouchAction||a._disableTouchAction(),a._deterministicLockstep=!!i.deterministicLockstep,a._lockstepMaxSteps=i.lockstepMaxSteps||0,a._timeStep=i.timeStep||1/60),a._prepareVRComponent(),i.autoEnableWebVR&&a.initWebVR()),a}var Pi=(Oi.prototype.createVertexBuffer=function(e,t,i,r,n,o,s){void 0===o&&(o=!1);var a=o?t:t*Float32Array.BYTES_PER_ELEMENT,h=r?o?r:r*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new Si(this._engine,this,e,this._updatable,!0,h,void 0===n?this._instanced:n,a,i,void 0,void 0,!0,this._divisor||s)},Oi.prototype.isUpdatable=function(){return this._updatable},Oi.prototype.getData=function(){return this._data},Oi.prototype.getBuffer=function(){return this._buffer},Oi.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},Oi.prototype.create=function(e){void 0===e&&(e=null),!e&&this._buffer||(e=e||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e),this._data=e):this._buffer=this._engine.createVertexBuffer(e))},Oi.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},Oi.prototype.update=function(e){this.create(e)},Oi.prototype.updateDirectly=function(e,t,i,r){void 0===r&&(r=!1),this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,r?t:t*Float32Array.BYTES_PER_ELEMENT,i?i*this.byteStride:void 0),this._data=null)},Oi.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},Oi);function Oi(e,t,i,r,n,o,s,a){void 0===r&&(r=0),void 0===n&&(n=!1),void 0===o&&(o=!1),void 0===s&&(s=!1),e.getScene?this._engine=e.getScene().getEngine():this._engine=e,this._updatable=i,this._instanced=o,this._divisor=a||1,this._data=t,this.byteStride=s?r:r*Float32Array.BYTES_PER_ELEMENT,n||this.create()}var Si=(Object.defineProperty(Ii.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(e){this._instanceDivisor=e,this._instanced=0!=e},enumerable:!0,configurable:!0}),Ii.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},Ii.prototype.getKind=function(){return this._kind},Ii.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},Ii.prototype.getData=function(){return this._buffer.getData()},Ii.prototype.getBuffer=function(){return this._buffer.getBuffer()},Ii.prototype.getStrideSize=function(){return this.byteStride/Ii.GetTypeByteLength(this.type)},Ii.prototype.getOffset=function(){return this.byteOffset/Ii.GetTypeByteLength(this.type)},Ii.prototype.getSize=function(){return this._size},Ii.prototype.getIsInstanced=function(){return this._instanced},Ii.prototype.getInstanceDivisor=function(){return this._instanceDivisor},Ii.prototype.create=function(e){this._buffer.create(e)},Ii.prototype.update=function(e){this._buffer.update(e)},Ii.prototype.updateDirectly=function(e,t,i){void 0===i&&(i=!1),this._buffer.updateDirectly(e,t,void 0,i)},Ii.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},Ii.prototype.forEach=function(e,t){Ii.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,e,this.normalized,t)},Ii.DeduceStride=function(e){switch(e){case Ii.UVKind:case Ii.UV2Kind:case Ii.UV3Kind:case Ii.UV4Kind:case Ii.UV5Kind:case Ii.UV6Kind:return 2;case Ii.NormalKind:case Ii.PositionKind:return 3;case Ii.ColorKind:case Ii.MatricesIndicesKind:case Ii.MatricesIndicesExtraKind:case Ii.MatricesWeightsKind:case Ii.MatricesWeightsExtraKind:case Ii.TangentKind:return 4;default:throw new Error("Invalid kind '"+e+"'")}},Ii.GetTypeByteLength=function(e){switch(e){case Ii.BYTE:case Ii.UNSIGNED_BYTE:return 1;case Ii.SHORT:case Ii.UNSIGNED_SHORT:return 2;case Ii.INT:case Ii.UNSIGNED_INT:case Ii.FLOAT:return 4;default:throw new Error("Invalid type '"+e+"'")}},Ii.ForEach=function(e,t,i,r,n,o,s,a){if(e instanceof Array)for(var h=t/4,l=i/4,u=0;u<o;u+=r){for(var c=0;c<r;c++)a(e[h+c],u+c);h+=l}else for(var d=e instanceof ArrayBuffer?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),f=Ii.GetTypeByteLength(n),u=0;u<o;u+=r){for(var p=t,c=0;c<r;c++)a(Ii._GetFloatValue(d,n,p,s),u+c),p+=f;t+=i}},Ii._GetFloatValue=function(e,t,i,r){switch(t){case Ii.BYTE:var n=e.getInt8(i);return r&&(n=Math.max(n/127,-1)),n;case Ii.UNSIGNED_BYTE:return n=e.getUint8(i),r&&(n/=255),n;case Ii.SHORT:return n=e.getInt16(i,!0),r&&(n=Math.max(n/32767,-1)),n;case Ii.UNSIGNED_SHORT:return n=e.getUint16(i,!0),r&&(n/=65535),n;case Ii.INT:return e.getInt32(i,!0);case Ii.UNSIGNED_INT:return e.getUint32(i,!0);case Ii.FLOAT:return e.getFloat32(i,!0);default:throw new Error("Invalid component type "+t)}},Ii.BYTE=5120,Ii.UNSIGNED_BYTE=5121,Ii.SHORT=5122,Ii.UNSIGNED_SHORT=5123,Ii.INT=5124,Ii.UNSIGNED_INT=5125,Ii.FLOAT=5126,Ii.PositionKind="position",Ii.NormalKind="normal",Ii.TangentKind="tangent",Ii.UVKind="uv",Ii.UV2Kind="uv2",Ii.UV3Kind="uv3",Ii.UV4Kind="uv4",Ii.UV5Kind="uv5",Ii.UV6Kind="uv6",Ii.ColorKind="color",Ii.MatricesIndicesKind="matricesIndices",Ii.MatricesWeightsKind="matricesWeights",Ii.MatricesIndicesExtraKind="matricesIndicesExtra",Ii.MatricesWeightsExtraKind="matricesWeightsExtra",Ii);function Ii(e,t,i,r,n,o,s,a,h,l,u,c,d){var f;void 0===u&&(u=!1),void 0===c&&(c=!1),void 0===d&&(d=1),t instanceof Pi?(this._buffer=t,this._ownsBuffer=!1):(this._buffer=new Pi(e,t,r,o,n,s,c),this._ownsBuffer=!0),this._kind=i,null==l?(f=this.getData(),this.type=Ii.FLOAT,f instanceof Int8Array?this.type=Ii.BYTE:f instanceof Uint8Array?this.type=Ii.UNSIGNED_BYTE:f instanceof Int16Array?this.type=Ii.SHORT:f instanceof Uint16Array?this.type=Ii.UNSIGNED_SHORT:f instanceof Int32Array?this.type=Ii.INT:f instanceof Uint32Array&&(this.type=Ii.UNSIGNED_INT)):this.type=l;var p=Ii.GetTypeByteLength(this.type);c?(this._size=h||(o?o/p:Ii.DeduceStride(i)),this.byteStride=o||this._buffer.byteStride||this._size*p,this.byteOffset=a||0):(this._size=h||o||Ii.DeduceStride(i),this.byteStride=o?o*p:this._buffer.byteStride||this._size*p,this.byteOffset=(a||0)*p),this.normalized=u,this._instanced=void 0!==s&&s,this._instanceDivisor=s?d:0}var Ri=(Di.prototype.set=function(e,t){switch(t){case Si.PositionKind:this.positions=e;break;case Si.NormalKind:this.normals=e;break;case Si.TangentKind:this.tangents=e;break;case Si.UVKind:this.uvs=e;break;case Si.UV2Kind:this.uvs2=e;break;case Si.UV3Kind:this.uvs3=e;break;case Si.UV4Kind:this.uvs4=e;break;case Si.UV5Kind:this.uvs5=e;break;case Si.UV6Kind:this.uvs6=e;break;case Si.ColorKind:this.colors=e;break;case Si.MatricesIndicesKind:this.matricesIndices=e;break;case Si.MatricesWeightsKind:this.matricesWeights=e;break;case Si.MatricesIndicesExtraKind:this.matricesIndicesExtra=e;break;case Si.MatricesWeightsExtraKind:this.matricesWeightsExtra=e}},Di.prototype.applyToMesh=function(e,t){return this._applyTo(e,t),this},Di.prototype.applyToGeometry=function(e,t){return this._applyTo(e,t),this},Di.prototype.updateMesh=function(e){return this._update(e),this},Di.prototype.updateGeometry=function(e){return this._update(e),this},Di.prototype._applyTo=function(e,t){return void 0===t&&(t=!1),this.positions&&e.setVerticesData(Si.PositionKind,this.positions,t),this.normals&&e.setVerticesData(Si.NormalKind,this.normals,t),this.tangents&&e.setVerticesData(Si.TangentKind,this.tangents,t),this.uvs&&e.setVerticesData(Si.UVKind,this.uvs,t),this.uvs2&&e.setVerticesData(Si.UV2Kind,this.uvs2,t),this.uvs3&&e.setVerticesData(Si.UV3Kind,this.uvs3,t),this.uvs4&&e.setVerticesData(Si.UV4Kind,this.uvs4,t),this.uvs5&&e.setVerticesData(Si.UV5Kind,this.uvs5,t),this.uvs6&&e.setVerticesData(Si.UV6Kind,this.uvs6,t),this.colors&&e.setVerticesData(Si.ColorKind,this.colors,t),this.matricesIndices&&e.setVerticesData(Si.MatricesIndicesKind,this.matricesIndices,t),this.matricesWeights&&e.setVerticesData(Si.MatricesWeightsKind,this.matricesWeights,t),this.matricesIndicesExtra&&e.setVerticesData(Si.MatricesIndicesExtraKind,this.matricesIndicesExtra,t),this.matricesWeightsExtra&&e.setVerticesData(Si.MatricesWeightsExtraKind,this.matricesWeightsExtra,t),this.indices?e.setIndices(this.indices,null,t):e.setIndices([],null),this},Di.prototype._update=function(e,t,i){return this.positions&&e.updateVerticesData(Si.PositionKind,this.positions,t,i),this.normals&&e.updateVerticesData(Si.NormalKind,this.normals,t,i),this.tangents&&e.updateVerticesData(Si.TangentKind,this.tangents,t,i),this.uvs&&e.updateVerticesData(Si.UVKind,this.uvs,t,i),this.uvs2&&e.updateVerticesData(Si.UV2Kind,this.uvs2,t,i),this.uvs3&&e.updateVerticesData(Si.UV3Kind,this.uvs3,t,i),this.uvs4&&e.updateVerticesData(Si.UV4Kind,this.uvs4,t,i),this.uvs5&&e.updateVerticesData(Si.UV5Kind,this.uvs5,t,i),this.uvs6&&e.updateVerticesData(Si.UV6Kind,this.uvs6,t,i),this.colors&&e.updateVerticesData(Si.ColorKind,this.colors,t,i),this.matricesIndices&&e.updateVerticesData(Si.MatricesIndicesKind,this.matricesIndices,t,i),this.matricesWeights&&e.updateVerticesData(Si.MatricesWeightsKind,this.matricesWeights,t,i),this.matricesIndicesExtra&&e.updateVerticesData(Si.MatricesIndicesExtraKind,this.matricesIndicesExtra,t,i),this.matricesWeightsExtra&&e.updateVerticesData(Si.MatricesWeightsExtraKind,this.matricesWeightsExtra,t,i),this.indices&&e.setIndices(this.indices,null),this},Di.prototype.transform=function(e){var t=e.m[0]*e.m[5]*e.m[10]<0,i=te.Zero();if(this.positions)for(var r=te.Zero(),n=0;n<this.positions.length;n+=3)te.FromArrayToRef(this.positions,n,r),te.TransformCoordinatesToRef(r,e,i),this.positions[n]=i.x,this.positions[n+1]=i.y,this.positions[n+2]=i.z;if(this.normals){var o=te.Zero();for(n=0;n<this.normals.length;n+=3)te.FromArrayToRef(this.normals,n,o),te.TransformNormalToRef(o,e,i),this.normals[n]=i.x,this.normals[n+1]=i.y,this.normals[n+2]=i.z}if(this.tangents){var s=j.Zero(),a=j.Zero();for(n=0;n<this.tangents.length;n+=4)j.FromArrayToRef(this.tangents,n,s),j.TransformNormalToRef(s,e,a),this.tangents[n]=a.x,this.tangents[n+1]=a.y,this.tangents[n+2]=a.z,this.tangents[n+3]=a.w}if(t&&this.indices)for(n=0;n<this.indices.length;n+=3){var h=this.indices[n+1];this.indices[n+1]=this.indices[n+2],this.indices[n+2]=h}return this},Di.prototype.merge=function(e,t){if(void 0===t&&(t=!1),this._validate(),e._validate(),!this.normals!=!e.normals||!this.tangents!=!e.tangents||!this.uvs!=!e.uvs||!this.uvs2!=!e.uvs2||!this.uvs3!=!e.uvs3||!this.uvs4!=!e.uvs4||!this.uvs5!=!e.uvs5||!this.uvs6!=!e.uvs6||!this.colors!=!e.colors||!this.matricesIndices!=!e.matricesIndices||!this.matricesWeights!=!e.matricesWeights||!this.matricesIndicesExtra!=!e.matricesIndicesExtra||!this.matricesWeightsExtra!=!e.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(e.indices){this.indices||(this.indices=[]);var i=this.positions?this.positions.length/3:0;if(void 0!==this.indices.BYTES_PER_ELEMENT){var r=this.indices.length+e.indices.length,n=new(t||this.indices instanceof Uint32Array?Uint32Array:Uint16Array)(r);n.set(this.indices);for(var o=this.indices.length,s=0;s<e.indices.length;s++)n[o+s]=e.indices[s]+i;this.indices=n}else for(s=0;s<e.indices.length;s++)this.indices.push(e.indices[s]+i)}return this.positions=this._mergeElement(this.positions,e.positions),this.normals=this._mergeElement(this.normals,e.normals),this.tangents=this._mergeElement(this.tangents,e.tangents),this.uvs=this._mergeElement(this.uvs,e.uvs),this.uvs2=this._mergeElement(this.uvs2,e.uvs2),this.uvs3=this._mergeElement(this.uvs3,e.uvs3),this.uvs4=this._mergeElement(this.uvs4,e.uvs4),this.uvs5=this._mergeElement(this.uvs5,e.uvs5),this.uvs6=this._mergeElement(this.uvs6,e.uvs6),this.colors=this._mergeElement(this.colors,e.colors),this.matricesIndices=this._mergeElement(this.matricesIndices,e.matricesIndices),this.matricesWeights=this._mergeElement(this.matricesWeights,e.matricesWeights),this.matricesIndicesExtra=this._mergeElement(this.matricesIndicesExtra,e.matricesIndicesExtra),this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,e.matricesWeightsExtra),this},Di.prototype._mergeElement=function(e,t){if(!e)return t;if(!t)return e;var i=t.length+e.length,r=e instanceof Float32Array,n=t instanceof Float32Array;if(r){var o=new Float32Array(i);return o.set(e),o.set(t,e.length),o}if(n){for(var s=e.slice(0),a=0,i=t.length;a<i;a++)s.push(t[a]);return s}return e.concat(t)},Di.prototype._validate=function(){if(!this.positions)throw new Error("Positions are required");function r(e,t){var i=Si.DeduceStride(e);if(t.length%i!=0)throw new Error("The "+e+"s array count must be a multiple of "+i);return t.length/i}function e(e,t){var i=r(e,t);if(i!==n)throw new Error("The "+e+"s element count ("+i+") does not match the positions count ("+n+")")}var n=r(Si.PositionKind,this.positions);this.normals&&e(Si.NormalKind,this.normals),this.tangents&&e(Si.TangentKind,this.tangents),this.uvs&&e(Si.UVKind,this.uvs),this.uvs2&&e(Si.UV2Kind,this.uvs2),this.uvs3&&e(Si.UV3Kind,this.uvs3),this.uvs4&&e(Si.UV4Kind,this.uvs4),this.uvs5&&e(Si.UV5Kind,this.uvs5),this.uvs6&&e(Si.UV6Kind,this.uvs6),this.colors&&e(Si.ColorKind,this.colors),this.matricesIndices&&e(Si.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&e(Si.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&e(Si.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&e(Si.MatricesWeightsExtraKind,this.matricesWeightsExtra)},Di.prototype.serialize=function(){var e=this.serialize();return this.positions&&(e.positions=this.positions),this.normals&&(e.normals=this.normals),this.tangents&&(e.tangents=this.tangents),this.uvs&&(e.uvs=this.uvs),this.uvs2&&(e.uvs2=this.uvs2),this.uvs3&&(e.uvs3=this.uvs3),this.uvs4&&(e.uvs4=this.uvs4),this.uvs5&&(e.uvs5=this.uvs5),this.uvs6&&(e.uvs6=this.uvs6),this.colors&&(e.colors=this.colors),this.matricesIndices&&(e.matricesIndices=this.matricesIndices,e.matricesIndices._isExpanded=!0),this.matricesWeights&&(e.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(e.matricesIndicesExtra=this.matricesIndicesExtra,e.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(e.matricesWeightsExtra=this.matricesWeightsExtra),e.indices=this.indices,e},Di.ExtractFromMesh=function(e,t,i){return Di._ExtractFrom(e,t,i)},Di.ExtractFromGeometry=function(e,t,i){return Di._ExtractFrom(e,t,i)},Di._ExtractFrom=function(e,t,i){var r=new Di;return e.isVerticesDataPresent(Si.PositionKind)&&(r.positions=e.getVerticesData(Si.PositionKind,t,i)),e.isVerticesDataPresent(Si.NormalKind)&&(r.normals=e.getVerticesData(Si.NormalKind,t,i)),e.isVerticesDataPresent(Si.TangentKind)&&(r.tangents=e.getVerticesData(Si.TangentKind,t,i)),e.isVerticesDataPresent(Si.UVKind)&&(r.uvs=e.getVerticesData(Si.UVKind,t,i)),e.isVerticesDataPresent(Si.UV2Kind)&&(r.uvs2=e.getVerticesData(Si.UV2Kind,t,i)),e.isVerticesDataPresent(Si.UV3Kind)&&(r.uvs3=e.getVerticesData(Si.UV3Kind,t,i)),e.isVerticesDataPresent(Si.UV4Kind)&&(r.uvs4=e.getVerticesData(Si.UV4Kind,t,i)),e.isVerticesDataPresent(Si.UV5Kind)&&(r.uvs5=e.getVerticesData(Si.UV5Kind,t,i)),e.isVerticesDataPresent(Si.UV6Kind)&&(r.uvs6=e.getVerticesData(Si.UV6Kind,t,i)),e.isVerticesDataPresent(Si.ColorKind)&&(r.colors=e.getVerticesData(Si.ColorKind,t,i)),e.isVerticesDataPresent(Si.MatricesIndicesKind)&&(r.matricesIndices=e.getVerticesData(Si.MatricesIndicesKind,t,i)),e.isVerticesDataPresent(Si.MatricesWeightsKind)&&(r.matricesWeights=e.getVerticesData(Si.MatricesWeightsKind,t,i)),e.isVerticesDataPresent(Si.MatricesIndicesExtraKind)&&(r.matricesIndicesExtra=e.getVerticesData(Si.MatricesIndicesExtraKind,t,i)),e.isVerticesDataPresent(Si.MatricesWeightsExtraKind)&&(r.matricesWeightsExtra=e.getVerticesData(Si.MatricesWeightsExtraKind,t,i)),r.indices=e.getIndices(t,i),r},Di.CreateRibbon=function(e){throw S.WarnImport("ribbonBuilder")},Di.CreateBox=function(e){throw S.WarnImport("boxBuilder")},Di.CreateTiledBox=function(e){throw S.WarnImport("tiledBoxBuilder")},Di.CreateTiledPlane=function(e){throw S.WarnImport("tiledPlaneBuilder")},Di.CreateSphere=function(e){throw S.WarnImport("sphereBuilder")},Di.CreateCylinder=function(e){throw S.WarnImport("cylinderBuilder")},Di.CreateTorus=function(e){throw S.WarnImport("torusBuilder")},Di.CreateLineSystem=function(e){throw S.WarnImport("linesBuilder")},Di.CreateDashedLines=function(e){throw S.WarnImport("linesBuilder")},Di.CreateGround=function(e){throw S.WarnImport("groundBuilder")},Di.CreateTiledGround=function(e){throw S.WarnImport("groundBuilder")},Di.CreateGroundFromHeightMap=function(e){throw S.WarnImport("groundBuilder")},Di.CreatePlane=function(e){throw S.WarnImport("planeBuilder")},Di.CreateDisc=function(e){throw S.WarnImport("discBuilder")},Di.CreatePolygon=function(e,t,i,r,n,o){throw S.WarnImport("polygonBuilder")},Di.CreateIcoSphere=function(e){throw S.WarnImport("icoSphereBuilder")},Di.CreatePolyhedron=function(e){throw S.WarnImport("polyhedronBuilder")},Di.CreateTorusKnot=function(e){throw S.WarnImport("torusKnotBuilder")},Di.ComputeNormals=function(e,t,i,r){var n,o=0,s=0,a=0,h=0,l=0,u=0,c=0,d=0,f=0,p=!1,_=!1,g=!1,m=!1,v=1,y=0,b=null;r&&(p=!!r.facetNormals,_=!!r.facetPositions,g=!!r.facetPartitioning,v=!0===r.useRightHandedSystem?-1:1,y=r.ratio||0,m=!!r.depthSort,b=r.distanceTo,m&&(void 0===b&&(b=te.Zero()),n=r.depthSortedFacets));var T,x,E,A,M,C,P,O,S,I,R,D,w,L,F,N,B,k=0,U=0,V=0,z=0;for(g&&r&&r.bbSize&&(N=F=L=w=D=R=I=S=O=P=C=M=A=E=x=T=0,B=(B=r.bbSize.x>r.bbSize.y?r.bbSize.x:r.bbSize.y)>r.bbSize.z?B:r.bbSize.z,k=r.subDiv.X*y/r.bbSize.x,U=r.subDiv.Y*y/r.bbSize.y,V=r.subDiv.Z*y/r.bbSize.z,z=r.subDiv.max*r.subDiv.max,r.facetPartitioning.length=0),o=0;o<e.length;o++)i[o]=0;for(var W=t.length/3|0,o=0;o<W;o++){var G,X=1+(c=3*t[3*o]),H=2+c,j=1+(d=3*t[3*o+1]),K=2+d,Y=1+(f=3*t[3*o+2]),q=2+f,Z=e[c]-e[d],Q=e[X]-e[j],J=e[H]-e[K],$=e[f]-e[d],ee=e[Y]-e[j],a=v*(Q*(s=e[q]-e[K])-J*ee),h=v*(J*$-Z*s),l=v*(Z*ee-Q*$);a/=u=0===(u=Math.sqrt(a*a+h*h+l*l))?1:u,h/=u,l/=u,p&&r&&(r.facetNormals[o].x=a,r.facetNormals[o].y=h,r.facetNormals[o].z=l),_&&r&&(r.facetPositions[o].x=(e[c]+e[d]+e[f])/3,r.facetPositions[o].y=(e[X]+e[j]+e[Y])/3,r.facetPositions[o].z=(e[H]+e[K]+e[q])/3),g&&r&&(T=Math.floor((r.facetPositions[o].x-r.bInfo.minimum.x*y)*k),x=Math.floor((r.facetPositions[o].y-r.bInfo.minimum.y*y)*U),E=Math.floor((r.facetPositions[o].z-r.bInfo.minimum.z*y)*V),A=Math.floor((e[c]-r.bInfo.minimum.x*y)*k),M=Math.floor((e[X]-r.bInfo.minimum.y*y)*U),C=Math.floor((e[H]-r.bInfo.minimum.z*y)*V),P=Math.floor((e[d]-r.bInfo.minimum.x*y)*k),O=Math.floor((e[j]-r.bInfo.minimum.y*y)*U),S=Math.floor((e[K]-r.bInfo.minimum.z*y)*V),I=Math.floor((e[f]-r.bInfo.minimum.x*y)*k),R=Math.floor((e[Y]-r.bInfo.minimum.y*y)*U),D=Math.floor((e[q]-r.bInfo.minimum.z*y)*V),L=A+r.subDiv.max*M+z*C,F=P+r.subDiv.max*O+z*S,N=I+r.subDiv.max*R+z*D,w=T+r.subDiv.max*x+z*E,r.facetPartitioning[w]=r.facetPartitioning[w]?r.facetPartitioning[w]:new Array,r.facetPartitioning[L]=r.facetPartitioning[L]?r.facetPartitioning[L]:new Array,r.facetPartitioning[F]=r.facetPartitioning[F]?r.facetPartitioning[F]:new Array,r.facetPartitioning[N]=r.facetPartitioning[N]?r.facetPartitioning[N]:new Array,r.facetPartitioning[L].push(o),F!=L&&r.facetPartitioning[F].push(o),N!=F&&N!=L&&r.facetPartitioning[N].push(o),w!=L&&w!=F&&w!=N&&r.facetPartitioning[w].push(o)),m&&r&&r.facetPositions&&((G=n[o]).ind=3*o,G.sqDistance=te.DistanceSquared(r.facetPositions[o],b)),i[c]+=a,i[X]+=h,i[H]+=l,i[d]+=a,i[j]+=h,i[K]+=l,i[f]+=a,i[Y]+=h,i[q]+=l}for(o=0;o<i.length/3;o++)a=i[3*o],h=i[3*o+1],l=i[3*o+2],a/=u=0===(u=Math.sqrt(a*a+h*h+l*l))?1:u,h/=u,l/=u,i[3*o]=a,i[3*o+1]=h,i[3*o+2]=l},Di._ComputeSides=function(e,t,i,r,n,o,s){var a,h=i.length,l=r.length;switch(e=e||Di.DEFAULTSIDE){case Di.FRONTSIDE:break;case Di.BACKSIDE:for(var u,c=0;c<h;c+=3)u=i[c],i[c]=i[c+2],i[c+2]=u;for(a=0;a<l;a++)r[a]=-r[a];break;case Di.DOUBLESIDE:for(var d=t.length,f=d/3,p=0;p<d;p++)t[d+p]=t[p];for(c=0;c<h;c+=3)i[c+h]=i[c+2]+f,i[c+1+h]=i[c+1]+f,i[c+2+h]=i[c]+f;for(a=0;a<l;a++)r[l+a]=-r[a];for(var _=n.length,g=0,g=0;g<_;g++)n[g+_]=n[g];for(o=o||new j(0,0,1,1),s=s||new j(0,0,1,1),c=g=0;c<_/2;c++)n[g]=o.x+(o.z-o.x)*n[g],n[g+1]=o.y+(o.w-o.y)*n[g+1],n[g+_]=s.x+(s.z-s.x)*n[g+_],n[g+_+1]=s.y+(s.w-s.y)*n[g+_+1],g+=2}},Di.ImportVertexData=function(e,t){var i=new Di,r=e.positions;r&&i.set(r,Si.PositionKind);var n=e.normals;n&&i.set(n,Si.NormalKind);var o=e.tangents;o&&i.set(o,Si.TangentKind);var s=e.uvs;s&&i.set(s,Si.UVKind);var a=e.uv2s;a&&i.set(a,Si.UV2Kind);var h=e.uv3s;h&&i.set(h,Si.UV3Kind);var l=e.uv4s;l&&i.set(l,Si.UV4Kind);var u=e.uv5s;u&&i.set(u,Si.UV5Kind);var c=e.uv6s;c&&i.set(c,Si.UV6Kind);var d=e.colors;d&&i.set(K.CheckColors4(d,r.length/3),Si.ColorKind);var f=e.matricesIndices;f&&i.set(f,Si.MatricesIndicesKind);var p=e.matricesWeights;p&&i.set(p,Si.MatricesWeightsKind);var _=e.indices;_&&(i.indices=_),t.setAllVerticesData(i,e.updatable)},Di.FRONTSIDE=0,Di.BACKSIDE=1,Di.DOUBLESIDE=2,Di.DEFAULTSIDE=0,Di);function Di(){}var wi=(Li.prototype.getNormal=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(Si.NormalKind))return null;var i,r,n,o,s,a,h,l,u,c,d,f,p=this.pickedMesh.getIndices();return p?(s=t?(i=this.pickedMesh.getVerticesData(Si.NormalKind),r=te.FromArray(i,3*p[3*this.faceId]),n=te.FromArray(i,3*p[3*this.faceId+1]),o=te.FromArray(i,3*p[3*this.faceId+2]),r=r.scale(this.bu),n=n.scale(this.bv),o=o.scale(1-this.bu-this.bv),new te(r.x+n.x+o.x,r.y+n.y+o.y,r.z+n.z+o.z)):(a=this.pickedMesh.getVerticesData(Si.PositionKind),h=te.FromArray(a,3*p[3*this.faceId]),l=te.FromArray(a,3*p[3*this.faceId+1]),u=te.FromArray(a,3*p[3*this.faceId+2]),c=h.subtract(l),d=u.subtract(l),te.Cross(c,d)),e&&(f=this.pickedMesh.getWorldMatrix(),this.pickedMesh.nonUniformScaling&&(P.Matrix[0].copyFrom(f),(f=P.Matrix[0]).setTranslationFromFloats(0,0,0),f.invert(),f.transposeToRef(P.Matrix[1]),f=P.Matrix[1]),s=te.TransformNormal(s,f)),s.normalize(),s):null},Li.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(Si.UVKind))return null;var e=this.pickedMesh.getIndices();if(!e)return null;var t=this.pickedMesh.getVerticesData(Si.UVKind);if(!t)return null;var i=H.FromArray(t,2*e[3*this.faceId]),r=H.FromArray(t,2*e[3*this.faceId+1]),n=H.FromArray(t,2*e[3*this.faceId+2]),i=i.scale(this.bu),r=r.scale(this.bv),n=n.scale(1-this.bu-this.bv);return new H(i.x+r.x+n.x,i.y+r.y+n.y)},Li);function Li(){this._pickingUnavailable=!1,this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshId=0,this.pickedSprite=null,this.originMesh=null,this.ray=null}var Fi=(Ni.prototype.reConstruct=function(e,t,i){var r=e.x,n=e.y,o=e.z,s=t.x,a=t.y,h=t.z,l=this.vectors;this.minimum.copyFromFloats(r,n,o),this.maximum.copyFromFloats(s,a,h),l[0].copyFromFloats(r,n,o),l[1].copyFromFloats(s,a,h),l[2].copyFromFloats(s,n,o),l[3].copyFromFloats(r,a,o),l[4].copyFromFloats(r,n,h),l[5].copyFromFloats(s,a,o),l[6].copyFromFloats(r,a,h),l[7].copyFromFloats(s,n,h),t.addToRef(e,this.center).scaleInPlace(.5),t.subtractToRef(e,this.extendSize).scaleInPlace(.5),this._worldMatrix=i||W.IdentityReadOnly,this._update(this._worldMatrix)},Ni.prototype.scale=function(e){var t=Ni.TmpVector3,i=this.maximum.subtractToRef(this.minimum,t[0]),r=i.length();i.normalizeFromLength(r);var n=r*e,o=i.scaleInPlace(.5*n),s=this.center.subtractToRef(o,t[1]),a=this.center.addToRef(o,t[2]);return this.reConstruct(s,a,this._worldMatrix),this},Ni.prototype.getWorldMatrix=function(){return this._worldMatrix},Ni.prototype._update=function(e){var t=this.minimumWorld,i=this.maximumWorld,r=this.directions,n=this.vectorsWorld,o=this.vectors;if(e.isIdentity()){for(t.copyFrom(this.minimum),i.copyFrom(this.maximum),s=0;s<8;++s)n[s].copyFrom(o[s]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{t.setAll(Number.MAX_VALUE),i.setAll(-Number.MAX_VALUE);for(var s=0;s<8;++s){var a=n[s];te.TransformCoordinatesToRef(o[s],e,a),t.minimizeInPlace(a),i.maximizeInPlace(a)}i.subtractToRef(t,this.extendSizeWorld).scaleInPlace(.5),i.addToRef(t,this.centerWorld).scaleInPlace(.5)}te.FromArrayToRef(e.m,0,r[0]),te.FromArrayToRef(e.m,4,r[1]),te.FromArrayToRef(e.m,8,r[2]),this._worldMatrix=e},Ni.prototype.isInFrustum=function(e){return Ni.IsInFrustum(this.vectorsWorld,e)},Ni.prototype.isCompletelyInFrustum=function(e){return Ni.IsCompletelyInFrustum(this.vectorsWorld,e)},Ni.prototype.intersectsPoint=function(e){var t=this.minimumWorld,i=this.maximumWorld,r=t.x,n=t.y,o=t.z,s=i.x,a=i.y,h=i.z,l=e.x,u=e.y,c=e.z,d=-C;return!(s-l<d||l-r<d||a-u<d||u-n<d||h-c<d||c-o<d)},Ni.prototype.intersectsSphere=function(e){return Ni.IntersectsSphere(this.minimumWorld,this.maximumWorld,e.centerWorld,e.radiusWorld)},Ni.prototype.intersectsMinMax=function(e,t){var i=this.minimumWorld,r=this.maximumWorld,n=i.x,o=i.y,s=i.z,a=r.x,h=r.y,l=r.z,u=e.x,c=e.y,d=e.z,f=t.x,p=t.y,_=t.z;return!(a<u||f<n||h<c||p<o||l<d||_<s)},Ni.Intersects=function(e,t){return e.intersectsMinMax(t.minimumWorld,t.maximumWorld)},Ni.IntersectsSphere=function(e,t,i,r){var n=Ni.TmpVector3[0];return te.ClampToRef(i,e,t,n),te.DistanceSquared(i,n)<=r*r},Ni.IsCompletelyInFrustum=function(e,t){for(var i=0;i<6;++i)for(var r=t[i],n=0;n<8;++n)if(r.dotCoordinate(e[n])<0)return!1;return!0},Ni.IsInFrustum=function(e,t){for(var i=0;i<6;++i){for(var r=!0,n=t[i],o=0;o<8;++o)if(0<=n.dotCoordinate(e[o])){r=!1;break}if(r)return!1}return!0},Ni.TmpVector3=p.BuildArray(3,te.Zero),Ni);function Ni(e,t,i){this.vectors=p.BuildArray(8,te.Zero),this.center=te.Zero(),this.centerWorld=te.Zero(),this.extendSize=te.Zero(),this.extendSizeWorld=te.Zero(),this.directions=p.BuildArray(3,te.Zero),this.vectorsWorld=p.BuildArray(8,te.Zero),this.minimumWorld=te.Zero(),this.maximumWorld=te.Zero(),this.minimum=te.Zero(),this.maximum=te.Zero(),this.reConstruct(e,t,i)}var Bi=(ki.prototype.reConstruct=function(e,t,i){this.minimum.copyFrom(e),this.maximum.copyFrom(t);var r=te.Distance(e,t);t.addToRef(e,this.center).scaleInPlace(.5),this.radius=.5*r,this._update(i||W.IdentityReadOnly)},ki.prototype.scale=function(e){var t=this.radius*e,i=ki.TmpVector3,r=i[0].setAll(t),n=this.center.subtractToRef(r,i[1]),o=this.center.addToRef(r,i[2]);return this.reConstruct(n,o,this._worldMatrix),this},ki.prototype.getWorldMatrix=function(){return this._worldMatrix},ki.prototype._update=function(e){var t;e.isIdentity()?(this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius):(te.TransformCoordinatesToRef(this.center,e,this.centerWorld),t=ki.TmpVector3[0],te.TransformNormalFromFloatsToRef(1,1,1,e,t),this.radiusWorld=Math.max(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z))*this.radius)},ki.prototype.isInFrustum=function(e){for(var t=this.centerWorld,i=this.radiusWorld,r=0;r<6;r++)if(e[r].dotCoordinate(t)<=-i)return!1;return!0},ki.prototype.isCenterInFrustum=function(e){for(var t=this.centerWorld,i=0;i<6;i++)if(e[i].dotCoordinate(t)<0)return!1;return!0},ki.prototype.intersectsPoint=function(e){var t=te.DistanceSquared(this.centerWorld,e);return!(this.radiusWorld*this.radiusWorld<t)},ki.Intersects=function(e,t){var i=te.DistanceSquared(e.centerWorld,t.centerWorld),r=e.radiusWorld+t.radiusWorld;return!(r*r<i)},ki.TmpVector3=p.BuildArray(3,te.Zero),ki);function ki(e,t,i){this.center=te.Zero(),this.centerWorld=te.Zero(),this.minimum=te.Zero(),this.maximum=te.Zero(),this.reConstruct(e,t,i)}function Ui(e,t,i){var r=te.Dot(t.centerWorld,e),n=Math.abs(te.Dot(t.directions[0],e))*t.extendSize.x+Math.abs(te.Dot(t.directions[1],e))*t.extendSize.y+Math.abs(te.Dot(t.directions[2],e))*t.extendSize.z;i.min=r-n,i.max=r+n}function Vi(e,t,i){return Ui(e,t,zi),Ui(e,i,Wi),!(Wi.max<zi.min||zi.max<Wi.min)}var zi={min:0,max:0},Wi={min:0,max:0},Gi=(Xi.prototype.reConstruct=function(e,t,i){this.boundingBox.reConstruct(e,t,i),this.boundingSphere.reConstruct(e,t,i)},Object.defineProperty(Xi.prototype,"minimum",{get:function(){return this.boundingBox.minimum},enumerable:!0,configurable:!0}),Object.defineProperty(Xi.prototype,"maximum",{get:function(){return this.boundingBox.maximum},enumerable:!0,configurable:!0}),Object.defineProperty(Xi.prototype,"isLocked",{get:function(){return this._isLocked},set:function(e){this._isLocked=e},enumerable:!0,configurable:!0}),Xi.prototype.update=function(e){this._isLocked||(this.boundingBox._update(e),this.boundingSphere._update(e))},Xi.prototype.centerOn=function(e,t){var i=Xi.TmpVector3[0].copyFrom(e).subtractInPlace(t),r=Xi.TmpVector3[1].copyFrom(e).addInPlace(t);return this.boundingBox.reConstruct(i,r,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(i,r,this.boundingBox.getWorldMatrix()),this},Xi.prototype.scale=function(e){return this.boundingBox.scale(e),this.boundingSphere.scale(e),this},Xi.prototype.isInFrustum=function(e,t){return void 0===t&&(t=0),!(2!==t&&3!==t||!this.boundingSphere.isCenterInFrustum(e))||!!this.boundingSphere.isInFrustum(e)&&(1===t||3===t||this.boundingBox.isInFrustum(e))},Object.defineProperty(Xi.prototype,"diagonalLength",{get:function(){var e=this.boundingBox;return e.maximumWorld.subtractToRef(e.minimumWorld,Xi.TmpVector3[0]).length()},enumerable:!0,configurable:!0}),Xi.prototype.isCompletelyInFrustum=function(e){return this.boundingBox.isCompletelyInFrustum(e)},Xi.prototype._checkCollision=function(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},Xi.prototype.intersectsPoint=function(e){return!!this.boundingSphere.centerWorld&&!!this.boundingSphere.intersectsPoint(e)&&!!this.boundingBox.intersectsPoint(e)},Xi.prototype.intersects=function(e,t){if(!Bi.Intersects(this.boundingSphere,e.boundingSphere))return!1;if(!Fi.Intersects(this.boundingBox,e.boundingBox))return!1;if(!t)return!0;var i=this.boundingBox,r=e.boundingBox;return!!(Vi(i.directions[0],i,r)&&Vi(i.directions[1],i,r)&&Vi(i.directions[2],i,r)&&Vi(r.directions[0],i,r)&&Vi(r.directions[1],i,r)&&Vi(r.directions[2],i,r)&&Vi(te.Cross(i.directions[0],r.directions[0]),i,r)&&Vi(te.Cross(i.directions[0],r.directions[1]),i,r)&&Vi(te.Cross(i.directions[0],r.directions[2]),i,r)&&Vi(te.Cross(i.directions[1],r.directions[0]),i,r)&&Vi(te.Cross(i.directions[1],r.directions[1]),i,r)&&Vi(te.Cross(i.directions[1],r.directions[2]),i,r)&&Vi(te.Cross(i.directions[2],r.directions[0]),i,r)&&Vi(te.Cross(i.directions[2],r.directions[1]),i,r)&&Vi(te.Cross(i.directions[2],r.directions[2]),i,r))},Xi.TmpVector3=p.BuildArray(2,te.Zero),Xi);function Xi(e,t,i){this._isLocked=!1,this.boundingBox=new Fi(e,t,i),this.boundingSphere=new Bi(e,t,i)}var Hi=function(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._collider=null,this._oldPositionForCollisions=new te(0,0,0),this._diffPositionForCollisions=new te(0,0,0)};function ji(e,t,i,r,n){void 0===r&&(r=null);for(var o=new te(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new te(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),a=t,h=t*(n=n||3);a<t+i;a++,h+=n){var l=e[h],u=e[h+1],c=e[h+2];o.minimizeInPlaceFromFloats(l,u,c),s.maximizeInPlaceFromFloats(l,u,c)}return r&&(o.x-=o.x*r.x+r.y,o.y-=o.y*r.x+r.y,o.z-=o.z*r.x+r.y,s.x+=s.x*r.x+r.y,s.y+=s.y*r.x+r.y,s.z+=s.z*r.x+r.y),{minimum:o,maximum:s}}var Ki,Yi=function(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=te.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1},qi=function(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new Yi,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1},Zi=(n(Qi,Ki=gi),Object.defineProperty(Qi,"BILLBOARDMODE_NONE",{get:function(){return gi.BILLBOARDMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(Qi,"BILLBOARDMODE_X",{get:function(){return gi.BILLBOARDMODE_X},enumerable:!0,configurable:!0}),Object.defineProperty(Qi,"BILLBOARDMODE_Y",{get:function(){return gi.BILLBOARDMODE_Y},enumerable:!0,configurable:!0}),Object.defineProperty(Qi,"BILLBOARDMODE_Z",{get:function(){return gi.BILLBOARDMODE_Z},enumerable:!0,configurable:!0}),Object.defineProperty(Qi,"BILLBOARDMODE_ALL",{get:function(){return gi.BILLBOARDMODE_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(Qi,"BILLBOARDMODE_USE_POSITION",{get:function(){return gi.BILLBOARDMODE_USE_POSITION},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"facetNb",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetNb},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"partitioningSubdivisions",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions},set:function(e){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=e},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"partitioningBBoxRatio",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio},set:function(e){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=e},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"mustDepthSortFacets",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort},set:function(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=e},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"facetDepthSortFrom",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom},set:function(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=e},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"isFacetDataEnabled",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled},enumerable:!0,configurable:!0}),Qi.prototype._updateNonUniformScalingState=function(e){return!!Ki.prototype._updateNonUniformScalingState.call(this,e)&&(this._markSubMeshesAsMiscDirty(),!0)},Object.defineProperty(Qi.prototype,"onCollide",{set:function(e){this._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._meshCollisionData._onCollideObserver),this._meshCollisionData._onCollideObserver=this.onCollideObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"onCollisionPositionChange",{set:function(e){this._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._meshCollisionData._onCollisionPositionChangeObserver),this._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"visibility",{get:function(){return this._internalAbstractMeshDataInfo._visibility},set:function(e){this._internalAbstractMeshDataInfo._visibility!==e&&(this._internalAbstractMeshDataInfo._visibility=e,this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"material",{get:function(){return this._material},set:function(e){this._material!==e&&(this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),(this._material=e)&&e.meshMap&&(e.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&this._unBindEffect())},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"receiveShadows",{get:function(){return this._internalAbstractMeshDataInfo._receiveShadows},set:function(e){this._internalAbstractMeshDataInfo._receiveShadows!==e&&(this._internalAbstractMeshDataInfo._receiveShadows=e,this._markSubMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"hasVertexAlpha",{get:function(){return this._internalAbstractMeshDataInfo._hasVertexAlpha},set:function(e){this._internalAbstractMeshDataInfo._hasVertexAlpha!==e&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=e,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"useVertexColors",{get:function(){return this._internalAbstractMeshDataInfo._useVertexColors},set:function(e){this._internalAbstractMeshDataInfo._useVertexColors!==e&&(this._internalAbstractMeshDataInfo._useVertexColors=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"numBoneInfluencers",{get:function(){return this._internalAbstractMeshDataInfo._numBoneInfluencers},set:function(e){this._internalAbstractMeshDataInfo._numBoneInfluencers!==e&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"applyFog",{get:function(){return this._internalAbstractMeshDataInfo._applyFog},set:function(e){this._internalAbstractMeshDataInfo._applyFog!==e&&(this._internalAbstractMeshDataInfo._applyFog=e,this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"layerMask",{get:function(){return this._internalAbstractMeshDataInfo._layerMask},set:function(e){e!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=e,this._resyncLightSources())},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"collisionMask",{get:function(){return this._meshCollisionData._collisionMask},set:function(e){this._meshCollisionData._collisionMask=isNaN(e)?-1:e},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"collisionGroup",{get:function(){return this._meshCollisionData._collisionGroup},set:function(e){this._meshCollisionData._collisionGroup=isNaN(e)?-1:e},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"lightSources",{get:function(){return this._lightSources},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"_positions",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"skeleton",{get:function(){return this._internalAbstractMeshDataInfo._skeleton},set:function(e){var t=this._internalAbstractMeshDataInfo._skeleton;t&&t.needInitialSkinMatrix&&t._unregisterMeshWithPoseMatrix(this),e&&e.needInitialSkinMatrix&&e._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=e,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()},enumerable:!0,configurable:!0}),Qi.prototype.getClassName=function(){return"AbstractMesh"},Qi.prototype.toString=function(e){var t="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");t+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);var i=this._internalAbstractMeshDataInfo._skeleton;return i&&(t+=", skeleton: "+i.name),e&&(t+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],t+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),t},Qi.prototype._getEffectiveParent=function(){return this._masterMesh&&this.billboardMode!==gi.BILLBOARDMODE_NONE?this._masterMesh:Ki.prototype._getEffectiveParent.call(this)},Qi.prototype._getActionManagerForTrigger=function(e,t){if(void 0===t&&(t=!0),this.actionManager&&(t||this.actionManager.isRecursive)){if(!e)return this.actionManager;if(this.actionManager.hasSpecificTrigger(e))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(e,!1):null},Qi.prototype._rebuild=function(){if(this.onRebuildObservable.notifyObservers(this),this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes)for(var e=0,t=this.subMeshes;e<t.length;e++)t[e]._rebuild()},Qi.prototype._resyncLightSources=function(){for(var e=this._lightSources.length=0,t=this.getScene().lights;e<t.length;e++){var i=t[e];i.isEnabled()&&i.canAffectMesh(this)&&this._lightSources.push(i)}this._markSubMeshesAsLightDirty()},Qi.prototype._resyncLightSource=function(e){var t=e.isEnabled()&&e.canAffectMesh(this),i=this._lightSources.indexOf(e);if(-1===i){if(!t)return;this._lightSources.push(e)}else{if(t)return;this._lightSources.splice(i,1)}this._markSubMeshesAsLightDirty()},Qi.prototype._unBindEffect=function(){for(var e=0,t=this.subMeshes;e<t.length;e++)t[e].setEffect(null)},Qi.prototype._removeLightSource=function(e,t){var i=this._lightSources.indexOf(e);-1!==i&&(this._lightSources.splice(i,1),this._markSubMeshesAsLightDirty(t))},Qi.prototype._markSubMeshesAsDirty=function(e){if(this.subMeshes)for(var t=0,i=this.subMeshes;t<i.length;t++){var r=i[t];r._materialDefines&&e(r._materialDefines)}},Qi.prototype._markSubMeshesAsLightDirty=function(t){void 0===t&&(t=!1),this._markSubMeshesAsDirty(function(e){return e.markAsLightDirty(t)})},Qi.prototype._markSubMeshesAsAttributesDirty=function(){this._markSubMeshesAsDirty(function(e){return e.markAsAttributesDirty()})},Qi.prototype._markSubMeshesAsMiscDirty=function(){if(this.subMeshes)for(var e=0,t=this.subMeshes;e<t.length;e++){var i=t[e].getMaterial();i&&i.markAsDirty(16)}},Object.defineProperty(Qi.prototype,"scaling",{get:function(){return this._scaling},set:function(e){this._scaling=e},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"isBlocked",{get:function(){return!1},enumerable:!0,configurable:!0}),Qi.prototype.getLOD=function(e){return this},Qi.prototype.getTotalVertices=function(){return 0},Qi.prototype.getTotalIndices=function(){return 0},Qi.prototype.getIndices=function(){return null},Qi.prototype.getVerticesData=function(e){return null},Qi.prototype.setVerticesData=function(e,t,i,r){return this},Qi.prototype.updateVerticesData=function(e,t,i,r){return this},Qi.prototype.setIndices=function(e,t){return this},Qi.prototype.isVerticesDataPresent=function(e){return!1},Qi.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},Qi.prototype.normalizeToUnitCube=function(e,t,i){return void 0===e&&(e=!0),void 0===t&&(t=!1),Ki.prototype.normalizeToUnitCube.call(this,e,t,i)},Qi.prototype.setBoundingInfo=function(e){return this._boundingInfo=e,this},Object.defineProperty(Qi.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(Si.MatricesIndicesKind)&&this.isVerticesDataPresent(Si.MatricesWeightsKind)},enumerable:!0,configurable:!0}),Qi.prototype._preActivate=function(){},Qi.prototype._preActivateForIntermediateRendering=function(e){},Qi.prototype._activate=function(e,t){return this._renderId=e,!0},Qi.prototype._postActivate=function(){},Qi.prototype._freeze=function(){},Qi.prototype._unFreeze=function(){},Qi.prototype.getWorldMatrix=function(){return this._masterMesh&&this.billboardMode===gi.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():Ki.prototype.getWorldMatrix.call(this)},Qi.prototype._getWorldMatrixDeterminant=function(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():Ki.prototype._getWorldMatrixDeterminant.call(this)},Object.defineProperty(Qi.prototype,"isAnInstance",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"hasInstances",{get:function(){return!1},enumerable:!0,configurable:!0}),Qi.prototype.movePOV=function(e,t,i){return this.position.addInPlace(this.calcMovePOV(e,t,i)),this},Qi.prototype.calcMovePOV=function(e,t,i){var r=new W;(this.rotationQuaternion?this.rotationQuaternion:x.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(r);var n=te.Zero(),o=this.definedFacingForward?-1:1;return te.TransformCoordinatesFromFloatsToRef(e*o,t,i*o,r,n),n},Qi.prototype.rotatePOV=function(e,t,i){return this.rotation.addInPlace(this.calcRotatePOV(e,t,i)),this},Qi.prototype.calcRotatePOV=function(e,t,i){var r=this.definedFacingForward?1:-1;return new te(e*r,t,i*r)},Qi.prototype.refreshBoundingInfo=function(e){return void 0===e&&(e=!1),this._boundingInfo&&this._boundingInfo.isLocked||this._refreshBoundingInfo(this._getPositionData(e),null),this},Qi.prototype._refreshBoundingInfo=function(e,t){var i;if(e&&(i=ji(e,0,this.getTotalVertices(),t),this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new Gi(i.minimum,i.maximum)),this.subMeshes)for(var r=0;r<this.subMeshes.length;r++)this.subMeshes[r].refreshBoundingInfo(e);this._updateBoundingInfo()},Qi.prototype._getPositionData=function(e){var t=this.getVerticesData(Si.PositionKind);if(t&&e&&this.skeleton){t=ri.Slice(t),this._generatePointsArray();var i=this.getVerticesData(Si.MatricesIndicesKind),r=this.getVerticesData(Si.MatricesWeightsKind);if(r&&i){var n=4<this.numBoneInfluencers,o=n?this.getVerticesData(Si.MatricesIndicesExtraKind):null,s=n?this.getVerticesData(Si.MatricesWeightsExtraKind):null;this.skeleton.prepare();for(var a,h,l=this.skeleton.getTransformMatrices(this),u=P.Vector3[0],c=P.Matrix[0],d=P.Matrix[1],f=0,p=0;p<t.length;p+=3,f+=4){for(c.reset(),a=0;a<4;a++)0<(h=r[f+a])&&(W.FromFloat32ArrayToRefScaled(l,Math.floor(16*i[f+a]),h,d),c.addToSelf(d));if(n)for(a=0;a<4;a++)0<(h=s[f+a])&&(W.FromFloat32ArrayToRefScaled(l,Math.floor(16*o[f+a]),h,d),c.addToSelf(d));te.TransformCoordinatesFromFloatsToRef(t[p],t[p+1],t[p+2],c,u),u.toArray(t,p),this._positions&&this._positions[p/3].copyFrom(u)}}}return t},Qi.prototype._updateBoundingInfo=function(){var e=this._effectiveMesh;return this._boundingInfo?this._boundingInfo.update(e.worldMatrixFromCache):this._boundingInfo=new Gi(this.absolutePosition,this.absolutePosition,e.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(e.worldMatrixFromCache),this},Qi.prototype._updateSubMeshesBoundingInfo=function(e){if(!this.subMeshes)return this;for(var t=this.subMeshes.length,i=0;i<t;i++){var r=this.subMeshes[i];(1<t||!r.IsGlobal)&&r.updateBoundingInfo(e)}return this},Qi.prototype._afterComputeWorldMatrix=function(){this.doNotSyncBoundingInfo||this._updateBoundingInfo()},Object.defineProperty(Qi.prototype,"_effectiveMesh",{get:function(){return this.skeleton&&this.skeleton.overrideMesh||this},enumerable:!0,configurable:!0}),Qi.prototype.isInFrustum=function(e){return null!==this._boundingInfo&&this._boundingInfo.isInFrustum(e,this.cullingStrategy)},Qi.prototype.isCompletelyInFrustum=function(e){return null!==this._boundingInfo&&this._boundingInfo.isCompletelyInFrustum(e)},Qi.prototype.intersectsMesh=function(e,t,i){if(void 0===t&&(t=!1),!this._boundingInfo||!e._boundingInfo)return!1;if(this._boundingInfo.intersects(e._boundingInfo,t))return!0;if(i)for(var r=0,n=this.getChildMeshes();r<n.length;r++)if(n[r].intersectsMesh(e,t,!0))return!0;return!1},Qi.prototype.intersectsPoint=function(e){return!!this._boundingInfo&&this._boundingInfo.intersectsPoint(e)},Object.defineProperty(Qi.prototype,"checkCollisions",{get:function(){return this._meshCollisionData._checkCollisions},set:function(e){this._meshCollisionData._checkCollisions=e},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"collider",{get:function(){return this._meshCollisionData._collider},enumerable:!0,configurable:!0}),Qi.prototype.moveWithCollisions=function(e){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._meshCollisionData._oldPositionForCollisions);var t=this.getScene().collisionCoordinator;return this._meshCollisionData._collider||(this._meshCollisionData._collider=t.createCollider()),this._meshCollisionData._collider._radius=this.ellipsoid,t.getNewPosition(this._meshCollisionData._oldPositionForCollisions,e,this._meshCollisionData._collider,3,this,this._onCollisionPositionChange,this.uniqueId),this},Qi.prototype._collideForSubMesh=function(e,t,i){if(this._generatePointsArray(),!this._positions)return this;if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(t)){e._lastColliderTransformMatrix=t.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];for(var r=e.verticesStart,n=e.verticesStart+e.verticesCount,o=r;o<n;o++)e._lastColliderWorldVertices.push(te.TransformCoordinates(this._positions[o],t))}return i._collide(e._trianglePlanes,e._lastColliderWorldVertices,this.getIndices(),e.indexStart,e.indexStart+e.indexCount,e.verticesStart,!!e.getMaterial(),this),this},Qi.prototype._processCollisionsForSubMeshes=function(e,t){for(var i=this._scene.getCollidingSubMeshCandidates(this,e),r=i.length,n=0;n<r;n++){var o=i.data[n];1<r&&!o._checkCollision(e)||this._collideForSubMesh(o,t,e)}return this},Qi.prototype._checkCollision=function(e){if(!this._boundingInfo||!this._boundingInfo._checkCollision(e))return this;var t=P.Matrix[0],i=P.Matrix[1];return W.ScalingToRef(1/e._radius.x,1/e._radius.y,1/e._radius.z,t),this.worldMatrixFromCache.multiplyToRef(t,i),this._processCollisionsForSubMeshes(e,i),this},Qi.prototype._generatePointsArray=function(){return!1},Qi.prototype.intersects=function(e,t,i){var r=new wi,n="InstancedLinesMesh"===this.getClassName()||"LinesMesh"===this.getClassName()?this.intersectionThreshold:0,o=this._boundingInfo;if(!(this.subMeshes&&o&&e.intersectsSphere(o.boundingSphere,n)&&e.intersectsBox(o.boundingBox,n)))return r;if(!this._generatePointsArray())return r;for(var s=null,a=this._scene.getIntersectingSubMeshCandidates(this,e),h=a.length,l=0;l<h;l++){var u=a.data[l];if(!(1<h)||u.canIntersects(e)){var c=u.intersects(e,this._positions,this.getIndices(),t,i);if(c&&(t||!s||c.distance<s.distance)&&((s=c).subMeshId=l,t))break}}if(s){var d=this.getWorldMatrix(),f=P.Vector3[0],p=P.Vector3[1];te.TransformCoordinatesToRef(e.origin,d,f),e.direction.scaleToRef(s.distance,p);var _=te.TransformNormal(p,d).addInPlace(f);return r.hit=!0,r.distance=te.Distance(f,_),r.pickedPoint=_,r.pickedMesh=this,r.bu=s.bu||0,r.bv=s.bv||0,r.faceId=s.faceId,r.subMeshId=s.subMeshId,r}return r},Qi.prototype.clone=function(e,t,i){return null},Qi.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this},Qi.prototype.dispose=function(e,t){var i,n=this;for(void 0===t&&(t=!1),this._scene.useMaterialMeshMap&&this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),i=0;i<this._intersectionsInProgress.length;i++){var r=this._intersectionsInProgress[i],o=r._intersectionsInProgress.indexOf(this);r._intersectionsInProgress.splice(o,1)}this._intersectionsInProgress=[],this.getScene().lights.forEach(function(e){var t=e.includedOnlyMeshes.indexOf(n);-1!==t&&e.includedOnlyMeshes.splice(t,1),-1!==(t=e.excludedMeshes.indexOf(n))&&e.excludedMeshes.splice(t,1);var i,r=e.getShadowGenerator();!r||(i=r.getShadowMap())&&i.renderList&&-1!==(t=i.renderList.indexOf(n))&&i.renderList.splice(t,1)}),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();var s=this.getScene().getEngine();if(this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,s.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),s.wipeCaches(),this.getScene().removeMesh(this),t&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!e)for(i=0;i<this.getScene().particleSystems.length;i++)this.getScene().particleSystems[i].emitter===this&&(this.getScene().particleSystems[i].dispose(),i--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),Ki.prototype.dispose.call(this,e,t)},Qi.prototype.addChild=function(e){return e.setParent(this),this},Qi.prototype.removeChild=function(e){return e.setParent(null),this},Qi.prototype._initFacetData=function(){var e=this._internalAbstractMeshDataInfo._facetData;e.facetNormals||(e.facetNormals=new Array),e.facetPositions||(e.facetPositions=new Array),e.facetPartitioning||(e.facetPartitioning=new Array),e.facetNb=this.getIndices().length/3|0,e.partitioningSubdivisions=e.partitioningSubdivisions?e.partitioningSubdivisions:10,e.partitioningBBoxRatio=e.partitioningBBoxRatio?e.partitioningBBoxRatio:1.01;for(var t=0;t<e.facetNb;t++)e.facetNormals[t]=te.Zero(),e.facetPositions[t]=te.Zero();return e.facetDataEnabled=!0,this},Qi.prototype.updateFacetData=function(){var e=this._internalAbstractMeshDataInfo._facetData;e.facetDataEnabled||this._initFacetData();var t,i=this.getVerticesData(Si.PositionKind),r=this.getIndices(),n=this.getVerticesData(Si.NormalKind),o=this.getBoundingInfo();if(e.facetDepthSort&&!e.facetDepthSortEnabled){if(e.facetDepthSortEnabled=!0,r instanceof Uint16Array)e.depthSortedIndices=new Uint16Array(r);else if(r instanceof Uint32Array)e.depthSortedIndices=new Uint32Array(r);else{for(var s=!1,a=0;a<r.length;a++)if(65535<r[a]){s=!0;break}e.depthSortedIndices=new(s?Uint32Array:Uint16Array)(r)}e.facetDepthSortFunction=function(e,t){return t.sqDistance-e.sqDistance},e.facetDepthSortFrom||(t=this.getScene().activeCamera,e.facetDepthSortFrom=t?t.position:te.Zero()),e.depthSortedFacets=[];for(var h=0;h<e.facetNb;h++){var l={ind:3*h,sqDistance:0};e.depthSortedFacets.push(l)}e.invertedMatrix=W.Identity(),e.facetDepthSortOrigin=te.Zero()}e.bbSize.x=o.maximum.x-o.minimum.x>C?o.maximum.x-o.minimum.x:C,e.bbSize.y=o.maximum.y-o.minimum.y>C?o.maximum.y-o.minimum.y:C,e.bbSize.z=o.maximum.z-o.minimum.z>C?o.maximum.z-o.minimum.z:C;var u=(u=e.bbSize.x>e.bbSize.y?e.bbSize.x:e.bbSize.y)>e.bbSize.z?u:e.bbSize.z;if(e.subDiv.max=e.partitioningSubdivisions,e.subDiv.X=Math.floor(e.subDiv.max*e.bbSize.x/u),e.subDiv.Y=Math.floor(e.subDiv.max*e.bbSize.y/u),e.subDiv.Z=Math.floor(e.subDiv.max*e.bbSize.z/u),e.subDiv.X=e.subDiv.X<1?1:e.subDiv.X,e.subDiv.Y=e.subDiv.Y<1?1:e.subDiv.Y,e.subDiv.Z=e.subDiv.Z<1?1:e.subDiv.Z,e.facetParameters.facetNormals=this.getFacetLocalNormals(),e.facetParameters.facetPositions=this.getFacetLocalPositions(),e.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),e.facetParameters.bInfo=o,e.facetParameters.bbSize=e.bbSize,e.facetParameters.subDiv=e.subDiv,e.facetParameters.ratio=this.partitioningBBoxRatio,e.facetParameters.depthSort=e.facetDepthSort,e.facetDepthSort&&e.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(e.invertedMatrix),te.TransformCoordinatesToRef(e.facetDepthSortFrom,e.invertedMatrix,e.facetDepthSortOrigin),e.facetParameters.distanceTo=e.facetDepthSortOrigin),e.facetParameters.depthSortedFacets=e.depthSortedFacets,Ri.ComputeNormals(i,r,n,e.facetParameters),e.facetDepthSort&&e.facetDepthSortEnabled){e.depthSortedFacets.sort(e.facetDepthSortFunction);for(var c=e.depthSortedIndices.length/3|0,h=0;h<c;h++){var d=e.depthSortedFacets[h].ind;e.depthSortedIndices[3*h]=r[d],e.depthSortedIndices[3*h+1]=r[d+1],e.depthSortedIndices[3*h+2]=r[d+2]}this.updateIndices(e.depthSortedIndices,void 0,!0)}return this},Qi.prototype.getFacetLocalNormals=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetNormals||this.updateFacetData(),e.facetNormals},Qi.prototype.getFacetLocalPositions=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetPositions||this.updateFacetData(),e.facetPositions},Qi.prototype.getFacetLocalPartitioning=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetPartitioning||this.updateFacetData(),e.facetPartitioning},Qi.prototype.getFacetPosition=function(e){var t=te.Zero();return this.getFacetPositionToRef(e,t),t},Qi.prototype.getFacetPositionToRef=function(e,t){var i=this.getFacetLocalPositions()[e],r=this.getWorldMatrix();return te.TransformCoordinatesToRef(i,r,t),this},Qi.prototype.getFacetNormal=function(e){var t=te.Zero();return this.getFacetNormalToRef(e,t),t},Qi.prototype.getFacetNormalToRef=function(e,t){var i=this.getFacetLocalNormals()[e];return te.TransformNormalToRef(i,this.getWorldMatrix(),t),this},Qi.prototype.getFacetsAtLocalCoordinates=function(e,t,i){var r=this.getBoundingInfo(),n=this._internalAbstractMeshDataInfo._facetData,o=Math.floor((e-r.minimum.x*n.partitioningBBoxRatio)*n.subDiv.X*n.partitioningBBoxRatio/n.bbSize.x),s=Math.floor((t-r.minimum.y*n.partitioningBBoxRatio)*n.subDiv.Y*n.partitioningBBoxRatio/n.bbSize.y),a=Math.floor((i-r.minimum.z*n.partitioningBBoxRatio)*n.subDiv.Z*n.partitioningBBoxRatio/n.bbSize.z);return o<0||o>n.subDiv.max||s<0||s>n.subDiv.max||a<0||a>n.subDiv.max?null:n.facetPartitioning[o+n.subDiv.max*s+n.subDiv.max*n.subDiv.max*a]},Qi.prototype.getClosestFacetAtCoordinates=function(e,t,i,r,n,o){void 0===n&&(n=!1),void 0===o&&(o=!0);var s=this.getWorldMatrix(),a=P.Matrix[5];s.invertToRef(a);var h=P.Vector3[8];te.TransformCoordinatesFromFloatsToRef(e,t,i,a,h);var l=this.getClosestFacetAtLocalCoordinates(h.x,h.y,h.z,r,n,o);return r&&te.TransformCoordinatesFromFloatsToRef(r.x,r.y,r.z,s,r),l},Qi.prototype.getClosestFacetAtLocalCoordinates=function(e,t,i,r,n,o){void 0===n&&(n=!1),void 0===o&&(o=!0);var s,a,h,l,u,c,d,f=null,p=0,_=this.getFacetLocalPositions(),g=this.getFacetLocalNormals(),m=this.getFacetsAtLocalCoordinates(e,t,i);if(!m)return null;for(var v,y,b,T,x=Number.MAX_VALUE,E=0;E<m.length;E++)b=g[y=m[E]],p=(e-(T=_[y]).x)*b.x+(t-T.y)*b.y+(i-T.z)*b.z,(!n||n&&o&&0<=p||n&&!o&&p<=0)&&(p=b.x*T.x+b.y*T.y+b.z*T.z,l=-(b.x*e+b.y*t+b.z*i-p)/(b.x*b.x+b.y*b.y+b.z*b.z),(v=(s=(u=e+b.x*l)-e)*s+(a=(c=t+b.y*l)-t)*a+(h=(d=i+b.z*l)-i)*h)<x&&(x=v,f=y,r&&(r.x=u,r.y=c,r.z=d)));return f},Qi.prototype.getFacetDataParameters=function(){return this._internalAbstractMeshDataInfo._facetData.facetParameters},Qi.prototype.disableFacetData=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetDataEnabled&&(e.facetDataEnabled=!1,e.facetPositions=new Array,e.facetNormals=new Array,e.facetPartitioning=new Array,e.facetParameters=null,e.depthSortedIndices=new Uint32Array(0)),this},Qi.prototype.updateIndices=function(e,t,i){return void 0===i&&(i=!1),this},Qi.prototype.createNormals=function(e){var t=this.getVerticesData(Si.PositionKind),i=this.getIndices(),r=this.isVerticesDataPresent(Si.NormalKind)?this.getVerticesData(Si.NormalKind):[];return Ri.ComputeNormals(t,i,r,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(Si.NormalKind,r,e),this},Qi.prototype.alignWithNormal=function(e,t){t=t||fi.Y;var i=P.Vector3[0],r=P.Vector3[1];return te.CrossToRef(t,e,r),te.CrossToRef(e,r,i),this.rotationQuaternion?x.RotationQuaternionFromAxisToRef(i,e,r,this.rotationQuaternion):te.RotationFromAxisToRef(i,e,r,this.rotation),this},Qi.prototype._checkOcclusionQuery=function(){return!1},Qi.prototype.disableEdgesRendering=function(){throw S.WarnImport("EdgesRenderer")},Qi.prototype.enableEdgesRendering=function(e,t){throw S.WarnImport("EdgesRenderer")},Qi.OCCLUSION_TYPE_NONE=0,Qi.OCCLUSION_TYPE_OPTIMISTIC=1,Qi.OCCLUSION_TYPE_STRICT=2,Qi.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,Qi.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,Qi.CULLINGSTRATEGY_STANDARD=0,Qi.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,Qi.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,Qi.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,Qi);function Qi(e,t){void 0===t&&(t=null);var r=Ki.call(this,e,t,!1)||this;return r._internalAbstractMeshDataInfo=new qi,r.cullingStrategy=Qi.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,r.onCollideObservable=new le,r.onCollisionPositionChangeObservable=new le,r.onMaterialChangedObservable=new le,r.definedFacingForward=!0,r._occlusionQuery=null,r._renderingGroup=null,r.alphaIndex=Number.MAX_VALUE,r.isVisible=!0,r.isPickable=!0,r.showSubMeshesBoundingBox=!1,r.isBlocker=!1,r.enablePointerMoveEvents=!1,r.renderingGroupId=0,r._material=null,r.outlineColor=Ne.Red(),r.outlineWidth=.02,r.overlayColor=Ne.Red(),r.overlayAlpha=.5,r.useOctreeForRenderingSelection=!0,r.useOctreeForPicking=!0,r.useOctreeForCollisions=!0,r.alwaysSelectAsActiveMesh=!1,r.doNotSyncBoundingInfo=!1,r.actionManager=null,r._meshCollisionData=new Hi,r.ellipsoid=new te(.5,1,.5),r.ellipsoidOffset=new te(0,0,0),r.edgesWidth=1,r.edgesColor=new K(1,0,0,1),r._edgesRenderer=null,r._masterMesh=null,r._boundingInfo=null,r._renderId=0,r._intersectionsInProgress=new Array,r._unIndexed=!1,r._lightSources=new Array,r._waitingData={lods:null,actions:null,freezeWorldMatrix:null},r._bonesTransformMatrices=null,r._transformMatrixTexture=null,r.onRebuildObservable=new le,r._onCollisionPositionChange=function(e,t,i){void 0===i&&(i=null),t.subtractToRef(r._meshCollisionData._oldPositionForCollisions,r._meshCollisionData._diffPositionForCollisions),r._meshCollisionData._diffPositionForCollisions.length()>Mi.CollisionsEpsilon&&r.position.addInPlace(r._meshCollisionData._diffPositionForCollisions),i&&r.onCollideObservable.notifyObservers(i),r.onCollisionPositionChangeObservable.notifyObservers(r.position)},r.getScene().addMesh(r),r._resyncLightSources(),r}var Ji=($i.prototype.toGlobal=function(e,t){return new $i(this.x*e,this.y*t,this.width*e,this.height*t)},$i.prototype.toGlobalToRef=function(e,t,i){return i.x=this.x*e,i.y=this.y*t,i.width=this.width*e,i.height=this.height*t,this},$i.prototype.clone=function(){return new $i(this.x,this.y,this.width,this.height)},$i);function $i(e,t,i,r){this.x=e,this.y=t,this.width=i,this.height=r}var er=(tr.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},tr.prototype.clone=function(){return new tr(this.normal.x,this.normal.y,this.normal.z,this.d)},tr.prototype.getClassName=function(){return"Plane"},tr.prototype.getHashCode=function(){return 397*this.normal.getHashCode()^(0|this.d)},tr.prototype.normalize=function(){var e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0!==e?1/e:0;return this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this},tr.prototype.transform=function(e){var t=tr._TmpMatrix;W.TransposeToRef(e,t);var i=t.m,r=this.normal.x,n=this.normal.y,o=this.normal.z,s=this.d;return new tr(r*i[0]+n*i[1]+o*i[2]+s*i[3],r*i[4]+n*i[5]+o*i[6]+s*i[7],r*i[8]+n*i[9]+o*i[10]+s*i[11],r*i[12]+n*i[13]+o*i[14]+s*i[15])},tr.prototype.dotCoordinate=function(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d},tr.prototype.copyFromPoints=function(e,t,i){var r=t.x-e.x,n=t.y-e.y,o=t.z-e.z,s=i.x-e.x,a=i.y-e.y,h=i.z-e.z,l=n*h-o*a,u=o*s-r*h,c=r*a-n*s,d=Math.sqrt(l*l+u*u+c*c),f=0!==d?1/d:0;return this.normal.x=l*f,this.normal.y=u*f,this.normal.z=c*f,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this},tr.prototype.isFrontFacingTo=function(e,t){return te.Dot(this.normal,e)<=t},tr.prototype.signedDistanceTo=function(e){return te.Dot(e,this.normal)+this.d},tr.FromArray=function(e){return new tr(e[0],e[1],e[2],e[3])},tr.FromPoints=function(e,t,i){var r=new tr(0,0,0,0);return r.copyFromPoints(e,t,i),r},tr.FromPositionAndNormal=function(e,t){var i=new tr(0,0,0,0);return t.normalize(),i.normal=t,i.d=-(t.x*e.x+t.y*e.y+t.z*e.z),i},tr.SignedDistanceToPlaneFromPositionAndNormal=function(e,t,i){var r=-(t.x*e.x+t.y*e.y+t.z*e.z);return te.Dot(i,t)+r},tr._TmpMatrix=W.Identity(),tr);function tr(e,t,i,r){this.normal=new te(e,t,i),this.d=r}var ir=(rr.GetPlanes=function(e){for(var t=[],i=0;i<6;i++)t.push(new er(0,0,0,0));return rr.GetPlanesToRef(e,t),t},rr.GetNearPlaneToRef=function(e,t){var i=e.m;t.normal.x=i[3]+i[2],t.normal.y=i[7]+i[6],t.normal.z=i[11]+i[10],t.d=i[15]+i[14],t.normalize()},rr.GetFarPlaneToRef=function(e,t){var i=e.m;t.normal.x=i[3]-i[2],t.normal.y=i[7]-i[6],t.normal.z=i[11]-i[10],t.d=i[15]-i[14],t.normalize()},rr.GetLeftPlaneToRef=function(e,t){var i=e.m;t.normal.x=i[3]+i[0],t.normal.y=i[7]+i[4],t.normal.z=i[11]+i[8],t.d=i[15]+i[12],t.normalize()},rr.GetRightPlaneToRef=function(e,t){var i=e.m;t.normal.x=i[3]-i[0],t.normal.y=i[7]-i[4],t.normal.z=i[11]-i[8],t.d=i[15]-i[12],t.normalize()},rr.GetTopPlaneToRef=function(e,t){var i=e.m;t.normal.x=i[3]-i[1],t.normal.y=i[7]-i[5],t.normal.z=i[11]-i[9],t.d=i[15]-i[13],t.normalize()},rr.GetBottomPlaneToRef=function(e,t){var i=e.m;t.normal.x=i[3]+i[1],t.normal.y=i[7]+i[5],t.normal.z=i[11]+i[9],t.d=i[15]+i[13],t.normalize()},rr.GetPlanesToRef=function(e,t){rr.GetNearPlaneToRef(e,t[0]),rr.GetFarPlaneToRef(e,t[1]),rr.GetLeftPlaneToRef(e,t[2]),rr.GetRightPlaneToRef(e,t[3]),rr.GetTopPlaneToRef(e,t[4]),rr.GetBottomPlaneToRef(e,t[5])},rr);function rr(){}var nr,or=(n(sr,nr=ci),Object.defineProperty(sr.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e},enumerable:!0,configurable:!0}),sr.prototype.storeState=function(){return this._stateStored=!0,this._storedFov=this.fov,this},sr.prototype._restoreStateValues=function(){return!!this._stateStored&&(this.fov=this._storedFov,!0)},sr.prototype.restoreState=function(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)},sr.prototype.getClassName=function(){return"Camera"},sr.prototype.toString=function(e){var t="Name: "+this.name;if(t+=", type: "+this.getClassName(),this.animations)for(var i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);return t},Object.defineProperty(sr.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!0,configurable:!0}),sr.prototype.getActiveMeshes=function(){return this._activeMeshes},sr.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},sr.prototype.isReady=function(e){if(void 0===e&&(e=!1),e)for(var t=0,i=this._postProcesses;t<i.length;t++){var r=i[t];if(r&&!r.isReady())return!1}return nr.prototype.isReady.call(this,e)},sr.prototype._initCache=function(){nr.prototype._initCache.call(this),this._cache.position=new te(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new te(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},sr.prototype._updateCache=function(e){e||nr.prototype._updateCache.call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)},sr.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},sr.prototype._isSynchronizedViewMatrix=function(){return!!nr.prototype._isSynchronized.call(this)&&this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent()},sr.prototype._isSynchronizedProjectionMatrix=function(){var e=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!e)return!1;var t=this.getEngine();return e=this.mode===sr.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===t.getAspectRatio(this):this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===t.getRenderWidth()&&this._cache.renderHeight===t.getRenderHeight()},sr.prototype.attachControl=function(e,t){},sr.prototype.detachControl=function(e){},sr.prototype.update=function(){this._checkInputs(),this.cameraRigMode!==sr.RIG_MODE_NONE&&this._updateRigCameras()},sr.prototype._checkInputs=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(sr.prototype,"rigCameras",{get:function(){return this._rigCameras},enumerable:!0,configurable:!0}),Object.defineProperty(sr.prototype,"rigPostProcess",{get:function(){return this._rigPostProcess},enumerable:!0,configurable:!0}),sr.prototype._getFirstPostProcess=function(){for(var e=0;e<this._postProcesses.length;e++)if(null!==this._postProcesses[e])return this._postProcesses[e];return null},sr.prototype._cascadePostProcessesToRigCams=function(){var e=this._getFirstPostProcess();e&&e.markTextureDirty();for(var t=0,i=this._rigCameras.length;t<i;t++){var r=this._rigCameras[t],n=r._rigPostProcess;n?("pass"===n.getEffectName()&&(r.isIntermediate=0===this._postProcesses.length),r._postProcesses=this._postProcesses.slice(0).concat(n),n.markTextureDirty()):r._postProcesses=this._postProcesses.slice(0)}},sr.prototype.attachPostProcess=function(e,t){return void 0===t&&(t=null),!e.isReusable()&&-1<this._postProcesses.indexOf(e)?(fe.Error("You're trying to reuse a post process not defined as reusable."),0):(null==t||t<0?this._postProcesses.push(e):null===this._postProcesses[t]?this._postProcesses[t]=e:this._postProcesses.splice(t,0,e),this._cascadePostProcessesToRigCams(),this._postProcesses.indexOf(e))},sr.prototype.detachPostProcess=function(e){var t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses[t]=null),this._cascadePostProcessesToRigCams()},sr.prototype.getWorldMatrix=function(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix},sr.prototype._getViewMatrix=function(){return W.Identity()},sr.prototype.getViewMatrix=function(e){return!e&&this._isSynchronizedViewMatrix()||(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix},sr.prototype.freezeProjectionMatrix=function(e){this._doNotComputeProjectionMatrix=!0,void 0!==e&&(this._projectionMatrix=e)},sr.prototype.unfreezeProjectionMatrix=function(){this._doNotComputeProjectionMatrix=!1},sr.prototype.getProjectionMatrix=function(e){if(this._doNotComputeProjectionMatrix||!e&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var t,i,r,n=this.getEngine(),o=this.getScene();return this.mode===sr.PERSPECTIVE_CAMERA?(this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=n.getAspectRatio(this),this.minZ<=0&&(this.minZ=.1),t=n.useReverseDepthBuffer,(o.useRightHandedSystem?t?W.PerspectiveFovReverseRHToRef:W.PerspectiveFovRHToRef:t?W.PerspectiveFovReverseLHToRef:W.PerspectiveFovLHToRef)(this.fov,n.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===sr.FOVMODE_VERTICAL_FIXED)):(i=n.getRenderWidth()/2,r=n.getRenderHeight()/2,o.useRightHandedSystem?W.OrthoOffCenterRHToRef(this.orthoLeft||-i,this.orthoRight||i,this.orthoBottom||-r,this.orthoTop||r,this.minZ,this.maxZ,this._projectionMatrix):W.OrthoOffCenterLHToRef(this.orthoLeft||-i,this.orthoRight||i,this.orthoBottom||-r,this.orthoTop||r,this.minZ,this.maxZ,this._projectionMatrix),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=n.getRenderWidth(),this._cache.renderHeight=n.getRenderHeight()),this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix},sr.prototype.getTransformationMatrix=function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix},sr.prototype._updateFrustumPlanes=function(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?ir.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=ir.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)},sr.prototype.isInFrustum=function(t,e){if(void 0===e&&(e=!1),this._updateFrustumPlanes(),e&&0<this.rigCameras.length){var i=!1;return this.rigCameras.forEach(function(e){e._updateFrustumPlanes(),i=i||t.isInFrustum(e._frustumPlanes)}),i}return t.isInFrustum(this._frustumPlanes)},sr.prototype.isCompletelyInFrustum=function(e){return this._updateFrustumPlanes(),e.isCompletelyInFrustum(this._frustumPlanes)},sr.prototype.getForwardRay=function(e,t,i){throw void 0===e&&(e=100),S.WarnImport("Ray")},sr.prototype.dispose=function(e,t){for(void 0===t&&(t=!1),this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);0<this._rigCameras.length;){var i=this._rigCameras.pop();i&&i.dispose()}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses=[];else if(this.cameraRigMode!==sr.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses=[];else for(var r=this._postProcesses.length;0<=--r;){var n=this._postProcesses[r];n&&n.dispose(this)}for(r=this.customRenderTargets.length;0<=--r;)this.customRenderTargets[r].dispose();this.customRenderTargets=[],this._activeMeshes.dispose(),nr.prototype.dispose.call(this,e,t)},Object.defineProperty(sr.prototype,"isLeftCamera",{get:function(){return this._isLeftCamera},enumerable:!0,configurable:!0}),Object.defineProperty(sr.prototype,"isRightCamera",{get:function(){return this._isRightCamera},enumerable:!0,configurable:!0}),Object.defineProperty(sr.prototype,"leftCamera",{get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]},enumerable:!0,configurable:!0}),Object.defineProperty(sr.prototype,"rightCamera",{get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]},enumerable:!0,configurable:!0}),sr.prototype.getLeftTarget=function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()},sr.prototype.getRightTarget=function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()},sr.prototype.setCameraRigMode=function(e,t){if(this.cameraRigMode!==e){for(;0<this._rigCameras.length;){var i=this._rigCameras.pop();i&&i.dispose()}var r,n;switch(this.cameraRigMode=e,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=t.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=ri.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==sr.RIG_MODE_NONE&&((r=this.createRigCamera(this.name+"_L",0))&&(r._isLeftCamera=!0),(n=this.createRigCamera(this.name+"_R",1))&&(n._isRightCamera=!0),r&&n&&(this._rigCameras.push(r),this._rigCameras.push(n))),this.cameraRigMode){case sr.RIG_MODE_STEREOSCOPIC_ANAGLYPH:sr._setStereoscopicAnaglyphRigMode(this);break;case sr.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case sr.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case sr.RIG_MODE_STEREOSCOPIC_OVERUNDER:case sr.RIG_MODE_STEREOSCOPIC_INTERLACED:sr._setStereoscopicRigMode(this);break;case sr.RIG_MODE_VR:sr._setVRRigMode(this,t);break;case sr.RIG_MODE_WEBVR:sr._setWebVRRigMode(this,t)}this._cascadePostProcessesToRigCams(),this.update()}},sr._setStereoscopicRigMode=function(e){throw"Import Cameras/RigModes/stereoscopicRigMode before using stereoscopic rig mode"},sr._setStereoscopicAnaglyphRigMode=function(e){throw"Import Cameras/RigModes/stereoscopicAnaglyphRigMode before using stereoscopic anaglyph rig mode"},sr._setVRRigMode=function(e,t){throw"Import Cameras/RigModes/vrRigMode before using VR rig mode"},sr._setWebVRRigMode=function(e,t){throw"Import Cameras/RigModes/WebVRRigMode before using Web VR rig mode"},sr.prototype._getVRProjectionMatrix=function(){return W.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},sr.prototype._updateCameraRotationMatrix=function(){},sr.prototype._updateWebVRCameraRotationMatrix=function(){},sr.prototype._getWebVRProjectionMatrix=function(){return W.Identity()},sr.prototype._getWebVRViewMatrix=function(){return W.Identity()},sr.prototype.setCameraRigParameter=function(e,t){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[e]=t,"interaxialDistance"===e&&(this._cameraRigParams.stereoHalfAngle=ri.ToRadians(t/.0637))},sr.prototype.createRigCamera=function(e,t){return null},sr.prototype._updateRigCameras=function(){for(var e=0;e<this._rigCameras.length;e++)this._rigCameras[e].minZ=this.minZ,this._rigCameras[e].maxZ=this.maxZ,this._rigCameras[e].fov=this.fov,this._rigCameras[e].upVector.copyFrom(this.upVector);this.cameraRigMode===sr.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},sr.prototype._setupInputs=function(){},sr.prototype.serialize=function(){var e=Q.Serialize(this);return e.type=this.getClassName(),this.parent&&(e.parentId=this.parent.id),this.inputs&&this.inputs.serialize(e),Q.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e},sr.prototype.clone=function(e){return Q.Clone(sr.GetConstructorFromName(this.getClassName(),e,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this)},sr.prototype.getDirection=function(e){var t=te.Zero();return this.getDirectionToRef(e,t),t},Object.defineProperty(sr.prototype,"absoluteRotation",{get:function(){var e=x.Zero();return this.getWorldMatrix().decompose(void 0,e),e},enumerable:!0,configurable:!0}),sr.prototype.getDirectionToRef=function(e,t){te.TransformNormalToRef(e,this.getWorldMatrix(),t)},sr.GetConstructorFromName=function(e,t,i,r,n){void 0===r&&(r=0),void 0===n&&(n=!0);var o=ci.Construct(e,t,i,{interaxial_distance:r,isStereoscopicSideBySide:n});return o||function(){return sr._createDefaultParsedCamera(t,i)}},sr.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},sr.Parse=function(e,t){var i,r=e.type,n=sr.GetConstructorFromName(r,e.name,t,e.interaxial_distance,e.isStereoscopicSideBySide),o=Q.Parse(n,e,t);if(e.parentId&&(o._waitingParentId=e.parentId),o.inputs&&(o.inputs.parse(e),o._setupInputs()),o.setPosition&&(o.position.copyFromFloats(0,0,0),o.setPosition(te.FromArray(e.position))),e.target&&o.setTarget&&o.setTarget(te.FromArray(e.target)),e.cameraRigMode&&(i=e.interaxial_distance?{interaxialDistance:e.interaxial_distance}:{},o.setCameraRigMode(e.cameraRigMode,i)),e.animations){for(var s=0;s<e.animations.length;s++){var a=e.animations[s],h=m.GetClass("BABYLON.Animation");h&&o.animations.push(h.Parse(a))}ci.ParseAnimationRanges(o,e,t)}return e.autoAnimate&&t.beginAnimation(o,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),o},sr._createDefaultParsedCamera=function(e,t){throw S.WarnImport("UniversalCamera")},sr.PERSPECTIVE_CAMERA=0,sr.ORTHOGRAPHIC_CAMERA=1,sr.FOVMODE_VERTICAL_FIXED=0,sr.FOVMODE_HORIZONTAL_FIXED=1,sr.RIG_MODE_NONE=0,sr.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,sr.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,sr.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,sr.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,sr.RIG_MODE_STEREOSCOPIC_INTERLACED=14,sr.RIG_MODE_VR=20,sr.RIG_MODE_WEBVR=21,sr.RIG_MODE_CUSTOM=22,sr.ForceAttachControlToAlwaysPreventDefault=!1,o([Z("position")],sr.prototype,"_position",void 0),o([Z()],sr.prototype,"upVector",void 0),o([z()],sr.prototype,"orthoLeft",void 0),o([z()],sr.prototype,"orthoRight",void 0),o([z()],sr.prototype,"orthoBottom",void 0),o([z()],sr.prototype,"orthoTop",void 0),o([z()],sr.prototype,"fov",void 0),o([z()],sr.prototype,"minZ",void 0),o([z()],sr.prototype,"maxZ",void 0),o([z()],sr.prototype,"inertia",void 0),o([z()],sr.prototype,"mode",void 0),o([z()],sr.prototype,"layerMask",void 0),o([z()],sr.prototype,"fovMode",void 0),o([z()],sr.prototype,"cameraRigMode",void 0),o([z()],sr.prototype,"interaxialDistance",void 0),o([z()],sr.prototype,"isStereoscopicSideBySide",void 0),sr);function sr(e,t,i,r){void 0===r&&(r=!0);var n=nr.call(this,e,i)||this;return n._position=te.Zero(),n.upVector=te.Up(),n.orthoLeft=null,n.orthoRight=null,n.orthoBottom=null,n.orthoTop=null,n.fov=.8,n.minZ=1,n.maxZ=1e4,n.inertia=.9,n.mode=sr.PERSPECTIVE_CAMERA,n.isIntermediate=!1,n.viewport=new Ji(0,0,1,1),n.layerMask=268435455,n.fovMode=sr.FOVMODE_VERTICAL_FIXED,n.cameraRigMode=sr.RIG_MODE_NONE,n.customRenderTargets=new Array,n.outputRenderTarget=null,n.onViewMatrixChangedObservable=new le,n.onProjectionMatrixChangedObservable=new le,n.onAfterCheckInputsObservable=new le,n.onRestoreStateObservable=new le,n.isRigCamera=!1,n._rigCameras=new Array,n._webvrViewMatrix=W.Identity(),n._skipRendering=!1,n._projectionMatrix=new W,n._postProcesses=new Array,n._activeMeshes=new $(256),n._globalPosition=te.Zero(),n._computedViewMatrix=W.Identity(),n._doNotComputeProjectionMatrix=!1,n._transformMatrix=W.Zero(),n._refreshFrustumPlanes=!0,n._isCamera=!0,n._isLeftCamera=!1,n._isRightCamera=!1,n.getScene().addCamera(n),r&&!n.getScene().activeCamera&&(n.getScene().activeCamera=n),n.position=t,n}var ar=(hr.AddParser=function(e,t){this._BabylonFileParsers[e]=t},hr.GetParser=function(e){return this._BabylonFileParsers[e]?this._BabylonFileParsers[e]:null},hr.AddIndividualParser=function(e,t){this._IndividualBabylonFileParsers[e]=t},hr.GetIndividualParser=function(e){return this._IndividualBabylonFileParsers[e]?this._IndividualBabylonFileParsers[e]:null},hr.Parse=function(e,t,i,r){for(var n in this._BabylonFileParsers)this._BabylonFileParsers.hasOwnProperty(n)&&this._BabylonFileParsers[n](e,t,i,r)},hr.prototype.getNodes=function(){var t=new Array;return t=(t=(t=(t=t.concat(this.meshes)).concat(this.lights)).concat(this.cameras)).concat(this.transformNodes),this.skeletons.forEach(function(e){return t=t.concat(e.bones)}),t},hr._BabylonFileParsers={},hr._IndividualBabylonFileParsers={},hr);function hr(){this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array,this.environmentTexture=null}var lr=(Object.defineProperty(ur.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!0,configurable:!0}),ur.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._areImageProcessingDirty=!1},ur.prototype.markAsUnprocessed=function(){this._isDirty=!0},ur.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},ur.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},ur.prototype.markAsLightDirty=function(e){void 0===e&&(e=!1),this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||e,this._isDirty=!0},ur.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},ur.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},ur.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},ur.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},ur.prototype.rebuild=function(){this._keys&&delete this._keys,this._keys=[];for(var e=0,t=Object.keys(this);e<t.length;e++){var i=t[e];"_"!==i[0]&&this._keys.push(i)}},ur.prototype.isEqual=function(e){if(this._keys.length!==e._keys.length)return!1;for(var t=0;t<this._keys.length;t++){var i=this._keys[t];if(this[i]!==e[i])return!1}return!0},ur.prototype.cloneTo=function(e){this._keys.length!==e._keys.length&&(e._keys=this._keys.slice(0));for(var t=0;t<this._keys.length;t++){var i=this._keys[t];e[i]=this[i]}},ur.prototype.reset=function(){for(var e=0;e<this._keys.length;e++){var t=this._keys[e];switch(typeof this[t]){case"number":this[t]=0;break;case"string":this[t]="";break;default:this[t]=!1}}},ur.prototype.toString=function(){for(var e="",t=0;t<this._keys.length;t++){var i=this._keys[t],r=this[i];switch(typeof r){case"number":case"string":e+="#define "+i+" "+r+"\n";break;default:r&&(e+="#define "+i+"\n")}}return e},ur);function ur(){this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1}var cr=(Object.defineProperty(dr.prototype,"globalHue",{get:function(){return this._globalHue},set:function(e){this._globalHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(dr.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(e){this._globalDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(dr.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(e){this._globalSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(dr.prototype,"globalExposure",{get:function(){return this._globalExposure},set:function(e){this._globalExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(dr.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(e){this._highlightsHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(dr.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(e){this._highlightsDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(dr.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(e){this._highlightsSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(dr.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(e){this._highlightsExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(dr.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(e){this._midtonesHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(dr.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(e){this._midtonesDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(dr.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(e){this._midtonesSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(dr.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(e){this._midtonesExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(dr.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(e){this._shadowsHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(dr.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(e){this._shadowsDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(dr.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(e){this._shadowsSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(dr.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(e){this._shadowsExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),dr.prototype.getClassName=function(){return"ColorCurves"},dr.Bind=function(e,t,i,r,n){void 0===i&&(i="vCameraColorCurvePositive"),void 0===r&&(r="vCameraColorCurveNeutral"),void 0===n&&(n="vCameraColorCurveNegative"),e._dirty&&(e._dirty=!1,e.getColorGradingDataToRef(e._globalHue,e._globalDensity,e._globalSaturation,e._globalExposure,e._globalCurve),e.getColorGradingDataToRef(e._highlightsHue,e._highlightsDensity,e._highlightsSaturation,e._highlightsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._highlightsCurve),e.getColorGradingDataToRef(e._midtonesHue,e._midtonesDensity,e._midtonesSaturation,e._midtonesExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._midtonesCurve),e.getColorGradingDataToRef(e._shadowsHue,e._shadowsDensity,e._shadowsSaturation,e._shadowsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._shadowsCurve),e._highlightsCurve.subtractToRef(e._midtonesCurve,e._positiveCurve),e._midtonesCurve.subtractToRef(e._shadowsCurve,e._negativeCurve)),t&&(t.setFloat4(i,e._positiveCurve.r,e._positiveCurve.g,e._positiveCurve.b,e._positiveCurve.a),t.setFloat4(r,e._midtonesCurve.r,e._midtonesCurve.g,e._midtonesCurve.b,e._midtonesCurve.a),t.setFloat4(n,e._negativeCurve.r,e._negativeCurve.g,e._negativeCurve.b,e._negativeCurve.a))},dr.PrepareUniforms=function(e){e.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},dr.prototype.getColorGradingDataToRef=function(e,t,i,r,n){null!=e&&(e=dr.clamp(e,0,360),t=dr.clamp(t,-100,100),i=dr.clamp(i,-100,100),r=dr.clamp(r,-100,100),t=dr.applyColorGradingSliderNonlinear(t),t*=.5,r=dr.applyColorGradingSliderNonlinear(r),t<0&&(t*=-1,e=(e+180)%360),dr.fromHSBToRef(e,t,50+.25*r,n),n.scaleToRef(2,n),n.a=1+.01*i)},dr.applyColorGradingSliderNonlinear=function(e){e/=100;var t=Math.abs(e),t=Math.pow(t,2);return e<0&&(t*=-1),t*=100},dr.fromHSBToRef=function(e,t,i,r){var n=dr.clamp(e,0,360),o=dr.clamp(t/100,0,1),s=dr.clamp(i/100,0,1);if(0===o)r.r=s,r.g=s,r.b=s;else{n/=60;var a=Math.floor(n),h=n-a,l=s*(1-o),u=s*(1-o*h),c=s*(1-o*(1-h));switch(a){case 0:r.r=s,r.g=c,r.b=l;break;case 1:r.r=u,r.g=s,r.b=l;break;case 2:r.r=l,r.g=s,r.b=c;break;case 3:r.r=l,r.g=u,r.b=s;break;case 4:r.r=c,r.g=l,r.b=s;break;default:r.r=s,r.g=l,r.b=u}}r.a=1},dr.clamp=function(e,t,i){return Math.min(Math.max(e,t),i)},dr.prototype.clone=function(){return Q.Clone(function(){return new dr},this)},dr.prototype.serialize=function(){return Q.Serialize(this)},dr.Parse=function(e){return Q.Parse(function(){return new dr},e,null,null)},o([z()],dr.prototype,"_globalHue",void 0),o([z()],dr.prototype,"_globalDensity",void 0),o([z()],dr.prototype,"_globalSaturation",void 0),o([z()],dr.prototype,"_globalExposure",void 0),o([z()],dr.prototype,"_highlightsHue",void 0),o([z()],dr.prototype,"_highlightsDensity",void 0),o([z()],dr.prototype,"_highlightsSaturation",void 0),o([z()],dr.prototype,"_highlightsExposure",void 0),o([z()],dr.prototype,"_midtonesHue",void 0),o([z()],dr.prototype,"_midtonesDensity",void 0),o([z()],dr.prototype,"_midtonesSaturation",void 0),o([z()],dr.prototype,"_midtonesExposure",void 0),dr);function dr(){this._dirty=!0,this._tempColor=new K(0,0,0,0),this._globalCurve=new K(0,0,0,0),this._highlightsCurve=new K(0,0,0,0),this._midtonesCurve=new K(0,0,0,0),this._shadowsCurve=new K(0,0,0,0),this._positiveCurve=new K(0,0,0,0),this._negativeCurve=new K(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}Q._ColorCurvesParser=cr.Parse;var fr;n(pr,fr=lr);function pr(){var e=fr.call(this)||this;return e.IMAGEPROCESSING=!1,e.VIGNETTE=!1,e.VIGNETTEBLENDMODEMULTIPLY=!1,e.VIGNETTEBLENDMODEOPAQUE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=!1,e.SAMPLER3DBGRMAP=!1,e.IMAGEPROCESSINGPOSTPROCESS=!1,e.EXPOSURE=!1,e.rebuild(),e}var _r=(Object.defineProperty(gr.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(e){this._colorCurvesEnabled!==e&&(this._colorCurvesEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(gr.prototype,"colorGradingTexture",{get:function(){return this._colorGradingTexture},set:function(e){this._colorGradingTexture!==e&&(this._colorGradingTexture=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(gr.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(e){this._colorGradingEnabled!==e&&(this._colorGradingEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(gr.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(e){this._colorGradingWithGreenDepth!==e&&(this._colorGradingWithGreenDepth=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(gr.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(e){this._colorGradingBGR!==e&&(this._colorGradingBGR=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(gr.prototype,"exposure",{get:function(){return this._exposure},set:function(e){this._exposure!==e&&(this._exposure=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(gr.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(e){this._toneMappingEnabled!==e&&(this._toneMappingEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(gr.prototype,"toneMappingType",{get:function(){return this._toneMappingType},set:function(e){this._toneMappingType!==e&&(this._toneMappingType=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(gr.prototype,"contrast",{get:function(){return this._contrast},set:function(e){this._contrast!==e&&(this._contrast=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(gr.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(e){this._vignetteBlendMode!==e&&(this._vignetteBlendMode=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(gr.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(e){this._vignetteEnabled!==e&&(this._vignetteEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(gr.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(e){this._applyByPostProcess!==e&&(this._applyByPostProcess=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(gr.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),gr.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},gr.prototype.getClassName=function(){return"ImageProcessingConfiguration"},gr.PrepareUniforms=function(e,t){t.EXPOSURE&&e.push("exposureLinear"),t.CONTRAST&&e.push("contrast"),t.COLORGRADING&&e.push("colorTransformSettings"),t.VIGNETTE&&(e.push("vInverseScreenSize"),e.push("vignetteSettings1"),e.push("vignetteSettings2")),t.COLORCURVES&&cr.PrepareUniforms(e)},gr.PrepareSamplers=function(e,t){t.COLORGRADING&&e.push("txColorTransform")},gr.prototype.prepareDefines=function(e,t){if(void 0===t&&(t=!1),t!==this.applyByPostProcess||!this._isEnabled)return e.VIGNETTE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.EXPOSURE=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.IMAGEPROCESSING=!1,void(e.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);switch(e.VIGNETTE=this.vignetteEnabled,e.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===gr._VIGNETTEMODE_MULTIPLY,e.VIGNETTEBLENDMODEOPAQUE=!e.VIGNETTEBLENDMODEMULTIPLY,e.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType){case gr.TONEMAPPING_ACES:e.TONEMAPPING_ACES=!0;break;default:e.TONEMAPPING_ACES=!1}e.CONTRAST=1!==this.contrast,e.EXPOSURE=1!==this.exposure,e.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,e.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,e.COLORGRADING?e.COLORGRADING3D=this.colorGradingTexture.is3D:e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,e.SAMPLER3DBGRMAP=this.colorGradingBGR,e.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,e.IMAGEPROCESSING=e.VIGNETTE||e.TONEMAPPING||e.CONTRAST||e.EXPOSURE||e.COLORCURVES||e.COLORGRADING},gr.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},gr.prototype.bind=function(e,t){var i,r,n,o,s,a,h,l;this._colorCurvesEnabled&&this.colorCurves&&cr.Bind(this.colorCurves,e),this._vignetteEnabled&&(i=1/e.getEngine().getRenderWidth(),r=1/e.getEngine().getRenderHeight(),e.setFloat2("vInverseScreenSize",i,r),n=null!=t?t:r/i,s=(a=Math.tan(.5*this.vignetteCameraFov))*n,o=Math.sqrt(s*a),s=ri.Mix(s,o,this.vignetteStretch),a=ri.Mix(a,o,this.vignetteStretch),e.setFloat4("vignetteSettings1",s,a,-s*this.vignetteCentreX,-a*this.vignetteCentreY),h=-2*this.vignetteWeight,e.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,h)),e.setFloat("exposureLinear",this.exposure),e.setFloat("contrast",this.contrast),this.colorGradingTexture&&(e.setTexture("txColorTransform",this.colorGradingTexture),l=this.colorGradingTexture.getSize().height,e.setFloat4("colorTransformSettings",(l-1)/l,.5/l,l,this.colorGradingTexture.level))},gr.prototype.clone=function(){return Q.Clone(function(){return new gr},this)},gr.prototype.serialize=function(){return Q.Serialize(this)},gr.Parse=function(e){return Q.Parse(function(){return new gr},e,null,null)},Object.defineProperty(gr,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!0,configurable:!0}),Object.defineProperty(gr,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!0,configurable:!0}),gr.TONEMAPPING_STANDARD=0,gr.TONEMAPPING_ACES=1,gr._VIGNETTEMODE_MULTIPLY=0,gr._VIGNETTEMODE_OPAQUE=1,o([U(7,void 0)],gr.prototype,"colorCurves",void 0),o([z()],gr.prototype,"_colorCurvesEnabled",void 0),o([X("colorGradingTexture")],gr.prototype,"_colorGradingTexture",void 0),o([z()],gr.prototype,"_colorGradingEnabled",void 0),o([z()],gr.prototype,"_colorGradingWithGreenDepth",void 0),o([z()],gr.prototype,"_colorGradingBGR",void 0),o([z()],gr.prototype,"_exposure",void 0),o([z()],gr.prototype,"_toneMappingEnabled",void 0),o([z()],gr.prototype,"_toneMappingType",void 0),o([z()],gr.prototype,"_contrast",void 0),o([z()],gr.prototype,"vignetteStretch",void 0),o([z()],gr.prototype,"vignetteCentreX",void 0),o([z()],gr.prototype,"vignetteCentreY",void 0),o([z()],gr.prototype,"vignetteWeight",void 0),o([U(8,void 0)],gr.prototype,"vignetteColor",void 0),o([z()],gr.prototype,"vignetteCameraFov",void 0),o([z()],gr.prototype,"_vignetteBlendMode",void 0),o([z()],gr.prototype,"_vignetteEnabled",void 0),o([z()],gr.prototype,"_applyByPostProcess",void 0),o([z()],gr.prototype,"_isEnabled",void 0),gr);function gr(){this.colorCurves=new cr,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=gr.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new K(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=gr.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new le}Q._ImageProcessingConfigurationParser=_r.Parse,Rt.prototype.createUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create uniform buffer");var i=new At(t);return this.bindUniformBuffer(i),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),i.references=1,i},Rt.prototype.createDynamicUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create dynamic uniform buffer");var i=new At(t);return this.bindUniformBuffer(i),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),i.references=1,i},Rt.prototype.updateUniformBuffer=function(e,t,i,r){this.bindUniformBuffer(e),void 0===i&&(i=0),void 0===r?t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,i,t):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,i,new Float32Array(t)):t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,t.subarray(i,i+r)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(t).subarray(i,i+r)),this.bindUniformBuffer(null)},Rt.prototype.bindUniformBuffer=function(e){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,e?e.underlyingResource:null)},Rt.prototype.bindUniformBufferBase=function(e,t){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,t,e?e.underlyingResource:null)},Rt.prototype.bindUniformBlock=function(e,t,i){var r=e.program,n=this._gl.getUniformBlockIndex(r,t);this._gl.uniformBlockBinding(r,n,i)};var mr=(Object.defineProperty(vr.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!0,configurable:!0}),Object.defineProperty(vr.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!0,configurable:!0}),vr.prototype.isDynamic=function(){return void 0!==this._dynamic},vr.prototype.getData=function(){return this._bufferData},vr.prototype.getBuffer=function(){return this._buffer},vr.prototype._fillAlignment=function(e){var t=e<=2?e:4;if(this._uniformLocationPointer%t!=0){var i=this._uniformLocationPointer;this._uniformLocationPointer+=t-this._uniformLocationPointer%t;for(var r=this._uniformLocationPointer-i,n=0;n<r;n++)this._data.push(0)}},vr.prototype.addUniform=function(e,t){if(!this._noUBO&&void 0===this._uniformLocations[e]){var i;if(t instanceof Array)t=(i=t).length;else{i=[];for(var r=0;r<t;r++)i.push(0)}for(this._fillAlignment(t),this._uniformSizes[e]=t,this._uniformLocations[e]=this._uniformLocationPointer,this._uniformLocationPointer+=t,r=0;r<t;r++)this._data.push(i[r]);this._needSync=!0}},vr.prototype.addMatrix=function(e,t){this.addUniform(e,Array.prototype.slice.call(t.toArray()))},vr.prototype.addFloat2=function(e,t,i){var r=[t,i];this.addUniform(e,r)},vr.prototype.addFloat3=function(e,t,i,r){var n=[t,i,r];this.addUniform(e,n)},vr.prototype.addColor3=function(e,t){var i=new Array;t.toArray(i),this.addUniform(e,i)},vr.prototype.addColor4=function(e,t,i){var r=new Array;t.toArray(r),r.push(i),this.addUniform(e,r)},vr.prototype.addVector3=function(e,t){var i=new Array;t.toArray(i),this.addUniform(e,i)},vr.prototype.addMatrix3x3=function(e){this.addUniform(e,12)},vr.prototype.addMatrix2x2=function(e){this.addUniform(e,8)},vr.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},vr.prototype._rebuild=function(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData))},vr.prototype.update=function(){this._buffer?(this._dynamic||this._needSync)&&(this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._needSync=!1):this.create()},vr.prototype.updateUniform=function(e,t,i){var r=this._uniformLocations[e];if(void 0===r){if(this._buffer)return void fe.Error("Cannot add an uniform after UBO has been created.");this.addUniform(e,i),r=this._uniformLocations[e]}if(this._buffer||this.create(),this._dynamic)for(o=0;o<i;o++)this._bufferData[r+o]=t[o];else{for(var n=!1,o=0;o<i;o++)16!==i&&this._bufferData[r+o]===t[o]||(n=!0,this._bufferData[r+o]=t[o]);this._needSync=this._needSync||n}},vr.prototype._cacheMatrix=function(e,t){var i=this._valueCache[e],r=t.updateFlag;return(void 0===i||i!==r)&&(this._valueCache[e]=r,!0)},vr.prototype._updateMatrix3x3ForUniform=function(e,t){for(var i=0;i<3;i++)vr._tempBuffer[4*i]=t[3*i],vr._tempBuffer[4*i+1]=t[3*i+1],vr._tempBuffer[4*i+2]=t[3*i+2],vr._tempBuffer[4*i+3]=0;this.updateUniform(e,vr._tempBuffer,12)},vr.prototype._updateMatrix3x3ForEffect=function(e,t){this._currentEffect.setMatrix3x3(e,t)},vr.prototype._updateMatrix2x2ForEffect=function(e,t){this._currentEffect.setMatrix2x2(e,t)},vr.prototype._updateMatrix2x2ForUniform=function(e,t){for(var i=0;i<2;i++)vr._tempBuffer[4*i]=t[2*i],vr._tempBuffer[4*i+1]=t[2*i+1],vr._tempBuffer[4*i+2]=0,vr._tempBuffer[4*i+3]=0;this.updateUniform(e,vr._tempBuffer,8)},vr.prototype._updateFloatForEffect=function(e,t){this._currentEffect.setFloat(e,t)},vr.prototype._updateFloatForUniform=function(e,t){vr._tempBuffer[0]=t,this.updateUniform(e,vr._tempBuffer,1)},vr.prototype._updateFloat2ForEffect=function(e,t,i,r){void 0===r&&(r=""),this._currentEffect.setFloat2(e+r,t,i)},vr.prototype._updateFloat2ForUniform=function(e,t,i){vr._tempBuffer[0]=t,vr._tempBuffer[1]=i,this.updateUniform(e,vr._tempBuffer,2)},vr.prototype._updateFloat3ForEffect=function(e,t,i,r,n){void 0===n&&(n=""),this._currentEffect.setFloat3(e+n,t,i,r)},vr.prototype._updateFloat3ForUniform=function(e,t,i,r){vr._tempBuffer[0]=t,vr._tempBuffer[1]=i,vr._tempBuffer[2]=r,this.updateUniform(e,vr._tempBuffer,3)},vr.prototype._updateFloat4ForEffect=function(e,t,i,r,n,o){void 0===o&&(o=""),this._currentEffect.setFloat4(e+o,t,i,r,n)},vr.prototype._updateFloat4ForUniform=function(e,t,i,r,n){vr._tempBuffer[0]=t,vr._tempBuffer[1]=i,vr._tempBuffer[2]=r,vr._tempBuffer[3]=n,this.updateUniform(e,vr._tempBuffer,4)},vr.prototype._updateMatrixForEffect=function(e,t){this._currentEffect.setMatrix(e,t)},vr.prototype._updateMatrixForUniform=function(e,t){this._cacheMatrix(e,t)&&this.updateUniform(e,t.toArray(),16)},vr.prototype._updateVector3ForEffect=function(e,t){this._currentEffect.setVector3(e,t)},vr.prototype._updateVector3ForUniform=function(e,t){t.toArray(vr._tempBuffer),this.updateUniform(e,vr._tempBuffer,3)},vr.prototype._updateVector4ForEffect=function(e,t){this._currentEffect.setVector4(e,t)},vr.prototype._updateVector4ForUniform=function(e,t){t.toArray(vr._tempBuffer),this.updateUniform(e,vr._tempBuffer,4)},vr.prototype._updateColor3ForEffect=function(e,t,i){void 0===i&&(i=""),this._currentEffect.setColor3(e+i,t)},vr.prototype._updateColor3ForUniform=function(e,t){t.toArray(vr._tempBuffer),this.updateUniform(e,vr._tempBuffer,3)},vr.prototype._updateColor4ForEffect=function(e,t,i,r){void 0===r&&(r=""),this._currentEffect.setColor4(e+r,t,i)},vr.prototype._updateColor4ForUniform=function(e,t,i){t.toArray(vr._tempBuffer),vr._tempBuffer[3]=i,this.updateUniform(e,vr._tempBuffer,4)},vr.prototype.setTexture=function(e,t){this._currentEffect.setTexture(e,t)},vr.prototype.updateUniformDirectly=function(e,t){this.updateUniform(e,t,t.length),this.update()},vr.prototype.bindToEffect=function(e,t){this._currentEffect=e,!this._noUBO&&this._buffer&&(this._alreadyBound=!0,e.bindUniformBuffer(this._buffer,t))},vr.prototype.dispose=function(){var e,t;this._noUBO||(-1!==(t=(e=this._engine._uniformBuffers).indexOf(this))&&(e[t]=e[e.length-1],e.pop()),this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null))},vr._MAX_UNIFORM_SIZE=256,vr._tempBuffer=new Float32Array(vr._MAX_UNIFORM_SIZE),vr);function vr(e,t,i){this._alreadyBound=!1,this._valueCache={},this._engine=e,this._noUBO=!e.supportsUniformBuffers,this._dynamic=i,this._data=t||[],this._uniformLocations={},this._uniformSizes={},this._uniformLocationPointer=0,this._needSync=!1,this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform)}var yr,br=(n(Tr,yr=ci),Object.defineProperty(Tr.prototype,"range",{get:function(){return this._range},set:function(e){this._range=e,this._inverseSquaredRange=1/(this.range*this.range)},enumerable:!0,configurable:!0}),Object.defineProperty(Tr.prototype,"intensityMode",{get:function(){return this._intensityMode},set:function(e){this._intensityMode=e,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(Tr.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(Tr.prototype,"shadowEnabled",{get:function(){return this._shadowEnabled},set:function(e){this._shadowEnabled!==e&&(this._shadowEnabled=e,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Tr.prototype,"includedOnlyMeshes",{get:function(){return this._includedOnlyMeshes},set:function(e){this._includedOnlyMeshes=e,this._hookArrayForIncludedOnly(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Tr.prototype,"excludedMeshes",{get:function(){return this._excludedMeshes},set:function(e){this._excludedMeshes=e,this._hookArrayForExcluded(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Tr.prototype,"excludeWithLayerMask",{get:function(){return this._excludeWithLayerMask},set:function(e){this._excludeWithLayerMask=e,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(Tr.prototype,"includeOnlyWithLayerMask",{get:function(){return this._includeOnlyWithLayerMask},set:function(e){this._includeOnlyWithLayerMask=e,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(Tr.prototype,"lightmapMode",{get:function(){return this._lightmapMode},set:function(e){this._lightmapMode!==e&&(this._lightmapMode=e,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Tr.prototype.transferTexturesToEffect=function(e,t){return this},Tr.prototype._bindLight=function(e,t,i,r,n){void 0===n&&(n=!1);var o,s,a=e.toString(),h=!1;n&&this._uniformBuffer._alreadyBound||(this._uniformBuffer.bindToEffect(i,"Light"+a),this._renderId===t.getRenderId()&&this._uniformBuffer.useUbo||(this._renderId=t.getRenderId(),o=this.getScaledIntensity(),this.transferToEffect(i,a),this.diffuse.scaleToRef(o,w.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",w.Color3[0],this.range,a),r&&(this.specular.scaleToRef(o,w.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",w.Color3[1],this.radius,a)),h=!0),this.transferTexturesToEffect(i,a),t.shadowsEnabled&&this.shadowEnabled&&(s=this.getShadowGenerator())&&(s.bindShadowLight(a,i),h=!0),h&&this._uniformBuffer.update())},Tr.prototype.getClassName=function(){return"Light"},Tr.prototype.toString=function(e){var t="Name: "+this.name;if(t+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);return t},Tr.prototype._syncParentEnabledState=function(){yr.prototype._syncParentEnabledState.call(this),this.isDisposed()||this._resyncMeshes()},Tr.prototype.setEnabled=function(e){yr.prototype.setEnabled.call(this,e),this._resyncMeshes()},Tr.prototype.getShadowGenerator=function(){return this._shadowGenerator},Tr.prototype.getAbsolutePosition=function(){return te.Zero()},Tr.prototype.canAffectMesh=function(e){return!(e&&(this.includedOnlyMeshes&&0<this.includedOnlyMeshes.length&&-1===this.includedOnlyMeshes.indexOf(e)||this.excludedMeshes&&0<this.excludedMeshes.length&&-1!==this.excludedMeshes.indexOf(e)||0!==this.includeOnlyWithLayerMask&&0==(this.includeOnlyWithLayerMask&e.layerMask)||0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&e.layerMask))},Tr.CompareLightsPriority=function(e,t){return e.shadowEnabled!==t.shadowEnabled?(t.shadowEnabled?1:0)-(e.shadowEnabled?1:0):t.renderPriority-e.renderPriority},Tr.prototype.dispose=function(e,t){void 0===t&&(t=!1),this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this);for(var i=0,r=this.getScene().meshes;i<r.length;i++)r[i]._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.getScene().removeLight(this),yr.prototype.dispose.call(this,e,t)},Tr.prototype.getTypeID=function(){return 0},Tr.prototype.getScaledIntensity=function(){return this._photometricScale*this.intensity},Tr.prototype.clone=function(e){var t=Tr.GetConstructorFromName(this.getTypeID(),e,this.getScene());return t?Q.Clone(t,this):null},Tr.prototype.serialize=function(){var t=Q.Serialize(this);return t.type=this.getTypeID(),this.parent&&(t.parentId=this.parent.id),0<this.excludedMeshes.length&&(t.excludedMeshesIds=[],this.excludedMeshes.forEach(function(e){t.excludedMeshesIds.push(e.id)})),0<this.includedOnlyMeshes.length&&(t.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(function(e){t.includedOnlyMeshesIds.push(e.id)})),Q.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t},Tr.GetConstructorFromName=function(e,t,i){var r=ci.Construct("Light_Type_"+e,t,i);return r||null},Tr.Parse=function(e,t){var i=Tr.GetConstructorFromName(e.type,e.name,t);if(!i)return null;var r=Q.Parse(i,e,t);if(e.excludedMeshesIds&&(r._excludedMeshesIds=e.excludedMeshesIds),e.includedOnlyMeshesIds&&(r._includedOnlyMeshesIds=e.includedOnlyMeshesIds),e.parentId&&(r._waitingParentId=e.parentId),void 0!==e.falloffType&&(r.falloffType=e.falloffType),void 0!==e.lightmapMode&&(r.lightmapMode=e.lightmapMode),e.animations){for(var n=0;n<e.animations.length;n++){var o=e.animations[n],s=m.GetClass("BABYLON.Animation");s&&r.animations.push(s.Parse(o))}ci.ParseAnimationRanges(r,e,t)}return e.autoAnimate&&t.beginAnimation(r,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),r},Tr.prototype._hookArrayForExcluded=function(o){var s=this,a=o.push;o.push=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var i=a.apply(o,e),r=0,n=e;r<n.length;r++)n[r]._resyncLightSource(s);return i};var h=o.splice;o.splice=function(e,t){for(var i=h.apply(o,[e,t]),r=0,n=i;r<n.length;r++)n[r]._resyncLightSource(s);return i};for(var e=0,t=o;e<t.length;e++)t[e]._resyncLightSource(this)},Tr.prototype._hookArrayForIncludedOnly=function(r){var n=this,o=r.push;r.push=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=o.apply(r,e);return n._resyncMeshes(),i};var s=r.splice;r.splice=function(e,t){var i=s.apply(r,[e,t]);return n._resyncMeshes(),i},this._resyncMeshes()},Tr.prototype._resyncMeshes=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++)t[e]._resyncLightSource(this)},Tr.prototype._markMeshesAsLightDirty=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){var i=t[e];-1!==i.lightSources.indexOf(this)&&i._markSubMeshesAsLightDirty()}},Tr.prototype._computePhotometricScale=function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()},Tr.prototype._getPhotometricScale=function(){var e=0,t=this.getTypeID(),i=this.intensityMode;switch(i===Tr.INTENSITYMODE_AUTOMATIC&&(i=t===Tr.LIGHTTYPEID_DIRECTIONALLIGHT?Tr.INTENSITYMODE_ILLUMINANCE:Tr.INTENSITYMODE_LUMINOUSINTENSITY),t){case Tr.LIGHTTYPEID_POINTLIGHT:case Tr.LIGHTTYPEID_SPOTLIGHT:switch(i){case Tr.INTENSITYMODE_LUMINOUSPOWER:e=1/(4*Math.PI);break;case Tr.INTENSITYMODE_LUMINOUSINTENSITY:e=1;break;case Tr.INTENSITYMODE_LUMINANCE:e=this.radius*this.radius}break;case Tr.LIGHTTYPEID_DIRECTIONALLIGHT:switch(i){case Tr.INTENSITYMODE_ILLUMINANCE:e=1;break;case Tr.INTENSITYMODE_LUMINANCE:var r=this.radius,r=Math.max(r,.001),e=2*Math.PI*(1-Math.cos(r))}break;case Tr.LIGHTTYPEID_HEMISPHERICLIGHT:e=1}return e},Tr.prototype._reorderLightsInScene=function(){var e=this.getScene();0!=this._renderPriority&&(e.requireLightSorting=!0),this.getScene().sortLightsByPriority()},Tr.FALLOFF_DEFAULT=0,Tr.FALLOFF_PHYSICAL=1,Tr.FALLOFF_GLTF=2,Tr.FALLOFF_STANDARD=3,Tr.LIGHTMAP_DEFAULT=0,Tr.LIGHTMAP_SPECULAR=1,Tr.LIGHTMAP_SHADOWSONLY=2,Tr.INTENSITYMODE_AUTOMATIC=0,Tr.INTENSITYMODE_LUMINOUSPOWER=1,Tr.INTENSITYMODE_LUMINOUSINTENSITY=2,Tr.INTENSITYMODE_ILLUMINANCE=3,Tr.INTENSITYMODE_LUMINANCE=4,Tr.LIGHTTYPEID_POINTLIGHT=0,Tr.LIGHTTYPEID_DIRECTIONALLIGHT=1,Tr.LIGHTTYPEID_SPOTLIGHT=2,Tr.LIGHTTYPEID_HEMISPHERICLIGHT=3,o([Y()],Tr.prototype,"diffuse",void 0),o([Y()],Tr.prototype,"specular",void 0),o([z()],Tr.prototype,"falloffType",void 0),o([z()],Tr.prototype,"intensity",void 0),o([z()],Tr.prototype,"range",null),o([z()],Tr.prototype,"intensityMode",null),o([z()],Tr.prototype,"radius",null),o([z()],Tr.prototype,"_renderPriority",void 0),o([V("_reorderLightsInScene")],Tr.prototype,"renderPriority",void 0),o([z("shadowEnabled")],Tr.prototype,"_shadowEnabled",void 0),o([z("excludeWithLayerMask")],Tr.prototype,"_excludeWithLayerMask",void 0),o([z("includeOnlyWithLayerMask")],Tr.prototype,"_includeOnlyWithLayerMask",void 0),o([z("lightmapMode")],Tr.prototype,"_lightmapMode",void 0),Tr);function Tr(e,t){var i=yr.call(this,e,t)||this;return i.diffuse=new Ne(1,1,1),i.specular=new Ne(1,1,1),i.falloffType=Tr.FALLOFF_DEFAULT,i.intensity=1,i._range=Number.MAX_VALUE,i._inverseSquaredRange=0,i._photometricScale=1,i._intensityMode=Tr.INTENSITYMODE_AUTOMATIC,i._radius=1e-5,i.renderPriority=0,i._shadowEnabled=!0,i._excludeWithLayerMask=0,i._includeOnlyWithLayerMask=0,i._lightmapMode=0,i._excludedMeshesIds=new Array,i._includedOnlyMeshesIds=new Array,i._isLight=!0,i.getScene().addLight(i),i._uniformBuffer=new mr(i.getScene().getEngine()),i._buildUniformLayout(),i.includedOnlyMeshes=new Array,i.excludedMeshes=new Array,i._resyncMeshes(),i}var xr=(Er.CreateNew=function(e,t,i){var r=e.getScene();return new Er(e,r.pointerX,r.pointerY,r.meshUnderPointer||e,t,i)},Er.CreateNewFromSprite=function(e,t,i,r){return new Er(e,t.pointerX,t.pointerY,t.meshUnderPointer,i,r)},Er.CreateNewFromScene=function(e,t){return new Er(null,e.pointerX,e.pointerY,e.meshUnderPointer,t)},Er.CreateNewFromPrimitive=function(e,t,i,r){return new Er(e,t.x,t.y,null,i,r)},Er);function Er(e,t,i,r,n,o){this.source=e,this.pointerX=t,this.pointerY=i,this.meshUnderPointer=r,this.sourceEvent=n,this.additionalData=o}var Ar=function(e,t,i){this.bu=e,this.bv=t,this.distance=i,this.faceId=0,this.subMeshId=0},Mr=(Object.defineProperty(Cr.prototype,"materialDefines",{get:function(){return this._materialDefines},set:function(e){this._materialDefines=e},enumerable:!0,configurable:!0}),Object.defineProperty(Cr.prototype,"effect",{get:function(){return this._materialEffect},enumerable:!0,configurable:!0}),Cr.prototype.setEffect=function(e,t){void 0===t&&(t=null),this._materialEffect!==e?(this._materialDefines=t,this._materialEffect=e):e||(this._materialDefines=null)},Cr);function Cr(){this._materialDefines=null,this._materialEffect=null}var Pr,Or=(n(Sr,Pr=Mr),Sr.AddToMesh=function(e,t,i,r,n,o,s,a){return void 0===a&&(a=!0),new Sr(e,t,i,r,n,o,s,a)},Object.defineProperty(Sr.prototype,"IsGlobal",{get:function(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()},enumerable:!0,configurable:!0}),Sr.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},Sr.prototype.setBoundingInfo=function(e){return this._boundingInfo=e,this},Sr.prototype.getMesh=function(){return this._mesh},Sr.prototype.getRenderingMesh=function(){return this._renderingMesh},Sr.prototype.getMaterial=function(){var e=this._renderingMesh.material;if(null==e)return this._mesh.getScene().defaultMaterial;if(e.getSubMaterial){var t=e.getSubMaterial(this.materialIndex);return this._currentMaterial!==t&&(this._currentMaterial=t,this._materialDefines=null),t}return e},Sr.prototype.refreshBoundingInfo=function(e){if(void 0===e&&(e=null),this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(!(e=e||this._renderingMesh.getVerticesData(Si.PositionKind)))return this._boundingInfo=this._mesh.getBoundingInfo(),this;var t,i,r=this._renderingMesh.getIndices();return i=0===this.indexStart&&this.indexCount===r.length?{minimum:(t=this._renderingMesh.getBoundingInfo()).minimum.clone(),maximum:t.maximum.clone()}:function(e,t,i,r,n){void 0===n&&(n=null);for(var o=new te(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new te(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),a=i;a<i+r;a++){var h=3*t[a],l=e[h],u=e[1+h],c=e[2+h];o.minimizeInPlaceFromFloats(l,u,c),s.maximizeInPlaceFromFloats(l,u,c)}return n&&(o.x-=o.x*n.x+n.y,o.y-=o.y*n.x+n.y,o.z-=o.z*n.x+n.y,s.x+=s.x*n.x+n.y,s.y+=s.y*n.x+n.y,s.z+=s.z*n.x+n.y),{minimum:o,maximum:s}}(e,r,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias),this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new Gi(i.minimum,i.maximum),this},Sr.prototype._checkCollision=function(e){return this.getBoundingInfo()._checkCollision(e)},Sr.prototype.updateBoundingInfo=function(e){var t=this.getBoundingInfo();return t||(this.refreshBoundingInfo(),t=this.getBoundingInfo()),t&&t.update(e),this},Sr.prototype.isInFrustum=function(e){var t=this.getBoundingInfo();return!!t&&t.isInFrustum(e,this._mesh.cullingStrategy)},Sr.prototype.isCompletelyInFrustum=function(e){var t=this.getBoundingInfo();return!!t&&t.isCompletelyInFrustum(e)},Sr.prototype.render=function(e){return this._renderingMesh.render(this,e,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this},Sr.prototype._getLinesIndexBuffer=function(e,t){if(!this._linesIndexBuffer){for(var i=[],r=this.indexStart;r<this.indexStart+this.indexCount;r+=3)i.push(e[r],e[r+1],e[r+1],e[r+2],e[r+2],e[r]);this._linesIndexBuffer=t.createIndexBuffer(i),this._linesIndexCount=i.length}return this._linesIndexBuffer},Sr.prototype.canIntersects=function(e){var t=this.getBoundingInfo();return!!t&&e.intersectsBox(t.boundingBox)},Sr.prototype.intersects=function(e,t,i,r,n){var o=this.getMaterial();if(!o)return null;var s=3,a=!1;switch(o.fillMode){case 3:case 4:case 5:case 6:case 8:return null;case 7:s=1,a=!0}return"InstancedLinesMesh"===this._mesh.getClassName()||"LinesMesh"===this._mesh.getClassName()?i.length?this._intersectLines(e,t,i,this._mesh.intersectionThreshold,r):this._intersectUnIndexedLines(e,t,i,this._mesh.intersectionThreshold,r):!i.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(e,t,i,r,n):this._intersectTriangles(e,t,i,s,a,r,n)},Sr.prototype._intersectLines=function(e,t,i,r,n){for(var o=null,s=this.indexStart;s<this.indexStart+this.indexCount;s+=2){var a=t[i[s]],h=t[i[s+1]],l=e.intersectionSegment(a,h,r);if(!(l<0)&&(n||!o||l<o.distance)&&((o=new Ar(null,null,l)).faceId=s/2,n))break}return o},Sr.prototype._intersectUnIndexedLines=function(e,t,i,r,n){for(var o=null,s=this.verticesStart;s<this.verticesStart+this.verticesCount;s+=2){var a=t[s],h=t[s+1],l=e.intersectionSegment(a,h,r);if(!(l<0)&&(n||!o||l<o.distance)&&((o=new Ar(null,null,l)).faceId=s/2,n))break}return o},Sr.prototype._intersectTriangles=function(e,t,i,r,n,o,s){for(var a=null,h=-1,l=this.indexStart;l<this.indexStart+this.indexCount;l+=r){h++;var u=i[l],c=i[l+1],d=i[l+2];if(n&&4294967295===d)l+=2;else{var f=t[u],p=t[c],_=t[d];if(!s||s(f,p,_,e)){var g=e.intersectsTriangle(f,p,_);if(g){if(g.distance<0)continue;if((o||!a||g.distance<a.distance)&&((a=g).faceId=h,o))break}}}}return a},Sr.prototype._intersectUnIndexedTriangles=function(e,t,i,r,n){for(var o=null,s=this.verticesStart;s<this.verticesStart+this.verticesCount;s+=3){var a=t[s],h=t[s+1],l=t[s+2];if(!n||n(a,h,l,e)){var u=e.intersectsTriangle(a,h,l);if(u){if(u.distance<0)continue;if((r||!o||u.distance<o.distance)&&((o=u).faceId=s/3,r))break}}}return o},Sr.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},Sr.prototype.clone=function(e,t){var i=new Sr(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,e,t,!1);if(!this.IsGlobal){var r=this.getBoundingInfo();if(!r)return i;i._boundingInfo=new Gi(r.minimum,r.maximum)}return i},Sr.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var e=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(e,1)},Sr.prototype.getClassName=function(){return"SubMesh"},Sr.CreateFromIndices=function(e,t,i,r,n){for(var o=Number.MAX_VALUE,s=-Number.MAX_VALUE,a=(n||r).getIndices(),h=t;h<t+i;h++){var l=a[h];l<o&&(o=l),s<l&&(s=l)}return new Sr(e,o,s-o+1,t,i,r,n)},Sr);function Sr(e,t,i,r,n,o,s,a){void 0===a&&(a=!0);var h=Pr.call(this)||this;return h.materialIndex=e,h.verticesStart=t,h.verticesCount=i,h.indexStart=r,h.indexCount=n,h._linesIndexCount=0,h._linesIndexBuffer=null,h._lastColliderWorldVertices=null,h._lastColliderTransformMatrix=null,h._renderId=0,h._alphaIndex=0,h._distanceToCamera=0,h._currentMaterial=null,h._mesh=o,h._renderingMesh=s||o,o.subMeshes.push(h),h._trianglePlanes=[],h._id=o.subMeshes.length-1,a&&(h.refreshBoundingInfo(),o.computeWorldMatrix(!0)),h}var Ir=(Object.defineProperty(Rr.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha!==e&&(this._alpha=e,this.markAsDirty(Rr.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(Rr.prototype,"backFaceCulling",{get:function(){return this._backFaceCulling},set:function(e){this._backFaceCulling!==e&&(this._backFaceCulling=e,this.markAsDirty(Rr.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(Rr.prototype,"hasRenderTargetTextures",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(Rr.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Rr.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new le),this._onBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(Rr.prototype,"onBind",{set:function(e){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Rr.prototype,"onUnBindObservable",{get:function(){return this._onUnBindObservable||(this._onUnBindObservable=new le),this._onUnBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(Rr.prototype,"alphaMode",{get:function(){return this._alphaMode},set:function(e){this._alphaMode!==e&&(this._alphaMode=e,this.markAsDirty(Rr.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(Rr.prototype,"needDepthPrePass",{get:function(){return this._needDepthPrePass},set:function(e){this._needDepthPrePass!==e&&(this._needDepthPrePass=e,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))},enumerable:!0,configurable:!0}),Object.defineProperty(Rr.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAsDirty(Rr.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(Rr.prototype,"wireframe",{get:function(){switch(this._fillMode){case Rr.WireFrameFillMode:case Rr.LineListDrawMode:case Rr.LineLoopDrawMode:case Rr.LineStripDrawMode:return!0}return this._scene.forceWireframe},set:function(e){this.fillMode=e?Rr.WireFrameFillMode:Rr.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(Rr.prototype,"pointsCloud",{get:function(){switch(this._fillMode){case Rr.PointFillMode:case Rr.PointListDrawMode:return!0}return this._scene.forcePointsCloud},set:function(e){this.fillMode=e?Rr.PointFillMode:Rr.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(Rr.prototype,"fillMode",{get:function(){return this._fillMode},set:function(e){this._fillMode!==e&&(this._fillMode=e,this.markAsDirty(Rr.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Rr.prototype.toString=function(e){return"Name: "+this.name},Rr.prototype.getClassName=function(){return"Material"},Object.defineProperty(Rr.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!0,configurable:!0}),Rr.prototype.freeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!0},Rr.prototype.unfreeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!1},Rr.prototype.isReady=function(e,t){return!0},Rr.prototype.isReadyForSubMesh=function(e,t,i){return!1},Rr.prototype.getEffect=function(){return this._effect},Rr.prototype.getScene=function(){return this._scene},Rr.prototype.needAlphaBlending=function(){return this.alpha<1},Rr.prototype.needAlphaBlendingForMesh=function(e){return this.needAlphaBlending()||e.visibility<1||e.hasVertexAlpha},Rr.prototype.needAlphaTesting=function(){return!1},Rr.prototype.getAlphaTestTexture=function(){return null},Rr.prototype.markDirty=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){var i=t[e];if(i.subMeshes)for(var r=0,n=i.subMeshes;r<n.length;r++){var o=n[r];o.getMaterial()===this&&o.effect&&(o.effect._wasPreviouslyReady=!1)}}},Rr.prototype._preBind=function(e,t){void 0===t&&(t=null);var i=this._scene.getEngine(),r=(null==t?this.sideOrientation:t)===Rr.ClockWiseSideOrientation;return i.enableEffect(e||this._effect),i.setState(this.backFaceCulling,this.zOffset,!1,r),r},Rr.prototype.bind=function(e,t){},Rr.prototype.bindForSubMesh=function(e,t,i){},Rr.prototype.bindOnlyWorldMatrix=function(e){},Rr.prototype.bindSceneUniformBuffer=function(e,t){t.bindToEffect(e,"Scene")},Rr.prototype.bindView=function(e){this._useUBO?this.bindSceneUniformBuffer(e,this.getScene().getSceneUniformBuffer()):e.setMatrix("view",this.getScene().getViewMatrix())},Rr.prototype.bindViewProjection=function(e){this._useUBO?this.bindSceneUniformBuffer(e,this.getScene().getSceneUniformBuffer()):e.setMatrix("viewProjection",this.getScene().getTransformMatrix())},Rr.prototype._shouldTurnAlphaTestOn=function(e){return!this.needAlphaBlendingForMesh(e)&&this.needAlphaTesting()},Rr.prototype._afterBind=function(e){var t;(this._scene._cachedMaterial=this)._scene._cachedVisibility=e?e.visibility:1,this._onBindObservable&&e&&this._onBindObservable.notifyObservers(e),this.disableDepthWrite&&(t=this._scene.getEngine(),this._cachedDepthWriteState=t.getDepthWrite(),t.setDepthWrite(!1)),0!==this.depthFunction&&(t=this._scene.getEngine(),this._cachedDepthFunctionState=t.getDepthFunction()||0,t.setDepthFunction(this.depthFunction))},Rr.prototype.unbind=function(){this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction&&this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState),this.disableDepthWrite&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)},Rr.prototype.getActiveTextures=function(){return[]},Rr.prototype.hasTexture=function(e){return!1},Rr.prototype.clone=function(e){return null},Rr.prototype.getBindedMeshes=function(){var t=this;if(this.meshMap){var e=new Array;for(var i in this.meshMap){var r=this.meshMap[i];r&&e.push(r)}return e}return this._scene.meshes.filter(function(e){return e.material===t})},Rr.prototype.forceCompilation=function(t,i,e,r){var n=this,o=l({clipPlane:!1,useInstances:!1},e),s=new Mr,a=this.getScene(),h=function(){var e;n._scene&&n._scene.getEngine()&&(s._materialDefines&&(s._materialDefines._renderId=-1),e=a.clipPlane,o.clipPlane&&(a.clipPlane=new er(0,0,0,1)),n._storeEffectOnSubMeshes?n.isReadyForSubMesh(t,s,o.useInstances)?i&&i(n):s.effect&&s.effect.getCompilationError()&&s.effect.allFallbacksProcessed()?r&&r(s.effect.getCompilationError()):setTimeout(h,16):n.isReady()?i&&i(n):setTimeout(h,16),o.clipPlane&&(a.clipPlane=e))};h()},Rr.prototype.forceCompilationAsync=function(i,r){var n=this;return new Promise(function(e,t){n.forceCompilation(i,function(){e()},r,function(e){t(e)})})},Rr.prototype.markAsDirty=function(e){this.getScene().blockMaterialDirtyMechanism||(Rr._DirtyCallbackArray.length=0,e&Rr.TextureDirtyFlag&&Rr._DirtyCallbackArray.push(Rr._TextureDirtyCallBack),e&Rr.LightDirtyFlag&&Rr._DirtyCallbackArray.push(Rr._LightsDirtyCallBack),e&Rr.FresnelDirtyFlag&&Rr._DirtyCallbackArray.push(Rr._FresnelDirtyCallBack),e&Rr.AttributesDirtyFlag&&Rr._DirtyCallbackArray.push(Rr._AttributeDirtyCallBack),e&Rr.MiscDirtyFlag&&Rr._DirtyCallbackArray.push(Rr._MiscDirtyCallBack),Rr._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(Rr._RunDirtyCallBacks),this.getScene().resetCachedMaterial())},Rr.prototype._markAllSubMeshesAsDirty=function(e){if(!this.getScene().blockMaterialDirtyMechanism)for(var t=0,i=this.getScene().meshes;t<i.length;t++){var r=i[t];if(r.subMeshes)for(var n=0,o=r.subMeshes;n<o.length;n++){var s=o[n];s.getMaterial()===this&&s._materialDefines&&e(s._materialDefines)}}},Rr.prototype._markAllSubMeshesAsAllDirty=function(){this._markAllSubMeshesAsDirty(Rr._AllDirtyCallBack)},Rr.prototype._markAllSubMeshesAsImageProcessingDirty=function(){this._markAllSubMeshesAsDirty(Rr._ImageProcessingDirtyCallBack)},Rr.prototype._markAllSubMeshesAsTexturesDirty=function(){this._markAllSubMeshesAsDirty(Rr._TextureDirtyCallBack)},Rr.prototype._markAllSubMeshesAsFresnelDirty=function(){this._markAllSubMeshesAsDirty(Rr._FresnelDirtyCallBack)},Rr.prototype._markAllSubMeshesAsFresnelAndMiscDirty=function(){this._markAllSubMeshesAsDirty(Rr._FresnelAndMiscDirtyCallBack)},Rr.prototype._markAllSubMeshesAsLightsDirty=function(){this._markAllSubMeshesAsDirty(Rr._LightsDirtyCallBack)},Rr.prototype._markAllSubMeshesAsAttributesDirty=function(){this._markAllSubMeshesAsDirty(Rr._AttributeDirtyCallBack)},Rr.prototype._markAllSubMeshesAsMiscDirty=function(){this._markAllSubMeshesAsDirty(Rr._MiscDirtyCallBack)},Rr.prototype._markAllSubMeshesAsTexturesAndMiscDirty=function(){this._markAllSubMeshesAsDirty(Rr._TextureAndMiscDirtyCallBack)},Rr.prototype.dispose=function(e,t,i){var r=this.getScene();if(r.stopAnimation(this),r.freeProcessedMaterials(),r.removeMaterial(this),!0!==i)if(this.meshMap)for(var n in this.meshMap)(o=this.meshMap[n])&&(o.material=null,this.releaseVertexArrayObject(o,e));else for(var o,s=0,a=r.meshes;s<a.length;s++)(o=a[s]).material!==this||o.sourceMesh||(o.material=null,this.releaseVertexArrayObject(o,e));this._uniformBuffer.dispose(),e&&this._effect&&(this._storeEffectOnSubMeshes||this._effect.dispose(),this._effect=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear()},Rr.prototype.releaseVertexArrayObject=function(e,t){if(e.geometry){var i=e.geometry;if(this._storeEffectOnSubMeshes)for(var r=0,n=e.subMeshes;r<n.length;r++){var o=n[r];i._releaseVertexArrayObject(o._materialEffect),t&&o._materialEffect&&o._materialEffect.dispose()}else i._releaseVertexArrayObject(this._effect)}},Rr.prototype.serialize=function(){return Q.Serialize(this)},Rr.Parse=function(e,t,i){if(e.customType){if("BABYLON.PBRMaterial"===e.customType&&e.overloadedAlbedo&&(e.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return fe.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else e.customType="BABYLON.StandardMaterial";return ri.Instantiate(e.customType).Parse(e,t,i)},Rr.TriangleFillMode=0,Rr.WireFrameFillMode=1,Rr.PointFillMode=2,Rr.PointListDrawMode=3,Rr.LineListDrawMode=4,Rr.LineLoopDrawMode=5,Rr.LineStripDrawMode=6,Rr.TriangleStripDrawMode=7,Rr.TriangleFanDrawMode=8,Rr.ClockWiseSideOrientation=0,Rr.CounterClockWiseSideOrientation=1,Rr.TextureDirtyFlag=1,Rr.LightDirtyFlag=2,Rr.FresnelDirtyFlag=4,Rr.AttributesDirtyFlag=8,Rr.MiscDirtyFlag=16,Rr.AllDirtyFlag=31,Rr._AllDirtyCallBack=function(e){return e.markAllAsDirty()},Rr._ImageProcessingDirtyCallBack=function(e){return e.markAsImageProcessingDirty()},Rr._TextureDirtyCallBack=function(e){return e.markAsTexturesDirty()},Rr._FresnelDirtyCallBack=function(e){return e.markAsFresnelDirty()},Rr._MiscDirtyCallBack=function(e){return e.markAsMiscDirty()},Rr._LightsDirtyCallBack=function(e){return e.markAsLightDirty()},Rr._AttributeDirtyCallBack=function(e){return e.markAsAttributesDirty()},Rr._FresnelAndMiscDirtyCallBack=function(e){Rr._FresnelDirtyCallBack(e),Rr._MiscDirtyCallBack(e)},Rr._TextureAndMiscDirtyCallBack=function(e){Rr._TextureDirtyCallBack(e),Rr._MiscDirtyCallBack(e)},Rr._DirtyCallbackArray=[],Rr._RunDirtyCallBacks=function(e){for(var t=0,i=Rr._DirtyCallbackArray;t<i.length;t++)(0,i[t])(e)},o([z()],Rr.prototype,"id",void 0),o([z()],Rr.prototype,"uniqueId",void 0),o([z()],Rr.prototype,"name",void 0),o([z()],Rr.prototype,"checkReadyOnEveryCall",void 0),o([z()],Rr.prototype,"checkReadyOnlyOnce",void 0),o([z()],Rr.prototype,"state",void 0),o([z("alpha")],Rr.prototype,"_alpha",void 0),o([z("backFaceCulling")],Rr.prototype,"_backFaceCulling",void 0),o([z()],Rr.prototype,"sideOrientation",void 0),o([z("alphaMode")],Rr.prototype,"_alphaMode",void 0),o([z()],Rr.prototype,"_needDepthPrePass",void 0),o([z()],Rr.prototype,"disableDepthWrite",void 0),o([z()],Rr.prototype,"forceDepthWrite",void 0),o([z()],Rr.prototype,"depthFunction",void 0),o([z()],Rr.prototype,"separateCullingPass",void 0),o([z("fogEnabled")],Rr.prototype,"_fogEnabled",void 0),o([z()],Rr.prototype,"pointSize",void 0),o([z()],Rr.prototype,"zOffset",void 0),o([z()],Rr.prototype,"wireframe",null),o([z()],Rr.prototype,"pointsCloud",null),o([z()],Rr.prototype,"fillMode",null),Rr);function Rr(e,t,i){this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new le,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this._effect=null,this._useUBO=!1,this._fillMode=Rr.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this.name=e,this.id=e||ri.RandomId(),this._scene=t||Ae.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._scene.useRightHandedSystem?this.sideOrientation=Rr.ClockWiseSideOrientation:this.sideOrientation=Rr.CounterClockWiseSideOrientation,this._uniformBuffer=new mr(this._scene.getEngine()),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,i||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={})}var Dr=(wr.prototype._prepareBuffers=function(){var e;this._vertexBuffers[Si.PositionKind]||((e=[]).push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1),this._vertexBuffers[Si.PositionKind]=new Si(this._scene.getEngine(),e,Si.PositionKind,!1,!1,2),this._buildIndexBuffer())},wr.prototype._buildIndexBuffer=function(){var e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)},wr.prototype._rebuild=function(){var e=this._vertexBuffers[Si.PositionKind];e&&(e._rebuild(),this._buildIndexBuffer())},wr.prototype._prepareFrame=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var i=this._scene.activeCamera;return!(!i||!(t=t||i._postProcesses.filter(function(e){return null!=e}))||0===t.length||!this._scene.postProcessesEnabled||(t[0].activate(i,e,null!=t),0))},wr.prototype.directRender=function(e,t,i,r,n){void 0===t&&(t=null),void 0===i&&(i=!1),void 0===r&&(r=0),void 0===n&&(n=0);for(var o=this._scene.getEngine(),s=0;s<e.length;s++){s<e.length-1?e[s+1].activate(this._scene.activeCamera,t):t?o.bindFramebuffer(t,r,void 0,void 0,i,n):o.restoreDefaultFramebuffer();var a=e[s],h=a.apply();h&&(a.onBeforeRenderObservable.notifyObservers(h),this._prepareBuffers(),o.bindBuffers(this._vertexBuffers,this._indexBuffer,h),o.drawElementsType(Ir.TriangleFillMode,0,6),a.onAfterRenderObservable.notifyObservers(h))}o.setDepthBuffer(!0),o.setDepthWrite(!0)},wr.prototype._finalizeFrame=function(e,t,i,r,n){void 0===n&&(n=!1);var o=this._scene.activeCamera;if(o&&0!==(r=r||o._postProcesses.filter(function(e){return null!=e})).length&&this._scene.postProcessesEnabled){for(var s=this._scene.getEngine(),a=0,h=r.length;a<h;a++){var l=r[a];if(a<h-1?l._outputTexture=r[a+1].activate(o,t):t?(s.bindFramebuffer(t,i,void 0,void 0,n),l._outputTexture=t):(s.restoreDefaultFramebuffer(),l._outputTexture=null),e)break;var u=l.apply();u&&(l.onBeforeRenderObservable.notifyObservers(u),this._prepareBuffers(),s.bindBuffers(this._vertexBuffers,this._indexBuffer,u),s.drawElementsType(Ir.TriangleFillMode,0,6),l.onAfterRenderObservable.notifyObservers(u))}s.setDepthBuffer(!0),s.setDepthWrite(!0),s.setAlphaMode(0)}},wr.prototype.dispose=function(){var e=this._vertexBuffers[Si.PositionKind];e&&(e.dispose(),this._vertexBuffers[Si.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},wr);function wr(e){this._vertexBuffers={},this._scene=e}var Lr=(Object.defineProperty(Fr.prototype,"opaqueSortCompareFn",{set:function(e){this._opaqueSortCompareFn=e,this._renderOpaque=e?this.renderOpaqueSorted:Fr.renderUnsorted},enumerable:!0,configurable:!0}),Object.defineProperty(Fr.prototype,"alphaTestSortCompareFn",{set:function(e){this._alphaTestSortCompareFn=e,this._renderAlphaTest=e?this.renderAlphaTestSorted:Fr.renderUnsorted},enumerable:!0,configurable:!0}),Object.defineProperty(Fr.prototype,"transparentSortCompareFn",{set:function(e){this._transparentSortCompareFn=e||Fr.defaultTransparentSortCompare,this._renderTransparent=this.renderTransparentSorted},enumerable:!0,configurable:!0}),Fr.prototype.render=function(e,t,i,r){if(e)e(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);else{var n=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(n.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),n.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);var o=n.getStencilBuffer();if(n.setStencilBuffer(!1),t&&this._renderSprites(),i&&this._renderParticles(r),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length&&(this._renderTransparent(this._transparentSubMeshes),n.setAlphaMode(0)),n.setStencilBuffer(!1),this._edgesRenderers.length){for(var s=0;s<this._edgesRenderers.length;s++)this._edgesRenderers.data[s].render();n.setAlphaMode(0)}n.setStencilBuffer(o)}},Fr.prototype.renderOpaqueSorted=function(e){return Fr.renderSorted(e,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},Fr.prototype.renderAlphaTestSorted=function(e){return Fr.renderSorted(e,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},Fr.prototype.renderTransparentSorted=function(e){return Fr.renderSorted(e,this._transparentSortCompareFn,this._scene.activeCamera,!0)},Fr.renderSorted=function(e,t,i,r){for(var n=0,o=i?i.globalPosition:Fr._zeroVector;n<e.length;n++)(l=e.data[n])._alphaIndex=l.getMesh().alphaIndex,l._distanceToCamera=te.Distance(l.getBoundingInfo().boundingSphere.centerWorld,o);var s=e.data.slice(0,e.length);for(t&&s.sort(t),n=0;n<s.length;n++){var a,h,l=s[n];!r||(a=l.getMaterial())&&a.needDepthPrePass&&((h=a.getScene().getEngine()).setColorWrite(!1),h.setAlphaMode(0),l.render(!1),h.setColorWrite(!0)),l.render(r)}},Fr.renderUnsorted=function(e){for(var t=0;t<e.length;t++)e.data[t].render(!1)},Fr.defaultTransparentSortCompare=function(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:Fr.backToFrontSortCompare(e,t)},Fr.backToFrontSortCompare=function(e,t){return e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0},Fr.frontToBackSortCompare=function(e,t){return e._distanceToCamera<t._distanceToCamera?-1:e._distanceToCamera>t._distanceToCamera?1:0},Fr.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset()},Fr.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},Fr.prototype.dispatch=function(e,t,i){void 0===t&&(t=e.getMesh()),void 0===i&&(i=e.getMaterial()),null!=i&&(i.needAlphaBlendingForMesh(t)?this._transparentSubMeshes.push(e):i.needAlphaTesting()?(i.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._alphaTestSubMeshes.push(e)):(i.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._opaqueSubMeshes.push(e)),t._renderingGroup=this,t._edgesRenderer&&t._edgesRenderer.isEnabled&&this._edgesRenderers.push(t._edgesRenderer))},Fr.prototype.dispatchSprites=function(e){this._spriteManagers.push(e)},Fr.prototype.dispatchParticles=function(e){this._particleSystems.push(e)},Fr.prototype._renderParticles=function(e){if(0!==this._particleSystems.length){var t=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var i=0;i<this._particleSystems.length;i++){var r,n=this._particleSystems.data[i];0!==(t&&t.layerMask&n.layerMask)&&((r=n.emitter).position&&e&&-1===e.indexOf(r)||this._scene._activeParticles.addCount(n.render(),!1))}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},Fr.prototype._renderSprites=function(){if(this._scene.spritesEnabled&&0!==this._spriteManagers.length){var e=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var t=0;t<this._spriteManagers.length;t++){var i=this._spriteManagers.data[t];0!==(e&&e.layerMask&i.layerMask)&&i.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},Fr._zeroVector=te.Zero(),Fr);function Fr(e,t,i,r,n){void 0===i&&(i=null),void 0===r&&(r=null),void 0===n&&(n=null),this.index=e,this._opaqueSubMeshes=new $(256),this._transparentSubMeshes=new $(256),this._alphaTestSubMeshes=new $(256),this._depthOnlySubMeshes=new $(256),this._particleSystems=new $(256),this._spriteManagers=new $(256),this._edgesRenderers=new $(16),this._scene=t,this.opaqueSortCompareFn=i,this.alphaTestSortCompareFn=r,this.transparentSortCompareFn=n}var Nr=function(){},Br=(kr.prototype._clearDepthStencilBuffer=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0),this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,e,t),this._depthStencilBufferAlreadyCleaned=!0)},kr.prototype.render=function(e,t,i,r){var n=this._renderingGroupInfo;if(n.scene=this._scene,n.camera=this._scene.activeCamera,this._scene.spriteManagers&&r)for(var o=0;o<this._scene.spriteManagers.length;o++){var s=this._scene.spriteManagers[o];this.dispatchSprites(s)}for(o=kr.MIN_RENDERINGGROUPS;o<kr.MAX_RENDERINGGROUPS;o++){this._depthStencilBufferAlreadyCleaned=o===kr.MIN_RENDERINGGROUPS;var a=this._renderingGroups[o];if(a){var h,l=Math.pow(2,o);n.renderingGroupId=o,this._scene.onBeforeRenderingGroupObservable.notifyObservers(n,l),!kr.AUTOCLEAR||(h=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(o):this._autoClearDepthStencil[o])&&h.autoClear&&this._clearDepthStencilBuffer(h.depth,h.stencil);for(var u=0,c=this._scene._beforeRenderingGroupDrawStage;u<c.length;u++)c[u].action(o);a.render(e,r,i,t);for(var d=0,f=this._scene._afterRenderingGroupDrawStage;d<f.length;d++)f[d].action(o);this._scene.onAfterRenderingGroupObservable.notifyObservers(n,l)}}},kr.prototype.reset=function(){for(var e=kr.MIN_RENDERINGGROUPS;e<kr.MAX_RENDERINGGROUPS;e++){var t=this._renderingGroups[e];t&&t.prepare()}},kr.prototype.dispose=function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null},kr.prototype.freeRenderingGroups=function(){for(var e=kr.MIN_RENDERINGGROUPS;e<kr.MAX_RENDERINGGROUPS;e++){var t=this._renderingGroups[e];t&&t.dispose()}},kr.prototype._prepareRenderingGroup=function(e){void 0===this._renderingGroups[e]&&(this._renderingGroups[e]=new Lr(e,this._scene,this._customOpaqueSortCompareFn[e],this._customAlphaTestSortCompareFn[e],this._customTransparentSortCompareFn[e]))},kr.prototype.dispatchSprites=function(e){var t=e.renderingGroupId||0;this._prepareRenderingGroup(t),this._renderingGroups[t].dispatchSprites(e)},kr.prototype.dispatchParticles=function(e){var t=e.renderingGroupId||0;this._prepareRenderingGroup(t),this._renderingGroups[t].dispatchParticles(e)},kr.prototype.dispatch=function(e,t,i){void 0===t&&(t=e.getMesh());var r=t.renderingGroupId||0;this._prepareRenderingGroup(r),this._renderingGroups[r].dispatch(e,t,i)},kr.prototype.setRenderingOrder=function(e,t,i,r){var n;void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=null),this._customOpaqueSortCompareFn[e]=t,this._customAlphaTestSortCompareFn[e]=i,this._customTransparentSortCompareFn[e]=r,this._renderingGroups[e]&&((n=this._renderingGroups[e]).opaqueSortCompareFn=this._customOpaqueSortCompareFn[e],n.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[e],n.transparentSortCompareFn=this._customTransparentSortCompareFn[e])},kr.prototype.setRenderingAutoClearDepthStencil=function(e,t,i,r){void 0===i&&(i=!0),void 0===r&&(r=!0),this._autoClearDepthStencil[e]={autoClear:t,depth:i,stencil:r}},kr.prototype.getAutoClearDepthStencilSetup=function(e){return this._autoClearDepthStencil[e]},kr.MAX_RENDERINGGROUPS=4,kr.MIN_RENDERINGGROUPS=0,kr.AUTOCLEAR=!0,kr);function kr(e){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new Nr,this._scene=e;for(var t=kr.MIN_RENDERINGGROUPS;t<kr.MAX_RENDERINGGROUPS;t++)this._autoClearDepthStencil[t]={autoClear:!0,depth:!0,stencil:!0}}var Ur=(Vr.NAME_EFFECTLAYER="EffectLayer",Vr.NAME_LAYER="Layer",Vr.NAME_LENSFLARESYSTEM="LensFlareSystem",Vr.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",Vr.NAME_PARTICLESYSTEM="ParticleSystem",Vr.NAME_GAMEPAD="Gamepad",Vr.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",Vr.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",Vr.NAME_DEPTHRENDERER="DepthRenderer",Vr.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",Vr.NAME_SPRITE="Sprite",Vr.NAME_OUTLINERENDERER="Outline",Vr.NAME_PROCEDURALTEXTURE="ProceduralTexture",Vr.NAME_SHADOWGENERATOR="ShadowGenerator",Vr.NAME_OCTREE="Octree",Vr.NAME_PHYSICSENGINE="PhysicsEngine",Vr.NAME_AUDIO="Audio",Vr.STEP_ISREADYFORMESH_EFFECTLAYER=0,Vr.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,Vr.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,Vr.STEP_ACTIVEMESH_BOUNDINGBOXRENDERER=0,Vr.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,Vr.STEP_BEFORECAMERADRAW_EFFECTLAYER=0,Vr.STEP_BEFORECAMERADRAW_LAYER=1,Vr.STEP_BEFORERENDERTARGETDRAW_LAYER=0,Vr.STEP_BEFORERENDERINGMESH_OUTLINE=0,Vr.STEP_AFTERRENDERINGMESH_OUTLINE=0,Vr.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,Vr.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,Vr.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,Vr.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,Vr.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,Vr.STEP_AFTERRENDERTARGETDRAW_LAYER=0,Vr.STEP_AFTERCAMERADRAW_EFFECTLAYER=0,Vr.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=1,Vr.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=2,Vr.STEP_AFTERCAMERADRAW_LAYER=3,Vr.STEP_AFTERRENDER_AUDIO=0,Vr.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,Vr.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,Vr.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,Vr.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,Vr.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,Vr.STEP_POINTERMOVE_SPRITE=0,Vr.STEP_POINTERDOWN_SPRITE=0,Vr.STEP_POINTERUP_SPRITE=0,Vr);function Vr(){}var zr,Wr=(n(Gr,zr=Array),Gr.Create=function(){return Object.create(Gr.prototype)},Gr.prototype.registerStep=function(e,t,i){var r=0;for(Number.MAX_VALUE;r<this.length&&!(e<this[r].index);r++);this.splice(r,0,{index:e,component:t,action:i.bind(t)})},Gr.prototype.clear=function(){this.length=0},Gr);function Gr(e){return zr.apply(this,e)||this}var Xr=(Hr.POINTERDOWN=1,Hr.POINTERUP=2,Hr.POINTERMOVE=4,Hr.POINTERWHEEL=8,Hr.POINTERPICK=16,Hr.POINTERTAP=32,Hr.POINTERDOUBLETAP=64,Hr);function Hr(){}function jr(e,t){this.type=e,this.event=t}var Kr,Yr=(n(qr,Kr=jr),qr);function qr(e,t,i,r){var n=Kr.call(this,e,t)||this;return n.ray=null,n.skipOnPointerObservable=!1,n.localPosition=new H(i,r),n}var Zr,Qr=(n(Jr,Zr=jr),Jr);function Jr(e,t,i){var r=Zr.call(this,e,t)||this;return r.pickInfo=i,r}var $r=(Object.defineProperty(en,"HasTriggers",{get:function(){for(var e in en.Triggers)if(en.Triggers.hasOwnProperty(e))return!0;return!1},enumerable:!0,configurable:!0}),Object.defineProperty(en,"HasPickTriggers",{get:function(){for(var e in en.Triggers)if(en.Triggers.hasOwnProperty(e)){var t=parseInt(e);if(1<=t&&t<=7)return!0}return!1},enumerable:!0,configurable:!0}),en.HasSpecificTrigger=function(e){for(var t in en.Triggers)if(en.Triggers.hasOwnProperty(t)&&parseInt(t)===e)return!0;return!1},en.Triggers={},en);function en(){this.hoverCursor="",this.actions=new Array,this.isRecursive=!1}var tn=(rn.KEYDOWN=1,rn.KEYUP=2,rn);function rn(){}var nn,on=function(e,t){this.type=e,this.event=t},sn=(n(an,nn=on),an);function an(e,t){var i=nn.call(this,e,t)||this;return i.type=e,i.event=t,i.skipOnPointerObservable=!1,i}var hn=(Object.defineProperty(ln.prototype,"singleClick",{get:function(){return this._singleClick},set:function(e){this._singleClick=e},enumerable:!0,configurable:!0}),Object.defineProperty(ln.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(e){this._doubleClick=e},enumerable:!0,configurable:!0}),Object.defineProperty(ln.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(e){this._hasSwiped=e},enumerable:!0,configurable:!0}),Object.defineProperty(ln.prototype,"ignore",{get:function(){return this._ignore},set:function(e){this._ignore=e},enumerable:!0,configurable:!0}),ln);function ln(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}var un=(Object.defineProperty(cn.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!0,configurable:!0}),Object.defineProperty(cn.prototype,"unTranslatedPointer",{get:function(){return new H(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!0,configurable:!0}),Object.defineProperty(cn.prototype,"pointerX",{get:function(){return this._pointerX},set:function(e){this._pointerX=e},enumerable:!0,configurable:!0}),Object.defineProperty(cn.prototype,"pointerY",{get:function(){return this._pointerY},set:function(e){this._pointerY=e},enumerable:!0,configurable:!0}),cn.prototype._updatePointerPosition=function(e){var t=this._scene.getEngine().getInputElementClientRect();t&&(this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},cn.prototype._processPointerMove=function(e,t){var i=this._scene,r=i.getEngine(),n=r.getInputElement();if(n){n.tabIndex=r.canvasTabIndex,i.doNotHandleCursors||(n.style.cursor=i.defaultCursor);var o=!!(e&&e.hit&&e.pickedMesh);o?(i.setPointerOverMesh(e.pickedMesh),this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.hasPointerTriggers&&(i.doNotHandleCursors||(this._pointerOverMesh.actionManager.hoverCursor?n.style.cursor=this._pointerOverMesh.actionManager.hoverCursor:n.style.cursor=i.hoverCursor))):i.setPointerOverMesh(null);for(var s,a,h=0,l=i._pointerMoveStage;h<l.length;h++)e=l[h].action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,o,n);e&&(s=t.type===this._wheelEventName?Xr.POINTERWHEEL:Xr.POINTERMOVE,i.onPointerMove&&i.onPointerMove(t,e,s),i.onPointerObservable.hasObservers()&&(a=new Qr(s,t,e),this._setRayOnPointerInfo(a),i.onPointerObservable.notifyObservers(a,s)))}},cn.prototype._setRayOnPointerInfo=function(e){var t=this._scene;e.pickInfo&&!e.pickInfo._pickingUnavailable&&(e.pickInfo.ray||(e.pickInfo.ray=t.createPickingRay(e.event.offsetX,e.event.offsetY,W.Identity(),t.activeCamera)))},cn.prototype._checkPrePointerObservable=function(e,t,i){var r=this._scene,n=new Yr(i,t,this._unTranslatedPointerX,this._unTranslatedPointerY);return e&&(n.ray=e.ray),r.onPrePointerObservable.notifyObservers(n,i),!!n.skipOnPointerObservable},cn.prototype.simulatePointerMove=function(e,t){var i=new PointerEvent("pointermove",t);this._checkPrePointerObservable(e,i,Xr.POINTERMOVE)||this._processPointerMove(e,i)},cn.prototype.simulatePointerDown=function(e,t){var i=new PointerEvent("pointerdown",t);this._checkPrePointerObservable(e,i,Xr.POINTERDOWN)||this._processPointerDown(e,i)},cn.prototype._processPointerDown=function(e,t){var i,r,n=this,o=this._scene;if(e&&e.hit&&e.pickedMesh){this._pickedDownMesh=e.pickedMesh;var s=e.pickedMesh._getActionManagerForTrigger();if(s){if(s.hasPickTriggers)switch(s.processTrigger(5,xr.CreateNew(e.pickedMesh,t)),t.button){case 0:s.processTrigger(2,xr.CreateNew(e.pickedMesh,t));break;case 1:s.processTrigger(4,xr.CreateNew(e.pickedMesh,t));break;case 2:s.processTrigger(3,xr.CreateNew(e.pickedMesh,t))}s.hasSpecificTrigger(8)&&window.setTimeout(function(){var e=o.pick(n._unTranslatedPointerX,n._unTranslatedPointerY,function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.actionManager&&e.actionManager.hasSpecificTrigger(8)&&e==n._pickedDownMesh},!1,o.cameraToUseForPointers);e&&e.hit&&e.pickedMesh&&s&&0!==n._totalPointersPressed&&Date.now()-n._startingPointerTime>cn.LongPressDelay&&!n._isPointerSwiping()&&(n._startingPointerTime=0,s.processTrigger(8,xr.CreateNew(e.pickedMesh,t)))},cn.LongPressDelay)}}else for(var a=0,h=o._pointerDownStage;a<h.length;a++)e=h[a].action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t);e&&(i=Xr.POINTERDOWN,o.onPointerDown&&o.onPointerDown(t,e,i),o.onPointerObservable.hasObservers()&&(r=new Qr(i,t,e),this._setRayOnPointerInfo(r),o.onPointerObservable.notifyObservers(r,i)))},cn.prototype._isPointerSwiping=function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>cn.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>cn.DragMovementThreshold},cn.prototype.simulatePointerUp=function(e,t,i){var r=new PointerEvent("pointerup",t),n=new hn;i?n.doubleClick=!0:n.singleClick=!0,this._checkPrePointerObservable(e,r,Xr.POINTERUP)||this._processPointerUp(e,r,n)},cn.prototype._processPointerUp=function(e,t,i){var r,n,o=this._scene;if(e&&e&&e.pickedMesh){this._pickedUpMesh=e.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(o.onPointerPick&&o.onPointerPick(t,e),i.singleClick&&!i.ignore&&o.onPointerObservable.hasObservers()&&(u=new Qr(r=Xr.POINTERPICK,t,e),this._setRayOnPointerInfo(u),o.onPointerObservable.notifyObservers(u,r)));var s,a=e.pickedMesh._getActionManagerForTrigger();a&&!i.ignore&&(a.processTrigger(7,xr.CreateNew(e.pickedMesh,t)),!i.hasSwiped&&i.singleClick&&a.processTrigger(1,xr.CreateNew(e.pickedMesh,t)),s=e.pickedMesh._getActionManagerForTrigger(6),i.doubleClick&&s&&s.processTrigger(6,xr.CreateNew(e.pickedMesh,t)))}else if(!i.ignore)for(var h=0,l=o._pointerUpStage;h<l.length;h++)e=l[h].action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t);!this._pickedDownMesh||this._pickedDownMesh===this._pickedUpMesh||(n=this._pickedDownMesh._getActionManagerForTrigger(16))&&n.processTrigger(16,xr.CreateNew(this._pickedDownMesh,t));var u,c=0;o.onPointerObservable.hasObservers()&&(i.ignore||i.hasSwiped||(i.singleClick&&o.onPointerObservable.hasSpecificMask(Xr.POINTERTAP)?c=Xr.POINTERTAP:i.doubleClick&&o.onPointerObservable.hasSpecificMask(Xr.POINTERDOUBLETAP)&&(c=Xr.POINTERDOUBLETAP),c&&(u=new Qr(c,t,e),this._setRayOnPointerInfo(u),o.onPointerObservable.notifyObservers(u,c))),i.ignore||(u=new Qr(c=Xr.POINTERUP,t,e),this._setRayOnPointerInfo(u),o.onPointerObservable.notifyObservers(u,c))),o.onPointerUp&&!i.ignore&&o.onPointerUp(t,e,c)},cn.prototype.isPointerCaptured=function(e){return void 0===e&&(e=0),this._pointerCaptures[e]},cn.prototype.attachControl=function(e,t,i,r){var c=this;void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===i&&(i=!0),void 0===r&&(r=null);var n,o,s,a=this._scene;function h(){r&&(r.addEventListener("keydown",c._onKeyDown,!1),r.addEventListener("keyup",c._onKeyUp,!1))}(r=r||a.getEngine().getInputElement())&&(n=a.getEngine(),this._initActionManager=function(e,t){var i;return c._meshPickProceed||(i=a.pick(c._unTranslatedPointerX,c._unTranslatedPointerY,a.pointerDownPredicate,!1,a.cameraToUseForPointers),(c._currentPickResult=i)&&(e=i.hit&&i.pickedMesh?i.pickedMesh._getActionManagerForTrigger():null),c._meshPickProceed=!0),e},this._delayedSimpleClick=function(e,t,i){(Date.now()-c._previousStartingPointerTime>cn.DoubleClickDelay&&!c._doubleClickOccured||e!==c._previousButtonPressed)&&(c._doubleClickOccured=!1,t.singleClick=!0,t.ignore=!1,i(t,c._currentPickResult))},this._initClickEvent=function(e,t,i,r){var n=new hn,o=c._currentPickResult=null,s=e.hasSpecificMask(Xr.POINTERPICK)||t.hasSpecificMask(Xr.POINTERPICK)||e.hasSpecificMask(Xr.POINTERTAP)||t.hasSpecificMask(Xr.POINTERTAP)||e.hasSpecificMask(Xr.POINTERDOUBLETAP)||t.hasSpecificMask(Xr.POINTERDOUBLETAP);!s&&$r&&(o=c._initActionManager(o,n))&&(s=o.hasPickTriggers);var a,h,l,u=!1;s&&(a=i.button,n.hasSwiped=c._isPointerSwiping(),n.hasSwiped||((h=!cn.ExclusiveDoubleClickMode)||(h=!e.hasSpecificMask(Xr.POINTERDOUBLETAP)&&!t.hasSpecificMask(Xr.POINTERDOUBLETAP))&&!$r.HasSpecificTrigger(6)&&(o=c._initActionManager(o,n))&&(h=!o.hasSpecificTrigger(6)),h?(Date.now()-c._previousStartingPointerTime>cn.DoubleClickDelay||a!==c._previousButtonPressed)&&(n.singleClick=!0,r(n,c._currentPickResult),u=!0):(c._previousDelayedSimpleClickTimeout=c._delayedSimpleClickTimeout,c._delayedSimpleClickTimeout=window.setTimeout(c._delayedSimpleClick.bind(c,a,n,r),cn.DoubleClickDelay)),!(l=e.hasSpecificMask(Xr.POINTERDOUBLETAP)||t.hasSpecificMask(Xr.POINTERDOUBLETAP))&&$r.HasSpecificTrigger(6)&&(o=c._initActionManager(o,n))&&(l=o.hasSpecificTrigger(6)),l&&(a===c._previousButtonPressed&&Date.now()-c._previousStartingPointerTime<cn.DoubleClickDelay&&!c._doubleClickOccured?(n.hasSwiped||c._isPointerSwiping()?(c._doubleClickOccured=!1,c._previousStartingPointerTime=c._startingPointerTime,c._previousStartingPointerPosition.x=c._startingPointerPosition.x,c._previousStartingPointerPosition.y=c._startingPointerPosition.y,c._previousButtonPressed=a,cn.ExclusiveDoubleClickMode?(c._previousDelayedSimpleClickTimeout&&clearTimeout(c._previousDelayedSimpleClickTimeout),c._previousDelayedSimpleClickTimeout=c._delayedSimpleClickTimeout,r(n,c._previousPickResult)):r(n,c._currentPickResult)):(c._previousStartingPointerTime=0,c._doubleClickOccured=!0,n.doubleClick=!0,n.ignore=!1,cn.ExclusiveDoubleClickMode&&c._previousDelayedSimpleClickTimeout&&clearTimeout(c._previousDelayedSimpleClickTimeout),c._previousDelayedSimpleClickTimeout=c._delayedSimpleClickTimeout,r(n,c._currentPickResult)),u=!0):(c._doubleClickOccured=!1,c._previousStartingPointerTime=c._startingPointerTime,c._previousStartingPointerPosition.x=c._startingPointerPosition.x,c._previousStartingPointerPosition.y=c._startingPointerPosition.y,c._previousButtonPressed=a)))),u||r(n,c._currentPickResult)},this._onPointerMove=function(e){var t;c._updatePointerPosition(e),c._checkPrePointerObservable(null,e,e.type===c._wheelEventName?Xr.POINTERWHEEL:Xr.POINTERMOVE)||(a.cameraToUseForPointers||a.activeCamera)&&(a.pointerMovePredicate||(a.pointerMovePredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(e.enablePointerMoveEvents||a.constantlyUpdateMeshUnderPointer||null!=e._getActionManagerForTrigger())&&(!a.cameraToUseForPointers||0!=(a.cameraToUseForPointers.layerMask&e.layerMask))}),t=a.pick(c._unTranslatedPointerX,c._unTranslatedPointerY,a.pointerMovePredicate,!1,a.cameraToUseForPointers),c._processPointerMove(t,e))},this._onPointerDown=function(e){var t;c._totalPointersPressed++,c._pickedDownMesh=null,c._meshPickProceed=!1,c._updatePointerPosition(e),a.preventDefaultOnPointerDown&&r&&(e.preventDefault(),r.focus()),c._startingPointerPosition.x=c._pointerX,c._startingPointerPosition.y=c._pointerY,c._startingPointerTime=Date.now(),c._checkPrePointerObservable(null,e,Xr.POINTERDOWN)||(a.cameraToUseForPointers||a.activeCamera)&&(c._pointerCaptures[e.pointerId]=!0,a.pointerDownPredicate||(a.pointerDownPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!a.cameraToUseForPointers||0!=(a.cameraToUseForPointers.layerMask&e.layerMask))}),c._pickedDownMesh=null,t=a.pick(c._unTranslatedPointerX,c._unTranslatedPointerY,a.pointerDownPredicate,!1,a.cameraToUseForPointers),c._processPointerDown(t,e))},this._onPointerUp=function(i){0!==c._totalPointersPressed&&(c._totalPointersPressed--,c._pickedUpMesh=null,c._meshPickProceed=!1,c._updatePointerPosition(i),a.preventDefaultOnPointerUp&&r&&(i.preventDefault(),r.focus()),c._initClickEvent(a.onPrePointerObservable,a.onPointerObservable,i,function(e,t){if(a.onPrePointerObservable.hasObservers()&&!e.ignore){if(!e.hasSwiped){if(e.singleClick&&a.onPrePointerObservable.hasSpecificMask(Xr.POINTERTAP)&&c._checkPrePointerObservable(null,i,Xr.POINTERTAP))return;if(e.doubleClick&&a.onPrePointerObservable.hasSpecificMask(Xr.POINTERDOUBLETAP)&&c._checkPrePointerObservable(null,i,Xr.POINTERDOUBLETAP))return}if(c._checkPrePointerObservable(null,i,Xr.POINTERUP))return}c._pointerCaptures[i.pointerId]&&(c._pointerCaptures[i.pointerId]=!1,(a.cameraToUseForPointers||a.activeCamera)&&(a.pointerUpPredicate||(a.pointerUpPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!a.cameraToUseForPointers||0!=(a.cameraToUseForPointers.layerMask&e.layerMask))}),!c._meshPickProceed&&($r&&$r.HasTriggers||a.onPointerObservable.hasObservers())&&c._initActionManager(null,e),t=t||c._currentPickResult,c._processPointerUp(t,i,e),c._previousPickResult=c._currentPickResult))}))},this._onKeyDown=function(e){var t=tn.KEYDOWN;if(a.onPreKeyboardObservable.hasObservers()){var i=new sn(t,e);if(a.onPreKeyboardObservable.notifyObservers(i,t),i.skipOnPointerObservable)return}a.onKeyboardObservable.hasObservers()&&(i=new on(t,e),a.onKeyboardObservable.notifyObservers(i,t)),a.actionManager&&a.actionManager.processTrigger(14,xr.CreateNewFromScene(a,e))},this._onKeyUp=function(e){var t=tn.KEYUP;if(a.onPreKeyboardObservable.hasObservers()){var i=new sn(t,e);if(a.onPreKeyboardObservable.notifyObservers(i,t),i.skipOnPointerObservable)return}a.onKeyboardObservable.hasObservers()&&(i=new on(t,e),a.onKeyboardObservable.notifyObservers(i,t)),a.actionManager&&a.actionManager.processTrigger(15,xr.CreateNewFromScene(a,e))},this._onCanvasFocusObserver=n.onCanvasFocusObservable.add((document.activeElement===r&&h(),h)),this._onCanvasBlurObserver=n.onCanvasBlurObservable.add(function(){r&&(r.removeEventListener("keydown",c._onKeyDown),r.removeEventListener("keyup",c._onKeyUp))}),o=ri.GetPointerPrefix(),i&&(r.addEventListener(o+"move",this._onPointerMove,!1),this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",r.addEventListener(this._wheelEventName,this._onPointerMove,!1)),t&&r.addEventListener(o+"down",this._onPointerDown,!1),!e||(s=a.getEngine().getHostWindow())&&s.addEventListener(o+"up",this._onPointerUp,!1))},cn.prototype.detachControl=function(){var e=ri.GetPointerPrefix(),t=this._scene.getEngine().getInputElement(),i=this._scene.getEngine();t&&(t.removeEventListener(e+"move",this._onPointerMove),t.removeEventListener(this._wheelEventName,this._onPointerMove),t.removeEventListener(e+"down",this._onPointerDown),window.removeEventListener(e+"up",this._onPointerUp),this._onCanvasBlurObserver&&i.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onCanvasFocusObserver&&i.onCanvasFocusObservable.remove(this._onCanvasFocusObserver),t.removeEventListener("keydown",this._onKeyDown),t.removeEventListener("keyup",this._onKeyUp),this._scene.doNotHandleCursors||(t.style.cursor=this._scene.defaultCursor))},cn.prototype.setPointerOverMesh=function(e){var t;this._pointerOverMesh!==e&&(this._pointerOverMesh&&(t=this._pointerOverMesh._getActionManagerForTrigger(10))&&t.processTrigger(10,xr.CreateNew(this._pointerOverMesh)),this._pointerOverMesh=e,this._pointerOverMesh&&(t=this._pointerOverMesh._getActionManagerForTrigger(9))&&t.processTrigger(9,xr.CreateNew(this._pointerOverMesh)))},cn.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},cn.DragMovementThreshold=10,cn.LongPressDelay=500,cn.DoubleClickDelay=300,cn.ExclusiveDoubleClickMode=!1,cn);function cn(e){this._wheelEventName="",this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new H(0,0),this._previousStartingPointerPosition=new H(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._scene=e}var dn=(Object.defineProperty(fn,"UniqueId",{get:function(){var e=this._UniqueIdCounter;return this._UniqueIdCounter++,e},enumerable:!0,configurable:!0}),fn._UniqueIdCounter=0,fn);function fn(){}var pn,_n=(n(gn,pn=ar),gn.DefaultMaterialFactory=function(e){throw S.WarnImport("StandardMaterial")},gn.CollisionCoordinatorFactory=function(){throw S.WarnImport("DefaultCollisionCoordinator")},Object.defineProperty(gn.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(e){this._environmentTexture!==e&&(this._environmentTexture=e,this.markAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(gn.prototype,"environmentIntensity",{get:function(){return this._environmentIntensity},set:function(e){this._environmentIntensity!==e&&(this._environmentIntensity=e,this.markAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(gn.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!0,configurable:!0}),Object.defineProperty(gn.prototype,"forceWireframe",{get:function(){return this._forceWireframe},set:function(e){this._forceWireframe!==e&&(this._forceWireframe=e,this.markAllMaterialsAsDirty(16))},enumerable:!0,configurable:!0}),Object.defineProperty(gn.prototype,"skipFrustumClipping",{get:function(){return this._skipFrustumClipping},set:function(e){this._skipFrustumClipping!==e&&(this._skipFrustumClipping=e)},enumerable:!0,configurable:!0}),Object.defineProperty(gn.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(e){this._forcePointsCloud!==e&&(this._forcePointsCloud=e,this.markAllMaterialsAsDirty(16))},enumerable:!0,configurable:!0}),Object.defineProperty(gn.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!0,configurable:!0}),Object.defineProperty(gn.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(gn.prototype,"beforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),e&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e))},enumerable:!0,configurable:!0}),Object.defineProperty(gn.prototype,"afterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),e&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(e))},enumerable:!0,configurable:!0}),Object.defineProperty(gn.prototype,"beforeCameraRender",{set:function(e){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(gn.prototype,"afterCameraRender",{set:function(e){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(gn.prototype,"unTranslatedPointer",{get:function(){return this._inputManager.unTranslatedPointer},enumerable:!0,configurable:!0}),Object.defineProperty(gn,"DragMovementThreshold",{get:function(){return un.DragMovementThreshold},set:function(e){un.DragMovementThreshold=e},enumerable:!0,configurable:!0}),Object.defineProperty(gn,"LongPressDelay",{get:function(){return un.LongPressDelay},set:function(e){un.LongPressDelay=e},enumerable:!0,configurable:!0}),Object.defineProperty(gn,"DoubleClickDelay",{get:function(){return un.DoubleClickDelay},set:function(e){un.DoubleClickDelay=e},enumerable:!0,configurable:!0}),Object.defineProperty(gn,"ExclusiveDoubleClickMode",{get:function(){return un.ExclusiveDoubleClickMode},set:function(e){un.ExclusiveDoubleClickMode=e},enumerable:!0,configurable:!0}),Object.defineProperty(gn.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(e){this._useRightHandedSystem!==e&&(this._useRightHandedSystem=e,this.markAllMaterialsAsDirty(16))},enumerable:!0,configurable:!0}),gn.prototype.setStepId=function(e){this._currentStepId=e},gn.prototype.getStepId=function(){return this._currentStepId},gn.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(gn.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAllMaterialsAsDirty(16))},enumerable:!0,configurable:!0}),Object.defineProperty(gn.prototype,"fogMode",{get:function(){return this._fogMode},set:function(e){this._fogMode!==e&&(this._fogMode=e,this.markAllMaterialsAsDirty(16))},enumerable:!0,configurable:!0}),Object.defineProperty(gn.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(e){this._shadowsEnabled!==e&&(this._shadowsEnabled=e,this.markAllMaterialsAsDirty(2))},enumerable:!0,configurable:!0}),Object.defineProperty(gn.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(e){this._lightsEnabled!==e&&(this._lightsEnabled=e,this.markAllMaterialsAsDirty(2))},enumerable:!0,configurable:!0}),Object.defineProperty(gn.prototype,"activeCamera",{get:function(){return this._activeCamera},set:function(e){e!==this._activeCamera&&(this._activeCamera=e,this.onActiveCameraChanged.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(gn.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=gn.DefaultMaterialFactory(this)),this._defaultMaterial},set:function(e){this._defaultMaterial=e},enumerable:!0,configurable:!0}),Object.defineProperty(gn.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(e){this._texturesEnabled!==e&&(this._texturesEnabled=e,this.markAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(gn.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(e){this._skeletonsEnabled!==e&&(this._skeletonsEnabled=e,this.markAllMaterialsAsDirty(8))},enumerable:!0,configurable:!0}),Object.defineProperty(gn.prototype,"collisionCoordinator",{get:function(){return this._collisionCoordinator||(this._collisionCoordinator=gn.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator},enumerable:!0,configurable:!0}),Object.defineProperty(gn.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!0,configurable:!0}),gn.prototype._registerTransientComponents=function(){if(0<this._transientComponents.length){for(var e=0,t=this._transientComponents;e<t.length;e++)t[e].register();this._transientComponents=[]}},gn.prototype._addComponent=function(e){this._components.push(e),this._transientComponents.push(e),e.addFromContainer&&e.serialize&&this._serializableComponents.push(e)},gn.prototype._getComponent=function(e){for(var t=0,i=this._components;t<i.length;t++){var r=i[t];if(r.name===e)return r}return null},gn.prototype.getClassName=function(){return"Scene"},gn.prototype._getDefaultMeshCandidates=function(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates},gn.prototype._getDefaultSubMeshCandidates=function(e){return this._defaultSubMeshCandidates.data=e.subMeshes,this._defaultSubMeshCandidates.length=e.subMeshes.length,this._defaultSubMeshCandidates},gn.prototype.setDefaultCandidateProviders=function(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)},Object.defineProperty(gn.prototype,"meshUnderPointer",{get:function(){return this._inputManager.meshUnderPointer},enumerable:!0,configurable:!0}),Object.defineProperty(gn.prototype,"pointerX",{get:function(){return this._inputManager.pointerX},set:function(e){this._inputManager.pointerX=e},enumerable:!0,configurable:!0}),Object.defineProperty(gn.prototype,"pointerY",{get:function(){return this._inputManager.pointerY},set:function(e){this._inputManager.pointerY=e},enumerable:!0,configurable:!0}),gn.prototype.getCachedMaterial=function(){return this._cachedMaterial},gn.prototype.getCachedEffect=function(){return this._cachedEffect},gn.prototype.getCachedVisibility=function(){return this._cachedVisibility},gn.prototype.isCachedMaterialInvalid=function(e,t,i){return void 0===i&&(i=1),this._cachedEffect!==t||this._cachedMaterial!==e||this._cachedVisibility!==i},gn.prototype.getEngine=function(){return this._engine},gn.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(gn.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!0,configurable:!0}),gn.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(gn.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!0,configurable:!0}),gn.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(gn.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!0,configurable:!0}),gn.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(gn.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!0,configurable:!0}),gn.prototype.getActiveMeshes=function(){return this._activeMeshes},gn.prototype.getAnimationRatio=function(){return void 0!==this._animationRatio?this._animationRatio:1},gn.prototype.getRenderId=function(){return this._renderId},gn.prototype.getFrameId=function(){return this._frameId},gn.prototype.incrementRenderId=function(){this._renderId++},gn.prototype._createUbo=function(){this._sceneUbo=new mr(this._engine,void 0,!0),this._sceneUbo.addUniform("viewProjection",16),this._sceneUbo.addUniform("view",16)},gn.prototype.simulatePointerMove=function(e,t){return this._inputManager.simulatePointerMove(e,t),this},gn.prototype.simulatePointerDown=function(e,t){return this._inputManager.simulatePointerDown(e,t),this},gn.prototype.simulatePointerUp=function(e,t,i){return this._inputManager.simulatePointerUp(e,t,i),this},gn.prototype.isPointerCaptured=function(e){return void 0===e&&(e=0),this._inputManager.isPointerCaptured(e)},gn.prototype.attachControl=function(e,t,i){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===i&&(i=!0),this._inputManager.attachControl(e,t,i)},gn.prototype.detachControl=function(){this._inputManager.detachControl()},gn.prototype.isReady=function(){if(this._isDisposed)return!1;var e,t=this.getEngine();if(!t.areAllEffectsReady())return!1;if(0<this._pendingData.length)return!1;for(e=0;e<this.meshes.length;e++){var i=this.meshes[e];if(i.isEnabled()&&i.subMeshes&&0!==i.subMeshes.length){if(!i.isReady(!0))return!1;for(var r="InstancedMesh"===i.getClassName()||"InstancedLinesMesh"===i.getClassName()||t.getCaps().instancedArrays&&0<i.instances.length,n=0,o=this._isReadyForMeshStage;n<o.length;n++)if(!o[n].action(i,r))return!1}}for(e=0;e<this.geometries.length;e++)if(2===this.geometries[e].delayLoadState)return!1;if(this.activeCameras&&0<this.activeCameras.length){for(var s=0,a=this.activeCameras;s<a.length;s++)if(!a[s].isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(var h=0,l=this.particleSystems;h<l.length;h++)if(!l[h].isReady())return!1;return!0},gn.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},gn.prototype.registerBeforeRender=function(e){this.onBeforeRenderObservable.add(e)},gn.prototype.unregisterBeforeRender=function(e){this.onBeforeRenderObservable.removeCallback(e)},gn.prototype.registerAfterRender=function(e){this.onAfterRenderObservable.add(e)},gn.prototype.unregisterAfterRender=function(e){this.onAfterRenderObservable.removeCallback(e)},gn.prototype._executeOnceBeforeRender=function(e){var t=this,i=function(){e(),setTimeout(function(){t.unregisterBeforeRender(i)})};this.registerBeforeRender(i)},gn.prototype.executeOnceBeforeRender=function(e,t){var i=this;void 0!==t?setTimeout(function(){i._executeOnceBeforeRender(e)},t):this._executeOnceBeforeRender(e)},gn.prototype._addPendingData=function(e){this._pendingData.push(e)},gn.prototype._removePendingData=function(e){var t=this.isLoading,i=this._pendingData.indexOf(e);-1!==i&&this._pendingData.splice(i,1),t&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},gn.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(gn.prototype,"isLoading",{get:function(){return 0<this._pendingData.length},enumerable:!0,configurable:!0}),gn.prototype.executeWhenReady=function(e){var t=this;this.onReadyObservable.add(e),-1===this._executeWhenReadyTimeoutId&&(this._executeWhenReadyTimeoutId=setTimeout(function(){t._checkIsReady()},150))},gn.prototype.whenReadyAsync=function(){var t=this;return new Promise(function(e){t.executeWhenReady(function(){e()})})},gn.prototype._checkIsReady=function(){var e=this;return this._registerTransientComponents(),this.isReady()?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=-1)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=-1)):void(this._executeWhenReadyTimeoutId=setTimeout(function(){e._checkIsReady()},150))},Object.defineProperty(gn.prototype,"animatables",{get:function(){return this._activeAnimatables},enumerable:!0,configurable:!0}),gn.prototype.resetLastAnimationTimeFrame=function(){this._animationTimeLast=be.Now},gn.prototype.getViewMatrix=function(){return this._viewMatrix},gn.prototype.getProjectionMatrix=function(){return this._projectionMatrix},gn.prototype.getTransformMatrix=function(){return this._transformMatrix},gn.prototype.setTransformMatrix=function(e,t,i,r){this._viewUpdateFlag===e.updateFlag&&this._projectionUpdateFlag===t.updateFlag||(this._viewUpdateFlag=e.updateFlag,this._projectionUpdateFlag=t.updateFlag,this._viewMatrix=e,this._projectionMatrix=t,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?ir.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=ir.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(i,r):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.update()))},gn.prototype.getSceneUniformBuffer=function(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo},gn.prototype.getUniqueId=function(){return dn.UniqueId},gn.prototype.addMesh=function(e,t){var i=this;void 0===t&&(t=!1),this._blockEntityCollection||(this.meshes.push(e),e._resyncLightSources(),e.parent||e._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach(function(e){i.addMesh(e)}))},gn.prototype.removeMesh=function(e,t){var i=this;void 0===t&&(t=!1);var r=this.meshes.indexOf(e);return-1!==r&&(this.meshes[r]=this.meshes[this.meshes.length-1],this.meshes.pop(),e.parent||e._removeFromSceneRootNodes()),this.onMeshRemovedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach(function(e){i.removeMesh(e)}),r},gn.prototype.addTransformNode=function(e){this._blockEntityCollection||(e._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(e),e.parent||e._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(e))},gn.prototype.removeTransformNode=function(e){var t,i=e._indexInSceneTransformNodesArray;return-1!==i&&(i!==this.transformNodes.length-1&&(t=this.transformNodes[this.transformNodes.length-1],(this.transformNodes[i]=t)._indexInSceneTransformNodesArray=i),e._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),e.parent||e._removeFromSceneRootNodes()),this.onTransformNodeRemovedObservable.notifyObservers(e),i},gn.prototype.removeSkeleton=function(e){var t=this.skeletons.indexOf(e);return-1!==t&&(this.skeletons.splice(t,1),this.onSkeletonRemovedObservable.notifyObservers(e)),t},gn.prototype.removeMorphTargetManager=function(e){var t=this.morphTargetManagers.indexOf(e);return-1!==t&&this.morphTargetManagers.splice(t,1),t},gn.prototype.removeLight=function(e){var t=this.lights.indexOf(e);if(-1!==t){for(var i=0,r=this.meshes;i<r.length;i++)r[i]._removeLightSource(e,!1);this.lights.splice(t,1),this.sortLightsByPriority(),e.parent||e._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(e),t},gn.prototype.removeCamera=function(e){var t=this.cameras.indexOf(e);-1!==t&&(this.cameras.splice(t,1),e.parent||e._removeFromSceneRootNodes());var i=this.activeCameras.indexOf(e);return-1!==i&&this.activeCameras.splice(i,1),this.activeCamera===e&&(0<this.cameras.length?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(e),t},gn.prototype.removeParticleSystem=function(e){var t=this.particleSystems.indexOf(e);return-1!==t&&this.particleSystems.splice(t,1),t},gn.prototype.removeAnimation=function(e){var t=this.animations.indexOf(e);return-1!==t&&this.animations.splice(t,1),t},gn.prototype.stopAnimation=function(e,t,i){},gn.prototype.removeAnimationGroup=function(e){var t=this.animationGroups.indexOf(e);return-1!==t&&this.animationGroups.splice(t,1),t},gn.prototype.removeMultiMaterial=function(e){var t=this.multiMaterials.indexOf(e);return-1!==t&&this.multiMaterials.splice(t,1),t},gn.prototype.removeMaterial=function(e){var t,i=e._indexInSceneMaterialArray;return-1!==i&&i<this.materials.length&&(i!==this.materials.length-1&&(t=this.materials[this.materials.length-1],(this.materials[i]=t)._indexInSceneMaterialArray=i),e._indexInSceneMaterialArray=-1,this.materials.pop()),this.onMaterialRemovedObservable.notifyObservers(e),i},gn.prototype.removeActionManager=function(e){var t=this.actionManagers.indexOf(e);return-1!==t&&this.actionManagers.splice(t,1),t},gn.prototype.removeTexture=function(e){var t=this.textures.indexOf(e);return-1!==t&&this.textures.splice(t,1),this.onTextureRemovedObservable.notifyObservers(e),t},gn.prototype.addLight=function(e){if(!this._blockEntityCollection){this.lights.push(e),this.sortLightsByPriority(),e.parent||e._addToSceneRootNodes();for(var t=0,i=this.meshes;t<i.length;t++){var r=i[t];-1===r.lightSources.indexOf(e)&&(r.lightSources.push(e),r._resyncLightSources())}this.onNewLightAddedObservable.notifyObservers(e)}},gn.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(br.CompareLightsPriority)},gn.prototype.addCamera=function(e){this._blockEntityCollection||(this.cameras.push(e),this.onNewCameraAddedObservable.notifyObservers(e),e.parent||e._addToSceneRootNodes())},gn.prototype.addSkeleton=function(e){this._blockEntityCollection||(this.skeletons.push(e),this.onNewSkeletonAddedObservable.notifyObservers(e))},gn.prototype.addParticleSystem=function(e){this._blockEntityCollection||this.particleSystems.push(e)},gn.prototype.addAnimation=function(e){this._blockEntityCollection||this.animations.push(e)},gn.prototype.addAnimationGroup=function(e){this._blockEntityCollection||this.animationGroups.push(e)},gn.prototype.addMultiMaterial=function(e){this._blockEntityCollection||this.multiMaterials.push(e)},gn.prototype.addMaterial=function(e){this._blockEntityCollection||(e._indexInSceneMaterialArray=this.materials.length,this.materials.push(e),this.onNewMaterialAddedObservable.notifyObservers(e))},gn.prototype.addMorphTargetManager=function(e){this._blockEntityCollection||this.morphTargetManagers.push(e)},gn.prototype.addGeometry=function(e){this._blockEntityCollection||(this.geometriesByUniqueId&&(this.geometriesByUniqueId[e.uniqueId]=this.geometries.length),this.geometries.push(e))},gn.prototype.addActionManager=function(e){this.actionManagers.push(e)},gn.prototype.addTexture=function(e){this._blockEntityCollection||(this.textures.push(e),this.onNewTextureAddedObservable.notifyObservers(e))},gn.prototype.switchActiveCamera=function(e,t){void 0===t&&(t=!0);var i=this._engine.getInputElement();i&&(this.activeCamera&&this.activeCamera.detachControl(i),this.activeCamera=e,t&&e.attachControl(i))},gn.prototype.setActiveCameraByID=function(e){var t=this.getCameraByID(e);return t?this.activeCamera=t:null},gn.prototype.setActiveCameraByName=function(e){var t=this.getCameraByName(e);return t?this.activeCamera=t:null},gn.prototype.getAnimationGroupByName=function(e){for(var t=0;t<this.animationGroups.length;t++)if(this.animationGroups[t].name===e)return this.animationGroups[t];return null},gn.prototype.getMaterialByUniqueID=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].uniqueId===e)return this.materials[t];return null},gn.prototype.getMaterialByID=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].id===e)return this.materials[t];return null},gn.prototype.getLastMaterialByID=function(e){for(var t=this.materials.length-1;0<=t;t--)if(this.materials[t].id===e)return this.materials[t];return null},gn.prototype.getMaterialByName=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].name===e)return this.materials[t];return null},gn.prototype.getTextureByUniqueID=function(e){for(var t=0;t<this.textures.length;t++)if(this.textures[t].uniqueId===e)return this.textures[t];return null},gn.prototype.getCameraByID=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].id===e)return this.cameras[t];return null},gn.prototype.getCameraByUniqueID=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].uniqueId===e)return this.cameras[t];return null},gn.prototype.getCameraByName=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].name===e)return this.cameras[t];return null},gn.prototype.getBoneByID=function(e){for(var t=0;t<this.skeletons.length;t++)for(var i=this.skeletons[t],r=0;r<i.bones.length;r++)if(i.bones[r].id===e)return i.bones[r];return null},gn.prototype.getBoneByName=function(e){for(var t=0;t<this.skeletons.length;t++)for(var i=this.skeletons[t],r=0;r<i.bones.length;r++)if(i.bones[r].name===e)return i.bones[r];return null},gn.prototype.getLightByName=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].name===e)return this.lights[t];return null},gn.prototype.getLightByID=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].id===e)return this.lights[t];return null},gn.prototype.getLightByUniqueID=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].uniqueId===e)return this.lights[t];return null},gn.prototype.getParticleSystemByID=function(e){for(var t=0;t<this.particleSystems.length;t++)if(this.particleSystems[t].id===e)return this.particleSystems[t];return null},gn.prototype.getGeometryByID=function(e){for(var t=0;t<this.geometries.length;t++)if(this.geometries[t].id===e)return this.geometries[t];return null},gn.prototype._getGeometryByUniqueID=function(e){if(this.geometriesByUniqueId){var t=this.geometriesByUniqueId[e];if(void 0!==t)return this.geometries[t]}else for(var i=0;i<this.geometries.length;i++)if(this.geometries[i].uniqueId===e)return this.geometries[i];return null},gn.prototype.pushGeometry=function(e,t){return!(!t&&this._getGeometryByUniqueID(e.uniqueId)||(this.addGeometry(e),this.onNewGeometryAddedObservable.notifyObservers(e),0))},gn.prototype.removeGeometry=function(e){var t,i;if(this.geometriesByUniqueId){if(void 0===(t=this.geometriesByUniqueId[e.uniqueId]))return!1}else if((t=this.geometries.indexOf(e))<0)return!1;return t!==this.geometries.length-1&&(i=this.geometries[this.geometries.length-1],this.geometries[t]=i,this.geometriesByUniqueId&&(this.geometriesByUniqueId[i.uniqueId]=t,this.geometriesByUniqueId[e.uniqueId]=void 0)),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(e),!0},gn.prototype.getGeometries=function(){return this.geometries},gn.prototype.getMeshByID=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].id===e)return this.meshes[t];return null},gn.prototype.getMeshesByID=function(t){return this.meshes.filter(function(e){return e.id===t})},gn.prototype.getTransformNodeByID=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].id===e)return this.transformNodes[t];return null},gn.prototype.getTransformNodeByUniqueID=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].uniqueId===e)return this.transformNodes[t];return null},gn.prototype.getTransformNodesByID=function(t){return this.transformNodes.filter(function(e){return e.id===t})},gn.prototype.getMeshByUniqueID=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].uniqueId===e)return this.meshes[t];return null},gn.prototype.getLastMeshByID=function(e){for(var t=this.meshes.length-1;0<=t;t--)if(this.meshes[t].id===e)return this.meshes[t];return null},gn.prototype.getLastEntryByID=function(e){for(var t=this.meshes.length-1;0<=t;t--)if(this.meshes[t].id===e)return this.meshes[t];for(t=this.transformNodes.length-1;0<=t;t--)if(this.transformNodes[t].id===e)return this.transformNodes[t];for(t=this.cameras.length-1;0<=t;t--)if(this.cameras[t].id===e)return this.cameras[t];for(t=this.lights.length-1;0<=t;t--)if(this.lights[t].id===e)return this.lights[t];return null},gn.prototype.getNodeByID=function(e){var t=this.getMeshByID(e);if(t)return t;var i=this.getTransformNodeByID(e);if(i)return i;var r=this.getLightByID(e);if(r)return r;var n=this.getCameraByID(e);if(n)return n;var o=this.getBoneByID(e);return o||null},gn.prototype.getNodeByName=function(e){var t=this.getMeshByName(e);if(t)return t;var i=this.getTransformNodeByName(e);if(i)return i;var r=this.getLightByName(e);if(r)return r;var n=this.getCameraByName(e);if(n)return n;var o=this.getBoneByName(e);return o||null},gn.prototype.getMeshByName=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].name===e)return this.meshes[t];return null},gn.prototype.getTransformNodeByName=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].name===e)return this.transformNodes[t];return null},gn.prototype.getLastSkeletonByID=function(e){for(var t=this.skeletons.length-1;0<=t;t--)if(this.skeletons[t].id===e)return this.skeletons[t];return null},gn.prototype.getSkeletonByUniqueId=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].uniqueId===e)return this.skeletons[t];return null},gn.prototype.getSkeletonById=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].id===e)return this.skeletons[t];return null},gn.prototype.getSkeletonByName=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].name===e)return this.skeletons[t];return null},gn.prototype.getMorphTargetManagerById=function(e){for(var t=0;t<this.morphTargetManagers.length;t++)if(this.morphTargetManagers[t].uniqueId===e)return this.morphTargetManagers[t];return null},gn.prototype.getMorphTargetById=function(e){for(var t=0;t<this.morphTargetManagers.length;++t)for(var i=this.morphTargetManagers[t],r=0;r<i.numTargets;++r){var n=i.getTarget(r);if(n.id===e)return n}return null},gn.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},Object.defineProperty(gn.prototype,"uid",{get:function(){return this._uid||(this._uid=ri.RandomId()),this._uid},enumerable:!0,configurable:!0}),gn.prototype.addExternalData=function(e,t){return this._externalData||(this._externalData=new ai),this._externalData.add(e,t)},gn.prototype.getExternalData=function(e){return this._externalData?this._externalData.get(e):null},gn.prototype.getOrAddExternalDataWithFactory=function(e,t){return this._externalData||(this._externalData=new ai),this._externalData.getOrAddWithFactory(e,t)},gn.prototype.removeExternalData=function(e){return this._externalData.remove(e)},gn.prototype._evaluateSubMesh=function(e,t,i){if(i.hasInstances||i.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||t.alwaysSelectAsActiveMesh||1===t.subMeshes.length||e.isInFrustum(this._frustumPlanes)){for(var r=0,n=this._evaluateSubMeshStage;r<n.length;r++)n[r].action(t,e);var o=e.getMaterial();null!=o&&(o.hasRenderTargetTextures&&null!=o.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(o)&&(this._processedMaterials.push(o),this._renderTargets.concatWithNoDuplicate(o.getRenderTargetTextures())),this._renderingManager.dispatch(e,t,o))}},gn.prototype.freeProcessedMaterials=function(){this._processedMaterials.dispose()},Object.defineProperty(gn.prototype,"blockfreeActiveMeshesAndRenderingGroups",{get:function(){return this._preventFreeActiveMeshesAndRenderingGroups},set:function(e){this._preventFreeActiveMeshesAndRenderingGroups!==e&&(e&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=e)},enumerable:!0,configurable:!0}),gn.prototype.freeActiveMeshes=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(var e=0;e<this.activeCameras.length;e++){var t=this.activeCameras[e];t&&t._activeMeshes&&t._activeMeshes.dispose()}},gn.prototype.freeRenderingGroups=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(var e=0;e<this.textures.length;e++){var t=this.textures[e];t&&t.renderList&&t.freeRenderingGroups()}},gn.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},gn.prototype.freezeActiveMeshes=function(t){var i=this;return void 0===t&&(t=!1),this.executeWhenReady(function(){if(i.activeCamera){i._frustumPlanes||i.setTransformMatrix(i.activeCamera.getViewMatrix(),i.activeCamera.getProjectionMatrix()),i._evaluateActiveMeshes(),i._activeMeshesFrozen=!0,i._skipEvaluateActiveMeshesCompletely=t;for(var e=0;e<i._activeMeshes.length;e++)i._activeMeshes.data[e]._freeze()}}),this},gn.prototype.unfreezeActiveMeshes=function(){for(var e=0;e<this.meshes.length;e++){var t=this.meshes[e];t._internalAbstractMeshDataInfo&&(t._internalAbstractMeshDataInfo._isActive=!1)}for(e=0;e<this._activeMeshes.length;e++)this._activeMeshes.data[e]._unFreeze();return this._activeMeshesFrozen=!1,this},gn.prototype._evaluateActiveMeshes=function(){if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely)for(var e=this._activeMeshes.length,t=0;t<e;t++)(n=this._activeMeshes.data[t]).computeWorldMatrix()}else if(this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();for(var i=0,r=this._beforeEvaluateActiveMeshStage;i<r.length;i++)r[i].action();for(var n,o,s=this.getActiveMeshCandidates(),a=s.length,t=0;t<a;t++)(n=s.data[t]).isBlocked||(this._totalVertices.addCount(n.getTotalVertices(),!1),n.isReady()&&n.isEnabled()&&0!==n.scaling.lengthSquared()&&(n.computeWorldMatrix(),n.actionManager&&n.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(n),null!=(o=this.customLODSelector?this.customLODSelector(n,this.activeCamera):n.getLOD(this.activeCamera))&&(o!==n&&o.billboardMode!==gi.BILLBOARDMODE_NONE&&o.computeWorldMatrix(),n._preActivate(),n.isVisible&&0<n.visibility&&0!=(n.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||n.alwaysSelectAsActiveMesh||n.isInFrustum(this._frustumPlanes))&&(this._activeMeshes.push(n),this.activeCamera._activeMeshes.push(n),o!==n&&o._activate(this._renderId,!1),n._activate(this._renderId,!1)&&(n.isAnInstance?n._internalAbstractMeshDataInfo._actAsRegularMesh&&(o=n):o._internalAbstractMeshDataInfo._onlyForInstances=!1,o._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(n,o)),n._postActivate()))));if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var h=0;h<this.particleSystems.length;h++){var l,u=this.particleSystems[h];u.isStarted()&&u.emitter&&((l=u.emitter).position&&!l.isEnabled()||(this._activeParticleSystems.push(u),u.animate(),this._renderingManager.dispatchParticles(u)))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},gn.prototype._activeMesh=function(e,t){this._skeletonsEnabled&&null!==t.skeleton&&void 0!==t.skeleton&&(this._activeSkeletons.pushNoDuplicate(t.skeleton)&&t.skeleton.prepare(),t.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(t));for(var i=0,r=this._activeMeshStage;i<r.length;i++)r[i].action(e,t);if(null!=t&&void 0!==t.subMeshes&&null!==t.subMeshes&&0<t.subMeshes.length)for(var n=this.getActiveSubMeshCandidates(t),o=n.length,s=0;s<o;s++){var a=n.data[s];this._evaluateSubMesh(a,t,e)}},gn.prototype.updateTransformMatrix=function(e){this.activeCamera&&this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(e))},gn.prototype._bindFrameBuffer=function(){var e;this.activeCamera&&this.activeCamera._multiviewTexture?this.activeCamera._multiviewTexture._bindFrameBuffer():this.activeCamera&&this.activeCamera.outputRenderTarget?this.getEngine().getCaps().multiview&&this.activeCamera.outputRenderTarget&&1<this.activeCamera.outputRenderTarget.getViewCount()?this.activeCamera.outputRenderTarget._bindFrameBuffer():(e=this.activeCamera.outputRenderTarget.getInternalTexture())?this.getEngine().bindFramebuffer(e):fe.Error("Camera contains invalid customDefaultRenderTarget"):this.getEngine().restoreDefaultFramebuffer()},gn.prototype._renderForCamera=function(e,t){if(!e||!e._skipRendering){var i=this._engine;if(this._activeCamera=e,!this.activeCamera)throw new Error("Active camera not set");i.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,this.getEngine().getCaps().multiview&&e.outputRenderTarget&&1<e.outputRenderTarget.getViewCount()?this.setTransformMatrix(e._rigCameras[0].getViewMatrix(),e._rigCameras[0].getProjectionMatrix(),e._rigCameras[1].getViewMatrix(),e._rigCameras[1].getProjectionMatrix()):this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var r=0;r<this._softwareSkinnedMeshes.length;r++){var n=this._softwareSkinnedMeshes.data[r];n.applySkeleton(n.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),e.customRenderTargets&&0<e.customRenderTargets.length&&this._renderTargets.concatWithNoDuplicate(e.customRenderTargets),t&&t.customRenderTargets&&0<t.customRenderTargets.length&&this._renderTargets.concatWithNoDuplicate(t.customRenderTargets);for(var o=0,s=this._gatherActiveCameraRenderTargetsStage;o<s.length;o++)s[o].action(this._renderTargets);if(this.renderTargetsEnabled){var a=!(this._intermediateRendering=!0);if(0<this._renderTargets.length){ri.StartPerformanceCounter("Render targets",0<this._renderTargets.length);for(var h=0;h<this._renderTargets.length;h++){var l,u=this._renderTargets.data[h];u._shouldRender()&&(this._renderId++,l=u.activeCamera&&u.activeCamera!==this.activeCamera,u.render(l,this.dumpNextRenderTargets),a=!0)}ri.EndPerformanceCounter("Render targets",0<this._renderTargets.length),this._renderId++}for(var c=0,d=this._cameraDrawRenderTargetStage;c<d.length;c++)a=d[c].action(this.activeCamera)||a;this._intermediateRendering=!1,this.activeCamera&&this.activeCamera.outputRenderTarget&&(a=!0),a&&this._bindFrameBuffer()}this.onAfterRenderTargetsRenderObservable.notifyObservers(this),this.postProcessManager&&!e._multiviewTexture&&this.postProcessManager._prepareFrame();for(var f=0,p=this._beforeCameraDrawStage;f<p.length;f++)p[f].action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(var _=0,g=this._afterCameraDrawStage;_<g.length;_++)g[_].action(this.activeCamera);this.postProcessManager&&!e._multiviewTexture&&this.postProcessManager._finalizeFrame(e.isIntermediate),this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}},gn.prototype._processSubCameras=function(e){if(e.cameraRigMode===or.RIG_MODE_NONE||e.outputRenderTarget&&1<e.outputRenderTarget.getViewCount()&&this.getEngine().getCaps().multiview)return this._renderForCamera(e),void this.onAfterRenderCameraObservable.notifyObservers(e);if(e._useMultiviewToSingleView)this._renderMultiviewToSingleView(e);else for(var t=0;t<e._rigCameras.length;t++)this._renderForCamera(e._rigCameras[t],e);this._activeCamera=e,this.setTransformMatrix(this._activeCamera.getViewMatrix(),this._activeCamera.getProjectionMatrix()),this.onAfterRenderCameraObservable.notifyObservers(e)},gn.prototype._checkIntersections=function(){for(var e=0;e<this._meshesForIntersections.length;e++){var t=this._meshesForIntersections.data[e];if(t.actionManager)for(var i=0;t.actionManager&&i<t.actionManager.actions.length;i++){var r,n,o,s,a=t.actionManager.actions[i];12!==a.trigger&&13!==a.trigger||(r=a.getTriggerParameter(),o=(n=r instanceof Zi?r:r.mesh).intersectsMesh(t,r.usePreciseIntersection),s=t._intersectionsInProgress.indexOf(n),o&&-1===s?12===a.trigger?(a._executeCurrent(xr.CreateNew(t,void 0,n)),t._intersectionsInProgress.push(n)):13===a.trigger&&t._intersectionsInProgress.push(n):!o&&-1<s&&(13===a.trigger&&a._executeCurrent(xr.CreateNew(t,void 0,n)),t.actionManager.hasSpecificTrigger(13,function(e){var t=e instanceof Zi?e:e.mesh;return n===t})&&13!==a.trigger||t._intersectionsInProgress.splice(s,1)))}}},gn.prototype._advancePhysicsEngineStep=function(e){},gn.prototype._animate=function(){},gn.prototype.animate=function(){if(this._engine.isDeterministicLockStep()){for(var e=Math.max(gn.MinDeltaTime,Math.min(this._engine.getDeltaTime(),gn.MaxDeltaTime))+this._timeAccumulator,t=this._engine.getTimeStep(),i=1e3/t/1e3,r=0,n=this._engine.getLockstepMaxSteps(),o=Math.floor(e/t),o=Math.min(o,n);0<e&&r<o;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=t*i,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this._advancePhysicsEngineStep(t),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,r++,e-=t;this._timeAccumulator=e<0?0:e}else e=this.useConstantAnimationDeltaTime?16:Math.max(gn.MinDeltaTime,Math.min(this._engine.getDeltaTime(),gn.MaxDeltaTime)),this._animationRatio=.06*e,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this._advancePhysicsEngineStep(e)},gn.prototype.render=function(e,t){if(void 0===e&&(e=!0),void 0===t&&(t=!1),!this.isDisposed){this._frameId++,this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),t||this.animate();for(var i=0,r=this._beforeCameraUpdateStage;i<r.length;i++)r[i].action();if(e)if(0<this.activeCameras.length)for(var n=0;n<this.activeCameras.length;n++){var o=this.activeCameras[n];if(o.update(),o.cameraRigMode!==or.RIG_MODE_NONE)for(var s=0;s<o._rigCameras.length;s++)o._rigCameras[s].update()}else if(this.activeCamera&&(this.activeCamera.update(),this.activeCamera.cameraRigMode!==or.RIG_MODE_NONE))for(s=0;s<this.activeCamera._rigCameras.length;s++)this.activeCamera._rigCameras[s].update();this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var a=this.getEngine(),h=this.activeCamera;if(this.renderTargetsEnabled){ri.StartPerformanceCounter("Custom render targets",0<this.customRenderTargets.length),this._intermediateRendering=!0;for(var l=0;l<this.customRenderTargets.length;l++){var u=this.customRenderTargets[l];if(u._shouldRender()){if(this._renderId++,this.activeCamera=u.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");a.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),u.render(h!==this.activeCamera,this.dumpNextRenderTargets)}}ri.EndPerformanceCounter("Custom render targets",0<this.customRenderTargets.length),this._intermediateRendering=!1,this._renderId++}this.activeCamera=h,this._bindFrameBuffer(),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(var c=0,d=this._beforeClearStage;c<d.length;c++)d[c].action();(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil);for(var f=0,p=this._gatherRenderTargetsStage;f<p.length;f++)p[f].action(this._renderTargets);if(0<this.activeCameras.length)for(n=0;n<this.activeCameras.length;n++)0<n&&this._engine.clear(null,!1,!0,!0),this._processSubCameras(this.activeCameras[n]);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera)}this._checkIntersections();for(var _=0,g=this._afterRenderStage;_<g.length;_++)g[_].action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(s=0;s<this._toBeDisposed.length;s++){var m=this._toBeDisposed[s];m&&m.dispose()}this._toBeDisposed=[]}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0)}},gn.prototype.freezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].freeze()},gn.prototype.unfreezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].unfreeze()},gn.prototype.dispose=function(){this.beforeRender=null,this.afterRender=null,Ae._LastCreatedScene===this&&(Ae._LastCreatedScene=null),this.skeletons=[],this.morphTargetManagers=[],this._transientComponents=[],this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._activeMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear();for(var e=0,t=this._components;e<t.length;e++)t[e].dispose();this.importedMeshesFiles=new Array,this.stopAllAnimations&&this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed=[];for(var i=0,r=this._activeRequests;i<r.length;i++)r[i].abort();this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.detachControl();var n=this._engine.getInputElement();if(n)for(var o=0;o<this.cameras.length;o++)this.cameras[o].detachControl(n);for(;this.animationGroups.length;)this.animationGroups[0].dispose();for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.transformNodes.length;)this.transformNodes[0].dispose(!0);for(;this.cameras.length;)this.cameras[0].dispose();for(this._defaultMaterial&&this._defaultMaterial.dispose();this.multiMaterials.length;)this.multiMaterials[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),-1<(o=this._engine.scenes.indexOf(this))&&this._engine.scenes.splice(o,1),this._engine.wipeCaches(!0),this._isDisposed=!0},Object.defineProperty(gn.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),gn.prototype.clearCachedVertexData=function(){for(var e=0;e<this.meshes.length;e++){var t=this.meshes[e].geometry;if(t)for(var i in t._indices=[],t._vertexBuffers)t._vertexBuffers.hasOwnProperty(i)&&(t._vertexBuffers[i]._buffer._data=null)}},gn.prototype.cleanCachedTextureBuffer=function(){for(var e=0,t=this.textures;e<t.length;e++){var i=t[e];i._buffer&&(i._buffer=null)}},gn.prototype.getWorldExtends=function(e){var n=new te(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new te(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return e=e||function(){return!0},this.meshes.filter(e).forEach(function(e){var t,i,r;e.computeWorldMatrix(!0),e.subMeshes&&0!==e.subMeshes.length&&!e.infiniteDistance&&(i=(t=e.getBoundingInfo()).boundingBox.minimumWorld,r=t.boundingBox.maximumWorld,te.CheckExtends(i,n,o),te.CheckExtends(r,n,o))}),{min:n,max:o}},gn.prototype.createPickingRay=function(e,t,i,r,n){throw void 0===n&&(n=!1),S.WarnImport("Ray")},gn.prototype.createPickingRayToRef=function(e,t,i,r,n,o){throw void 0===o&&(o=!1),S.WarnImport("Ray")},gn.prototype.createPickingRayInCameraSpace=function(e,t,i){throw S.WarnImport("Ray")},gn.prototype.createPickingRayInCameraSpaceToRef=function(e,t,i,r){throw S.WarnImport("Ray")},gn.prototype.pick=function(e,t,i,r,n,o){var s=new wi;return s._pickingUnavailable=!0,s},gn.prototype.pickWithRay=function(e,t,i,r){throw S.WarnImport("Ray")},gn.prototype.multiPick=function(e,t,i,r,n){throw S.WarnImport("Ray")},gn.prototype.multiPickWithRay=function(e,t,i){throw S.WarnImport("Ray")},gn.prototype.setPointerOverMesh=function(e){this._inputManager.setPointerOverMesh(e)},gn.prototype.getPointerOverMesh=function(){return this._inputManager.getPointerOverMesh()},gn.prototype._rebuildGeometries=function(){for(var e=0,t=this.geometries;e<t.length;e++)t[e]._rebuild();for(var i=0,r=this.meshes;i<r.length;i++)r[i]._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(var n=0,o=this._components;n<o.length;n++)o[n].rebuild();for(var s=0,a=this.particleSystems;s<a.length;s++)a[s].rebuild()},gn.prototype._rebuildTextures=function(){for(var e=0,t=this.textures;e<t.length;e++)t[e]._rebuild();this.markAllMaterialsAsDirty(1)},gn.prototype._getByTags=function(e,t,i){if(void 0===t)return e;var r=[];for(var n in i=i||function(e){},e){var o=e[n];_&&_.MatchesQuery(o,t)&&(r.push(o),i(o))}return r},gn.prototype.getMeshesByTags=function(e,t){return this._getByTags(this.meshes,e,t)},gn.prototype.getCamerasByTags=function(e,t){return this._getByTags(this.cameras,e,t)},gn.prototype.getLightsByTags=function(e,t){return this._getByTags(this.lights,e,t)},gn.prototype.getMaterialByTags=function(e,t){return this._getByTags(this.materials,e,t).concat(this._getByTags(this.multiMaterials,e,t))},gn.prototype.setRenderingOrder=function(e,t,i,r){void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=null),this._renderingManager.setRenderingOrder(e,t,i,r)},gn.prototype.setRenderingAutoClearDepthStencil=function(e,t,i,r){void 0===i&&(i=!0),void 0===r&&(r=!0),this._renderingManager.setRenderingAutoClearDepthStencil(e,t,i,r)},gn.prototype.getAutoClearDepthStencilSetup=function(e){return this._renderingManager.getAutoClearDepthStencilSetup(e)},Object.defineProperty(gn.prototype,"blockMaterialDirtyMechanism",{get:function(){return this._blockMaterialDirtyMechanism},set:function(e){this._blockMaterialDirtyMechanism!==e&&((this._blockMaterialDirtyMechanism=e)||this.markAllMaterialsAsDirty(31))},enumerable:!0,configurable:!0}),gn.prototype.markAllMaterialsAsDirty=function(e,t){if(!this._blockMaterialDirtyMechanism)for(var i=0,r=this.materials;i<r.length;i++){var n=r[i];t&&!t(n)||n.markAsDirty(e)}},gn.prototype._loadFile=function(e,t,i,r,n,o){var s=this,a=Xt.LoadFile(e,t,i,r?this.offlineProvider:void 0,n,o);return this._activeRequests.push(a),a.onCompleteObservable.add(function(e){s._activeRequests.splice(s._activeRequests.indexOf(e),1)}),a},gn.prototype._loadFileAsync=function(e,r,n,o){var s=this;return new Promise(function(t,i){s._loadFile(e,function(e){t(e)},r,n,o,function(e,t){i(t)})})},gn.prototype._requestFile=function(e,t,i,r,n,o,s){var a=this,h=Xt.RequestFile(e,t,i,r?this.offlineProvider:void 0,n,o,s);return this._activeRequests.push(h),h.onCompleteObservable.add(function(e){a._activeRequests.splice(a._activeRequests.indexOf(e),1)}),h},gn.prototype._requestFileAsync=function(e,r,n,o,s){var a=this;return new Promise(function(t,i){a._requestFile(e,function(e){t(e)},r,n,o,function(e){i(e)},s)})},gn.prototype._readFile=function(e,t,i,r,n){var o=this,s=Xt.ReadFile(e,t,i,r,n);return this._activeRequests.push(s),s.onCompleteObservable.add(function(e){o._activeRequests.splice(o._activeRequests.indexOf(e),1)}),s},gn.prototype._readFileAsync=function(e,r,n){var o=this;return new Promise(function(t,i){o._readFile(e,function(e){t(e)},r,n,function(e){i(e)})})},gn.FOGMODE_NONE=0,gn.FOGMODE_EXP=1,gn.FOGMODE_EXP2=2,gn.FOGMODE_LINEAR=3,gn.MinDeltaTime=1,gn.MaxDeltaTime=1e3,gn);function gn(e,t){var i=pn.call(this)||this;i._inputManager=new un(i),i.cameraToUseForPointers=null,i._isScene=!0,i._blockEntityCollection=!1,i.autoClear=!0,i.autoClearDepthAndStencil=!0,i.clearColor=new K(.2,.2,.3,1),i.ambientColor=new Ne(0,0,0),i._environmentIntensity=1,i._forceWireframe=!1,i._skipFrustumClipping=!1,i._forcePointsCloud=!1,i.animationsEnabled=!0,i._animationPropertiesOverride=null,i.useConstantAnimationDeltaTime=!1,i.constantlyUpdateMeshUnderPointer=!1,i.hoverCursor="pointer",i.defaultCursor="",i.doNotHandleCursors=!1,i.preventDefaultOnPointerDown=!0,i.preventDefaultOnPointerUp=!0,i.metadata=null,i.reservedDataStore=null,i.disableOfflineSupportExceptionRules=new Array,i.onDisposeObservable=new le,i._onDisposeObserver=null,i.onBeforeRenderObservable=new le,i._onBeforeRenderObserver=null,i.onAfterRenderObservable=new le,i.onAfterRenderCameraObservable=new le,i._onAfterRenderObserver=null,i.onBeforeAnimationsObservable=new le,i.onAfterAnimationsObservable=new le,i.onBeforeDrawPhaseObservable=new le,i.onAfterDrawPhaseObservable=new le,i.onReadyObservable=new le,i.onBeforeCameraRenderObservable=new le,i._onBeforeCameraRenderObserver=null,i.onAfterCameraRenderObservable=new le,i._onAfterCameraRenderObserver=null,i.onBeforeActiveMeshesEvaluationObservable=new le,i.onAfterActiveMeshesEvaluationObservable=new le,i.onBeforeParticlesRenderingObservable=new le,i.onAfterParticlesRenderingObservable=new le,i.onDataLoadedObservable=new le,i.onNewCameraAddedObservable=new le,i.onCameraRemovedObservable=new le,i.onNewLightAddedObservable=new le,i.onLightRemovedObservable=new le,i.onNewGeometryAddedObservable=new le,i.onGeometryRemovedObservable=new le,i.onNewTransformNodeAddedObservable=new le,i.onTransformNodeRemovedObservable=new le,i.onNewMeshAddedObservable=new le,i.onMeshRemovedObservable=new le,i.onNewSkeletonAddedObservable=new le,i.onSkeletonRemovedObservable=new le,i.onNewMaterialAddedObservable=new le,i.onMaterialRemovedObservable=new le,i.onNewTextureAddedObservable=new le,i.onTextureRemovedObservable=new le,i.onBeforeRenderTargetsRenderObservable=new le,i.onAfterRenderTargetsRenderObservable=new le,i.onBeforeStepObservable=new le,i.onAfterStepObservable=new le,i.onActiveCameraChanged=new le,i.onBeforeRenderingGroupObservable=new le,i.onAfterRenderingGroupObservable=new le,i.onMeshImportedObservable=new le,i.onAnimationFileImportedObservable=new le,i._registeredForLateAnimationBindings=new re(256),i.onPrePointerObservable=new le,i.onPointerObservable=new le,i.onPreKeyboardObservable=new le,i.onKeyboardObservable=new le,i._useRightHandedSystem=!1,i._timeAccumulator=0,i._currentStepId=0,i._currentInternalStep=0,i._fogEnabled=!0,i._fogMode=gn.FOGMODE_NONE,i.fogColor=new Ne(.2,.2,.3),i.fogDensity=.1,i.fogStart=0,i.fogEnd=1e3,i._shadowsEnabled=!0,i._lightsEnabled=!0,i.activeCameras=new Array,i._texturesEnabled=!0,i.particlesEnabled=!0,i.spritesEnabled=!0,i._skeletonsEnabled=!0,i.lensFlaresEnabled=!0,i.collisionsEnabled=!0,i.gravity=new te(0,-9.807,0),i.postProcessesEnabled=!0,i.postProcesses=new Array,i.renderTargetsEnabled=!0,i.dumpNextRenderTargets=!1,i.customRenderTargets=new Array,i.importedMeshesFiles=new Array,i.probesEnabled=!0,i._meshesForIntersections=new re(256),i.proceduralTexturesEnabled=!0,i._totalVertices=new xi,i._activeIndices=new xi,i._activeParticles=new xi,i._activeBones=new xi,i._animationTime=0,i.animationTimeScale=1,i._renderId=0,i._frameId=0,i._executeWhenReadyTimeoutId=-1,i._intermediateRendering=!1,i._viewUpdateFlag=-1,i._projectionUpdateFlag=-1,i._toBeDisposed=new Array(256),i._activeRequests=new Array,i._pendingData=new Array,i._isDisposed=!1,i.dispatchAllSubMeshesOfActiveMeshes=!1,i._activeMeshes=new $(256),i._processedMaterials=new $(256),i._renderTargets=new re(256),i._activeParticleSystems=new $(256),i._activeSkeletons=new re(32),i._softwareSkinnedMeshes=new re(32),i._activeAnimatables=new Array,i._transformMatrix=W.Zero(),i.requireLightSorting=!1,i._components=[],i._serializableComponents=[],i._transientComponents=[],i._beforeCameraUpdateStage=Wr.Create(),i._beforeClearStage=Wr.Create(),i._gatherRenderTargetsStage=Wr.Create(),i._gatherActiveCameraRenderTargetsStage=Wr.Create(),i._isReadyForMeshStage=Wr.Create(),i._beforeEvaluateActiveMeshStage=Wr.Create(),i._evaluateSubMeshStage=Wr.Create(),i._activeMeshStage=Wr.Create(),i._cameraDrawRenderTargetStage=Wr.Create(),i._beforeCameraDrawStage=Wr.Create(),i._beforeRenderTargetDrawStage=Wr.Create(),i._beforeRenderingGroupDrawStage=Wr.Create(),i._beforeRenderingMeshStage=Wr.Create(),i._afterRenderingMeshStage=Wr.Create(),i._afterRenderingGroupDrawStage=Wr.Create(),i._afterCameraDrawStage=Wr.Create(),i._afterRenderTargetDrawStage=Wr.Create(),i._afterRenderStage=Wr.Create(),i._pointerMoveStage=Wr.Create(),i._pointerDownStage=Wr.Create(),i._pointerUpStage=Wr.Create(),i.geometriesByUniqueId=null,i._defaultMeshCandidates={data:[],length:0},i._defaultSubMeshCandidates={data:[],length:0},i._preventFreeActiveMeshesAndRenderingGroups=!1,i._activeMeshesFrozen=!1,i._skipEvaluateActiveMeshesCompletely=!1,i._allowPostProcessClearColor=!0,i.getDeterministicFrameTime=function(){return i._engine.getTimeStep()},i._blockMaterialDirtyMechanism=!1;var r=l({useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1},t);return i._engine=e||Ae.LastCreatedEngine,r.virtual||(Ae._LastCreatedScene=i)._engine.scenes.push(i),i._uid=null,i._renderingManager=new Br(i),Dr&&(i.postProcessManager=new Dr(i)),ce.IsWindowObjectExist()&&i.attachControl(),i._createUbo(),_r&&(i._imageProcessingConfiguration=new _r),i.setDefaultCandidateProviders(),r.useGeometryUniqueIdsMap&&(i.geometriesByUniqueId={}),i.useMaterialMeshMap=r.useMaterialMeshMap,i.useClonedMeshMap=r.useClonedMeshMap,t&&t.virtual||i._engine.onNewSceneAddedObservable.notifyObservers(i),i}var mn,vn=(n(yn,mn=Ir),yn.prototype.getEffect=function(){return this._activeEffect},yn.prototype.isReady=function(e,t){return!!e&&(!e.subMeshes||0===e.subMeshes.length||this.isReadyForSubMesh(e,e.subMeshes[0],t))},yn.prototype.bindOnlyWorldMatrix=function(e){this._activeEffect.setMatrix("world",e)},yn.prototype.bindOnlyNormalMatrix=function(e){this._activeEffect.setMatrix("normalMatrix",e)},yn.prototype.bind=function(e,t){t&&this.bindForSubMesh(e,t,t.subMeshes[0])},yn.prototype._afterBind=function(e,t){void 0===t&&(t=null),mn.prototype._afterBind.call(this,e),this.getScene()._cachedEffect=t},yn.prototype._mustRebind=function(e,t,i){return void 0===i&&(i=1),e.isCachedMaterialInvalid(this,t,i)},yn);function yn(e,t){var i=mn.call(this,e,t)||this;return i._normalMatrix=new W,i.allowShaderHotSwapping=!0,i._storeEffectOnSubMeshes=!0,i}var bn=(Tn.BindEyePosition=function(e,t){var i;t._forcedViewPosition?e.setVector3("vEyePosition",t._forcedViewPosition):(i=(i=t.activeCamera.globalPosition)||t.activeCamera.devicePosition,e.setVector3("vEyePosition",t._mirroredCameraPosition?t._mirroredCameraPosition:i))},Tn.PrepareDefinesForMergedUV=function(e,t,i){t._needUVs=!0,t[i]=!0,e.getTextureMatrix().isIdentityAs3x2()?(t[i+"DIRECTUV"]=e.coordinatesIndex+1,0===e.coordinatesIndex?t.MAINUV1=!0:t.MAINUV2=!0):t[i+"DIRECTUV"]=0},Tn.BindTextureMatrix=function(e,t,i){var r=e.getTextureMatrix();t.updateMatrix(i+"Matrix",r)},Tn.GetFogState=function(e,t){return t.fogEnabled&&e.applyFog&&t.fogMode!==_n.FOGMODE_NONE},Tn.PrepareDefinesForMisc=function(e,t,i,r,n,o,s){s._areMiscDirty&&(s.LOGARITHMICDEPTH=i,s.POINTSIZE=r,s.FOG=n&&this.GetFogState(e,t),s.NONUNIFORMSCALING=e.nonUniformScaling,s.ALPHATEST=o)},Tn.PrepareDefinesForFrameBoundValues=function(e,t,i,r,n){void 0===n&&(n=null);var o=!1,s=null==n?void 0!==e.clipPlane&&null!==e.clipPlane:n,a=null==n?void 0!==e.clipPlane2&&null!==e.clipPlane2:n,h=null==n?void 0!==e.clipPlane3&&null!==e.clipPlane3:n,l=null==n?void 0!==e.clipPlane4&&null!==e.clipPlane4:n,u=null==n?void 0!==e.clipPlane5&&null!==e.clipPlane5:n,c=null==n?void 0!==e.clipPlane6&&null!==e.clipPlane6:n;i.CLIPPLANE!==s&&(i.CLIPPLANE=s,o=!0),i.CLIPPLANE2!==a&&(i.CLIPPLANE2=a,o=!0),i.CLIPPLANE3!==h&&(i.CLIPPLANE3=h,o=!0),i.CLIPPLANE4!==l&&(i.CLIPPLANE4=l,o=!0),i.CLIPPLANE5!==u&&(i.CLIPPLANE5=u,o=!0),i.CLIPPLANE6!==c&&(i.CLIPPLANE6=c,o=!0),i.DEPTHPREPASS!==!t.getColorWrite()&&(i.DEPTHPREPASS=!i.DEPTHPREPASS,o=!0),i.INSTANCES!==r&&(i.INSTANCES=r,o=!0),o&&i.markAsUnprocessed()},Tn.PrepareDefinesForBones=function(e,t){var i;e.useBones&&e.computeBonesUsingShaders&&e.skeleton?(t.NUM_BONE_INFLUENCERS=e.numBoneInfluencers,i=void 0!==t.BONETEXTURE,e.skeleton.isUsingTextureForMatrices&&i?t.BONETEXTURE=!0:(t.BonesPerMesh=e.skeleton.bones.length+1,t.BONETEXTURE=!i&&void 0)):(t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0)},Tn.PrepareDefinesForMorphTargets=function(e,t){var i=e.morphTargetManager;i?(t.MORPHTARGETS_UV=i.supportsUVs&&t.UV1,t.MORPHTARGETS_TANGENT=i.supportsTangents&&t.TANGENT,t.MORPHTARGETS_NORMAL=i.supportsNormals&&t.NORMAL,t.MORPHTARGETS=0<i.numInfluencers,t.NUM_MORPH_INFLUENCERS=i.numInfluencers):(t.MORPHTARGETS_UV=!1,t.MORPHTARGETS_TANGENT=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS=!1,t.NUM_MORPH_INFLUENCERS=0)},Tn.PrepareDefinesForAttributes=function(e,t,i,r,n,o){return void 0===n&&(n=!1),void 0===o&&(o=!0),!(!t._areAttributesDirty&&t._needNormals===t._normals&&t._needUVs===t._uvs||(t._normals=t._needNormals,t._uvs=t._needUVs,t.NORMAL=t._needNormals&&e.isVerticesDataPresent(Si.NormalKind),t._needNormals&&e.isVerticesDataPresent(Si.TangentKind)&&(t.TANGENT=!0),t._needUVs?(t.UV1=e.isVerticesDataPresent(Si.UVKind),t.UV2=e.isVerticesDataPresent(Si.UV2Kind)):(t.UV1=!1,t.UV2=!1),i&&(s=e.useVertexColors&&e.isVerticesDataPresent(Si.ColorKind),t.VERTEXCOLOR=s,t.VERTEXALPHA=e.hasVertexAlpha&&s&&o),r&&this.PrepareDefinesForBones(e,t),n&&this.PrepareDefinesForMorphTargets(e,t),0));var s},Tn.PrepareDefinesForMultiview=function(e,t){var i;e.activeCamera&&(i=t.MULTIVIEW,t.MULTIVIEW=null!==e.activeCamera.outputRenderTarget&&1<e.activeCamera.outputRenderTarget.getViewCount(),t.MULTIVIEW!=i&&t.markAsUnprocessed())},Tn.PrepareDefinesForLight=function(e,t,i,r,n,o,s){switch(s.needNormals=!0,void 0===n["LIGHT"+r]&&(s.needRebuild=!0),n["LIGHT"+r]=!0,n["SPOTLIGHT"+r]=!1,n["HEMILIGHT"+r]=!1,n["POINTLIGHT"+r]=!1,n["DIRLIGHT"+r]=!1,i.prepareLightSpecificDefines(n,r),n["LIGHT_FALLOFF_PHYSICAL"+r]=!1,n["LIGHT_FALLOFF_GLTF"+r]=!1,n["LIGHT_FALLOFF_STANDARD"+r]=!1,i.falloffType){case br.FALLOFF_GLTF:n["LIGHT_FALLOFF_GLTF"+r]=!0;break;case br.FALLOFF_PHYSICAL:n["LIGHT_FALLOFF_PHYSICAL"+r]=!0;break;case br.FALLOFF_STANDARD:n["LIGHT_FALLOFF_STANDARD"+r]=!0}var a,h;o&&!i.specular.equalsFloats(0,0,0)&&(s.specularEnabled=!0),n["SHADOW"+r]=!1,n["SHADOWCSM"+r]=!1,n["SHADOWCSMDEBUG"+r]=!1,n["SHADOWCSMNUM_CASCADES"+r]=!1,n["SHADOWCSMUSESHADOWMAXZ"+r]=!1,n["SHADOWCSMNOBLEND"+r]=!1,n["SHADOWCSM_RIGHTHANDED"+r]=!1,n["SHADOWPCF"+r]=!1,n["SHADOWPCSS"+r]=!1,n["SHADOWPOISSON"+r]=!1,n["SHADOWESM"+r]=!1,n["SHADOWCUBE"+r]=!1,n["SHADOWLOWQUALITY"+r]=!1,n["SHADOWMEDIUMQUALITY"+r]=!1,t&&t.receiveShadows&&e.shadowsEnabled&&i.shadowEnabled&&(!(a=i.getShadowGenerator())||(h=a.getShadowMap())&&h.renderList&&0<h.renderList.length&&(s.shadowEnabled=!0,a.prepareDefines(n,r))),i.lightmapMode!=br.LIGHTMAP_DEFAULT?(s.lightmapMode=!0,n["LIGHTMAPEXCLUDED"+r]=!0,n["LIGHTMAPNOSPECULAR"+r]=i.lightmapMode==br.LIGHTMAP_SHADOWSONLY):(n["LIGHTMAPEXCLUDED"+r]=!1,n["LIGHTMAPNOSPECULAR"+r]=!1)},Tn.PrepareDefinesForLights=function(e,t,i,r,n,o){if(void 0===n&&(n=4),void 0===o&&(o=!1),!i._areLightsDirty)return i._needNormals;var s=0,a={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(e.lightsEnabled&&!o)for(var h=0,l=t.lightSources;h<l.length;h++){var u=l[h];if(this.PrepareDefinesForLight(e,t,u,s,i,r,a),++s===n)break}i.SPECULARTERM=a.specularEnabled,i.SHADOWS=a.shadowEnabled;for(var c=s;c<n;c++)void 0!==i["LIGHT"+c]&&(i["LIGHT"+c]=!1,i["HEMILIGHT"+c]=!1,i["POINTLIGHT"+c]=!1,i["DIRLIGHT"+c]=!1,i["SPOTLIGHT"+c]=!1,i["SHADOW"+c]=!1,i["SHADOWCSM"+c]=!1,i["SHADOWCSMDEBUG"+c]=!1,i["SHADOWCSMNUM_CASCADES"+c]=!1,i["SHADOWCSMUSESHADOWMAXZ"+c]=!1,i["SHADOWCSMNOBLEND"+c]=!1,i["SHADOWCSM_RIGHTHANDED"+c]=!1,i["SHADOWPCF"+c]=!1,i["SHADOWPCSS"+c]=!1,i["SHADOWPOISSON"+c]=!1,i["SHADOWESM"+c]=!1,i["SHADOWCUBE"+c]=!1,i["SHADOWLOWQUALITY"+c]=!1,i["SHADOWMEDIUMQUALITY"+c]=!1);var d=e.getEngine().getCaps();return void 0===i.SHADOWFLOAT&&(a.needRebuild=!0),i.SHADOWFLOAT=a.shadowEnabled&&(d.textureFloatRender&&d.textureFloatLinearFiltering||d.textureHalfFloatRender&&d.textureHalfFloatLinearFiltering),i.LIGHTMAPEXCLUDED=a.lightmapMode,a.needRebuild&&i.rebuild(),a.needNormals},Tn.PrepareUniformsAndSamplersForLight=function(e,t,i,r,n){void 0===n&&(n=null),t.push("vLightData"+e,"vLightDiffuse"+e,"vLightSpecular"+e,"vLightDirection"+e,"vLightFalloff"+e,"vLightGround"+e,"lightMatrix"+e,"shadowsInfo"+e,"depthValues"+e),n&&n.push("Light"+e),i.push("shadowSampler"+e),i.push("depthSampler"+e),t.push("viewFrustumZ"+e,"cascadeBlendFactor"+e,"lightSizeUVCorrection"+e,"depthCorrection"+e,"penumbraDarkness"+e,"frustumLengths"+e),r&&(i.push("projectionLightSampler"+e),t.push("textureProjectionMatrix"+e))},Tn.PrepareUniformsAndSamplersList=function(e,t,i,r){void 0===r&&(r=4);var n,o=null;e.uniformsNames?(n=e.uniformsNames,o=e.uniformBuffersNames,t=e.samplers,i=e.defines,r=e.maxSimultaneousLights||0):(n=e,t=t||[]);for(var s=0;s<r&&i["LIGHT"+s];s++)this.PrepareUniformsAndSamplersForLight(s,n,t,i["PROJECTEDLIGHTTEXTURE"+s],o);i.NUM_MORPH_INFLUENCERS&&n.push("morphTargetInfluences")},Tn.HandleFallbacksForShadows=function(e,t,i,r){void 0===i&&(i=4),void 0===r&&(r=0);for(var n=0,o=0;o<i&&e["LIGHT"+o];o++)0<o&&(n=r+o,t.addFallback(n,"LIGHT"+o)),e.SHADOWS||(e["SHADOW"+o]&&t.addFallback(r,"SHADOW"+o),e["SHADOWPCF"+o]&&t.addFallback(r,"SHADOWPCF"+o),e["SHADOWPCSS"+o]&&t.addFallback(r,"SHADOWPCSS"+o),e["SHADOWPOISSON"+o]&&t.addFallback(r,"SHADOWPOISSON"+o),e["SHADOWESM"+o]&&t.addFallback(r,"SHADOWESM"+o));return n++},Tn.PrepareAttributesForMorphTargetsInfluencers=function(e,t,i){this._TmpMorphInfluencers.NUM_MORPH_INFLUENCERS=i,this.PrepareAttributesForMorphTargets(e,t,this._TmpMorphInfluencers)},Tn.PrepareAttributesForMorphTargets=function(e,t,i){var r=i.NUM_MORPH_INFLUENCERS;if(0<r&&Ae.LastCreatedEngine)for(var n=Ae.LastCreatedEngine.getCaps().maxVertexAttribs,o=t.morphTargetManager,s=o&&o.supportsNormals&&i.NORMAL,a=o&&o.supportsTangents&&i.TANGENT,h=o&&o.supportsUVs&&i.UV1,l=0;l<r;l++)e.push(Si.PositionKind+l),s&&e.push(Si.NormalKind+l),a&&e.push(Si.TangentKind+l),h&&e.push(Si.UVKind+"_"+l),e.length>n&&fe.Error("Cannot add more vertex attributes for mesh "+t.name)},Tn.PrepareAttributesForBones=function(e,t,i,r){0<i.NUM_BONE_INFLUENCERS&&(r.addCPUSkinningFallback(0,t),e.push(Si.MatricesIndicesKind),e.push(Si.MatricesWeightsKind),4<i.NUM_BONE_INFLUENCERS&&(e.push(Si.MatricesIndicesExtraKind),e.push(Si.MatricesWeightsExtraKind)))},Tn.PrepareAttributesForInstances=function(e,t){t.INSTANCES&&this.PushAttributesForInstances(e)},Tn.PushAttributesForInstances=function(e){e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3")},Tn.BindLightProperties=function(e,t,i){e.transferToEffect(t,i+"")},Tn.BindLight=function(e,t,i,r,n,o){void 0===o&&(o=!1),e._bindLight(t,i,r,n,o)},Tn.BindLights=function(e,t,i,r,n,o){void 0===n&&(n=4),void 0===o&&(o=!1);for(var s=Math.min(t.lightSources.length,n),a=0;a<s;a++){var h=t.lightSources[a];this.BindLight(h,a,e,i,"boolean"==typeof r?r:r.SPECULARTERM,o)}},Tn.BindFogParameters=function(e,t,i,r){void 0===r&&(r=!1),e.fogEnabled&&t.applyFog&&e.fogMode!==_n.FOGMODE_NONE&&(i.setFloat4("vFogInfos",e.fogMode,e.fogStart,e.fogEnd,e.fogDensity),r?(e.fogColor.toLinearSpaceToRef(this._tempFogColor),i.setColor3("vFogColor",this._tempFogColor)):i.setColor3("vFogColor",e.fogColor))},Tn.BindBonesParameters=function(e,t){var i,r,n;t&&e&&(e.computeBonesUsingShaders&&t._bonesComputationForcedToCPU&&(e.computeBonesUsingShaders=!1),e.useBones&&e.computeBonesUsingShaders&&e.skeleton&&((i=e.skeleton).isUsingTextureForMatrices&&-1<t.getUniformIndex("boneTextureWidth")?(r=i.getTransformMatrixTexture(e),t.setTexture("boneSampler",r),t.setFloat("boneTextureWidth",4*(i.bones.length+1))):(n=i.getTransformMatrices(e))&&t.setMatrices("mBones",n)))},Tn.BindMorphTargetParameters=function(e,t){var i=e.morphTargetManager;e&&i&&t.setFloatArray("morphTargetInfluences",i.influences)},Tn.BindLogDepth=function(e,t,i){e.LOGARITHMICDEPTH&&t.setFloat("logarithmicDepthConstant",2/(Math.log(i.activeCamera.maxZ+1)/Math.LN2))},Tn.BindClipPlane=function(e,t){var i;t.clipPlane&&(i=t.clipPlane,e.setFloat4("vClipPlane",i.normal.x,i.normal.y,i.normal.z,i.d)),t.clipPlane2&&(i=t.clipPlane2,e.setFloat4("vClipPlane2",i.normal.x,i.normal.y,i.normal.z,i.d)),t.clipPlane3&&(i=t.clipPlane3,e.setFloat4("vClipPlane3",i.normal.x,i.normal.y,i.normal.z,i.d)),t.clipPlane4&&(i=t.clipPlane4,e.setFloat4("vClipPlane4",i.normal.x,i.normal.y,i.normal.z,i.d)),t.clipPlane5&&(i=t.clipPlane5,e.setFloat4("vClipPlane5",i.normal.x,i.normal.y,i.normal.z,i.d)),t.clipPlane6&&(i=t.clipPlane6,e.setFloat4("vClipPlane6",i.normal.x,i.normal.y,i.normal.z,i.d))},Tn._TmpMorphInfluencers={NUM_MORPH_INFLUENCERS:0},Tn._tempFogColor=Ne.Black(),Tn);function Tn(){}var xn=(En.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},En.prototype.getClassName=function(){return"Size"},En.prototype.getHashCode=function(){return 397*(0|this.width)^(0|this.height)},En.prototype.copyFrom=function(e){this.width=e.width,this.height=e.height},En.prototype.copyFromFloats=function(e,t){return this.width=e,this.height=t,this},En.prototype.set=function(e,t){return this.copyFromFloats(e,t)},En.prototype.multiplyByFloats=function(e,t){return new En(this.width*e,this.height*t)},En.prototype.clone=function(){return new En(this.width,this.height)},En.prototype.equals=function(e){return!!e&&this.width===e.width&&this.height===e.height},Object.defineProperty(En.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),En.Zero=function(){return new En(0,0)},En.prototype.add=function(e){return new En(this.width+e.width,this.height+e.height)},En.prototype.subtract=function(e){return new En(this.width-e.width,this.height-e.height)},En.Lerp=function(e,t,i){return new En(e.width+(t.width-e.width)*i,e.height+(t.height-e.height)*i)},En);function En(e,t){this.width=e,this.height=t}var An=(Object.defineProperty(Mn.prototype,"hasAlpha",{get:function(){return this._hasAlpha},set:function(e){this._hasAlpha!==e&&(this._hasAlpha=e,this._scene&&this._scene.markAllMaterialsAsDirty(17))},enumerable:!0,configurable:!0}),Object.defineProperty(Mn.prototype,"coordinatesMode",{get:function(){return this._coordinatesMode},set:function(e){this._coordinatesMode!==e&&(this._coordinatesMode=e,this._scene&&this._scene.markAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(Mn.prototype,"isCube",{get:function(){return!!this._texture&&this._texture.isCube},set:function(e){this._texture&&(this._texture.isCube=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Mn.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(e){this._texture&&(this._texture.is3D=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Mn.prototype,"is2DArray",{get:function(){return!!this._texture&&this._texture.is2DArray},set:function(e){this._texture&&(this._texture.is2DArray=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Mn.prototype,"isRGBD",{get:function(){return null!=this._texture&&this._texture._isRGBD},set:function(e){this._texture&&(this._texture._isRGBD=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Mn.prototype,"noMipmap",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(Mn.prototype,"lodGenerationOffset",{get:function(){return this._texture?this._texture._lodGenerationOffset:0},set:function(e){this._texture&&(this._texture._lodGenerationOffset=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Mn.prototype,"lodGenerationScale",{get:function(){return this._texture?this._texture._lodGenerationScale:0},set:function(e){this._texture&&(this._texture._lodGenerationScale=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Mn.prototype,"linearSpecularLOD",{get:function(){return!!this._texture&&this._texture._linearSpecularLOD},set:function(e){this._texture&&(this._texture._linearSpecularLOD=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Mn.prototype,"irradianceTexture",{get:function(){return this._texture?this._texture._irradianceTexture:null},set:function(e){this._texture&&(this._texture._irradianceTexture=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Mn.prototype,"uid",{get:function(){return this._uid||(this._uid=ti.RandomId()),this._uid},enumerable:!0,configurable:!0}),Mn.prototype.toString=function(){return this.name},Mn.prototype.getClassName=function(){return"BaseTexture"},Object.defineProperty(Mn.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Mn.prototype,"isBlocking",{get:function(){return!0},enumerable:!0,configurable:!0}),Mn.prototype.getScene=function(){return this._scene},Mn.prototype.getTextureMatrix=function(){return W.IdentityReadOnly},Mn.prototype.getReflectionTextureMatrix=function(){return W.IdentityReadOnly},Mn.prototype.getInternalTexture=function(){return this._texture},Mn.prototype.isReadyOrNotBlocking=function(){return!this.isBlocking||this.isReady()},Mn.prototype.isReady=function(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady},Mn.prototype.getSize=function(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize},Mn.prototype.getBaseSize=function(){return this.isReady()&&this._texture?this._texture._size?new xn(this._texture._size,this._texture._size):new xn(this._texture.baseWidth,this._texture.baseHeight):xn.Zero()},Mn.prototype.updateSamplingMode=function(e){var t;!this._texture||(t=this.getScene())&&t.getEngine().updateTextureSamplingMode(e,this._texture)},Mn.prototype.scale=function(e){},Object.defineProperty(Mn.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),Mn.prototype._getFromCache=function(e,t,i,r){if(!this._scene)return null;for(var n=this._scene.getEngine().getLoadedTexturesCache(),o=0;o<n.length;o++){var s=n[o];if(!(void 0!==r&&r!==s.invertY||s.url!==e||s.generateMipMaps!==!t||i&&i!==s.samplingMode))return s.incrementReferences(),s}return null},Mn.prototype._rebuild=function(){},Mn.prototype.delayLoad=function(){},Mn.prototype.clone=function(){return null},Object.defineProperty(Mn.prototype,"textureType",{get:function(){return this._texture&&void 0!==this._texture.type?this._texture.type:0},enumerable:!0,configurable:!0}),Object.defineProperty(Mn.prototype,"textureFormat",{get:function(){return this._texture&&void 0!==this._texture.format?this._texture.format:5},enumerable:!0,configurable:!0}),Mn.prototype._markAllSubMeshesAsTexturesDirty=function(){var e=this.getScene();e&&e.markAllMaterialsAsDirty(1)},Mn.prototype.readPixels=function(e,t,i){if(void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=null),!this._texture)return null;var r=this.getSize(),n=r.width,o=r.height,s=this.getScene();if(!s)return null;var a=s.getEngine();return 0!=t&&(n/=Math.pow(2,t),o/=Math.pow(2,t),n=Math.round(n),o=Math.round(o)),this._texture.isCube?a._readTexturePixels(this._texture,n,o,e,t,i):a._readTexturePixels(this._texture,n,o,-1,t,i)},Mn.prototype.releaseInternalTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null)},Object.defineProperty(Mn.prototype,"_lodTextureHigh",{get:function(){return this._texture?this._texture._lodTextureHigh:null},enumerable:!0,configurable:!0}),Object.defineProperty(Mn.prototype,"_lodTextureMid",{get:function(){return this._texture?this._texture._lodTextureMid:null},enumerable:!0,configurable:!0}),Object.defineProperty(Mn.prototype,"_lodTextureLow",{get:function(){return this._texture?this._texture._lodTextureLow:null},enumerable:!0,configurable:!0}),Mn.prototype.dispose=function(){var e;this._scene&&(this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene._removePendingData(this),0<=(e=this._scene.textures.indexOf(this))&&this._scene.textures.splice(e,1),this._scene.onTextureRemovedObservable.notifyObservers(this)),void 0!==this._texture&&(this.releaseInternalTexture(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear())},Mn.prototype.serialize=function(){if(!this.name)return null;var e=Q.Serialize(this);return Q.AppendSerializedAnimations(this,e),e},Mn.WhenAllReady=function(t,i){var r=t.length;if(0!==r)for(var n,o,s=0;s<t.length;s++)!function(){var e;(n=t[s]).isReady()?0==--r&&i():(o=n.onLoadObservable)&&(e=function(){o.removeCallback(e),0==--r&&i()},o.add(e))}();else i()},Mn.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,o([z()],Mn.prototype,"uniqueId",void 0),o([z()],Mn.prototype,"name",void 0),o([z()],Mn.prototype,"metadata",void 0),o([z("hasAlpha")],Mn.prototype,"_hasAlpha",void 0),o([z()],Mn.prototype,"getAlphaFromRGB",void 0),o([z()],Mn.prototype,"level",void 0),o([z()],Mn.prototype,"coordinatesIndex",void 0),o([z("coordinatesMode")],Mn.prototype,"_coordinatesMode",void 0),o([z()],Mn.prototype,"wrapU",void 0),o([z()],Mn.prototype,"wrapV",void 0),o([z()],Mn.prototype,"wrapR",void 0),o([z()],Mn.prototype,"anisotropicFilteringLevel",void 0),o([z()],Mn.prototype,"isCube",null),o([z()],Mn.prototype,"is3D",null),o([z()],Mn.prototype,"is2DArray",null),o([z(),V("_markAllSubMeshesAsTexturesDirty")],Mn.prototype,"gammaSpace",void 0),o([z()],Mn.prototype,"invertZ",void 0),o([z()],Mn.prototype,"lodLevelInAlpha",void 0),o([z()],Mn.prototype,"lodGenerationOffset",null),o([z()],Mn.prototype,"lodGenerationScale",null),o([z()],Mn.prototype,"linearSpecularLOD",null),o([X()],Mn.prototype,"irradianceTexture",null),o([z()],Mn.prototype,"isRenderTarget",void 0),Mn);function Mn(e){this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this.getAlphaFromRGB=!1,this.level=1,this.coordinatesIndex=0,this._coordinatesMode=0,this.wrapU=1,this.wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=Mn.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this.gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this.animations=new Array,this.onDisposeObservable=new le,this._onDisposeObserver=null,this.delayLoadState=0,this._scene=null,this._texture=null,this._uid=null,this._cachedSize=xn.Zero(),this._scene=e||Ae.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this)),this._uid=null}var Cn,Pn=(n(On,Cn=An),Object.defineProperty(On.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!0,configurable:!0}),Object.defineProperty(On.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(e){this._isBlocking=e},enumerable:!0,configurable:!0}),Object.defineProperty(On.prototype,"samplingMode",{get:function(){return this._texture?this._texture.samplingMode:this._initialSamplingMode},enumerable:!0,configurable:!0}),Object.defineProperty(On.prototype,"invertY",{get:function(){return this._invertY},enumerable:!0,configurable:!0}),On.prototype.updateURL=function(e,t,i){void 0===t&&(t=null),this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(1)),this.name&&!_e.StartsWith(this.name,"data:")||(this.name=e),this.url=e,this._buffer=t,this.delayLoadState=4,i&&(this._delayedOnLoad=i),this.delayLoad()},On.prototype.delayLoad=function(){var e;4!==this.delayLoadState||(e=this.getScene())&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY),this._texture?this._delayedOnLoad&&(this._texture.isReady?Qt.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=e.getEngine().createTexture(this.url,this._noMipmap,this._invertY,e,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,null,this._mimeType),this._deleteBuffer&&delete this._buffer),this._delayedOnLoad=null,this._delayedOnError=null)},On.prototype._prepareRowForTextureGeneration=function(e,t,i,r){e*=this._cachedUScale,t*=this._cachedVScale,e-=this.uRotationCenter*this._cachedUScale,t-=this.vRotationCenter*this._cachedVScale,i-=this.wRotationCenter,te.TransformCoordinatesFromFloatsToRef(e,t,i,this._rowGenerationMatrix,r),r.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,r.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,r.z+=this.wRotationCenter},On.prototype.getTextureMatrix=function(e){var t=this;if(void 0===e&&(e=1),this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*e===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*e,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedTextureMatrix||(this._cachedTextureMatrix=W.Zero(),this._rowGenerationMatrix=new W,this._t0=te.Zero(),this._t1=te.Zero(),this._t2=te.Zero()),W.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),W.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix);var i=this.getScene();return i&&i.markAllMaterialsAsDirty(1,function(e){return e.hasTexture(t)}),this._cachedTextureMatrix},On.prototype.getReflectionTextureMatrix=function(){var t=this,e=this.getScene();if(!e)return this._cachedTextureMatrix;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode){if(this.coordinatesMode!==On.PROJECTION_MODE)return this._cachedTextureMatrix;if(this._cachedProjectionMatrixId===e.getProjectionMatrix().updateFlag)return this._cachedTextureMatrix}switch(this._cachedTextureMatrix||(this._cachedTextureMatrix=W.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=W.Zero()),this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case On.PLANAR_MODE:W.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case On.PROJECTION_MODE:W.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);var i=e.getProjectionMatrix();this._cachedProjectionMatrixId=i.updateFlag,i.multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:W.IdentityToRef(this._cachedTextureMatrix)}return e.markAllMaterialsAsDirty(1,function(e){return-1!==e.getActiveTextures().indexOf(t)}),this._cachedTextureMatrix},On.prototype.clone=function(){var e=this;return Q.Clone(function(){return new On(e._texture?e._texture.url:null,e.getScene(),e._noMipmap,e._invertY,e.samplingMode,void 0,void 0,e._texture?e._texture._buffer:void 0)},this)},On.prototype.serialize=function(){var e=this.name;On.SerializeBuffers||_e.StartsWith(this.name,"data:")&&(this.name="");var t=Cn.prototype.serialize.call(this);return t?(On.SerializeBuffers&&("string"==typeof this._buffer&&"data:"===this._buffer.substr(0,5)?(t.base64String=this._buffer,t.name=t.name.replace("data:","")):this.url&&_e.StartsWith(this.url,"data:")&&this._buffer instanceof Uint8Array&&(t.base64String="data:image/png;base64,"+_e.EncodeArrayBufferToBase64(this._buffer))),t.invertY=this._invertY,t.samplingMode=this.samplingMode,this.name=e,t):null},On.prototype.getClassName=function(){return"Texture"},On.prototype.dispose=function(){Cn.prototype.dispose.call(this),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null},On.Parse=function(a,h,l){if(a.customType){var e=$t.Instantiate(a.customType).Parse(a,h,l);return a.samplingMode&&e.updateSamplingMode&&e._samplingMode&&e._samplingMode!==a.samplingMode&&e.updateSamplingMode(a.samplingMode),e}if(a.isCube&&!a.isRenderTarget)return On._CubeTextureParser(a,h,l);if(!a.name&&!a.isRenderTarget)return null;var t,i=Q.Parse(function(){var e=!0;if(a.noMipmap&&(e=!1),a.mirrorPlane){var t=On._CreateMirror(a.name,a.renderTargetSize,h,e);return t._waitingRenderList=a.renderList,t.mirrorPlane=er.FromArray(a.mirrorPlane),t}if(a.isRenderTarget){var i=null;if(a.isCube){if(h.reflectionProbes)for(var r=0;r<h.reflectionProbes.length;r++){var n=h.reflectionProbes[r];if(n.name===a.name)return n.cubeTexture}}else(i=On._CreateRenderTargetTexture(a.name,a.renderTargetSize,h,e))._waitingRenderList=a.renderList;return i}var o,s=a.base64String?On.CreateFromBase64String(a.base64String,a.name,h,!e,a.invertY):(o=l+a.name,On.UseSerializedUrlIfAny&&a.url&&(o=a.url),new On(o,h,!e,a.invertY));return s},a,h);if(i&&i._texture&&(i._texture._cachedWrapU=null,i._texture._cachedWrapV=null,i._texture._cachedWrapR=null),a.samplingMode&&(t=a.samplingMode,i&&i.samplingMode!==t&&i.updateSamplingMode(t)),i&&a.animations)for(var r=0;r<a.animations.length;r++){var n=a.animations[r],o=m.GetClass("BABYLON.Animation");o&&i.animations.push(o.Parse(n))}return i},On.CreateFromBase64String=function(e,t,i,r,n,o,s,a,h){return void 0===o&&(o=On.TRILINEAR_SAMPLINGMODE),void 0===s&&(s=null),void 0===a&&(a=null),void 0===h&&(h=5),new On("data:"+t,i,r,n,o,s,a,e,!1,h)},On.LoadFromDataString=function(e,t,i,r,n,o,s,a,h,l){return void 0===r&&(r=!1),void 0===n&&(n=!1),void 0===o&&(o=!0),void 0===s&&(s=On.TRILINEAR_SAMPLINGMODE),void 0===a&&(a=null),void 0===h&&(h=null),void 0===l&&(l=5),"data:"!==e.substr(0,5)&&(e="data:"+e),new On(e,i,n,o,s,a,h,t,r,l)},On.SerializeBuffers=!0,On._CubeTextureParser=function(e,t,i){throw S.WarnImport("CubeTexture")},On._CreateMirror=function(e,t,i,r){throw S.WarnImport("MirrorTexture")},On._CreateRenderTargetTexture=function(e,t,i,r){throw S.WarnImport("RenderTargetTexture")},On.NEAREST_SAMPLINGMODE=1,On.NEAREST_NEAREST_MIPLINEAR=8,On.BILINEAR_SAMPLINGMODE=2,On.LINEAR_LINEAR_MIPNEAREST=11,On.TRILINEAR_SAMPLINGMODE=3,On.LINEAR_LINEAR_MIPLINEAR=3,On.NEAREST_NEAREST_MIPNEAREST=4,On.NEAREST_LINEAR_MIPNEAREST=5,On.NEAREST_LINEAR_MIPLINEAR=6,On.NEAREST_LINEAR=7,On.NEAREST_NEAREST=1,On.LINEAR_NEAREST_MIPNEAREST=9,On.LINEAR_NEAREST_MIPLINEAR=10,On.LINEAR_LINEAR=2,On.LINEAR_NEAREST=12,On.EXPLICIT_MODE=0,On.SPHERICAL_MODE=1,On.PLANAR_MODE=2,On.CUBIC_MODE=3,On.PROJECTION_MODE=4,On.SKYBOX_MODE=5,On.INVCUBIC_MODE=6,On.EQUIRECTANGULAR_MODE=7,On.FIXED_EQUIRECTANGULAR_MODE=8,On.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,On.CLAMP_ADDRESSMODE=0,On.WRAP_ADDRESSMODE=1,On.MIRROR_ADDRESSMODE=2,On.UseSerializedUrlIfAny=!1,o([z()],On.prototype,"url",void 0),o([z()],On.prototype,"uOffset",void 0),o([z()],On.prototype,"vOffset",void 0),o([z()],On.prototype,"uScale",void 0),o([z()],On.prototype,"vScale",void 0),o([z()],On.prototype,"uAng",void 0),o([z()],On.prototype,"vAng",void 0),o([z()],On.prototype,"wAng",void 0),o([z()],On.prototype,"uRotationCenter",void 0),o([z()],On.prototype,"vRotationCenter",void 0),o([z()],On.prototype,"wRotationCenter",void 0),o([z()],On.prototype,"isBlocking",null),On);function On(e,t,i,r,n,o,s,a,h,l,u){void 0===i&&(i=!1),void 0===r&&(r=!0),void 0===n&&(n=On.TRILINEAR_SAMPLINGMODE),void 0===o&&(o=null),void 0===s&&(s=null),void 0===a&&(a=null),void 0===h&&(h=!1);var c=Cn.call(this,t&&"Scene"===t.getClassName()?t:null)||this;c.url=null,c.uOffset=0,c.vOffset=0,c.uScale=1,c.vScale=1,c.uAng=0,c.vAng=0,c.wAng=0,c.uRotationCenter=.5,c.vRotationCenter=.5,c.wRotationCenter=.5,c.inspectableCustomProperties=null,c._noMipmap=!1,c._invertY=!1,c._rowGenerationMatrix=null,c._cachedTextureMatrix=null,c._projectionModeMatrix=null,c._t0=null,c._t1=null,c._t2=null,c._cachedUOffset=-1,c._cachedVOffset=-1,c._cachedUScale=0,c._cachedVScale=0,c._cachedUAng=-1,c._cachedVAng=-1,c._cachedWAng=-1,c._cachedProjectionMatrixId=-1,c._cachedCoordinatesMode=-1,c._initialSamplingMode=On.BILINEAR_SAMPLINGMODE,c._buffer=null,c._deleteBuffer=!1,c._format=null,c._delayedOnLoad=null,c._delayedOnError=null,c.onLoadObservable=new le,c._isBlocking=!0,c.name=e||"",c.url=e,c._noMipmap=i,c._invertY=r,c._initialSamplingMode=n,c._buffer=a,c._deleteBuffer=h,c._mimeType=u,l&&(c._format=l);var d=c.getScene(),f=t&&t.getCaps?t:d?d.getEngine():null;if(!f)return c;f.onBeforeTextureInitObservable.notifyObservers(c);function p(){c._texture&&(c._texture._invertVScale&&(c.vScale*=-1,c.vOffset+=1),null!==c._texture._cachedWrapU&&(c.wrapU=c._texture._cachedWrapU,c._texture._cachedWrapU=null),null!==c._texture._cachedWrapV&&(c.wrapV=c._texture._cachedWrapV,c._texture._cachedWrapV=null),null!==c._texture._cachedWrapR&&(c.wrapR=c._texture._cachedWrapR,c._texture._cachedWrapR=null)),c.onLoadObservable.hasObservers()&&c.onLoadObservable.notifyObservers(c),o&&o(),!c.isBlocking&&d&&d.resetCachedMaterial()}return c.url?(c._texture=c._getFromCache(c.url,i,n,r),c._texture?c._texture.isReady?Qt.SetImmediate(p):c._texture.onLoadedObservable.add(p):d&&d.useDelayedTextureLoading?(c.delayLoadState=4,c._delayedOnLoad=p,c._delayedOnError=s):(c._texture=f.createTexture(c.url,i,r,d,n,p,s,c._buffer,void 0,c._format,null,u),h&&delete c._buffer)):(c._delayedOnLoad=p,c._delayedOnError=s),c}Q._TextureParser=Pn.Parse;var Sn=(Object.defineProperty(In,"DiffuseTextureEnabled",{get:function(){return this._DiffuseTextureEnabled},set:function(e){this._DiffuseTextureEnabled!==e&&(this._DiffuseTextureEnabled=e,Mi.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(In,"AmbientTextureEnabled",{get:function(){return this._AmbientTextureEnabled},set:function(e){this._AmbientTextureEnabled!==e&&(this._AmbientTextureEnabled=e,Mi.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(In,"OpacityTextureEnabled",{get:function(){return this._OpacityTextureEnabled},set:function(e){this._OpacityTextureEnabled!==e&&(this._OpacityTextureEnabled=e,Mi.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(In,"ReflectionTextureEnabled",{get:function(){return this._ReflectionTextureEnabled},set:function(e){this._ReflectionTextureEnabled!==e&&(this._ReflectionTextureEnabled=e,Mi.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(In,"EmissiveTextureEnabled",{get:function(){return this._EmissiveTextureEnabled},set:function(e){this._EmissiveTextureEnabled!==e&&(this._EmissiveTextureEnabled=e,Mi.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(In,"SpecularTextureEnabled",{get:function(){return this._SpecularTextureEnabled},set:function(e){this._SpecularTextureEnabled!==e&&(this._SpecularTextureEnabled=e,Mi.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(In,"BumpTextureEnabled",{get:function(){return this._BumpTextureEnabled},set:function(e){this._BumpTextureEnabled!==e&&(this._BumpTextureEnabled=e,Mi.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(In,"LightmapTextureEnabled",{get:function(){return this._LightmapTextureEnabled},set:function(e){this._LightmapTextureEnabled!==e&&(this._LightmapTextureEnabled=e,Mi.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(In,"RefractionTextureEnabled",{get:function(){return this._RefractionTextureEnabled},set:function(e){this._RefractionTextureEnabled!==e&&(this._RefractionTextureEnabled=e,Mi.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(In,"ColorGradingTextureEnabled",{get:function(){return this._ColorGradingTextureEnabled},set:function(e){this._ColorGradingTextureEnabled!==e&&(this._ColorGradingTextureEnabled=e,Mi.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(In,"FresnelEnabled",{get:function(){return this._FresnelEnabled},set:function(e){this._FresnelEnabled!==e&&(this._FresnelEnabled=e,Mi.MarkAllMaterialsAsDirty(4))},enumerable:!0,configurable:!0}),Object.defineProperty(In,"ClearCoatTextureEnabled",{get:function(){return this._ClearCoatTextureEnabled},set:function(e){this._ClearCoatTextureEnabled!==e&&(this._ClearCoatTextureEnabled=e,Mi.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(In,"ClearCoatBumpTextureEnabled",{get:function(){return this._ClearCoatBumpTextureEnabled},set:function(e){this._ClearCoatBumpTextureEnabled!==e&&(this._ClearCoatBumpTextureEnabled=e,Mi.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(In,"ClearCoatTintTextureEnabled",{get:function(){return this._ClearCoatTintTextureEnabled},set:function(e){this._ClearCoatTintTextureEnabled!==e&&(this._ClearCoatTintTextureEnabled=e,Mi.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(In,"SheenTextureEnabled",{get:function(){return this._SheenTextureEnabled},set:function(e){this._SheenTextureEnabled!==e&&(this._SheenTextureEnabled=e,Mi.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(In,"AnisotropicTextureEnabled",{get:function(){return this._AnisotropicTextureEnabled},set:function(e){this._AnisotropicTextureEnabled!==e&&(this._AnisotropicTextureEnabled=e,Mi.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),Object.defineProperty(In,"ThicknessTextureEnabled",{get:function(){return this._ThicknessTextureEnabled},set:function(e){this._ThicknessTextureEnabled!==e&&(this._ThicknessTextureEnabled=e,Mi.MarkAllMaterialsAsDirty(1))},enumerable:!0,configurable:!0}),In._DiffuseTextureEnabled=!0,In._AmbientTextureEnabled=!0,In._OpacityTextureEnabled=!0,In._ReflectionTextureEnabled=!0,In._EmissiveTextureEnabled=!0,In._SpecularTextureEnabled=!0,In._BumpTextureEnabled=!0,In._LightmapTextureEnabled=!0,In._RefractionTextureEnabled=!0,In._ColorGradingTextureEnabled=!0,In._FresnelEnabled=!0,In._ClearCoatTextureEnabled=!0,In._ClearCoatBumpTextureEnabled=!0,In._ClearCoatTintTextureEnabled=!0,In._SheenTextureEnabled=!0,In._AnisotropicTextureEnabled=!0,In._ThicknessTextureEnabled=!0,In);function In(){}var Rn="defaultFragmentDeclaration",Dn="uniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\nuniform float visibility;\n\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifndef REFRACTIONMAP_3D\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;\nuniform vec4 refractionRightColor;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\n#endif\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION) || defined(REFLECTIONMAP_EQUIRECTANGULAR) || defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_SKYBOX)\nuniform mat4 reflectionMatrix;\n#endif\n#ifndef REFLECTIONMAP_SKYBOX\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize;\n#endif\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#endif",wn=(st.IncludesShadersStore[Rn]=Dn,"defaultUboDeclaration"),Ln="layout(std140,column_major) uniform;\nuniform Material\n{\nvec4 diffuseLeftColor;\nvec4 diffuseRightColor;\nvec4 opacityParts;\nvec4 reflectionLeftColor;\nvec4 reflectionRightColor;\nvec4 refractionLeftColor;\nvec4 refractionRightColor;\nvec4 emissiveLeftColor;\nvec4 emissiveRightColor;\nvec2 vDiffuseInfos;\nvec2 vAmbientInfos;\nvec2 vOpacityInfos;\nvec2 vReflectionInfos;\nvec3 vReflectionPosition;\nvec3 vReflectionSize;\nvec2 vEmissiveInfos;\nvec2 vLightmapInfos;\nvec2 vSpecularInfos;\nvec3 vBumpInfos;\nmat4 diffuseMatrix;\nmat4 ambientMatrix;\nmat4 opacityMatrix;\nmat4 reflectionMatrix;\nmat4 emissiveMatrix;\nmat4 lightmapMatrix;\nmat4 specularMatrix;\nmat4 bumpMatrix;\nvec2 vTangentSpaceParams;\nfloat pointSize;\nmat4 refractionMatrix;\nvec4 vRefractionInfos;\nvec4 vSpecularColor;\nvec3 vEmissiveColor;\nfloat visibility;\nvec4 vDiffuseColor;\n};\nuniform Scene {\nmat4 viewProjection;\n#ifdef MULTIVIEW\nmat4 viewProjectionR;\n#endif\nmat4 view;\n};\n",Fn=(st.IncludesShadersStore[wn]=Ln,"helperFunctions"),Nn="const float PI=3.1415926535897932384626433832795;\nconst float LinearEncodePowerApprox=2.2;\nconst float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;\nconst vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);\nconst float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {\nvec3 i0=inMatrix[0];\nvec3 i1=inMatrix[1];\nvec3 i2=inMatrix[2];\nmat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);\nreturn outMatrix;\n}\n\nmat3 inverseMat3(mat3 inMatrix) {\nfloat a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];\nfloat a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];\nfloat a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];\nfloat b01=a22*a11-a12*a21;\nfloat b11=-a22*a10+a12*a20;\nfloat b21=a21*a10-a11*a20;\nfloat det=a00*b01+a01*b11+a02*b21;\nreturn mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;\n}\nvec3 toLinearSpace(vec3 color)\n{\nreturn pow(color,vec3(LinearEncodePowerApprox));\n}\nvec3 toGammaSpace(vec3 color)\n{\nreturn pow(color,vec3(GammaEncodePowerApprox));\n}\nfloat toGammaSpace(float color)\n{\nreturn pow(color,GammaEncodePowerApprox);\n}\nfloat square(float value)\n{\nreturn value*value;\n}\nfloat pow5(float value) {\nfloat sq=value*value;\nreturn sq*sq*value;\n}\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,LuminanceEncodeApprox),0.,1.);\n}\n\nfloat getRand(vec2 seed) {\nreturn fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);\n}\nfloat dither(vec2 seed,float varianceAmount) {\nfloat rand=getRand(seed);\nfloat dither=mix(-varianceAmount/255.0,varianceAmount/255.0,rand);\nreturn dither;\n}\n\nconst float rgbdMaxRange=255.0;\nvec4 toRGBD(vec3 color) {\nfloat maxRGB=maxEps(max(color.r,max(color.g,color.b)));\nfloat D=max(rgbdMaxRange/maxRGB,1.);\nD=clamp(floor(D)/255.0,0.,1.);\n\nvec3 rgb=color.rgb*D;\n\nrgb=toGammaSpace(rgb);\nreturn vec4(rgb,D);\n}\nvec3 fromRGBD(vec4 rgbd) {\n\nrgbd.rgb=toLinearSpace(rgbd.rgb);\n\nreturn rgbd.rgb/rgbd.a;\n}\n",Bn=(st.IncludesShadersStore[Fn]=Nn,"lightFragmentDeclaration"),kn="#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec4 vLightSpecular{X};\n#else\nvec4 vLightSpecular{X}=vec4(0.);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float cascadeBlendFactor{X};\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\nuniform highp sampler2DArray depthSampler{X};\nuniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float penumbraDarkness{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\n#else\nuniform highp sampler2DArray shadowSampler{X};\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nconst vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]\n(\nvec3 ( 1.5,0.0,0.0 ),\nvec3 ( 0.0,1.5,0.0 ),\nvec3 ( 0.0,0.0,5.5 ),\nvec3 ( 1.5,0.0,5.5 ),\nvec3 ( 1.5,1.5,0.0 ),\nvec3 ( 1.0,1.0,1.0 ),\nvec3 ( 0.0,1.0,5.5 ),\nvec3 ( 0.5,3.5,0.75 )\n);\nvec3 shadowDebug{X};\n#endif\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nint index{X}=-1;\n#else\nint index{X}=SHADOWCSMNUM_CASCADES{X}-1;\n#endif\nfloat diff{X}=0.;\n#elif defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};\nuniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\nuniform vec4 vLightFalloff{X};\n#elif defined(POINTLIGHT{X})\nuniform vec4 vLightFalloff{X};\n#elif defined(HEMILIGHT{X})\nuniform vec3 vLightGround{X};\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#endif",Un=(st.IncludesShadersStore[Bn]=kn,"lightUboDeclaration"),Vn="#ifdef LIGHT{X}\nuniform Light{X}\n{\nvec4 vLightData;\nvec4 vLightDiffuse;\nvec4 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;\nvec4 vLightFalloff;\n#elif defined(POINTLIGHT{X})\nvec4 vLightFalloff;\n#elif defined(HEMILIGHT{X})\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;\nvec2 depthValues;\n} light{X};\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float cascadeBlendFactor{X};\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\nuniform highp sampler2DArray depthSampler{X};\nuniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float penumbraDarkness{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\n#else\nuniform highp sampler2DArray shadowSampler{X};\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nconst vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]\n(\nvec3 ( 1.5,0.0,0.0 ),\nvec3 ( 0.0,1.5,0.0 ),\nvec3 ( 0.0,0.0,5.5 ),\nvec3 ( 1.5,0.0,5.5 ),\nvec3 ( 1.5,1.5,0.0 ),\nvec3 ( 1.0,1.0,1.0 ),\nvec3 ( 0.0,1.0,5.5 ),\nvec3 ( 0.5,3.5,0.75 )\n);\nvec3 shadowDebug{X};\n#endif\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nint index{X}=-1;\n#else\nint index{X}=SHADOWCSMNUM_CASCADES{X}-1;\n#endif\nfloat diff{X}=0.;\n#elif defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif",zn=(st.IncludesShadersStore[Un]=Vn,"lightsFragmentFunctions"),Wn="\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef NDOTL\nfloat ndl;\n#endif\n};\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 lightVectorW;\nfloat attenuation=1.0;\nif (lightData.w == 0.)\n{\nvec3 direction=lightData.xyz-vPositionW;\nattenuation=max(0.,1.0-length(direction)/range);\nlightVectorW=normalize(direction);\n}\nelse\n{\nlightVectorW=normalize(-lightData.xyz);\n}\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 direction=lightData.xyz-vPositionW;\nvec3 lightVectorW=normalize(direction);\nfloat attenuation=max(0.,1.0-length(direction)/range);\n\nfloat cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));\nif (cosAngle>=lightDirection.w)\n{\ncosAngle=max(0.,pow(cosAngle,lightData.w));\nattenuation*=cosAngle;\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\n#ifdef NDOTL\nresult.ndl=0.;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {\nlightingInfo result;\n\nfloat ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor;\n#endif\nreturn result;\n}\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\nvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\nstrq/=strq.w;\nvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\nreturn textureColor;\n}",Gn=(st.IncludesShadersStore[zn]=Wn,"shadowsFragmentFunctions"),Xn="#ifdef SHADOWS\n#ifndef SHADOWFLOAT\n\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nfloat computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)\n{\nfloat mask=smoothstep(1.0-frustumEdgeFalloff,1.00000012,clamp(dot(clipSpace,clipSpace),0.,1.));\nreturn mix(value,1.0,mask);\n}\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadow=textureCube(shadowSampler,directionToLight).x;\n#endif\nif (depth>shadow)\n{\nreturn darkness;\n}\nreturn 1.0;\n}\nfloat computeShadowWithPoissonSamplingCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n\n#ifndef SHADOWFLOAT\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;\n#else\nif (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;\n#endif\nreturn min(1.0,visibility+darkness);\n}\nfloat computeShadowWithESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);\nreturn esm;\n}\nfloat computeShadowWithCloseESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn esm;\n}\n#ifdef WEBGL2\nfloat computeShadowCSM(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nvec3 uvLayer=vec3(uv.x,uv.y,layer);\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uvLayer));\n#else\nfloat shadow=texture2D(shadowSampler,uvLayer).x;\n#endif\nif (shadowPixelDepth>shadow)\n{\nreturn computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff);\n}\nreturn 1.;\n}\n#endif\nfloat computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadow=texture2D(shadowSampler,uv).x;\n#endif\nif (shadowPixelDepth>shadow)\n{\nreturn computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff);\n}\nreturn 1.;\n}\nfloat computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\n#ifndef SHADOWFLOAT\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<shadowPixelDepth) visibility-=0.25;\n#else\nif (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<shadowPixelDepth) visibility-=0.25;\n#endif\nreturn computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\n#ifdef WEBGL2\n#define GREATEST_LESS_THAN_ONE 0.99999994\n\nfloat computeShadowWithCSMPCF1(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);\nvec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);\nfloat shadow=texture(shadowSampler,uvDepthLayer);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithCSMPCF3(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;\nuv+=0.5;\nvec2 st=fract(uv);\nvec2 base_uv=floor(uv)-0.5;\nbase_uv*=shadowMapSizeAndInverse.y;\n\n\n\n\nvec2 uvw0=3.-2.*st;\nvec2 uvw1=1.+2.*st;\nvec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;\nvec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));\nshadow=shadow/16.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithCSMPCF5(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;\nuv+=0.5;\nvec2 st=fract(uv);\nvec2 base_uv=floor(uv)-0.5;\nbase_uv*=shadowMapSizeAndInverse.y;\n\n\nvec2 uvw0=4.-3.*st;\nvec2 uvw1=vec2(7.);\nvec2 uvw2=1.+3.*st;\nvec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;\nvec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[0]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[1]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[2]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[2]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[2]),layer,uvDepth.z));\nshadow=shadow/144.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\nfloat computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nfloat shadow=texture2D(shadowSampler,uvDepth);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;\nuv+=0.5;\nvec2 st=fract(uv);\nvec2 base_uv=floor(uv)-0.5;\nbase_uv*=shadowMapSizeAndInverse.y;\n\n\n\n\nvec2 uvw0=3.-2.*st;\nvec2 uvw1=1.+2.*st;\nvec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;\nvec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow=shadow/16.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;\nuv+=0.5;\nvec2 st=fract(uv);\nvec2 base_uv=floor(uv)-0.5;\nbase_uv*=shadowMapSizeAndInverse.y;\n\n\nvec2 uvw0=4.-3.*st;\nvec2 uvw1=vec2(7.);\nvec2 uvw2=1.+3.*st;\nvec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;\nvec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z));\nshadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z));\nshadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z));\nshadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z));\nshadow=shadow/144.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\nconst vec3 PoissonSamplers32[64]=vec3[64](\nvec3(0.06407013,0.05409927,0.),\nvec3(0.7366577,0.5789394,0.),\nvec3(-0.6270542,-0.5320278,0.),\nvec3(-0.4096107,0.8411095,0.),\nvec3(0.6849564,-0.4990818,0.),\nvec3(-0.874181,-0.04579735,0.),\nvec3(0.9989998,0.0009880066,0.),\nvec3(-0.004920578,-0.9151649,0.),\nvec3(0.1805763,0.9747483,0.),\nvec3(-0.2138451,0.2635818,0.),\nvec3(0.109845,0.3884785,0.),\nvec3(0.06876755,-0.3581074,0.),\nvec3(0.374073,-0.7661266,0.),\nvec3(0.3079132,-0.1216763,0.),\nvec3(-0.3794335,-0.8271583,0.),\nvec3(-0.203878,-0.07715034,0.),\nvec3(0.5912697,0.1469799,0.),\nvec3(-0.88069,0.3031784,0.),\nvec3(0.5040108,0.8283722,0.),\nvec3(-0.5844124,0.5494877,0.),\nvec3(0.6017799,-0.1726654,0.),\nvec3(-0.5554981,0.1559997,0.),\nvec3(-0.3016369,-0.3900928,0.),\nvec3(-0.5550632,-0.1723762,0.),\nvec3(0.925029,0.2995041,0.),\nvec3(-0.2473137,0.5538505,0.),\nvec3(0.9183037,-0.2862392,0.),\nvec3(0.2469421,0.6718712,0.),\nvec3(0.3916397,-0.4328209,0.),\nvec3(-0.03576927,-0.6220032,0.),\nvec3(-0.04661255,0.7995201,0.),\nvec3(0.4402924,0.3640312,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.)\n);\nconst vec3 PoissonSamplers64[64]=vec3[64](\nvec3(-0.613392,0.617481,0.),\nvec3(0.170019,-0.040254,0.),\nvec3(-0.299417,0.791925,0.),\nvec3(0.645680,0.493210,0.),\nvec3(-0.651784,0.717887,0.),\nvec3(0.421003,0.027070,0.),\nvec3(-0.817194,-0.271096,0.),\nvec3(-0.705374,-0.668203,0.),\nvec3(0.977050,-0.108615,0.),\nvec3(0.063326,0.142369,0.),\nvec3(0.203528,0.214331,0.),\nvec3(-0.667531,0.326090,0.),\nvec3(-0.098422,-0.295755,0.),\nvec3(-0.885922,0.215369,0.),\nvec3(0.566637,0.605213,0.),\nvec3(0.039766,-0.396100,0.),\nvec3(0.751946,0.453352,0.),\nvec3(0.078707,-0.715323,0.),\nvec3(-0.075838,-0.529344,0.),\nvec3(0.724479,-0.580798,0.),\nvec3(0.222999,-0.215125,0.),\nvec3(-0.467574,-0.405438,0.),\nvec3(-0.248268,-0.814753,0.),\nvec3(0.354411,-0.887570,0.),\nvec3(0.175817,0.382366,0.),\nvec3(0.487472,-0.063082,0.),\nvec3(-0.084078,0.898312,0.),\nvec3(0.488876,-0.783441,0.),\nvec3(0.470016,0.217933,0.),\nvec3(-0.696890,-0.549791,0.),\nvec3(-0.149693,0.605762,0.),\nvec3(0.034211,0.979980,0.),\nvec3(0.503098,-0.308878,0.),\nvec3(-0.016205,-0.872921,0.),\nvec3(0.385784,-0.393902,0.),\nvec3(-0.146886,-0.859249,0.),\nvec3(0.643361,0.164098,0.),\nvec3(0.634388,-0.049471,0.),\nvec3(-0.688894,0.007843,0.),\nvec3(0.464034,-0.188818,0.),\nvec3(-0.440840,0.137486,0.),\nvec3(0.364483,0.511704,0.),\nvec3(0.034028,0.325968,0.),\nvec3(0.099094,-0.308023,0.),\nvec3(0.693960,-0.366253,0.),\nvec3(0.678884,-0.204688,0.),\nvec3(0.001801,0.780328,0.),\nvec3(0.145177,-0.898984,0.),\nvec3(0.062655,-0.611866,0.),\nvec3(0.315226,-0.604297,0.),\nvec3(-0.780145,0.486251,0.),\nvec3(-0.371868,0.882138,0.),\nvec3(0.200476,0.494430,0.),\nvec3(-0.494552,-0.711051,0.),\nvec3(0.612476,0.705252,0.),\nvec3(-0.578845,-0.768792,0.),\nvec3(-0.772454,-0.090976,0.),\nvec3(0.504440,0.372295,0.),\nvec3(0.155736,0.065157,0.),\nvec3(0.391522,0.849605,0.),\nvec3(-0.620106,-0.328104,0.),\nvec3(0.789239,-0.419965,0.),\nvec3(-0.545396,0.538133,0.),\nvec3(-0.178564,-0.596057,0.)\n);\n\n\n\n\n\nfloat computeShadowWithCSMPCSS(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);\nvec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);\nfloat blockerDepth=0.0;\nfloat sumBlockerDepth=0.0;\nfloat numBlocker=0.0;\nfor (int i=0; i<searchTapCount; i ++) {\nblockerDepth=texture(depthSampler,vec3(uvDepth.xy+(lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse*PoissonSamplers32[i].xy),layer)).r;\nif (blockerDepth<depthMetric) {\nsumBlockerDepth+=blockerDepth;\nnumBlocker++;\n}\n}\nif (numBlocker<1.0) {\nreturn 1.0;\n}\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;\n\nfloat AAOffset=shadowMapSizeInverse*10.;\n\n\nfloat penumbraRatio=((depthMetric-avgBlockerDepth)*depthCorrection+AAOffset);\nvec4 filterRadius=vec4(penumbraRatio*lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse,0.,0.);\nfloat random=getRand(vPositionFromLight.xy);\nfloat rotationAngle=random*3.1415926;\nvec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));\nfloat shadow=0.;\nfor (int i=0; i<pcfTapCount; i++) {\nvec4 offset=vec4(poissonSamplers[i],0.);\n\noffset=vec4(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.,0.);\nshadow+=texture2D(shadowSampler,uvDepthLayer+offset*filterRadius);\n}\nshadow/=float(pcfTapCount);\n\nshadow=mix(shadow,1.,min((depthMetric-avgBlockerDepth)*depthCorrection*penumbraDarkness,1.));\n\nshadow=mix(darkness,1.,shadow);\n\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\n\n\nfloat computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nfloat blockerDepth=0.0;\nfloat sumBlockerDepth=0.0;\nfloat numBlocker=0.0;\nfor (int i=0; i<searchTapCount; i ++) {\nblockerDepth=texture(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy)).r;\nif (blockerDepth<depthMetric) {\nsumBlockerDepth+=blockerDepth;\nnumBlocker++;\n}\n}\nif (numBlocker<1.0) {\nreturn 1.0;\n}\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;\n\nfloat AAOffset=shadowMapSizeInverse*10.;\n\n\nfloat penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);\nfloat filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;\nfloat random=getRand(vPositionFromLight.xy);\nfloat rotationAngle=random*3.1415926;\nvec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));\nfloat shadow=0.;\nfor (int i=0; i<pcfTapCount; i++) {\nvec3 offset=poissonSamplers[i];\n\noffset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);\nshadow+=texture2D(shadowSampler,uvDepth+offset*filterRadius);\n}\nshadow/=float(pcfTapCount);\n\nshadow=mix(shadow,1.,depthMetric-avgBlockerDepth);\n\nshadow=mix(darkness,1.,shadow);\n\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);\n}\nfloat computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);\n}\nfloat computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);\n}\nfloat computeShadowWithCSMPCSS16(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\nfloat computeShadowWithCSMPCSS32(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\nfloat computeShadowWithCSMPCSS64(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\n#endif\n#endif\n",Hn=(st.IncludesShadersStore[Gn]=Xn,"fresnelFunction"),jn="#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{\nfloat fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);\nreturn clamp(fresnelTerm,0.,1.);\n}\n#endif",Kn=(st.IncludesShadersStore[Hn]=jn,"reflectionFunction"),Yn="vec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {\n\nvec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;\nvec3 halfSize=cubeSize*0.5;\nvec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;\nvec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;\n\nvec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);\n\nfloat distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);\n\nvec3 intersectPositionWS=vertexPos+origVec*distance;\n\nreturn intersectPositionWS-cubePos;\n}\nvec3 computeFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)\n{\nfloat lon=atan(direction.z,direction.x);\nfloat lat=acos(direction.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(s,t,0);\n}\nvec3 computeMirroredFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)\n{\nfloat lon=atan(direction.z,direction.x);\nfloat lat=acos(direction.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(1.0-s,t,0);\n}\nvec3 computeEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 cameraToVertex=normalize(worldPos.xyz-eyePosition);\nvec3 r=normalize(reflect(cameraToVertex,worldNormal));\nr=vec3(reflectionMatrix*vec4(r,0));\nfloat lon=atan(r.z,r.x);\nfloat lat=acos(r.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(s,t,0);\n}\nvec3 computeSphericalCoords(vec4 worldPos,vec3 worldNormal,mat4 view,mat4 reflectionMatrix)\n{\nvec3 viewDir=normalize(vec3(view*worldPos));\nvec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));\nvec3 r=reflect(viewDir,viewNormal);\nr=vec3(reflectionMatrix*vec4(r,0));\nr.z=r.z-1.0;\nfloat m=2.0*length(r);\nreturn vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);\n}\nvec3 computePlanarCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 viewDir=worldPos.xyz-eyePosition;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n}\nvec3 computeCubicCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 viewDir=normalize(worldPos.xyz-eyePosition);\n\nvec3 coords=reflect(viewDir,worldNormal);\ncoords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;\n}\nvec3 computeCubicLocalCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix,vec3 reflectionSize,vec3 reflectionPosition)\n{\nvec3 viewDir=normalize(worldPos.xyz-eyePosition);\n\nvec3 coords=reflect(viewDir,worldNormal);\ncoords=parallaxCorrectNormal(worldPos.xyz,coords,reflectionSize,reflectionPosition);\ncoords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;\n}\nvec3 computeProjectionCoords(vec4 worldPos,mat4 view,mat4 reflectionMatrix)\n{\nreturn vec3(reflectionMatrix*(view*worldPos));\n}\nvec3 computeSkyBoxCoords(vec3 positionW,mat4 reflectionMatrix)\n{\nreturn vec3(reflectionMatrix*vec4(positionW,0));\n}\n#ifdef REFLECTION\nvec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);\nreturn computeMirroredFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);\nreturn computeFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nreturn computeEquirectangularCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nreturn computeSphericalCoords(worldPos,worldNormal,view,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nreturn computePlanarCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_CUBIC\n#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\nreturn computeCubicLocalCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix,vReflectionSize,vReflectionPosition);\n#else\nreturn computeCubicCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn computeProjectionCoords(worldPos,view,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn computeSkyBoxCoords(vPositionUVW,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}\n#endif",qn=(st.IncludesShadersStore[Kn]=Yn,"imageProcessingDeclaration"),Zn="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#ifdef VIGNETTE\nuniform vec2 vInverseScreenSize;\nuniform vec4 vignetteSettings1;\nuniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;\nuniform vec4 vCameraColorCurveNeutral;\nuniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif",Qn=(st.IncludesShadersStore[qn]=Zn,"imageProcessingFunctions"),Jn="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{\nfloat sliceSize=2.0*sampler3dSetting.x;\n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);\n\n\nfloat sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;\nsliceUV.x+=sliceInteger*sliceSize;\nsliceUV=saturate(sliceUV);\nvec4 slice0Color=texture2D(colorTransform,sliceUV);\nsliceUV.x+=sliceSize;\nsliceUV=saturate(sliceUV);\nvec4 slice1Color=texture2D(colorTransform,sliceUV);\nvec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;\n}\n#endif\n#ifdef TONEMAPPING_ACES\n\n\n\n\n\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);\n\nconst mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108,1.10813,-0.07276),\nvec3(-0.07367,-0.00605,1.07602)\n);\nvec3 RRTAndODTFit(vec3 v)\n{\nvec3 a=v*(v+0.0245786)-0.000090537;\nvec3 b=v*(0.983729*v+0.4329510)+0.238081;\nreturn a/b;\n}\nvec3 ACESFitted(vec3 color)\n{\ncolor=ACESInputMat*color;\n\ncolor=RRTAndODTFit(color);\ncolor=ACESOutputMat*color;\n\ncolor=saturate(color);\nreturn color;\n}\n#endif\nvec4 applyImageProcessing(vec4 result) {\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\n\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;\nviewportXY=viewportXY*2.0-1.0;\nvec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);\nfloat vignetteTerm=dot(vignetteXY1,vignetteXY1);\nfloat vignette=pow(vignetteTerm,vignetteSettings2.w);\n\nvec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);\nresult.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#ifdef TONEMAPPING\n#ifdef TONEMAPPING_ACES\nresult.rgb=ACESFitted(result.rgb);\n#else\nconst float tonemappingCalibration=1.590579;\nresult.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\n#endif\n\nresult.rgb=toGammaSpace(result.rgb);\nresult.rgb=saturate(result.rgb);\n#ifdef CONTRAST\n\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);\nif (contrast<1.0) {\n\nresult.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);\n} else {\n\nresult.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);\n}\n#endif\n\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\n\nfloat luma=getLuminance(result.rgb);\nvec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));\nvec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;\nresult.rgb*=colorCurve.rgb;\nresult.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\nreturn result;\n}",$n=(st.IncludesShadersStore[Qn]=Jn,"bumpFragmentFunctions"),eo="#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nvarying mat3 vTBN;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nuniform mat4 normalMatrix;\n#endif\nvec3 perturbNormal(mat3 cotangentFrame,vec3 textureSample,float scale)\n{\ntextureSample=textureSample*2.0-1.0;\n#ifdef NORMALXYSCALE\ntextureSample=normalize(textureSample*vec3(scale,scale,1.0));\n#endif\nreturn normalize(cotangentFrame*textureSample);\n}\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv,vec2 tangentSpaceParams)\n{\n\nuv=gl_FrontFacing ? uv : -uv;\n\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\n\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;\n\ntangent*=tangentSpaceParams.x;\nbitangent*=tangentSpaceParams.y;\n\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(bitangent,bitangent)));\nreturn mat3(tangent*invmax,bitangent*invmax,normal);\n}\n#endif\n#if defined(BUMP)\n#if BUMPDIRECTUV == 1\n#define vBumpUV vMainUV1\n#elif BUMPDIRECTUV == 2\n#define vBumpUV vMainUV2\n#else\nvarying vec2 vBumpUV;\n#endif\nuniform sampler2D bumpSampler;\nvec3 perturbNormal(mat3 cotangentFrame,vec2 uv)\n{\nreturn perturbNormal(cotangentFrame,texture2D(bumpSampler,uv).xyz,vBumpInfos.y);\n}\n#endif\n#if defined(BUMP) || defined(CLEARCOAT_BUMP)\nvec3 perturbNormal(mat3 cotangentFrame,vec3 color)\n{\nreturn perturbNormal(cotangentFrame,color,vBumpInfos.y);\n}\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)\n{\nreturn cotangent_frame(normal,p,uv,vTangentSpaceParams);\n}\n#endif\n#if defined(BUMP) && defined(PARALLAX)\nconst float minSamples=4.;\nconst float maxSamples=15.;\nconst int iMaxSamples=15;\n\nvec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {\nfloat parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;\nparallaxLimit*=parallaxScale;\nvec2 vOffsetDir=normalize(vViewDirCoT.xy);\nvec2 vMaxOffset=vOffsetDir*parallaxLimit;\nfloat numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));\nfloat stepSize=1.0/numSamples;\n\nfloat currRayHeight=1.0;\nvec2 vCurrOffset=vec2(0,0);\nvec2 vLastOffset=vec2(0,0);\nfloat lastSampledHeight=1.0;\nfloat currSampledHeight=1.0;\nfor (int i=0; i<iMaxSamples; i++)\n{\ncurrSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;\n\nif (currSampledHeight>currRayHeight)\n{\nfloat delta1=currSampledHeight-currRayHeight;\nfloat delta2=(currRayHeight+stepSize)-lastSampledHeight;\nfloat ratio=delta1/(delta1+delta2);\nvCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;\n\nbreak;\n}\nelse\n{\ncurrRayHeight-=stepSize;\nvLastOffset=vCurrOffset;\nvCurrOffset+=stepSize*vMaxOffset;\nlastSampledHeight=currSampledHeight;\n}\n}\nreturn vCurrOffset;\n}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{\n\nfloat height=texture2D(bumpSampler,vBumpUV).w;\nvec2 texCoordOffset=heightScale*viewDir.xy*height;\nreturn -texCoordOffset;\n}\n#endif",to=(st.IncludesShadersStore[$n]=eo,"clipPlaneFragmentDeclaration"),io="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif",ro=(st.IncludesShadersStore[to]=io,"logDepthDeclaration"),no="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;\nvarying float vFragmentDepth;\n#endif",oo=(st.IncludesShadersStore[ro]=no,"fogFragmentDeclaration"),so="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying vec3 vFogDistance;\nfloat CalcFogFactor()\n{\nfloat fogCoeff=1.0;\nfloat fogStart=vFogInfos.y;\nfloat fogEnd=vFogInfos.z;\nfloat fogDensity=vFogInfos.w;\nfloat fogDistance=length(vFogDistance);\nif (FOGMODE_LINEAR == vFogInfos.x)\n{\nfogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);\n}\nelse if (FOGMODE_EXP == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDensity);\n}\nelse if (FOGMODE_EXP2 == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);\n}\nreturn clamp(fogCoeff,0.0,1.0);\n}\n#endif",ao=(st.IncludesShadersStore[oo]=so,"clipPlaneFragment"),ho="#ifdef CLIPPLANE\nif (fClipDistance>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE2\nif (fClipDistance2>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE3\nif (fClipDistance3>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE4\nif (fClipDistance4>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE5\nif (fClipDistance5>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE6\nif (fClipDistance6>0.0)\n{\ndiscard;\n}\n#endif",lo=(st.IncludesShadersStore[ao]=ho,"bumpFragment"),uo="vec2 uvOffset=vec2(0.0,0.0);\n#if defined(BUMP) || defined(PARALLAX)\n#ifdef NORMALXYSCALE\nfloat normalScale=1.0;\n#else\nfloat normalScale=vBumpInfos.y;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nmat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,vBumpUV);\n#endif\n#elif defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nmat3 TBN=cotangent_frame(normalW,vPositionW,vMainUV1,vec2(1.,1.));\n#endif\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nuvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);\n#else\nuvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\n#endif\n#ifdef BUMP\n#ifdef OBJECTSPACE_NORMALMAP\nnormalW=normalize(texture2D(bumpSampler,vBumpUV).xyz*2.0-1.0);\nnormalW=normalize(mat3(normalMatrix)*normalW);\n#else\nnormalW=perturbNormal(TBN,vBumpUV+uvOffset);\n#endif\n#endif",co=(st.IncludesShadersStore[lo]=uo,"depthPrePass"),fo="#ifdef DEPTHPREPASS\ngl_FragColor=vec4(0.,0.,0.,1.0);\nreturn;\n#endif",po=(st.IncludesShadersStore[co]=fo,"lightFragment"),_o="#ifdef LIGHT{X}\n#if defined(SHADOWONLY) || defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X})\n\n#else\n#ifdef PBR\n\n#ifdef SPOTLIGHT{X}\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(POINTLIGHT{X})\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(HEMILIGHT{X})\npreInfo=computeHemisphericPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(DIRLIGHT{X})\npreInfo=computeDirectionalPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#endif\npreInfo.NdotV=NdotV;\n\n#ifdef SPOTLIGHT{X}\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\npreInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\npreInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\npreInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\npreInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#endif\n#elif defined(POINTLIGHT{X})\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\n#endif\n#else\npreInfo.attenuation=1.0;\n#endif\n\n\n#ifdef HEMILIGHT{X}\npreInfo.roughness=roughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(roughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\n\n#ifdef HEMILIGHT{X}\ninfo.diffuse=computeHemisphericDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb,light{X}.vLightGround);\n#elif defined(SS_TRANSLUCENCY)\ninfo.diffuse=computeDiffuseAndTransmittedLighting(preInfo,light{X}.vLightDiffuse.rgb,transmittance);\n#else\ninfo.diffuse=computeDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb);\n#endif\n\n#ifdef SPECULARTERM\n#ifdef ANISOTROPIC\ninfo.specular=computeAnisotropicSpecularLighting(preInfo,viewDirectionW,normalW,anisotropicTangent,anisotropicBitangent,anisotropy,specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#else\ninfo.specular=computeSpecularLighting(preInfo,normalW,specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n#endif\n\n#ifdef SHEEN\n#ifdef SHEEN_LINKWITHALBEDO\n\npreInfo.roughness=sheenIntensity;\n#endif\ninfo.sheen=computeSheenLighting(preInfo,normalW,sheenColor,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n\n#ifdef CLEARCOAT\n\n#ifdef HEMILIGHT{X}\npreInfo.roughness=clearCoatRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(clearCoatRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\ninfo.clearCoat=computeClearCoatLighting(preInfo,clearCoatNormalW,clearCoatAARoughnessFactors.x,clearCoatIntensity,light{X}.vLightDiffuse.rgb);\n#ifdef CLEARCOAT_TINT\n\nabsorption=computeClearCoatLightingAbsorption(clearCoatNdotVRefract,preInfo.L,clearCoatNormalW,clearCoatColor,clearCoatThickness,clearCoatIntensity);\ninfo.diffuse*=absorption;\n#ifdef SPECULARTERM\ninfo.specular*=absorption;\n#endif\n#endif\n\ninfo.diffuse*=info.clearCoat.w;\n#ifdef SPECULARTERM\ninfo.specular*=info.clearCoat.w;\n#endif\n#ifdef SHEEN\ninfo.sheen*=info.clearCoat.w;\n#endif\n#endif\n#else\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);\n#elif defined(HEMILIGHT{X})\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightGround,glossiness);\n#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);\n#endif\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\ninfo.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightSampler{X},textureProjectionMatrix{X});\n#endif\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nfor (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++)\n{\n#ifdef SHADOWCSM_RIGHTHANDED{X}\ndiff{X}=viewFrustumZ{X}[i]+vPositionFromCamera{X}.z;\n#else\ndiff{X}=viewFrustumZ{X}[i]-vPositionFromCamera{X}.z;\n#endif\nif (diff{X}>=0.) {\nindex{X}=i;\nbreak;\n}\n}\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nif (index{X}>=0)\n#endif\n{\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#else\nshadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#endif\n#else\nshadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=vec3(shadow)*vCascadeColorsMultiplier{X}[index{X}];\n#endif\n#ifndef SHADOWCSMNOBLEND{X}\nfloat frustumLength=frustumLengths{X}[index{X}];\nfloat diffRatio=clamp(diff{X}/frustumLength,0.,1.)*cascadeBlendFactor{X};\nif (index{X}<(SHADOWCSMNUM_CASCADES{X}-1) && diffRatio<1.)\n{\nindex{X}+=1;\nfloat nextShadow=0.;\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nnextShadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#else\nnextShadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#endif\n#else\nnextShadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\nshadow=mix(nextShadow,shadow,diffRatio);\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=mix(vec3(nextShadow)*vCascadeColorsMultiplier{X}[index{X}],shadowDebug{X},diffRatio);\n#endif\n}\n#endif\n}\n#elif defined(SHADOWCLOSEESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithCloseESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPOISSON{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithPoissonSamplingCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#else\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#endif\n#ifdef SHADOWONLY\n#ifndef SHADOWINUSE\n#define SHADOWINUSE\n#endif\nglobalShadow+=shadow;\nshadowLightCount+=1.0;\n#endif\n#else\nshadow=1.;\n#endif\n#ifndef SHADOWONLY\n#ifdef CUSTOMUSERLIGHTING\ndiffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);\n#ifdef SPECULARTERM\nspecularBase+=computeCustomSpecularLighting(info,specularBase,shadow);\n#endif\n#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})\ndiffuseBase+=lightmapColor.rgb*shadow;\n#ifdef SPECULARTERM\n#ifndef LIGHTMAPNOSPECULAR{X}\nspecularBase+=info.specular*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef CLEARCOAT\n#ifndef LIGHTMAPNOSPECULAR{X}\nclearCoatBase+=info.clearCoat.rgb*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef SHEEN\n#ifndef LIGHTMAPNOSPECULAR{X}\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#else\n#ifdef SHADOWCSMDEBUG{X}\ndiffuseBase+=info.diffuse*shadowDebug{X};\n#else\ndiffuseBase+=info.diffuse*shadow;\n#endif\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#ifdef CLEARCOAT\nclearCoatBase+=info.clearCoat.rgb*shadow;\n#endif\n#ifdef SHEEN\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#endif\n#endif",go=(st.IncludesShadersStore[po]=_o,"logDepthFragment"),mo="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif",vo=(st.IncludesShadersStore[go]=mo,"fogFragment"),yo="#ifdef FOG\nfloat fog=CalcFogFactor();\ncolor.rgb=fog*color.rgb+(1.0-fog)*vFogColor;\n#endif",bo=(st.IncludesShadersStore[vo]=yo,"defaultPixelShader"),To="#include<__decl__defaultFragment>\n#if defined(BUMP) || !defined(NORMAL)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n\n#define RECIPROCAL_PI2 0.15915494\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\n#if DIFFUSEDIRECTUV == 1\n#define vDiffuseUV vMainUV1\n#elif DIFFUSEDIRECTUV == 2\n#define vDiffuseUV vMainUV2\n#else\nvarying vec2 vDiffuseUV;\n#endif\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef AMBIENT\n#if AMBIENTDIRECTUV == 1\n#define vAmbientUV vMainUV1\n#elif AMBIENTDIRECTUV == 2\n#define vAmbientUV vMainUV2\n#else\nvarying vec2 vAmbientUV;\n#endif\nuniform sampler2D ambientSampler;\n#endif\n#ifdef OPACITY\n#if OPACITYDIRECTUV == 1\n#define vOpacityUV vMainUV1\n#elif OPACITYDIRECTUV == 2\n#define vOpacityUV vMainUV2\n#else\nvarying vec2 vOpacityUV;\n#endif\nuniform sampler2D opacitySampler;\n#endif\n#ifdef EMISSIVE\n#if EMISSIVEDIRECTUV == 1\n#define vEmissiveUV vMainUV1\n#elif EMISSIVEDIRECTUV == 2\n#define vEmissiveUV vMainUV2\n#else\nvarying vec2 vEmissiveUV;\n#endif\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\n#if LIGHTMAPDIRECTUV == 1\n#define vLightmapUV vMainUV1\n#elif LIGHTMAPDIRECTUV == 2\n#define vLightmapUV vMainUV2\n#else\nvarying vec2 vLightmapUV;\n#endif\nuniform sampler2D lightmapSampler;\n#endif\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\n#if SPECULARDIRECTUV == 1\n#define vSpecularUV vMainUV1\n#elif SPECULARDIRECTUV == 2\n#define vSpecularUV vMainUV2\n#else\nvarying vec2 vSpecularUV;\n#endif\nuniform sampler2D specularSampler;\n#endif\n#ifdef ALPHATEST\nuniform float alphaCutOff;\n#endif\n\n#include<fresnelFunction>\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));\n#endif\n#include<bumpFragment>\n#ifdef TWOSIDEDLIGHTING\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);\n#ifdef ALPHATEST\nif (baseColor.a<alphaCutOff)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE\n\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);\nspecularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb*vLightmapInfos.y;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n\nvec3 refractionColor=vec3(0.,0.,0.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0) {\nrefractionColor=textureCube(refractionCubeSampler,refractionVector).rgb;\n}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\nrefractionColor=texture2D(refraction2DSampler,refractionCoords).rgb;\n#endif\n#ifdef IS_REFRACTION_LINEAR\nrefractionColor=toGammaSpace(refractionColor);\n#endif\nrefractionColor*=vRefractionInfos.x;\n#endif\n\nvec3 reflectionColor=vec3(0.,0.,0.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias).rgb;\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb;\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords).rgb;\n#endif\n#ifdef IS_REFLECTION_LINEAR\nreflectionColor=toGammaSpace(reflectionColor);\n#endif\nreflectionColor*=vReflectionInfos.x;\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);\nrefractionColor*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+emissiveColor+refractionColor,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+refractionColor,alpha);\n#endif\n\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor;\n#else\ncolor.rgb+=lightmapColor;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\ncolor.rgb=max(color.rgb,0.);\n#include<logDepthFragment>\n#include<fogFragment>\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor.rgb=toLinearSpace(color.rgb);\n#else\n#ifdef IMAGEPROCESSING\ncolor.rgb=toLinearSpace(color.rgb);\ncolor=applyImageProcessing(color);\n#endif\n#endif\ncolor.a*=visibility;\n#ifdef PREMULTIPLYALPHA\n\ncolor.rgb*=color.a;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\ngl_FragColor=color;\n}\n",xo=(st.ShadersStore[bo]=To,"defaultVertexDeclaration"),Eo="\nuniform mat4 viewProjection;\nuniform mat4 view;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef REFLECTION\nuniform mat4 reflectionMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n",Ao=(st.IncludesShadersStore[xo]=Eo,"bonesDeclaration"),Mo="#if NUM_BONE_INFLUENCERS>0\n#ifdef BONETEXTURE\nuniform sampler2D boneSampler;\nuniform float boneTextureWidth;\n#else\nuniform mat4 mBones[BonesPerMesh];\n#endif\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;\nattribute vec4 matricesWeightsExtra;\n#endif\n#ifdef BONETEXTURE\nmat4 readMatrixFromRawSampler(sampler2D smp,float index)\n{\nfloat offset=index*4.0;\nfloat dx=1.0/boneTextureWidth;\nvec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));\nvec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));\nvec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));\nvec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));\nreturn mat4(m0,m1,m2,m3);\n}\n#endif\n#endif",Co=(st.IncludesShadersStore[Ao]=Mo,"instancesDeclaration"),Po="#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#else\nuniform mat4 world;\n#endif",Oo=(st.IncludesShadersStore[Co]=Po,"bumpVertexDeclaration"),So="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP)\n#if defined(TANGENT) && defined(NORMAL)\nvarying mat3 vTBN;\n#endif\n#endif\n",Io=(st.IncludesShadersStore[Oo]=So,"clipPlaneVertexDeclaration"),Ro="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;\nvarying float fClipDistance6;\n#endif",Do=(st.IncludesShadersStore[Io]=Ro,"fogVertexDeclaration"),wo="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif",Lo=(st.IncludesShadersStore[Do]=wo,"morphTargetsVertexGlobalDeclaration"),Fo="#ifdef MORPHTARGETS\nuniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];\n#endif",No=(st.IncludesShadersStore[Lo]=Fo,"morphTargetsVertexDeclaration"),Bo="#ifdef MORPHTARGETS\nattribute vec3 position{X};\n#ifdef MORPHTARGETS_NORMAL\nattribute vec3 normal{X};\n#endif\n#ifdef MORPHTARGETS_TANGENT\nattribute vec3 tangent{X};\n#endif\n#ifdef MORPHTARGETS_UV\nattribute vec2 uv_{X};\n#endif\n#endif",ko=(st.IncludesShadersStore[No]=Bo,"morphTargetsVertex"),Uo="#ifdef MORPHTARGETS\npositionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated+=(uv_{X}-uv)*morphTargetInfluences[{X}];\n#endif\n#endif",Vo=(st.IncludesShadersStore[ko]=Uo,"instancesVertex"),zo="#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#else\nmat4 finalWorld=world;\n#endif",Wo=(st.IncludesShadersStore[Vo]=zo,"bonesVertex"),Go="#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\n#ifdef BONETEXTURE\ninfluence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];\n#endif\n#else\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\n#endif\nfinalWorld=finalWorld*influence;\n#endif",Xo=(st.IncludesShadersStore[Wo]=Go,"bumpVertex"),Ho="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP)\n#if defined(TANGENT) && defined(NORMAL)\nvec3 tbnNormal=normalize(normalUpdated);\nvec3 tbnTangent=normalize(tangentUpdated.xyz);\nvec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;\nvTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);\n#endif\n#endif",jo=(st.IncludesShadersStore[Xo]=Ho,"clipPlaneVertex"),Ko="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif",Yo=(st.IncludesShadersStore[jo]=Ko,"fogVertex"),qo="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif",Zo=(st.IncludesShadersStore[Yo]=qo,"shadowsVertex"),Qo="#ifdef SHADOWS\n#if defined(SHADOWCSM{X})\nvPositionFromCamera{X}=view*worldPos;\nfor (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) {\nvPositionFromLight{X}[i]=lightMatrix{X}[i]*worldPos;\nvDepthMetric{X}[i]=((vPositionFromLight{X}[i].z+light{X}.depthValues.x)/(light{X}.depthValues.y));\n}\n#elif defined(SHADOW{X}) && !defined(SHADOWCUBE{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\nvDepthMetric{X}=((vPositionFromLight{X}.z+light{X}.depthValues.x)/(light{X}.depthValues.y));\n#endif\n#endif",Jo=(st.IncludesShadersStore[Zo]=Qo,"pointCloudVertex"),$o="#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif",es=(st.IncludesShadersStore[Jo]=$o,"logDepthVertex"),ts="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;\ngl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif",is=(st.IncludesShadersStore[es]=ts,"defaultVertexShader"),rs="#include<__decl__defaultVertex>\n\n#define CUSTOM_VERTEX_BEGIN\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nvarying vec2 vDiffuseUV;\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nvarying vec2 vAmbientUV;\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nvarying vec2 vOpacityUV;\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nvarying vec2 vEmissiveUV;\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nvarying vec2 vLightmapUV;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nvarying vec2 vSpecularUV;\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nvarying vec2 vBumpUV;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=positionUpdated;\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR == 0u) {\ngl_Position=viewProjection*worldPos;\n} else {\ngl_Position=viewProjectionR*worldPos;\n}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uvUpdated=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uvUpdated;\n#endif\n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n#include<pointCloudVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}\n",ns=(st.ShadersStore[is]=rs,os.prototype.unBindMesh=function(){this._mesh=null},os.prototype.addFallback=function(e,t){this._defines[e]||(e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e),this._defines[e]=new Array),this._defines[e].push(t)},os.prototype.addCPUSkinningFallback=function(e,t){this._mesh=t,e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e)},Object.defineProperty(os.prototype,"hasMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!0,configurable:!0}),os.prototype.reduce=function(e,t){if(this._mesh&&this._mesh.computeBonesUsingShaders&&0<this._mesh.numBoneInfluencers){this._mesh.computeBonesUsingShaders=!1,e=e.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),t._bonesComputationForcedToCPU=!0;for(var i=this._mesh.getScene(),r=0;r<i.meshes.length;r++){var n=i.meshes[r];if(n.material){if(n.computeBonesUsingShaders&&0!==n.numBoneInfluencers)if(n.material.getEffect()===t)n.computeBonesUsingShaders=!1;else if(n.subMeshes)for(var o=0,s=n.subMeshes;o<s.length;o++)if(s[o].effect===t){n.computeBonesUsingShaders=!1;break}}else!this._mesh.material&&n.computeBonesUsingShaders&&0<n.numBoneInfluencers&&(n.computeBonesUsingShaders=!1)}}else{var a=this._defines[this._currentRank];if(a)for(r=0;r<a.length;r++)e=e.replace("#define "+a[r],"");this._currentRank++}return e},os);function os(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}var ss,as=(n(hs,ss=lr),hs.prototype.setReflectionMode=function(e){for(var t=0,i=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];t<i.length;t++){var r=i[t];this[r]=r===e}},hs);function hs(){var e=ss.call(this)||this;return e.MAINUV1=!1,e.MAINUV2=!1,e.DIFFUSE=!1,e.DIFFUSEDIRECTUV=0,e.AMBIENT=!1,e.AMBIENTDIRECTUV=0,e.OPACITY=!1,e.OPACITYDIRECTUV=0,e.OPACITYRGB=!1,e.REFLECTION=!1,e.EMISSIVE=!1,e.EMISSIVEDIRECTUV=0,e.SPECULAR=!1,e.SPECULARDIRECTUV=0,e.BUMP=!1,e.BUMPDIRECTUV=0,e.PARALLAX=!1,e.PARALLAXOCCLUSION=!1,e.SPECULAROVERALPHA=!1,e.CLIPPLANE=!1,e.CLIPPLANE2=!1,e.CLIPPLANE3=!1,e.CLIPPLANE4=!1,e.CLIPPLANE5=!1,e.CLIPPLANE6=!1,e.ALPHATEST=!1,e.DEPTHPREPASS=!1,e.ALPHAFROMDIFFUSE=!1,e.POINTSIZE=!1,e.FOG=!1,e.SPECULARTERM=!1,e.DIFFUSEFRESNEL=!1,e.OPACITYFRESNEL=!1,e.REFLECTIONFRESNEL=!1,e.REFRACTIONFRESNEL=!1,e.EMISSIVEFRESNEL=!1,e.FRESNEL=!1,e.NORMAL=!1,e.UV1=!1,e.UV2=!1,e.VERTEXCOLOR=!1,e.VERTEXALPHA=!1,e.NUM_BONE_INFLUENCERS=0,e.BonesPerMesh=0,e.BONETEXTURE=!1,e.INSTANCES=!1,e.GLOSSINESS=!1,e.ROUGHNESS=!1,e.EMISSIVEASILLUMINATION=!1,e.LINKEMISSIVEWITHDIFFUSE=!1,e.REFLECTIONFRESNELFROMSPECULAR=!1,e.LIGHTMAP=!1,e.LIGHTMAPDIRECTUV=0,e.OBJECTSPACE_NORMALMAP=!1,e.USELIGHTMAPASSHADOWMAP=!1,e.REFLECTIONMAP_3D=!1,e.REFLECTIONMAP_SPHERICAL=!1,e.REFLECTIONMAP_PLANAR=!1,e.REFLECTIONMAP_CUBIC=!1,e.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,e.REFLECTIONMAP_PROJECTION=!1,e.REFLECTIONMAP_SKYBOX=!1,e.REFLECTIONMAP_EXPLICIT=!1,e.REFLECTIONMAP_EQUIRECTANGULAR=!1,e.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,e.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,e.INVERTCUBICMAP=!1,e.LOGARITHMICDEPTH=!1,e.REFRACTION=!1,e.REFRACTIONMAP_3D=!1,e.REFLECTIONOVERALPHA=!1,e.TWOSIDEDLIGHTING=!1,e.SHADOWFLOAT=!1,e.MORPHTARGETS=!1,e.MORPHTARGETS_NORMAL=!1,e.MORPHTARGETS_TANGENT=!1,e.MORPHTARGETS_UV=!1,e.NUM_MORPH_INFLUENCERS=0,e.NONUNIFORMSCALING=!1,e.PREMULTIPLYALPHA=!1,e.IMAGEPROCESSING=!1,e.VIGNETTE=!1,e.VIGNETTEBLENDMODEMULTIPLY=!1,e.VIGNETTEBLENDMODEOPAQUE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=!1,e.SAMPLER3DBGRMAP=!1,e.IMAGEPROCESSINGPOSTPROCESS=!1,e.MULTIVIEW=!1,e.IS_REFLECTION_LINEAR=!1,e.IS_REFRACTION_LINEAR=!1,e.EXPOSURE=!1,e.rebuild(),e}var ls,us,cs,ds=(n(fs,ls=vn),Object.defineProperty(fs.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),fs.prototype._attachImageProcessingConfiguration=function(e){var t=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){t._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(fs.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(fs.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(fs.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(fs.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!0,configurable:!0}),Object.defineProperty(fs.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!0,configurable:!0}),Object.defineProperty(fs.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this._imageProcessingConfiguration.colorGradingTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(fs.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(e){this._imageProcessingConfiguration.colorCurves=e},enumerable:!0,configurable:!0}),Object.defineProperty(fs.prototype,"hasRenderTargetTextures",{get:function(){return!!(fs.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||!!(fs.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},enumerable:!0,configurable:!0}),fs.prototype.getClassName=function(){return"StandardMaterial"},Object.defineProperty(fs.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!0,configurable:!0}),fs.prototype.needAlphaBlending=function(){return this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled},fs.prototype.needAlphaTesting=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha},fs.prototype._shouldUseAlphaFromDiffuseTexture=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture},fs.prototype.getAlphaTestTexture=function(){return this._diffuseTexture},fs.prototype.isReadyForSubMesh=function(e,t,i){if(void 0===i&&(i=!1),t.effect&&this.isFrozen&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t._materialDefines=new as);var r=this.getScene(),n=t._materialDefines;if(!this.checkReadyOnEveryCall&&t.effect&&n._renderId===r.getRenderId())return!0;var o=r.getEngine();if(n._needNormals=bn.PrepareDefinesForLights(r,e,n,!0,this._maxSimultaneousLights,this._disableLighting),bn.PrepareDefinesForMultiview(r,n),n._areTexturesDirty){if(n._needUVs=!1,n.MAINUV1=!1,n.MAINUV2=!1,r.texturesEnabled){if(this._diffuseTexture&&fs.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;bn.PrepareDefinesForMergedUV(this._diffuseTexture,n,"DIFFUSE")}else n.DIFFUSE=!1;if(this._ambientTexture&&fs.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;bn.PrepareDefinesForMergedUV(this._ambientTexture,n,"AMBIENT")}else n.AMBIENT=!1;if(this._opacityTexture&&fs.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;bn.PrepareDefinesForMergedUV(this._opacityTexture,n,"OPACITY"),n.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else n.OPACITY=!1;if(this._reflectionTexture&&fs.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(n._needNormals=!0,n.REFLECTION=!0,n.ROUGHNESS=0<this._roughness,n.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,n.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===Pn.INVCUBIC_MODE,n.REFLECTIONMAP_3D=this._reflectionTexture.isCube,this._reflectionTexture.coordinatesMode){case Pn.EXPLICIT_MODE:n.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case Pn.PLANAR_MODE:n.setReflectionMode("REFLECTIONMAP_PLANAR");break;case Pn.PROJECTION_MODE:n.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case Pn.SKYBOX_MODE:n.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case Pn.SPHERICAL_MODE:n.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case Pn.EQUIRECTANGULAR_MODE:n.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case Pn.FIXED_EQUIRECTANGULAR_MODE:n.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case Pn.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:n.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case Pn.CUBIC_MODE:case Pn.INVCUBIC_MODE:default:n.setReflectionMode("REFLECTIONMAP_CUBIC")}n.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else n.REFLECTION=!1;if(this._emissiveTexture&&fs.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;bn.PrepareDefinesForMergedUV(this._emissiveTexture,n,"EMISSIVE")}else n.EMISSIVE=!1;if(this._lightmapTexture&&fs.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;bn.PrepareDefinesForMergedUV(this._lightmapTexture,n,"LIGHTMAP"),n.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap}else n.LIGHTMAP=!1;if(this._specularTexture&&fs.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;bn.PrepareDefinesForMergedUV(this._specularTexture,n,"SPECULAR"),n.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else n.SPECULAR=!1;if(r.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&fs.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;bn.PrepareDefinesForMergedUV(this._bumpTexture,n,"BUMP"),n.PARALLAX=this._useParallax,n.PARALLAXOCCLUSION=this._useParallaxOcclusion,n.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else n.BUMP=!1;if(this._refractionTexture&&fs.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;n._needUVs=!0,n.REFRACTION=!0,n.REFRACTIONMAP_3D=this._refractionTexture.isCube}else n.REFRACTION=!1;n.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else n.DIFFUSE=!1,n.AMBIENT=!1,n.OPACITY=!1,n.REFLECTION=!1,n.EMISSIVE=!1,n.LIGHTMAP=!1,n.BUMP=!1,n.REFRACTION=!1;n.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),n.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,n.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,n.SPECULAROVERALPHA=this._useSpecularOverAlpha,n.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode}if(n._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(n),n.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,n.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(n._areFresnelDirty&&(fs.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(n.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,n.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,n.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,n.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,n.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,n.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,n._needNormals=!0,n.FRESNEL=!0):n.FRESNEL=!1),bn.PrepareDefinesForMisc(e,r,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),n),bn.PrepareDefinesForAttributes(e,n,!0,!0,!0),bn.PrepareDefinesForFrameBoundValues(r,o,n,i),n.isDirty){var s=n._areLightsDisposed;n.markAsProcessed();var a=new ns;n.REFLECTION&&a.addFallback(0,"REFLECTION"),n.SPECULAR&&a.addFallback(0,"SPECULAR"),n.BUMP&&a.addFallback(0,"BUMP"),n.PARALLAX&&a.addFallback(1,"PARALLAX"),n.PARALLAXOCCLUSION&&a.addFallback(0,"PARALLAXOCCLUSION"),n.SPECULAROVERALPHA&&a.addFallback(0,"SPECULAROVERALPHA"),n.FOG&&a.addFallback(1,"FOG"),n.POINTSIZE&&a.addFallback(0,"POINTSIZE"),n.LOGARITHMICDEPTH&&a.addFallback(0,"LOGARITHMICDEPTH"),bn.HandleFallbacksForShadows(n,a,this._maxSimultaneousLights),n.SPECULARTERM&&a.addFallback(0,"SPECULARTERM"),n.DIFFUSEFRESNEL&&a.addFallback(1,"DIFFUSEFRESNEL"),n.OPACITYFRESNEL&&a.addFallback(2,"OPACITYFRESNEL"),n.REFLECTIONFRESNEL&&a.addFallback(3,"REFLECTIONFRESNEL"),n.EMISSIVEFRESNEL&&a.addFallback(4,"EMISSIVEFRESNEL"),n.FRESNEL&&a.addFallback(4,"FRESNEL"),n.MULTIVIEW&&a.addFallback(0,"MULTIVIEW");var h=[Si.PositionKind];n.NORMAL&&h.push(Si.NormalKind),n.UV1&&h.push(Si.UVKind),n.UV2&&h.push(Si.UV2Kind),n.VERTEXCOLOR&&h.push(Si.ColorKind),bn.PrepareAttributesForBones(h,e,n,a),bn.PrepareAttributesForInstances(h,n),bn.PrepareAttributesForMorphTargets(h,e,n);var l="default",u=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth"],c=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler"],d=["Material","Scene"];_r&&(_r.PrepareUniforms(u,n),_r.PrepareSamplers(c,n)),bn.PrepareUniformsAndSamplersList({uniformsNames:u,uniformBuffersNames:d,samplers:c,defines:n,maxSimultaneousLights:this._maxSimultaneousLights}),this.customShaderNameResolve&&(l=this.customShaderNameResolve(l,u,d,c,n));var f=n.toString(),p=t.effect,_=r.getEngine().createEffect(l,{attributes:h,uniformsNames:u,uniformBuffersNames:d,samplers:c,defines:f,fallbacks:a,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:n.NUM_MORPH_INFLUENCERS}},o);if(_)if(this.allowShaderHotSwapping&&p&&!_.isReady()){if(_=p,this._rebuildInParallel=!0,n.markAsUnprocessed(),s)return!(n._areLightsDisposed=!0)}else this._rebuildInParallel=!1,r.resetCachedMaterial(),t.setEffect(_,n),this.buildUniformLayout()}return!(!t.effect||!t.effect.isReady())&&(n._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0)},fs.prototype.buildUniformLayout=function(){var e=this._uniformBuffer;e.addUniform("diffuseLeftColor",4),e.addUniform("diffuseRightColor",4),e.addUniform("opacityParts",4),e.addUniform("reflectionLeftColor",4),e.addUniform("reflectionRightColor",4),e.addUniform("refractionLeftColor",4),e.addUniform("refractionRightColor",4),e.addUniform("emissiveLeftColor",4),e.addUniform("emissiveRightColor",4),e.addUniform("vDiffuseInfos",2),e.addUniform("vAmbientInfos",2),e.addUniform("vOpacityInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vSpecularInfos",2),e.addUniform("vBumpInfos",3),e.addUniform("diffuseMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("reflectionMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("specularMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("pointSize",1),e.addUniform("refractionMatrix",16),e.addUniform("vRefractionInfos",4),e.addUniform("vSpecularColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("visibility",1),e.addUniform("vDiffuseColor",4),e.create()},fs.prototype.unbind=function(){var e;this._activeEffect&&(e=!1,this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&(this._activeEffect.setTexture("reflection2DSampler",null),e=!0),this._refractionTexture&&this._refractionTexture.isRenderTarget&&(this._activeEffect.setTexture("refraction2DSampler",null),e=!0),e&&this._markAllSubMeshesAsTexturesDirty()),ls.prototype.unbind.call(this)},fs.prototype.bindForSubMesh=function(e,t,i){var r,n,o,s,a,h=this.getScene(),l=i._materialDefines;!l||(r=i.effect)&&(this._activeEffect=r,l.INSTANCES||this.bindOnlyWorldMatrix(e),l.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix)),n=this._mustRebind(h,r,t.visibility),bn.BindBonesParameters(t,r),o=this._uniformBuffer,n&&(o.bindToEffect(r,"Material"),this.bindViewProjection(r),o.useUbo&&this.isFrozen&&o.isSync||(fs.FresnelEnabled&&l.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(o.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),o.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&o.updateColor4("opacityParts",new Ne(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(o.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),o.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(o.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),o.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(o.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),o.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),h.texturesEnabled&&(this._diffuseTexture&&fs.DiffuseTextureEnabled&&(o.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),bn.BindTextureMatrix(this._diffuseTexture,o,"diffuse"),this._diffuseTexture.hasAlpha&&r.setFloat("alphaCutOff",this.alphaCutOff)),this._ambientTexture&&fs.AmbientTextureEnabled&&(o.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),bn.BindTextureMatrix(this._ambientTexture,o,"ambient")),this._opacityTexture&&fs.OpacityTextureEnabled&&(o.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),bn.BindTextureMatrix(this._opacityTexture,o,"opacity")),this._reflectionTexture&&fs.ReflectionTextureEnabled&&(o.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),o.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize&&(s=this._reflectionTexture,o.updateVector3("vReflectionPosition",s.boundingBoxPosition),o.updateVector3("vReflectionSize",s.boundingBoxSize))),this._emissiveTexture&&fs.EmissiveTextureEnabled&&(o.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),bn.BindTextureMatrix(this._emissiveTexture,o,"emissive")),this._lightmapTexture&&fs.LightmapTextureEnabled&&(o.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),bn.BindTextureMatrix(this._lightmapTexture,o,"lightmap")),this._specularTexture&&fs.SpecularTextureEnabled&&(o.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),bn.BindTextureMatrix(this._specularTexture,o,"specular")),this._bumpTexture&&h.getEngine().getCaps().standardDerivatives&&fs.BumpTextureEnabled&&(o.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),bn.BindTextureMatrix(this._bumpTexture,o,"bump"),h._mirroredCameraPosition?o.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):o.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&fs.RefractionTextureEnabled&&(a=1,this._refractionTexture.isCube||(o.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(a=this._refractionTexture.depth)),o.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,a,this.invertRefractionY?-1:1))),this.pointsCloud&&o.updateFloat("pointSize",this.pointSize),l.SPECULARTERM&&o.updateColor4("vSpecularColor",this.specularColor,this.specularPower),o.updateColor3("vEmissiveColor",fs.EmissiveTextureEnabled?this.emissiveColor:Ne.BlackReadOnly),o.updateFloat("visibility",t.visibility),o.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha)),h.texturesEnabled&&(this._diffuseTexture&&fs.DiffuseTextureEnabled&&r.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&fs.AmbientTextureEnabled&&r.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&fs.OpacityTextureEnabled&&r.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&fs.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?r.setTexture("reflectionCubeSampler",this._reflectionTexture):r.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&fs.EmissiveTextureEnabled&&r.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&fs.LightmapTextureEnabled&&r.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&fs.SpecularTextureEnabled&&r.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&h.getEngine().getCaps().standardDerivatives&&fs.BumpTextureEnabled&&r.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&fs.RefractionTextureEnabled&&(a=1,this._refractionTexture.isCube?r.setTexture("refractionCubeSampler",this._refractionTexture):r.setTexture("refraction2DSampler",this._refractionTexture))),bn.BindClipPlane(r,h),h.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),bn.BindEyePosition(r,h),r.setColor3("vAmbientColor",this._globalAmbientColor)),!n&&this.isFrozen||(h.lightsEnabled&&!this._disableLighting&&bn.BindLights(h,t,r,l,this._maxSimultaneousLights,this._rebuildInParallel),(h.fogEnabled&&t.applyFog&&h.fogMode!==_n.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture)&&this.bindView(r),bn.BindFogParameters(h,t,r),l.NUM_MORPH_INFLUENCERS&&bn.BindMorphTargetParameters(t,r),this.useLogarithmicDepth&&bn.BindLogDepth(l,r,h),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),o.update(),this._afterBind(t,this._activeEffect))},fs.prototype.getAnimatables=function(){var e=[];return this._diffuseTexture&&this._diffuseTexture.animations&&0<this._diffuseTexture.animations.length&&e.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&0<this._ambientTexture.animations.length&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&0<this._opacityTexture.animations.length&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&0<this._reflectionTexture.animations.length&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&0<this._emissiveTexture.animations.length&&e.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&0<this._specularTexture.animations.length&&e.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&0<this._bumpTexture.animations.length&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&0<this._lightmapTexture.animations.length&&e.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&0<this._refractionTexture.animations.length&&e.push(this._refractionTexture),e},fs.prototype.getActiveTextures=function(){var e=ls.prototype.getActiveTextures.call(this);return this._diffuseTexture&&e.push(this._diffuseTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._specularTexture&&e.push(this._specularTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),this._refractionTexture&&e.push(this._refractionTexture),e},fs.prototype.hasTexture=function(e){return!!ls.prototype.hasTexture.call(this,e)||this._diffuseTexture===e||this._ambientTexture===e||this._opacityTexture===e||this._reflectionTexture===e||this._emissiveTexture===e||this._specularTexture===e||this._bumpTexture===e||this._lightmapTexture===e||this._refractionTexture===e},fs.prototype.dispose=function(e,t){t&&(this._diffuseTexture&&this._diffuseTexture.dispose(),this._ambientTexture&&this._ambientTexture.dispose(),this._opacityTexture&&this._opacityTexture.dispose(),this._reflectionTexture&&this._reflectionTexture.dispose(),this._emissiveTexture&&this._emissiveTexture.dispose(),this._specularTexture&&this._specularTexture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._lightmapTexture&&this._lightmapTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),ls.prototype.dispose.call(this,e,t)},fs.prototype.clone=function(e){var t=this,i=Q.Clone(function(){return new fs(e,t.getScene())},this);return i.name=e,i.id=e,i},fs.prototype.serialize=function(){return Q.Serialize(this)},fs.Parse=function(e,t,i){return Q.Parse(function(){return new fs(e.name,t)},e,t,i)},Object.defineProperty(fs,"DiffuseTextureEnabled",{get:function(){return Sn.DiffuseTextureEnabled},set:function(e){Sn.DiffuseTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(fs,"AmbientTextureEnabled",{get:function(){return Sn.AmbientTextureEnabled},set:function(e){Sn.AmbientTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(fs,"OpacityTextureEnabled",{get:function(){return Sn.OpacityTextureEnabled},set:function(e){Sn.OpacityTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(fs,"ReflectionTextureEnabled",{get:function(){return Sn.ReflectionTextureEnabled},set:function(e){Sn.ReflectionTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(fs,"EmissiveTextureEnabled",{get:function(){return Sn.EmissiveTextureEnabled},set:function(e){Sn.EmissiveTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(fs,"SpecularTextureEnabled",{get:function(){return Sn.SpecularTextureEnabled},set:function(e){Sn.SpecularTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(fs,"BumpTextureEnabled",{get:function(){return Sn.BumpTextureEnabled},set:function(e){Sn.BumpTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(fs,"LightmapTextureEnabled",{get:function(){return Sn.LightmapTextureEnabled},set:function(e){Sn.LightmapTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(fs,"RefractionTextureEnabled",{get:function(){return Sn.RefractionTextureEnabled},set:function(e){Sn.RefractionTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(fs,"ColorGradingTextureEnabled",{get:function(){return Sn.ColorGradingTextureEnabled},set:function(e){Sn.ColorGradingTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(fs,"FresnelEnabled",{get:function(){return Sn.FresnelEnabled},set:function(e){Sn.FresnelEnabled=e},enumerable:!0,configurable:!0}),o([X("diffuseTexture")],fs.prototype,"_diffuseTexture",void 0),o([V("_markAllSubMeshesAsTexturesAndMiscDirty")],fs.prototype,"diffuseTexture",void 0),o([X("ambientTexture")],fs.prototype,"_ambientTexture",void 0),o([V("_markAllSubMeshesAsTexturesDirty")],fs.prototype,"ambientTexture",void 0),o([X("opacityTexture")],fs.prototype,"_opacityTexture",void 0),o([V("_markAllSubMeshesAsTexturesAndMiscDirty")],fs.prototype,"opacityTexture",void 0),o([X("reflectionTexture")],fs.prototype,"_reflectionTexture",void 0),o([V("_markAllSubMeshesAsTexturesDirty")],fs.prototype,"reflectionTexture",void 0),o([X("emissiveTexture")],fs.prototype,"_emissiveTexture",void 0),o([V("_markAllSubMeshesAsTexturesDirty")],fs.prototype,"emissiveTexture",void 0),o([X("specularTexture")],fs.prototype,"_specularTexture",void 0),o([V("_markAllSubMeshesAsTexturesDirty")],fs.prototype,"specularTexture",void 0),o([X("bumpTexture")],fs.prototype,"_bumpTexture",void 0),o([V("_markAllSubMeshesAsTexturesDirty")],fs.prototype,"bumpTexture",void 0),o([X("lightmapTexture")],fs.prototype,"_lightmapTexture",void 0),o([V("_markAllSubMeshesAsTexturesDirty")],fs.prototype,"lightmapTexture",void 0),o([X("refractionTexture")],fs.prototype,"_refractionTexture",void 0),o([V("_markAllSubMeshesAsTexturesDirty")],fs.prototype,"refractionTexture",void 0),o([Y("ambient")],fs.prototype,"ambientColor",void 0),o([Y("diffuse")],fs.prototype,"diffuseColor",void 0),o([Y("specular")],fs.prototype,"specularColor",void 0),o([Y("emissive")],fs.prototype,"emissiveColor",void 0),o([z()],fs.prototype,"specularPower",void 0),o([z("useAlphaFromDiffuseTexture")],fs.prototype,"_useAlphaFromDiffuseTexture",void 0),o([V("_markAllSubMeshesAsTexturesDirty")],fs.prototype,"useAlphaFromDiffuseTexture",void 0),o([z("useEmissiveAsIllumination")],fs.prototype,"_useEmissiveAsIllumination",void 0),o([V("_markAllSubMeshesAsTexturesDirty")],fs.prototype,"useEmissiveAsIllumination",void 0),o([z("linkEmissiveWithDiffuse")],fs.prototype,"_linkEmissiveWithDiffuse",void 0),o([V("_markAllSubMeshesAsTexturesDirty")],fs.prototype,"linkEmissiveWithDiffuse",void 0),o([z("useSpecularOverAlpha")],fs.prototype,"_useSpecularOverAlpha",void 0),o([V("_markAllSubMeshesAsTexturesDirty")],fs.prototype,"useSpecularOverAlpha",void 0),o([z("useReflectionOverAlpha")],fs.prototype,"_useReflectionOverAlpha",void 0),o([V("_markAllSubMeshesAsTexturesDirty")],fs.prototype,"useReflectionOverAlpha",void 0),o([z("disableLighting")],fs.prototype,"_disableLighting",void 0),o([V("_markAllSubMeshesAsLightsDirty")],fs.prototype,"disableLighting",void 0),o([z("useObjectSpaceNormalMap")],fs.prototype,"_useObjectSpaceNormalMap",void 0),o([V("_markAllSubMeshesAsTexturesDirty")],fs.prototype,"useObjectSpaceNormalMap",void 0),o([z("useParallax")],fs.prototype,"_useParallax",void 0),o([V("_markAllSubMeshesAsTexturesDirty")],fs.prototype,"useParallax",void 0),o([z("useParallaxOcclusion")],fs.prototype,"_useParallaxOcclusion",void 0),o([V("_markAllSubMeshesAsTexturesDirty")],fs.prototype,"useParallaxOcclusion",void 0),o([z()],fs.prototype,"parallaxScaleBias",void 0),o([z("roughness")],fs.prototype,"_roughness",void 0),o([V("_markAllSubMeshesAsTexturesDirty")],fs.prototype,"roughness",void 0),o([z()],fs.prototype,"indexOfRefraction",void 0),o([z()],fs.prototype,"invertRefractionY",void 0),o([z()],fs.prototype,"alphaCutOff",void 0),o([z("useLightmapAsShadowmap")],fs.prototype,"_useLightmapAsShadowmap",void 0),o([V("_markAllSubMeshesAsTexturesDirty")],fs.prototype,"useLightmapAsShadowmap",void 0),o([q("diffuseFresnelParameters")],fs.prototype,"_diffuseFresnelParameters",void 0),o([V("_markAllSubMeshesAsFresnelDirty")],fs.prototype,"diffuseFresnelParameters",void 0),o([q("opacityFresnelParameters")],fs.prototype,"_opacityFresnelParameters",void 0),o([V("_markAllSubMeshesAsFresnelAndMiscDirty")],fs.prototype,"opacityFresnelParameters",void 0),o([q("reflectionFresnelParameters")],fs.prototype,"_reflectionFresnelParameters",void 0),o([V("_markAllSubMeshesAsFresnelDirty")],fs.prototype,"reflectionFresnelParameters",void 0),o([q("refractionFresnelParameters")],fs.prototype,"_refractionFresnelParameters",void 0),o([V("_markAllSubMeshesAsFresnelDirty")],fs.prototype,"refractionFresnelParameters",void 0),o([q("emissiveFresnelParameters")],fs.prototype,"_emissiveFresnelParameters",void 0),o([V("_markAllSubMeshesAsFresnelDirty")],fs.prototype,"emissiveFresnelParameters",void 0),o([z("useReflectionFresnelFromSpecular")],fs.prototype,"_useReflectionFresnelFromSpecular",void 0),o([V("_markAllSubMeshesAsFresnelDirty")],fs.prototype,"useReflectionFresnelFromSpecular",void 0),o([z("useGlossinessFromSpecularMapAlpha")],fs.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),o([V("_markAllSubMeshesAsTexturesDirty")],fs.prototype,"useGlossinessFromSpecularMapAlpha",void 0),o([z("maxSimultaneousLights")],fs.prototype,"_maxSimultaneousLights",void 0),o([V("_markAllSubMeshesAsLightsDirty")],fs.prototype,"maxSimultaneousLights",void 0),o([z("invertNormalMapX")],fs.prototype,"_invertNormalMapX",void 0),o([V("_markAllSubMeshesAsTexturesDirty")],fs.prototype,"invertNormalMapX",void 0),o([z("invertNormalMapY")],fs.prototype,"_invertNormalMapY",void 0),o([V("_markAllSubMeshesAsTexturesDirty")],fs.prototype,"invertNormalMapY",void 0),o([z("twoSidedLighting")],fs.prototype,"_twoSidedLighting",void 0),o([V("_markAllSubMeshesAsTexturesDirty")],fs.prototype,"twoSidedLighting",void 0),o([z()],fs.prototype,"useLogarithmicDepth",null),fs);function fs(e,t){var i=ls.call(this,e,t)||this;return i._diffuseTexture=null,i._ambientTexture=null,i._opacityTexture=null,i._reflectionTexture=null,i._emissiveTexture=null,i._specularTexture=null,i._bumpTexture=null,i._lightmapTexture=null,i._refractionTexture=null,i.ambientColor=new Ne(0,0,0),i.diffuseColor=new Ne(1,1,1),i.specularColor=new Ne(1,1,1),i.emissiveColor=new Ne(0,0,0),i.specularPower=64,i._useAlphaFromDiffuseTexture=!1,i._useEmissiveAsIllumination=!1,i._linkEmissiveWithDiffuse=!1,i._useSpecularOverAlpha=!1,i._useReflectionOverAlpha=!1,i._disableLighting=!1,i._useObjectSpaceNormalMap=!1,i._useParallax=!1,i._useParallaxOcclusion=!1,i.parallaxScaleBias=.05,i._roughness=0,i.indexOfRefraction=.98,i.invertRefractionY=!0,i.alphaCutOff=.4,i._useLightmapAsShadowmap=!1,i._useReflectionFresnelFromSpecular=!1,i._useGlossinessFromSpecularMapAlpha=!1,i._maxSimultaneousLights=4,i._invertNormalMapX=!1,i._invertNormalMapY=!1,i._twoSidedLighting=!1,i._renderTargets=new $(16),i._worldViewProjectionMatrix=W.Zero(),i._globalAmbientColor=new Ne(0,0,0),i._rebuildInParallel=!1,i._attachImageProcessingConfiguration(null),i.getRenderTargetTextures=function(){return i._renderTargets.reset(),fs.ReflectionTextureEnabled&&i._reflectionTexture&&i._reflectionTexture.isRenderTarget&&i._renderTargets.push(i._reflectionTexture),fs.RefractionTextureEnabled&&i._refractionTexture&&i._refractionTexture.isRenderTarget&&i._renderTargets.push(i._refractionTexture),i._renderTargets},i}m.RegisteredTypes["BABYLON.StandardMaterial"]=ds,_n.DefaultMaterialFactory=function(e){return new ds("default material",e)},(cs=us=us||{})[cs.CW=0]="CW",cs[cs.CCW=1]="CCW";var ps=(_s.Interpolate=function(e,t,i,r,n){for(var o=1-3*r+3*t,s=3*r-6*t,a=3*t,h=e,l=0;l<5;l++){var u=h*h;h-=1/(3*o*u+2*s*h+a)*(u*h*o+s*u+a*h-e),h=Math.min(1,Math.max(0,h))}return 3*Math.pow(1-h,2)*h*i+3*(1-h)*Math.pow(h,2)*n+Math.pow(h,3)},_s);function _s(){}var gs=(ms.prototype.degrees=function(){return 180*this._radians/Math.PI},ms.prototype.radians=function(){return this._radians},ms.BetweenTwoPoints=function(e,t){var i=t.subtract(e);return new ms(Math.atan2(i.y,i.x))},ms.FromRadians=function(e){return new ms(e)},ms.FromDegrees=function(e){return new ms(e*Math.PI/180)},ms);function ms(e){this._radians=e,this._radians<0&&(this._radians+=2*Math.PI)}var vs=function(e,t,i){this.startPoint=e,this.midPoint=t,this.endPoint=i;var r=Math.pow(t.x,2)+Math.pow(t.y,2),n=(Math.pow(e.x,2)+Math.pow(e.y,2)-r)/2,o=(r-Math.pow(i.x,2)-Math.pow(i.y,2))/2,s=(e.x-t.x)*(t.y-i.y)-(t.x-i.x)*(e.y-t.y);this.centerPoint=new H((n*(t.y-i.y)-o*(e.y-t.y))/s,((e.x-t.x)*o-(t.x-i.x)*n)/s),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=gs.BetweenTwoPoints(this.centerPoint,this.startPoint);var a=this.startAngle.degrees(),h=gs.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),l=gs.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();180<h-a&&(h-=360),h-a<-180&&(h+=360),180<l-h&&(l-=360),l-h<-180&&(l+=360),this.orientation=h-a<0?us.CW:us.CCW,this.angle=gs.FromDegrees(this.orientation===us.CW?a-l:l-a)},ys=(bs.prototype.addLineTo=function(e,t){if(this.closed)return this;var i=new H(e,t),r=this._points[this._points.length-1];return this._points.push(i),this._length+=i.subtract(r).length(),this},bs.prototype.addArcTo=function(e,t,i,r,n){if(void 0===n&&(n=36),this.closed)return this;var o=this._points[this._points.length-1],s=new H(e,t),a=new H(i,r),h=new vs(o,s,a),l=h.angle.radians()/n;h.orientation===us.CW&&(l*=-1);for(var u=h.startAngle.radians()+l,c=0;c<n;c++){var d=Math.cos(u)*h.radius+h.centerPoint.x,f=Math.sin(u)*h.radius+h.centerPoint.y;this.addLineTo(d,f),u+=l}return this},bs.prototype.close=function(){return this.closed=!0,this},bs.prototype.length=function(){var e,t=this._length;return this.closed&&(e=this._points[this._points.length-1],t+=this._points[0].subtract(e).length()),t},bs.prototype.getPoints=function(){return this._points},bs.prototype.getPointAtLengthPosition=function(e){if(e<0||1<e)return H.Zero();for(var t=e*this.length(),i=0,r=0;r<this._points.length;r++){var n=(r+1)%this._points.length,o=this._points[r],s=this._points[n].subtract(o),a=s.length()+i;if(i<=t&&t<=a){var h=s.normalize(),l=t-i;return new H(o.x+h.x*l,o.y+h.y*l)}i=a}return H.Zero()},bs.StartingAt=function(e,t){return new bs(e,t)},bs);function bs(e,t){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new H(e,t))}var Ts=(xs.prototype.getCurve=function(){return this._curve},xs.prototype.getPoints=function(){return this._curve},xs.prototype.length=function(){return this._distances[this._distances.length-1]},xs.prototype.getTangents=function(){return this._tangents},xs.prototype.getNormals=function(){return this._normals},xs.prototype.getBinormals=function(){return this._binormals},xs.prototype.getDistances=function(){return this._distances},xs.prototype.getPointAt=function(e){return this._updatePointAtData(e).point},xs.prototype.getTangentAt=function(e,t){return void 0===t&&(t=!1),this._updatePointAtData(e,t),t?te.TransformCoordinates(te.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]},xs.prototype.getNormalAt=function(e,t){return void 0===t&&(t=!1),this._updatePointAtData(e,t),t?te.TransformCoordinates(te.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]},xs.prototype.getBinormalAt=function(e,t){return void 0===t&&(t=!1),this._updatePointAtData(e,t),t?te.TransformCoordinates(te.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]},xs.prototype.getDistanceAt=function(e){return this.length()*e},xs.prototype.getPreviousPointIndexAt=function(e){return this._updatePointAtData(e),this._pointAtData.previousPointArrayIndex},xs.prototype.getSubPositionAt=function(e){return this._updatePointAtData(e),this._pointAtData.subPosition},xs.prototype.getClosestPositionTo=function(e){for(var t=Number.MAX_VALUE,i=0,r=0;r<this._curve.length-1;r++){var n=this._curve[r+0],o=this._curve[r+1].subtract(n).normalize(),s=this._distances[r+1]-this._distances[r+0],a=Math.min(Math.max(te.Dot(o,e.subtract(n).normalize()),0)*te.Distance(n,e)/s,1),h=te.Distance(n.add(o.scale(a*s)),e);h<t&&(t=h,i=(this._distances[r+0]+s*a)/this.length())}return i},xs.prototype.slice=function(e,t){var i;void 0===e&&(e=0),void 0===t&&(t=1),e<0&&(e=1- -1*e%1),t<0&&(t=1- -1*t%1),t<e&&(i=e,e=t,t=i);var r=this.getCurve(),n=this.getPointAt(e),o=this.getPreviousPointIndexAt(e),s=this.getPointAt(t),a=this.getPreviousPointIndexAt(t)+1,h=[];return 0!==e&&(o++,h.push(n)),h.push.apply(h,r.slice(o,a)),1===t&&1!==e||h.push(s),new xs(h,this.getNormalAt(e),this._raw,this._alignTangentsWithPath)},xs.prototype.update=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=!1);for(var r=0;r<e.length;r++)this._curve[r].x=e[r].x,this._curve[r].y=e[r].y,this._curve[r].z=e[r].z;return this._compute(t,i),this},xs.prototype._compute=function(e,t){void 0===t&&(t=!1);var i=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[i-1]=this._curve[i-1].subtract(this._curve[i-2]),this._raw||this._tangents[i-1].normalize();var r,n,o,s,a,h=this._tangents[0],l=this._normalVector(h,e);this._normals[0]=l,this._raw||this._normals[0].normalize(),this._binormals[0]=te.Cross(h,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var u=1;u<i;u++)r=this._getLastNonNullVector(u),u<i-1&&(n=this._getFirstNonNullVector(u),this._tangents[u]=t?n:r.add(n),this._tangents[u].normalize()),this._distances[u]=this._distances[u-1]+r.length(),o=this._tangents[u],a=this._binormals[u-1],this._normals[u]=te.Cross(a,o),this._raw||(0===this._normals[u].length()?(s=this._normals[u-1],this._normals[u]=s.clone()):this._normals[u].normalize()),this._binormals[u]=te.Cross(o,this._normals[u]),this._raw||this._binormals[u].normalize();this._pointAtData.id=NaN},xs.prototype._getFirstNonNullVector=function(e){for(var t=1,i=this._curve[e+t].subtract(this._curve[e]);0===i.length()&&e+t+1<this._curve.length;)t++,i=this._curve[e+t].subtract(this._curve[e]);return i},xs.prototype._getLastNonNullVector=function(e){for(var t=1,i=this._curve[e].subtract(this._curve[e-t]);0===i.length()&&t+1<e;)t++,i=this._curve[e].subtract(this._curve[e-t]);return i},xs.prototype._normalVector=function(e,t){var i,r,n=e.length();return 0===n&&(n=1),null==t?(i=c.WithinEpsilon(Math.abs(e.y)/n,1,C)?c.WithinEpsilon(Math.abs(e.x)/n,1,C)?c.WithinEpsilon(Math.abs(e.z)/n,1,C)?te.Zero():new te(0,0,1):new te(1,0,0):new te(0,-1,0),r=te.Cross(e,i)):(r=te.Cross(e,t),te.CrossToRef(r,e,r)),r.normalize(),r},xs.prototype._updatePointAtData=function(e,t){if(void 0===t&&(t=!1),this._pointAtData.id===e)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=e;var i=this.getPoints();if(e<=0)return this._setPointAtData(0,0,i[0],0,t);if(1<=e)return this._setPointAtData(1,1,i[i.length-1],i.length-1,t);for(var r,n=i[0],o=0,s=e*this.length(),a=1;a<i.length;a++){r=i[a];var h=te.Distance(n,r);if((o+=h)===s)return this._setPointAtData(e,1,r,a,t);if(s<o){var l=(o-s)/h,u=n.subtract(r),c=r.add(u.scaleInPlace(l));return this._setPointAtData(e,1-l,c,a-1,t)}n=r}return this._pointAtData},xs.prototype._setPointAtData=function(e,t,i,r,n){return this._pointAtData.point=i,this._pointAtData.position=e,this._pointAtData.subPosition=t,this._pointAtData.previousPointArrayIndex=r,(this._pointAtData.interpolateReady=n)&&this._updateInterpolationMatrix(),this._pointAtData},xs.prototype._updateInterpolationMatrix=function(){this._pointAtData.interpolationMatrix=W.Identity();var e,t,i,r,n,o,s,a,h,l=this._pointAtData.previousPointArrayIndex;l!==this._tangents.length-1&&(e=l+1,t=this._tangents[l].clone(),i=this._normals[l].clone(),r=this._binormals[l].clone(),n=this._tangents[e].clone(),o=this._normals[e].clone(),s=this._binormals[e].clone(),a=x.RotationQuaternionFromAxis(i,r,t),h=x.RotationQuaternionFromAxis(o,s,n),x.Slerp(a,h,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix))},xs);function xs(e,t,i,r){void 0===t&&(t=null),void 0===r&&(r=!1),this.path=e,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:te.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:W.Identity()};for(var n=0;n<e.length;n++)this._curve[n]=e[n].clone();this._raw=i||!1,this._alignTangentsWithPath=r,this._compute(t,r)}Es.CreateQuadraticBezier=function(e,t,i,r){r=2<r?r:3;for(var n=new Array,o=function(e,t,i,r){return(1-e)*(1-e)*t+2*e*(1-e)*i+e*e*r},s=0;s<=r;s++)n.push(new te(o(s/r,e.x,t.x,i.x),o(s/r,e.y,t.y,i.y),o(s/r,e.z,t.z,i.z)));return new Es(n)},Es.CreateCubicBezier=function(e,t,i,r,n){n=3<n?n:4;for(var o=new Array,s=function(e,t,i,r,n){return(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*i+3*e*e*(1-e)*r+e*e*e*n},a=0;a<=n;a++)o.push(new te(s(a/n,e.x,t.x,i.x,r.x),s(a/n,e.y,t.y,i.y,r.y),s(a/n,e.z,t.z,i.z,r.z)));return new Es(o)},Es.CreateHermiteSpline=function(e,t,i,r,n){for(var o=new Array,s=1/n,a=0;a<=n;a++)o.push(te.Hermite(e,t,i,r,a*s));return new Es(o)},Es.CreateCatmullRomSpline=function(e,t,i){var r=new Array,n=1/t,o=0;if(i){for(var s=e.length,a=0;a<s;a++)for(var h=o=0;h<t;h++)r.push(te.CatmullRom(e[a%s],e[(a+1)%s],e[(a+2)%s],e[(a+3)%s],o)),o+=n;r.push(r[0])}else{var l=new Array;for(l.push(e[0].clone()),Array.prototype.push.apply(l,e),l.push(e[e.length-1].clone()),a=0;a<l.length-3;a++)for(h=o=0;h<t;h++)r.push(te.CatmullRom(l[a],l[a+1],l[a+2],l[a+3],o)),o+=n;a--,r.push(te.CatmullRom(l[a],l[a+1],l[a+2],l[a+3],o))}return new Es(r)},Es.prototype.getPoints=function(){return this._points},Es.prototype.length=function(){return this._length},Es.prototype.continue=function(e){for(var t=this._points[this._points.length-1],i=this._points.slice(),r=e.getPoints(),n=1;n<r.length;n++)i.push(r[n].subtract(r[0]).add(t));return new Es(i)},Es.prototype._computeLength=function(e){for(var t=0,i=1;i<e.length;i++)t+=e[i].subtract(e[i-1]).length();return t};function Es(e){this._length=0,this._points=e,this._length=this._computeLength(e)}var As=(Ms.prototype.clone=function(){return new Ms(this.position.clone(),this.normal.clone())},Ms);function Ms(e,t){void 0===e&&(e=te.Zero()),void 0===t&&(t=te.Up()),this.position=e,this.normal=t}Cs.prototype.clone=function(){return new Cs(this.position.clone(),this.normal.clone(),this.uv.clone())};function Cs(e,t,i){void 0===e&&(e=te.Zero()),void 0===t&&(t=te.Up()),void 0===i&&(i=H.Zero()),this.position=e,this.normal=t,this.uv=i}var Ps,Os=(n(Ss,Ps=or),Ss.prototype.getFrontPosition=function(e){this.getWorldMatrix();var t=this.getTarget().subtract(this.position);return t.normalize(),t.scaleInPlace(e),this.globalPosition.add(t)},Ss.prototype._getLockedTargetPosition=function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null},Ss.prototype.storeState=function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),Ps.prototype.storeState.call(this)},Ss.prototype._restoreStateValues=function(){return!!Ps.prototype._restoreStateValues.call(this)&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)},Ss.prototype._initCache=function(){Ps.prototype._initCache.call(this),this._cache.lockedTarget=new te(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new te(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},Ss.prototype._updateCache=function(e){e||Ps.prototype._updateCache.call(this);var t=this._getLockedTargetPosition();t?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(t):this._cache.lockedTarget=t.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},Ss.prototype._isSynchronizedViewMatrix=function(){if(!Ps.prototype._isSynchronizedViewMatrix.call(this))return!1;var e=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(e):!e)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},Ss.prototype._computeLocalCameraSpeed=function(){var e=this.getEngine();return this.speed*Math.sqrt(e.getDeltaTime()/(100*e.getFps()))},Ss.prototype.setTarget=function(e){this.upVector.normalize(),this._initialFocalDistance=e.subtract(this.position).length(),this.position.z===e.z&&(this.position.z+=C),W.LookAtLHToRef(this.position,e,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var t=e.subtract(this.position);0<=t.x?this.rotation.y=-Math.atan(t.z/t.x)+Math.PI/2:this.rotation.y=-Math.atan(t.z/t.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&x.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},Ss.prototype.getTarget=function(){return this._currentTarget},Ss.prototype._decideIfNeedsToMove=function(){return 0<Math.abs(this.cameraDirection.x)||0<Math.abs(this.cameraDirection.y)||0<Math.abs(this.cameraDirection.z)},Ss.prototype._updatePosition=function(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(P.Matrix[0]),te.TransformNormalToRef(this.cameraDirection,P.Matrix[0],P.Vector3[0]),void this.position.addInPlace(P.Vector3[0]);this.position.addInPlace(this.cameraDirection)},Ss.prototype._checkInputs=function(){var e,t=this._decideIfNeedsToMove(),i=0<Math.abs(this.cameraRotation.x)||0<Math.abs(this.cameraRotation.y);t&&this._updatePosition(),i&&(this.rotation.x+=this.cameraRotation.x,this.rotation.y+=this.cameraRotation.y,this.rotationQuaternion&&this.rotation.lengthSquared()&&x.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion),this.noRotationConstraint||(e=1.570796,this.rotation.x>e&&(this.rotation.x=e),this.rotation.x<-e&&(this.rotation.x=-e))),t&&(Math.abs(this.cameraDirection.x)<this.speed*C&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*C&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*C&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),i&&(Math.abs(this.cameraRotation.x)<this.speed*C&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*C&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),Ps.prototype._checkInputs.call(this)},Ss.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):W.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},Ss.prototype._rotateUpVectorWithCameraRotationMatrix=function(){return te.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this},Ss.prototype._getViewMatrix=function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!=this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),te.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?fi.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(x.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),fi.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix},Ss.prototype._computeViewMatrix=function(e,t,i){var r;this.parent?(r=this.parent.getWorldMatrix(),te.TransformCoordinatesToRef(e,r,this._globalPosition),te.TransformCoordinatesToRef(t,r,this._globalCurrentTarget),te.TransformNormalToRef(i,r,this._globalCurrentUpVector),this._markSyncedWithParent()):(this._globalPosition.copyFrom(e),this._globalCurrentTarget.copyFrom(t),this._globalCurrentUpVector.copyFrom(i)),this.getScene().useRightHandedSystem?W.LookAtRHToRef(this._globalPosition,this._globalCurrentTarget,this._globalCurrentUpVector,this._viewMatrix):W.LookAtLHToRef(this._globalPosition,this._globalCurrentTarget,this._globalCurrentUpVector,this._viewMatrix)},Ss.prototype.createRigCamera=function(e,t){if(this.cameraRigMode===or.RIG_MODE_NONE)return null;var i=new Ss(e,this.position.clone(),this.getScene());return i.isRigCamera=!0,(i.rigParent=this).cameraRigMode!==or.RIG_MODE_VR&&this.cameraRigMode!==or.RIG_MODE_WEBVR||(this.rotationQuaternion||(this.rotationQuaternion=new x),i._cameraRigParams={},i.rotationQuaternion=new x),i},Ss.prototype._updateRigCameras=function(){var e=this._rigCameras[0],t=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case or.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case or.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case or.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case or.RIG_MODE_STEREOSCOPIC_OVERUNDER:case or.RIG_MODE_STEREOSCOPIC_INTERLACED:var i=this.cameraRigMode===or.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,r=this.cameraRigMode===or.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*i,e),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*r,t);break;case or.RIG_MODE_VR:e.rotationQuaternion?(e.rotationQuaternion.copyFrom(this.rotationQuaternion),t.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.rotation.copyFrom(this.rotation),t.rotation.copyFrom(this.rotation)),e.position.copyFrom(this.position),t.position.copyFrom(this.position)}Ps.prototype._updateRigCameras.call(this)},Ss.prototype._getRigCamPositionAndTarget=function(e,t){this.getTarget().subtractToRef(this.position,Ss._TargetFocalPoint),Ss._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);var i=Ss._TargetFocalPoint.addInPlace(this.position);W.TranslationToRef(-i.x,-i.y,-i.z,Ss._TargetTransformMatrix),Ss._TargetTransformMatrix.multiplyToRef(W.RotationY(e),Ss._RigCamTransformMatrix),W.TranslationToRef(i.x,i.y,i.z,Ss._TargetTransformMatrix),Ss._RigCamTransformMatrix.multiplyToRef(Ss._TargetTransformMatrix,Ss._RigCamTransformMatrix),te.TransformCoordinatesToRef(this.position,Ss._RigCamTransformMatrix,t.position),t.setTarget(i)},Ss.prototype.getClassName=function(){return"TargetCamera"},Ss._RigCamTransformMatrix=new W,Ss._TargetTransformMatrix=new W,Ss._TargetFocalPoint=new te,o([Z()],Ss.prototype,"rotation",void 0),o([z()],Ss.prototype,"speed",void 0),o([U(6,"lockedTargetId")],Ss.prototype,"lockedTarget",void 0),Ss);function Ss(e,t,i,r){void 0===r&&(r=!0);var n=Ps.call(this,e,t,i,r)||this;return n.cameraDirection=new te(0,0,0),n.cameraRotation=new H(0,0),n.updateUpVectorFromRotation=!1,n._tmpQuaternion=new x,n.rotation=new te(0,0,0),n.speed=2,n.noRotationConstraint=!1,n.lockedTarget=null,n._currentTarget=te.Zero(),n._initialFocalDistance=1,n._viewMatrix=W.Zero(),n._camMatrix=W.Zero(),n._cameraTransformMatrix=W.Zero(),n._cameraRotationMatrix=W.Zero(),n._referencePoint=new te(0,0,1),n._transformedReferencePoint=te.Zero(),n._globalCurrentTarget=te.Zero(),n._globalCurrentUpVector=te.Zero(),n._defaultUp=te.Up(),n._cachedRotationZ=0,n._cachedQuaternionRotationZ=0,n}var Is={},Rs=(Ds.prototype.add=function(e){var t=e.getSimpleName();this.attached[t]?fe.Warn("camera input of type "+t+" already exists on camera"):((this.attached[t]=e).camera=this.camera,e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e))),this.attachedElement&&e.attachControl(this.attachedElement))},Ds.prototype.remove=function(e){for(var t in this.attached){var i=this.attached[t];i===e&&(i.detachControl(this.attachedElement),i.camera=null,delete this.attached[t],this.rebuildInputCheck())}},Ds.prototype.removeByType=function(e){for(var t in this.attached){var i=this.attached[t];i.getClassName()===e&&(i.detachControl(this.attachedElement),i.camera=null,delete this.attached[t],this.rebuildInputCheck())}},Ds.prototype._addCheckInputs=function(e){var t=this.checkInputs;return function(){t(),e()}},Ds.prototype.attachInput=function(e){this.attachedElement&&e.attachControl(this.attachedElement,this.noPreventDefault)},Ds.prototype.attachElement=function(e,t){if(void 0===t&&(t=!1),!this.attachedElement)for(var i in t=!or.ForceAttachControlToAlwaysPreventDefault&&t,this.attachedElement=e,this.noPreventDefault=t,this.attached)this.attached[i].attachControl(e,t)},Ds.prototype.detachElement=function(e,t){if(void 0===t&&(t=!1),this.attachedElement===e){for(var i in this.attached)this.attached[i].detachControl(e),t&&(this.attached[i].camera=null);this.attachedElement=null}},Ds.prototype.rebuildInputCheck=function(){for(var e in this.checkInputs=function(){},this.attached){var t=this.attached[e];t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t)))}},Ds.prototype.clear=function(){this.attachedElement&&this.detachElement(this.attachedElement,!0),this.attached={},this.attachedElement=null,this.checkInputs=function(){}},Ds.prototype.serialize=function(e){var t={};for(var i in this.attached){var r=this.attached[i],n=Q.Serialize(r);t[r.getClassName()]=n}e.inputsmgr=t},Ds.prototype.parse=function(e){var t,i,r,n=e.inputsmgr;if(n)for(var o in this.clear(),n)(i=Is[o])&&(t=n[o],r=Q.Parse(function(){return new i},t,null),this.add(r));else for(var o in this.attached)(i=Is[this.attached[o].getClassName()])&&(r=Q.Parse(function(){return new i},e,null),this.remove(this.attached[o]),this.add(r))},Ds);function Ds(e){this.attached={},this.camera=e,this.checkInputs=function(){}}var ws=(Ls.prototype.attachControl=function(e,r){var n=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){n._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(e){var t,i=e.event;i.metaKey||(e.type===tn.KEYDOWN?-1===n.keysUp.indexOf(i.keyCode)&&-1===n.keysDown.indexOf(i.keyCode)&&-1===n.keysLeft.indexOf(i.keyCode)&&-1===n.keysRight.indexOf(i.keyCode)||(-1===(t=n._keys.indexOf(i.keyCode))&&n._keys.push(i.keyCode),r||i.preventDefault()):-1===n.keysUp.indexOf(i.keyCode)&&-1===n.keysDown.indexOf(i.keyCode)&&-1===n.keysLeft.indexOf(i.keyCode)&&-1===n.keysRight.indexOf(i.keyCode)||(0<=(t=n._keys.indexOf(i.keyCode))&&n._keys.splice(t,1),r||i.preventDefault()))}))},Ls.prototype.detachControl=function(e){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},Ls.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var e=this.camera,t=0;t<this._keys.length;t++){var i=this._keys[t],r=e._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(i)?e._localDirection.copyFromFloats(-r,0,0):-1!==this.keysUp.indexOf(i)?e._localDirection.copyFromFloats(0,0,r):-1!==this.keysRight.indexOf(i)?e._localDirection.copyFromFloats(r,0,0):-1!==this.keysDown.indexOf(i)&&e._localDirection.copyFromFloats(0,0,-r),e.getScene().useRightHandedSystem&&(e._localDirection.z*=-1),e.getViewMatrix().invertToRef(e._cameraTransformMatrix),te.TransformNormalToRef(e._localDirection,e._cameraTransformMatrix,e._transformedDirection),e.cameraDirection.addInPlace(e._transformedDirection)}},Ls.prototype.getClassName=function(){return"FreeCameraKeyboardMoveInput"},Ls.prototype._onLostFocus=function(){this._keys=[]},Ls.prototype.getSimpleName=function(){return"keyboard"},o([z()],Ls.prototype,"keysUp",void 0),o([z()],Ls.prototype,"keysDown",void 0),o([z()],Ls.prototype,"keysLeft",void 0),o([z()],Ls.prototype,"keysRight",void 0),Ls);function Ls(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this._keys=new Array}Is.FreeCameraKeyboardMoveInput=ws;var Fs=(Ns.prototype.attachControl=function(o,s){var a=this,h=this.camera.getEngine();this._pointerInput||(this._pointerInput=function(e){var t=e.event;if(!h.isInVRExclusivePointerMode&&(a.touchEnabled||"touch"!==t.pointerType)&&(e.type===Xr.POINTERMOVE||-1!==a.buttons.indexOf(t.button))){var i=t.srcElement||t.target;if(e.type===Xr.POINTERDOWN&&i){try{i.setPointerCapture(t.pointerId)}catch(e){}a.previousPosition={x:t.clientX,y:t.clientY},s||(t.preventDefault(),o.focus())}else if(e.type===Xr.POINTERUP&&i){try{i.releasePointerCapture(t.pointerId)}catch(e){}a.previousPosition=null,s||t.preventDefault()}else if(e.type===Xr.POINTERMOVE){if(!a.previousPosition||h.isPointerLock)return;var r=t.clientX-a.previousPosition.x,n=t.clientY-a.previousPosition.y;a.camera.getScene().useRightHandedSystem&&(r*=-1),a.camera.parent&&a.camera.parent._getWorldMatrixDeterminant()<0&&(r*=-1),a._allowCameraRotation&&(a.camera.cameraRotation.y+=r/a.angularSensibility,a.camera.cameraRotation.x+=n/a.angularSensibility),a.onPointerMovedObservable.notifyObservers({offsetX:r,offsetY:n}),a.previousPosition={x:t.clientX,y:t.clientY},s||t.preventDefault()}}}),this._onMouseMove=function(e){var t,i;h.isPointerLock&&(h.isInVRExclusivePointerMode||(t=e.movementX||e.mozMovementX||e.webkitMovementX||e.msMovementX||0,a.camera.getScene().useRightHandedSystem&&(t*=-1),a.camera.parent&&a.camera.parent._getWorldMatrixDeterminant()<0&&(t*=-1),a.camera.cameraRotation.y+=t/a.angularSensibility,i=e.movementY||e.mozMovementY||e.webkitMovementY||e.msMovementY||0,a.camera.cameraRotation.x+=i/a.angularSensibility,a.previousPosition=null,s||e.preventDefault()))},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,Xr.POINTERDOWN|Xr.POINTERUP|Xr.POINTERMOVE),o.addEventListener("mousemove",this._onMouseMove,!1),o.addEventListener("contextmenu",this.onContextMenu.bind(this),!1)},Ns.prototype.onContextMenu=function(e){e.preventDefault()},Ns.prototype.detachControl=function(e){this._observer&&e&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._onMouseMove&&e.removeEventListener("mousemove",this._onMouseMove),this.onContextMenu&&e.removeEventListener("contextmenu",this.onContextMenu),this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this.previousPosition=null)},Ns.prototype.getClassName=function(){return"FreeCameraMouseInput"},Ns.prototype.getSimpleName=function(){return"mouse"},o([z()],Ns.prototype,"buttons",void 0),o([z()],Ns.prototype,"angularSensibility",void 0),Ns);function Ns(e){void 0===e&&(e=!0),this.touchEnabled=e,this.buttons=[0,1,2],this.angularSensibility=2e3,this.previousPosition=null,this.onPointerMovedObservable=new le,this._allowCameraRotation=!0}Is.FreeCameraMouseInput=Fs;var Bs=(ks.prototype.attachControl=function(e,r){var n=this,o=null;void 0===this._pointerInput&&(this._onLostFocus=function(){n._offsetX=null,n._offsetY=null},this._pointerInput=function(e){var t,i=e.event;if("mouse"!==i.pointerType)if(e.type===Xr.POINTERDOWN){if(r||i.preventDefault(),n._pointerPressed.push(i.pointerId),1!==n._pointerPressed.length)return;o={x:i.clientX,y:i.clientY}}else if(e.type===Xr.POINTERUP){if(r||i.preventDefault(),-1===(t=n._pointerPressed.indexOf(i.pointerId)))return;if(n._pointerPressed.splice(t,1),0!=t)return;o=null,n._offsetX=null,n._offsetY=null}else if(e.type===Xr.POINTERMOVE){if(r||i.preventDefault(),!o)return;if(0!=(t=n._pointerPressed.indexOf(i.pointerId)))return;n._offsetX=i.clientX-o.x,n._offsetY=-(i.clientY-o.y)}}),this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,Xr.POINTERDOWN|Xr.POINTERUP|Xr.POINTERMOVE),this._onLostFocus&&e.addEventListener("blur",this._onLostFocus)},ks.prototype.detachControl=function(e){this._pointerInput&&e&&(this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null),this._onLostFocus&&(e.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null),this._pointerPressed=[],this._offsetX=null,this._offsetY=null)},ks.prototype.checkInputs=function(){var e,t,i;this._offsetX&&this._offsetY&&((e=this.camera).cameraRotation.y+=this._offsetX/this.touchAngularSensibility,1<this._pointerPressed.length?e.cameraRotation.x+=-this._offsetY/this.touchAngularSensibility:(t=e._computeLocalCameraSpeed(),i=new te(0,0,t*this._offsetY/this.touchMoveSensibility),W.RotationYawPitchRollToRef(e.rotation.y,e.rotation.x,0,e._cameraRotationMatrix),e.cameraDirection.addInPlace(te.TransformCoordinates(i,e._cameraRotationMatrix))))},ks.prototype.getClassName=function(){return"FreeCameraTouchInput"},ks.prototype.getSimpleName=function(){return"touch"},o([z()],ks.prototype,"touchAngularSensibility",void 0),o([z()],ks.prototype,"touchMoveSensibility",void 0),ks);function ks(){this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array}Is.FreeCameraTouchInput=Bs;var Us,Vs=(n(zs,Us=Rs),zs.prototype.addKeyboard=function(){return this.add(new ws),this},zs.prototype.addMouse=function(e){return void 0===e&&(e=!0),this._mouseInput||(this._mouseInput=new Fs(e),this.add(this._mouseInput)),this},zs.prototype.removeMouse=function(){return this._mouseInput&&this.remove(this._mouseInput),this},zs.prototype.addTouch=function(){return this.add(new Bs),this},zs.prototype.clear=function(){Us.prototype.clear.call(this),this._mouseInput=null},zs);function zs(e){var t=Us.call(this,e)||this;return t._mouseInput=null,t}var Ws;n(Gs,Ws=Os),Object.defineProperty(Gs.prototype,"angularSensibility",{get:function(){var e=this.inputs.attached.mouse;return e?e.angularSensibility:0},set:function(e){var t=this.inputs.attached.mouse;t&&(t.angularSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Gs.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysUp=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Gs.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysDown=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Gs.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Gs.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysRight=e)},enumerable:!0,configurable:!0}),Gs.prototype.attachControl=function(e,t){this.inputs.attachElement(e,t)},Gs.prototype.detachControl=function(e){this.inputs.detachElement(e),this.cameraDirection=new te(0,0,0),this.cameraRotation=new H(0,0)},Object.defineProperty(Gs.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(e){this._collisionMask=isNaN(e)?-1:e},enumerable:!0,configurable:!0}),Gs.prototype._collideWithWorld=function(e){var t=this.parent?te.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position;t.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);var i=this.getScene().collisionCoordinator;this._collider||(this._collider=i.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var r=e;this.applyGravity&&(r=e.add(this.getScene().gravity)),i.getNewPosition(this._oldPosition,r,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},Gs.prototype._checkInputs=function(){this._localDirection||(this._localDirection=te.Zero(),this._transformedDirection=te.Zero()),this.inputs.checkInputs(),Ws.prototype._checkInputs.call(this)},Gs.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||0<Math.abs(this.cameraDirection.x)||0<Math.abs(this.cameraDirection.y)||0<Math.abs(this.cameraDirection.z)},Gs.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):Ws.prototype._updatePosition.call(this)},Gs.prototype.dispose=function(){this.inputs.clear(),Ws.prototype.dispose.call(this)},Gs.prototype.getClassName=function(){return"FreeCamera"},o([Z()],Gs.prototype,"ellipsoid",void 0),o([Z()],Gs.prototype,"ellipsoidOffset",void 0),o([z()],Gs.prototype,"checkCollisions",void 0),o([z()],Gs.prototype,"applyGravity",void 0);function Gs(e,t,i,r){void 0===r&&(r=!0);var n=Ws.call(this,e,t,i,r)||this;return n.ellipsoid=new te(.5,1,.5),n.ellipsoidOffset=new te(0,0,0),n.checkCollisions=!1,n.applyGravity=!1,n._needMoveForGravity=!1,n._oldPosition=te.Zero(),n._diffPosition=te.Zero(),n._newPosition=te.Zero(),n._collisionMask=-1,n._onCollisionPositionChange=function(e,t,i){void 0===i&&(i=null);var r;r=t,n._newPosition.copyFrom(r),n._newPosition.subtractToRef(n._oldPosition,n._diffPosition),n._diffPosition.length()>Mi.CollisionsEpsilon&&(n.position.addInPlace(n._diffPosition),n.onCollide&&i&&n.onCollide(i))},n.inputs=new Vs(n),n.inputs.addKeyboard().addMouse(),n}var Xs=(Object.defineProperty(Hs,"ForceFullSceneLoadingForIncremental",{get:function(){return Hs._ForceFullSceneLoadingForIncremental},set:function(e){Hs._ForceFullSceneLoadingForIncremental=e},enumerable:!0,configurable:!0}),Object.defineProperty(Hs,"ShowLoadingScreen",{get:function(){return Hs._ShowLoadingScreen},set:function(e){Hs._ShowLoadingScreen=e},enumerable:!0,configurable:!0}),Object.defineProperty(Hs,"loggingLevel",{get:function(){return Hs._loggingLevel},set:function(e){Hs._loggingLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(Hs,"CleanBoneMatrixWeights",{get:function(){return Hs._CleanBoneMatrixWeights},set:function(e){Hs._CleanBoneMatrixWeights=e},enumerable:!0,configurable:!0}),Hs._ForceFullSceneLoadingForIncremental=!1,Hs._ShowLoadingScreen=!0,Hs._CleanBoneMatrixWeights=!1,Hs._loggingLevel=0,Hs);function Hs(){}var js=(Object.defineProperty(Ks.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(e){this._boundingBias?this._boundingBias.copyFrom(e):this._boundingBias=e.clone(),this._updateBoundingInfo(!0,null)},enumerable:!0,configurable:!0}),Ks.CreateGeometryForMesh=function(e){var t=new Ks(Ks.RandomId(),e.getScene());return t.applyToMesh(e),t},Object.defineProperty(Ks.prototype,"extend",{get:function(){return this._extend},enumerable:!0,configurable:!0}),Ks.prototype.getScene=function(){return this._scene},Ks.prototype.getEngine=function(){return this._engine},Ks.prototype.isReady=function(){return 1===this.delayLoadState||0===this.delayLoadState},Object.defineProperty(Ks.prototype,"doNotSerialize",{get:function(){for(var e=0;e<this._meshes.length;e++)if(!this._meshes[e].doNotSerialize)return!1;return!0},enumerable:!0,configurable:!0}),Ks.prototype._rebuild=function(){for(var e in this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._vertexBuffers)this._vertexBuffers[e]._rebuild()},Ks.prototype.setAllVerticesData=function(e,t){e.applyToGeometry(this,t),this.notifyUpdate()},Ks.prototype.setVerticesData=function(e,t,i,r){void 0===i&&(i=!1);var n=new Si(this._engine,t,e,i,0===this._meshes.length,r);this.setVerticesBuffer(n)},Ks.prototype.removeVerticesData=function(e){this._vertexBuffers[e]&&(this._vertexBuffers[e].dispose(),delete this._vertexBuffers[e])},Ks.prototype.setVerticesBuffer=function(e,t){void 0===t&&(t=null);var i=e.getKind();if(this._vertexBuffers[i]&&this._vertexBuffers[i].dispose(),this._vertexBuffers[i]=e,i===Si.PositionKind){var r=e.getData();null!=t?this._totalVertices=t:null!=r&&(this._totalVertices=r.length/(e.byteStride/4)),this._updateExtend(r),this._resetPointsArrayCache();for(var n=this._meshes,o=n.length,s=0;s<o;s++){var a=n[s];a._boundingInfo=new Gi(this._extend.minimum,this._extend.maximum),a._createGlobalSubMesh(!1),a.computeWorldMatrix(!0)}}this.notifyUpdate(i),this._vertexArrayObjects&&(this._disposeVertexArrayObjects(),this._vertexArrayObjects={})},Ks.prototype.updateVerticesDataDirectly=function(e,t,i,r){void 0===r&&(r=!1);var n=this.getVertexBuffer(e);n&&(n.updateDirectly(t,i,r),this.notifyUpdate(e))},Ks.prototype.updateVerticesData=function(e,t,i){void 0===i&&(i=!1);var r=this.getVertexBuffer(e);r&&(r.update(t),e===Si.PositionKind&&this._updateBoundingInfo(i,t),this.notifyUpdate(e))},Ks.prototype._updateBoundingInfo=function(e,t){if(e&&this._updateExtend(t),this._resetPointsArrayCache(),e)for(var i=0,r=this._meshes;i<r.length;i++){var n=r[i];n._boundingInfo?n._boundingInfo.reConstruct(this._extend.minimum,this._extend.maximum):n._boundingInfo=new Gi(this._extend.minimum,this._extend.maximum);for(var o=0,s=n.subMeshes;o<s.length;o++)s[o].refreshBoundingInfo()}},Ks.prototype._bind=function(e,t){var i;e&&(void 0===t&&(t=this._indexBuffer),(i=this.getVertexBuffers())&&(t==this._indexBuffer&&this._vertexArrayObjects?(this._vertexArrayObjects[e.key]||(this._vertexArrayObjects[e.key]=this._engine.recordVertexArrayObject(i,t,e)),this._engine.bindVertexArrayObject(this._vertexArrayObjects[e.key],t)):this._engine.bindBuffers(i,t,e)))},Ks.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},Ks.prototype.getVerticesData=function(e,t,i){var r=this.getVertexBuffer(e);if(!r)return null;var n=r.getData();if(!n)return null;var o=r.getSize()*Si.GetTypeByteLength(r.type),s=this._totalVertices*r.getSize();if(r.type!==Si.FLOAT||r.byteStride!==o){var a=[];return r.forEach(s,function(e){return a.push(e)}),a}if((n instanceof Array||n instanceof Float32Array)&&0===r.byteOffset&&n.length===s)return i||t&&1!==this._meshes.length?ri.Slice(n):n;if(n instanceof Array){var h=r.byteOffset/4;return ri.Slice(n,h,h+s)}if(n instanceof ArrayBuffer)return new Float32Array(n,r.byteOffset,s);if(h=n.byteOffset+r.byteOffset,i||t&&1!==this._meshes.length){var l=new Float32Array(s),u=new Float32Array(n.buffer,h,s);return l.set(u),l}return new Float32Array(n.buffer,h,s)},Ks.prototype.isVertexBufferUpdatable=function(e){var t=this._vertexBuffers[e];return!!t&&t.isUpdatable()},Ks.prototype.getVertexBuffer=function(e){return this.isReady()?this._vertexBuffers[e]:null},Ks.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},Ks.prototype.isVerticesDataPresent=function(e){return this._vertexBuffers?void 0!==this._vertexBuffers[e]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},Ks.prototype.getVerticesDataKinds=function(){var e,t=[];if(!this._vertexBuffers&&this._delayInfo)for(e in this._delayInfo)t.push(e);else for(e in this._vertexBuffers)t.push(e);return t},Ks.prototype.updateIndices=function(e,t,i){if(void 0===i&&(i=!1),this._indexBuffer)if(this._indexBufferIsUpdatable){var r=e.length!==this._indices.length;if(i||(this._indices=e.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,e,t),r)for(var n=0,o=this._meshes;n<o.length;n++)o[n]._createGlobalSubMesh(!0)}else this.setIndices(e,null,!0)},Ks.prototype.setIndices=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=!1),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._disposeVertexArrayObjects(),this._indices=e,this._indexBufferIsUpdatable=i,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,i)),null!=t&&(this._totalVertices=t);for(var r=0,n=this._meshes;r<n.length;r++)n[r]._createGlobalSubMesh(!0);this.notifyUpdate()},Ks.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},Ks.prototype.getIndices=function(e,t){if(!this.isReady())return null;var i=this._indices;if(t||e&&1!==this._meshes.length){for(var r=i.length,n=[],o=0;o<r;o++)n.push(i[o]);return n}return i},Ks.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},Ks.prototype._releaseVertexArrayObject=function(e){void 0===e&&(e=null),e&&this._vertexArrayObjects&&this._vertexArrayObjects[e.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e.key]),delete this._vertexArrayObjects[e.key])},Ks.prototype.releaseForMesh=function(e,t){var i=this._meshes,r=i.indexOf(e);-1!==r&&(i.splice(r,1),e._geometry=null,0===i.length&&t&&this.dispose())},Ks.prototype.applyToMesh=function(e){var t,i;e._geometry!==this&&((t=e._geometry)&&t.releaseForMesh(e),i=this._meshes,(e._geometry=this)._scene.pushGeometry(this),i.push(e),this.isReady()?this._applyToMesh(e):e._boundingInfo=this._boundingInfo)},Ks.prototype._updateExtend=function(e){void 0===e&&(e=null),e=e||this.getVerticesData(Si.PositionKind),this._extend=ji(e,0,this._totalVertices,this.boundingBias,3)},Ks.prototype._applyToMesh=function(e){var t=this._meshes.length;for(var i in this._vertexBuffers){1===t&&this._vertexBuffers[i].create();var r=this._vertexBuffers[i].getBuffer();r&&(r.references=t),i===Si.PositionKind&&(this._extend||this._updateExtend(),e._boundingInfo=new Gi(this._extend.minimum,this._extend.maximum),e._createGlobalSubMesh(!1),e._updateBoundingInfo())}1===t&&this._indices&&0<this._indices.length&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=t),e._syncGeometryWithMorphTargetManager(),e.synchronizeInstances()},Ks.prototype.notifyUpdate=function(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e);for(var t=0,i=this._meshes;t<i.length;t++)i[t]._markSubMeshesAsAttributesDirty()},Ks.prototype.load=function(e,t){2!==this.delayLoadState&&(this.isReady()?t&&t():(this.delayLoadState=2,this._queueLoad(e,t)))},Ks.prototype._queueLoad=function(n,o){var s=this;this.delayLoadingFile&&(n._addPendingData(this),n._loadFile(this.delayLoadingFile,function(e){if(s._delayLoadingFunction){s._delayLoadingFunction(JSON.parse(e),s),s.delayLoadState=1,s._delayInfo=[],n._removePendingData(s);for(var t=s._meshes,i=t.length,r=0;r<i;r++)s._applyToMesh(t[r]);o&&o()}},void 0,!0))},Ks.prototype.toLeftHanded=function(){var e=this.getIndices(!1);if(null!=e&&0<e.length){for(var t=0;t<e.length;t+=3){var i=e[t+0];e[t+0]=e[t+2],e[t+2]=i}this.setIndices(e)}var r=this.getVerticesData(Si.PositionKind,!1);if(null!=r&&0<r.length){for(t=0;t<r.length;t+=3)r[t+2]=-r[t+2];this.setVerticesData(Si.PositionKind,r,!1)}var n=this.getVerticesData(Si.NormalKind,!1);if(null!=n&&0<n.length){for(t=0;t<n.length;t+=3)n[t+2]=-n[t+2];this.setVerticesData(Si.NormalKind,n,!1)}},Ks.prototype._resetPointsArrayCache=function(){this._positions=null},Ks.prototype._generatePointsArray=function(){if(this._positions)return!0;var e=this.getVerticesData(Si.PositionKind);if(!e||0===e.length)return!1;this._positions=[];for(var t=0;t<e.length;t+=3)this._positions.push(te.FromArray(e,t));return!0},Ks.prototype.isDisposed=function(){return this._isDisposed},Ks.prototype._disposeVertexArrayObjects=function(){if(this._vertexArrayObjects){for(var e in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e]);this._vertexArrayObjects={}}},Ks.prototype.dispose=function(){for(var e=this._meshes,t=e.length,i=0;i<t;i++)this.releaseForMesh(e[i]);for(var r in this._meshes=[],this._disposeVertexArrayObjects(),this._vertexBuffers)this._vertexBuffers[r].dispose();this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},Ks.prototype.copy=function(e){var t=new Ri;t.indices=[];var i=this.getIndices();if(i)for(var r=0;r<i.length;r++)t.indices.push(i[r]);var n,o=!1,s=!1;for(n in this._vertexBuffers){var a,h=this.getVerticesData(n);h&&(h instanceof Float32Array?t.set(new Float32Array(h),n):t.set(h.slice(0),n),s||(a=this.getVertexBuffer(n))&&(s=!(o=a.isUpdatable())))}var l=new Ks(e,this._scene,t,o);for(n in l.delayLoadState=this.delayLoadState,l.delayLoadingFile=this.delayLoadingFile,l._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)l._delayInfo=l._delayInfo||[],l._delayInfo.push(n);return l._boundingInfo=new Gi(this._extend.minimum,this._extend.maximum),l},Ks.prototype.serialize=function(){var e={};return e.id=this.id,e.updatable=this._updatable,_&&_.HasTags(this)&&(e.tags=_.GetTags(this)),e},Ks.prototype.toNumberArray=function(e){return Array.isArray(e)?e:Array.prototype.slice.call(e)},Ks.prototype.serializeVerticeData=function(){var e=this.serialize();return this.isVerticesDataPresent(Si.PositionKind)&&(e.positions=this.toNumberArray(this.getVerticesData(Si.PositionKind)),this.isVertexBufferUpdatable(Si.PositionKind)&&(e.positions._updatable=!0)),this.isVerticesDataPresent(Si.NormalKind)&&(e.normals=this.toNumberArray(this.getVerticesData(Si.NormalKind)),this.isVertexBufferUpdatable(Si.NormalKind)&&(e.normals._updatable=!0)),this.isVerticesDataPresent(Si.TangentKind)&&(e.tangets=this.toNumberArray(this.getVerticesData(Si.TangentKind)),this.isVertexBufferUpdatable(Si.TangentKind)&&(e.tangets._updatable=!0)),this.isVerticesDataPresent(Si.UVKind)&&(e.uvs=this.toNumberArray(this.getVerticesData(Si.UVKind)),this.isVertexBufferUpdatable(Si.UVKind)&&(e.uvs._updatable=!0)),this.isVerticesDataPresent(Si.UV2Kind)&&(e.uv2s=this.toNumberArray(this.getVerticesData(Si.UV2Kind)),this.isVertexBufferUpdatable(Si.UV2Kind)&&(e.uv2s._updatable=!0)),this.isVerticesDataPresent(Si.UV3Kind)&&(e.uv3s=this.toNumberArray(this.getVerticesData(Si.UV3Kind)),this.isVertexBufferUpdatable(Si.UV3Kind)&&(e.uv3s._updatable=!0)),this.isVerticesDataPresent(Si.UV4Kind)&&(e.uv4s=this.toNumberArray(this.getVerticesData(Si.UV4Kind)),this.isVertexBufferUpdatable(Si.UV4Kind)&&(e.uv4s._updatable=!0)),this.isVerticesDataPresent(Si.UV5Kind)&&(e.uv5s=this.toNumberArray(this.getVerticesData(Si.UV5Kind)),this.isVertexBufferUpdatable(Si.UV5Kind)&&(e.uv5s._updatable=!0)),this.isVerticesDataPresent(Si.UV6Kind)&&(e.uv6s=this.toNumberArray(this.getVerticesData(Si.UV6Kind)),this.isVertexBufferUpdatable(Si.UV6Kind)&&(e.uv6s._updatable=!0)),this.isVerticesDataPresent(Si.ColorKind)&&(e.colors=this.toNumberArray(this.getVerticesData(Si.ColorKind)),this.isVertexBufferUpdatable(Si.ColorKind)&&(e.colors._updatable=!0)),this.isVerticesDataPresent(Si.MatricesIndicesKind)&&(e.matricesIndices=this.toNumberArray(this.getVerticesData(Si.MatricesIndicesKind)),e.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(Si.MatricesIndicesKind)&&(e.matricesIndices._updatable=!0)),this.isVerticesDataPresent(Si.MatricesWeightsKind)&&(e.matricesWeights=this.toNumberArray(this.getVerticesData(Si.MatricesWeightsKind)),this.isVertexBufferUpdatable(Si.MatricesWeightsKind)&&(e.matricesWeights._updatable=!0)),e.indices=this.toNumberArray(this.getIndices()),e},Ks.ExtractFromMesh=function(e,t){var i=e._geometry;return i?i.copy(t):null},Ks.RandomId=function(){return ri.RandomId()},Ks._ImportGeometry=function(e,t){var i=t.getScene(),r=e.geometryId;if(r){var n=i.getGeometryByID(r);n&&n.applyToMesh(t)}else if(e instanceof ArrayBuffer){var o,s,a,h,l,u,c,d,f,p,_,g,m=t._binaryInfo;if(m.positionsAttrDesc&&0<m.positionsAttrDesc.count&&(o=new Float32Array(e,m.positionsAttrDesc.offset,m.positionsAttrDesc.count),t.setVerticesData(Si.PositionKind,o,!1)),m.normalsAttrDesc&&0<m.normalsAttrDesc.count&&(s=new Float32Array(e,m.normalsAttrDesc.offset,m.normalsAttrDesc.count),t.setVerticesData(Si.NormalKind,s,!1)),m.tangetsAttrDesc&&0<m.tangetsAttrDesc.count&&(a=new Float32Array(e,m.tangetsAttrDesc.offset,m.tangetsAttrDesc.count),t.setVerticesData(Si.TangentKind,a,!1)),m.uvsAttrDesc&&0<m.uvsAttrDesc.count&&(h=new Float32Array(e,m.uvsAttrDesc.offset,m.uvsAttrDesc.count),t.setVerticesData(Si.UVKind,h,!1)),m.uvs2AttrDesc&&0<m.uvs2AttrDesc.count&&(l=new Float32Array(e,m.uvs2AttrDesc.offset,m.uvs2AttrDesc.count),t.setVerticesData(Si.UV2Kind,l,!1)),m.uvs3AttrDesc&&0<m.uvs3AttrDesc.count&&(u=new Float32Array(e,m.uvs3AttrDesc.offset,m.uvs3AttrDesc.count),t.setVerticesData(Si.UV3Kind,u,!1)),m.uvs4AttrDesc&&0<m.uvs4AttrDesc.count&&(c=new Float32Array(e,m.uvs4AttrDesc.offset,m.uvs4AttrDesc.count),t.setVerticesData(Si.UV4Kind,c,!1)),m.uvs5AttrDesc&&0<m.uvs5AttrDesc.count&&(d=new Float32Array(e,m.uvs5AttrDesc.offset,m.uvs5AttrDesc.count),t.setVerticesData(Si.UV5Kind,d,!1)),m.uvs6AttrDesc&&0<m.uvs6AttrDesc.count&&(f=new Float32Array(e,m.uvs6AttrDesc.offset,m.uvs6AttrDesc.count),t.setVerticesData(Si.UV6Kind,f,!1)),m.colorsAttrDesc&&0<m.colorsAttrDesc.count&&(p=new Float32Array(e,m.colorsAttrDesc.offset,m.colorsAttrDesc.count),t.setVerticesData(Si.ColorKind,p,!1,m.colorsAttrDesc.stride)),m.matricesIndicesAttrDesc&&0<m.matricesIndicesAttrDesc.count){for(var v=new Int32Array(e,m.matricesIndicesAttrDesc.offset,m.matricesIndicesAttrDesc.count),y=[],b=0;b<v.length;b++){var T=v[b];y.push(255&T),y.push((65280&T)>>8),y.push((16711680&T)>>16),y.push(T>>24)}t.setVerticesData(Si.MatricesIndicesKind,y,!1)}if(m.matricesWeightsAttrDesc&&0<m.matricesWeightsAttrDesc.count&&(_=new Float32Array(e,m.matricesWeightsAttrDesc.offset,m.matricesWeightsAttrDesc.count),t.setVerticesData(Si.MatricesWeightsKind,_,!1)),m.indicesAttrDesc&&0<m.indicesAttrDesc.count&&(g=new Int32Array(e,m.indicesAttrDesc.offset,m.indicesAttrDesc.count),t.setIndices(g,null)),m.subMeshesAttrDesc&&0<m.subMeshesAttrDesc.count){var x=new Int32Array(e,m.subMeshesAttrDesc.offset,5*m.subMeshesAttrDesc.count);for(t.subMeshes=[],b=0;b<m.subMeshesAttrDesc.count;b++){var E=x[5*b+0],A=x[5*b+1],M=x[5*b+2],C=x[5*b+3],P=x[5*b+4];Or.AddToMesh(E,A,M,C,P,t)}}}else if(e.positions&&e.normals&&e.indices){if(t.setVerticesData(Si.PositionKind,e.positions,e.positions._updatable),t.setVerticesData(Si.NormalKind,e.normals,e.normals._updatable),e.tangents&&t.setVerticesData(Si.TangentKind,e.tangents,e.tangents._updatable),e.uvs&&t.setVerticesData(Si.UVKind,e.uvs,e.uvs._updatable),e.uvs2&&t.setVerticesData(Si.UV2Kind,e.uvs2,e.uvs2._updatable),e.uvs3&&t.setVerticesData(Si.UV3Kind,e.uvs3,e.uvs3._updatable),e.uvs4&&t.setVerticesData(Si.UV4Kind,e.uvs4,e.uvs4._updatable),e.uvs5&&t.setVerticesData(Si.UV5Kind,e.uvs5,e.uvs5._updatable),e.uvs6&&t.setVerticesData(Si.UV6Kind,e.uvs6,e.uvs6._updatable),e.colors&&t.setVerticesData(Si.ColorKind,K.CheckColors4(e.colors,e.positions.length/3),e.colors._updatable),e.matricesIndices)if(e.matricesIndices._isExpanded)delete e.matricesIndices._isExpanded,t.setVerticesData(Si.MatricesIndicesKind,e.matricesIndices,e.matricesIndices._updatable);else{for(y=[],b=0;b<e.matricesIndices.length;b++){var O=e.matricesIndices[b];y.push(255&O),y.push((65280&O)>>8),y.push((16711680&O)>>16),y.push(O>>24)}t.setVerticesData(Si.MatricesIndicesKind,y,e.matricesIndices._updatable)}if(e.matricesIndicesExtra)if(e.matricesIndicesExtra._isExpanded)delete e.matricesIndices._isExpanded,t.setVerticesData(Si.MatricesIndicesExtraKind,e.matricesIndicesExtra,e.matricesIndicesExtra._updatable);else{for(y=[],b=0;b<e.matricesIndicesExtra.length;b++)O=e.matricesIndicesExtra[b],y.push(255&O),y.push((65280&O)>>8),y.push((16711680&O)>>16),y.push(O>>24);t.setVerticesData(Si.MatricesIndicesExtraKind,y,e.matricesIndicesExtra._updatable)}e.matricesWeights&&(Ks._CleanMatricesWeights(e,t),t.setVerticesData(Si.MatricesWeightsKind,e.matricesWeights,e.matricesWeights._updatable)),e.matricesWeightsExtra&&t.setVerticesData(Si.MatricesWeightsExtraKind,e.matricesWeightsExtra,e.matricesWeights._updatable),t.setIndices(e.indices,null)}if(e.subMeshes){t.subMeshes=[];for(var S=0;S<e.subMeshes.length;S++){var I=e.subMeshes[S];Or.AddToMesh(I.materialIndex,I.verticesStart,I.verticesCount,I.indexStart,I.indexCount,t)}}t._shouldGenerateFlatShading&&(t.convertToFlatShadedMesh(),delete t._shouldGenerateFlatShading),t.computeWorldMatrix(!0),i.onMeshImportedObservable.notifyObservers(t)},Ks._CleanMatricesWeights=function(e,t){if(Xs.CleanBoneMatrixWeights){var i=0;if(-1<e.skeletonId){var r=t.getScene().getLastSkeletonByID(e.skeletonId);if(r){i=r.bones.length;for(var n=t.getVerticesData(Si.MatricesIndicesKind),o=t.getVerticesData(Si.MatricesIndicesExtraKind),s=e.matricesWeights,a=e.matricesWeightsExtra,h=e.numBoneInfluencer,l=s.length,u=0;u<l;u+=4){for(var c=0,d=-1,f=0;f<4;f++)c+=p=s[u+f],p<.001&&d<0&&(d=f);if(a)for(var p,f=0;f<4;f++)c+=p=a[u+f],p<.001&&d<0&&(d=f+4);if((d<0||h-1<d)&&(d=h-1),.001<c){for(var _=1/c,f=0;f<4;f++)s[u+f]*=_;if(a)for(f=0;f<4;f++)a[u+f]*=_}else 4<=d?(a[u+d-4]=1-c,o[u+d-4]=i):(s[u+d]=1-c,n[u+d]=i)}t.setVerticesData(Si.MatricesIndicesKind,n),e.matricesWeightsExtra&&t.setVerticesData(Si.MatricesIndicesExtraKind,o)}}}},Ks.Parse=function(e,t,i){if(t.getGeometryByID(e.id))return null;var r=new Ks(e.id,t,void 0,e.updatable);return _&&_.AddTagsTo(r,e.tags),e.delayLoadingFile?(r.delayLoadState=4,r.delayLoadingFile=i+e.delayLoadingFile,r._boundingInfo=new Gi(te.FromArray(e.boundingBoxMinimum),te.FromArray(e.boundingBoxMaximum)),r._delayInfo=[],e.hasUVs&&r._delayInfo.push(Si.UVKind),e.hasUVs2&&r._delayInfo.push(Si.UV2Kind),e.hasUVs3&&r._delayInfo.push(Si.UV3Kind),e.hasUVs4&&r._delayInfo.push(Si.UV4Kind),e.hasUVs5&&r._delayInfo.push(Si.UV5Kind),e.hasUVs6&&r._delayInfo.push(Si.UV6Kind),e.hasColors&&r._delayInfo.push(Si.ColorKind),e.hasMatricesIndices&&r._delayInfo.push(Si.MatricesIndicesKind),e.hasMatricesWeights&&r._delayInfo.push(Si.MatricesWeightsKind),r._delayLoadingFunction=Ri.ImportVertexData):Ri.ImportVertexData(e,r),t.pushGeometry(r,!0),r},Ks);function Ks(e,t,i,r,n){void 0===r&&(r=!1),void 0===n&&(n=null),this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this.id=e,this.uniqueId=t.getUniqueId(),this._engine=t.getEngine(),this._meshes=[],this._scene=t,this._vertexBuffers={},this._indices=[],this._updatable=r,i?this.setAllVerticesData(i,r):(this._totalVertices=0,this._indices=[]),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),n&&(this.applyToMesh(n),n.computeWorldMatrix(!0))}var Ys,qs=(n(Zs,Ys=Ir),Object.defineProperty(Zs.prototype,"subMaterials",{get:function(){return this._subMaterials},set:function(e){this._subMaterials=e,this._hookArray(e)},enumerable:!0,configurable:!0}),Zs.prototype.getChildren=function(){return this.subMaterials},Zs.prototype._hookArray=function(r){var n=this,o=r.push;r.push=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=o.apply(r,e);return n._markAllSubMeshesAsTexturesDirty(),i};var s=r.splice;r.splice=function(e,t){var i=s.apply(r,[e,t]);return n._markAllSubMeshesAsTexturesDirty(),i}},Zs.prototype.getSubMaterial=function(e){return e<0||e>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[e]},Zs.prototype.getActiveTextures=function(){var e;return(e=Ys.prototype.getActiveTextures.call(this)).concat.apply(e,this.subMaterials.map(function(e){return e?e.getActiveTextures():[]}))},Zs.prototype.getClassName=function(){return"MultiMaterial"},Zs.prototype.isReadyForSubMesh=function(e,t,i){for(var r=0;r<this.subMaterials.length;r++){var n=this.subMaterials[r];if(n){if(n._storeEffectOnSubMeshes){if(!n.isReadyForSubMesh(e,t,i))return!1;continue}if(!n.isReady(e))return!1}}return!0},Zs.prototype.clone=function(e,t){for(var i=new Zs(e,this.getScene()),r=0;r<this.subMaterials.length;r++){var n=null,o=this.subMaterials[r],n=t&&o?o.clone(e+"-"+o.name):this.subMaterials[r];i.subMaterials.push(n)}return i},Zs.prototype.serialize=function(){var e={};e.name=this.name,e.id=this.id,_&&(e.tags=_.GetTags(this)),e.materials=[];for(var t=0;t<this.subMaterials.length;t++){var i=this.subMaterials[t];i?e.materials.push(i.id):e.materials.push(null)}return e},Zs.prototype.dispose=function(e,t,i){var r=this.getScene();if(r){if(i)for(var n=0;n<this.subMaterials.length;n++){var o=this.subMaterials[n];o&&o.dispose(e,t)}0<=(n=r.multiMaterials.indexOf(this))&&r.multiMaterials.splice(n,1),Ys.prototype.dispose.call(this,e,t)}},Zs.ParseMultiMaterial=function(e,t){var i=new Zs(e.name,t);i.id=e.id,_&&_.AddTagsTo(i,e.tags);for(var r=0;r<e.materials.length;r++){var n=e.materials[r];n?i.subMaterials.push(t.getLastMaterialByID(n)):i.subMaterials.push(null)}return i},Zs);function Zs(e,t){var i=Ys.call(this,e,t,!0)||this;return t.multiMaterials.push(i),i.subMaterials=new Array,i._storeEffectOnSubMeshes=!0,i}m.RegisteredTypes["BABYLON.MultiMaterial"]=qs;var Qs,Js=function(e,t){this.distance=e,this.mesh=t},$s=function(){},ea=function(){this.visibleInstances={},this.batchCache=new ta,this.instancesBufferSize=2048},ta=function(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array,this.hardwareInstancedRendering=new Array},ia=function(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._morphTargetManager=null},ra=(n(na,Qs=Zi),na._GetDefaultSideOrientation=function(e){return e||na.FRONTSIDE},Object.defineProperty(na.prototype,"onBeforeRenderObservable",{get:function(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new le),this._internalMeshDataInfo._onBeforeRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(na.prototype,"onBeforeBindObservable",{get:function(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new le),this._internalMeshDataInfo._onBeforeBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(na.prototype,"onAfterRenderObservable",{get:function(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new le),this._internalMeshDataInfo._onAfterRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(na.prototype,"onBeforeDrawObservable",{get:function(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new le),this._internalMeshDataInfo._onBeforeDrawObservable},enumerable:!0,configurable:!0}),Object.defineProperty(na.prototype,"onBeforeDraw",{set:function(e){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(na.prototype,"hasInstances",{get:function(){return 0<this.instances.length},enumerable:!0,configurable:!0}),Object.defineProperty(na.prototype,"morphTargetManager",{get:function(){return this._internalMeshDataInfo._morphTargetManager},set:function(e){this._internalMeshDataInfo._morphTargetManager!==e&&(this._internalMeshDataInfo._morphTargetManager=e,this._syncGeometryWithMorphTargetManager())},enumerable:!0,configurable:!0}),Object.defineProperty(na.prototype,"source",{get:function(){return this._internalMeshDataInfo._source},enumerable:!0,configurable:!0}),Object.defineProperty(na.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(e){this._unIndexed!==e&&(this._unIndexed=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(na.prototype,"worldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.instancesData},enumerable:!0,configurable:!0}),Object.defineProperty(na.prototype,"manualUpdateOfWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.manualUpdate},set:function(e){this._instanceDataStorage.manualUpdate=e},enumerable:!0,configurable:!0}),na.prototype.instantiateHierarchy=function(e,t,i){void 0===e&&(e=null);var r=!(0<this.getTotalVertices())||t&&t.doNotInstantiate?this.clone("Clone of "+(this.name||this.id),e||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));r&&(r.parent=e||this.parent,r.position=this.position.clone(),r.scaling=this.scaling.clone(),this.rotationQuaternion?r.rotationQuaternion=this.rotationQuaternion.clone():r.rotation=this.rotation.clone(),i&&i(this,r));for(var n=0,o=this.getChildTransformNodes(!0);n<o.length;n++)o[n].instantiateHierarchy(r,t,i);return r},na.prototype.getClassName=function(){return"Mesh"},Object.defineProperty(na.prototype,"_isMesh",{get:function(){return!0},enumerable:!0,configurable:!0}),na.prototype.toString=function(e){var t,i,r=Qs.prototype.toString.call(this,e);if(r+=", n vertices: "+this.getTotalVertices(),r+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var n=0;n<this.animations.length;n++)r+=", animation[0]: "+this.animations[n].toString(e);return e&&(this._geometry?(t=this.getIndices(),(i=this.getVerticesData(Si.PositionKind))&&t&&(r+=", flat shading: "+(i.length/3===t.length?"YES":"NO"))):r+=", flat shading: UNKNOWN"),r},na.prototype._unBindEffect=function(){Qs.prototype._unBindEffect.call(this);for(var e=0,t=this.instances;e<t.length;e++)t[e]._unBindEffect()},Object.defineProperty(na.prototype,"hasLODLevels",{get:function(){return 0<this._internalMeshDataInfo._LODLevels.length},enumerable:!0,configurable:!0}),na.prototype.getLODLevels=function(){return this._internalMeshDataInfo._LODLevels},na.prototype._sortLODLevels=function(){this._internalMeshDataInfo._LODLevels.sort(function(e,t){return e.distance<t.distance?1:e.distance>t.distance?-1:0})},na.prototype.addLODLevel=function(e,t){if(t&&t._masterMesh)return fe.Warn("You cannot use a mesh as LOD level twice"),this;var i=new Js(e,t);return this._internalMeshDataInfo._LODLevels.push(i),t&&(t._masterMesh=this),this._sortLODLevels(),this},na.prototype.getLODLevelAtDistance=function(e){for(var t=this._internalMeshDataInfo,i=0;i<t._LODLevels.length;i++){var r=t._LODLevels[i];if(r.distance===e)return r.mesh}return null},na.prototype.removeLODLevel=function(e){for(var t=this._internalMeshDataInfo,i=0;i<t._LODLevels.length;i++)t._LODLevels[i].mesh===e&&(t._LODLevels.splice(i,1),e&&(e._masterMesh=null));return this._sortLODLevels(),this},na.prototype.getLOD=function(e,t){var i=this._internalMeshDataInfo;if(!i._LODLevels||0===i._LODLevels.length)return this;var r=(t||this.getBoundingInfo().boundingSphere).centerWorld.subtract(e.globalPosition).length();if(i._LODLevels[i._LODLevels.length-1].distance>r)return this.onLODLevelSelection&&this.onLODLevelSelection(r,this,this),this;for(var n=0;n<i._LODLevels.length;n++){var o=i._LODLevels[n];if(o.distance<r)return o.mesh&&(o.mesh._preActivate(),o.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)),this.onLODLevelSelection&&this.onLODLevelSelection(r,this,o.mesh),o.mesh}return this.onLODLevelSelection&&this.onLODLevelSelection(r,this,this),this},Object.defineProperty(na.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),na.prototype.getTotalVertices=function(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()},na.prototype.getVerticesData=function(e,t,i){return this._geometry?this._geometry.getVerticesData(e,t,i):null},na.prototype.getVertexBuffer=function(e){return this._geometry?this._geometry.getVertexBuffer(e):null},na.prototype.isVerticesDataPresent=function(e){return this._geometry?this._geometry.isVerticesDataPresent(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},na.prototype.isVertexBufferUpdatable=function(e){return this._geometry?this._geometry.isVertexBufferUpdatable(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},na.prototype.getVerticesDataKinds=function(){if(this._geometry)return this._geometry.getVerticesDataKinds();var t=new Array;return this._delayInfo&&this._delayInfo.forEach(function(e){t.push(e)}),t},na.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},na.prototype.getIndices=function(e,t){return this._geometry?this._geometry.getIndices(e,t):[]},Object.defineProperty(na.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!0,configurable:!0}),na.prototype.isReady=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),2===this.delayLoadState)return!1;if(!Qs.prototype.isReady.call(this,e))return!1;if(!this.subMeshes||0===this.subMeshes.length)return!0;if(!e)return!0;var i=this.getEngine(),r=this.getScene(),n=t||i.getCaps().instancedArrays&&0<this.instances.length;this.computeWorldMatrix();var o=this.material||r.defaultMaterial;if(o)if(o._storeEffectOnSubMeshes)for(var s=0,a=this.subMeshes;s<a.length;s++){var h=(p=a[s]).getMaterial();if(h)if(h._storeEffectOnSubMeshes){if(!h.isReadyForSubMesh(this,p,n))return!1}else if(!h.isReady(this,n))return!1}else if(!o.isReady(this,n))return!1;for(var l=0,u=this.lightSources;l<u.length;l++){var c=u[l].getShadowGenerator();if(c)for(var d=0,f=this.subMeshes;d<f.length;d++){var p=f[d];if(!c.isReady(p,n))return!1}}for(var _=0,g=this._internalMeshDataInfo._LODLevels;_<g.length;_++){var m=g[_];if(m.mesh&&!m.mesh.isReady(n))return!1}return!0},Object.defineProperty(na.prototype,"areNormalsFrozen",{get:function(){return this._internalMeshDataInfo._areNormalsFrozen},enumerable:!0,configurable:!0}),na.prototype.freezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this},na.prototype.unfreezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this},Object.defineProperty(na.prototype,"overridenInstanceCount",{set:function(e){this._instanceDataStorage.overridenInstanceCount=e},enumerable:!0,configurable:!0}),na.prototype._preActivate=function(){var e=this._internalMeshDataInfo,t=this.getScene().getRenderId();return e._preActivateId===t||(e._preActivateId=t,this._instanceDataStorage.visibleInstances=null),this},na.prototype._preActivateForIntermediateRendering=function(e){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=e),this},na.prototype._registerInstanceForRenderId=function(e,t){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:t,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[t]||(this._instanceDataStorage.visibleInstances[t]=new Array),this._instanceDataStorage.visibleInstances[t].push(e),this},na.prototype.refreshBoundingInfo=function(e){if(void 0===e&&(e=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var t=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getPositionData(e),t),this},na.prototype._createGlobalSubMesh=function(e){var t=this.getTotalVertices();if(!t||!this.getIndices())return null;if(this.subMeshes&&0<this.subMeshes.length){var i=this.getIndices();if(!i)return null;var r=i.length,n=!1;if(e)n=!0;else for(var o=0,s=this.subMeshes;o<s.length;o++){var a=s[o];if(a.indexStart+a.indexCount>=r){n=!0;break}if(a.verticesStart+a.verticesCount>=t){n=!0;break}}if(!n)return this.subMeshes[0]}return this.releaseSubMeshes(),new Or(0,0,t,0,this.getTotalIndices(),this)},na.prototype.subdivide=function(e){if(!(e<1)){for(var t=this.getTotalIndices(),i=t/e|0,r=0;i%3!=0;)i++;this.releaseSubMeshes();for(var n=0;n<e&&!(t<=r);n++)Or.CreateFromIndices(0,r,Math.min(i,t-r),this),r+=i;this.synchronizeInstances()}},na.prototype.setVerticesData=function(e,t,i,r){var n,o;return void 0===i&&(i=!1),this._geometry?this._geometry.setVerticesData(e,t,i,r):((n=new Ri).set(t,e),o=this.getScene(),new js(js.RandomId(),o,n,i,this)),this},na.prototype.removeVerticesData=function(e){this._geometry&&this._geometry.removeVerticesData(e)},na.prototype.markVerticesDataAsUpdatable=function(e,t){void 0===t&&(t=!0);var i=this.getVertexBuffer(e);i&&i.isUpdatable()!==t&&this.setVerticesData(e,this.getVerticesData(e),t)},na.prototype.setVerticesBuffer=function(e){return this._geometry||(this._geometry=js.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(e),this},na.prototype.updateVerticesData=function(e,t,i,r){return this._geometry&&(r?(this.makeGeometryUnique(),this.updateVerticesData(e,t,i,!1)):this._geometry.updateVerticesData(e,t,i)),this},na.prototype.updateMeshPositions=function(e,t){void 0===t&&(t=!0);var i=this.getVerticesData(Si.PositionKind);if(!i)return this;if(e(i),this.updateVerticesData(Si.PositionKind,i,!1,!1),t){var r=this.getIndices(),n=this.getVerticesData(Si.NormalKind);if(!n)return this;Ri.ComputeNormals(i,r,n),this.updateVerticesData(Si.NormalKind,n,!1,!1)}return this},na.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;var e=this._geometry,t=this._geometry.copy(js.RandomId());return e.releaseForMesh(this,!0),t.applyToMesh(this),this},na.prototype.setIndices=function(e,t,i){var r,n;return void 0===t&&(t=null),void 0===i&&(i=!1),this._geometry?this._geometry.setIndices(e,t,i):((r=new Ri).indices=e,n=this.getScene(),new js(js.RandomId(),n,r,i,this)),this},na.prototype.updateIndices=function(e,t,i){return void 0===i&&(i=!1),this._geometry&&this._geometry.updateIndices(e,t,i),this},na.prototype.toLeftHanded=function(){return this._geometry&&this._geometry.toLeftHanded(),this},na.prototype._bind=function(e,t,i){if(!this._geometry)return this;var r,n=this.getScene().getEngine();if(this._unIndexed)r=null;else switch(i){case Ir.PointFillMode:r=null;break;case Ir.WireFrameFillMode:r=e._getLinesIndexBuffer(this.getIndices(),n);break;default:r=this._geometry.getIndexBuffer()}return this._geometry._bind(t,r),this},na.prototype._draw=function(e,t,i){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);var r=this.getScene().getEngine();return this._unIndexed||t==Ir.PointFillMode?r.drawArraysType(t,e.verticesStart,e.verticesCount,i):t==Ir.WireFrameFillMode?r.drawElementsType(t,0,e._linesIndexCount,i):r.drawElementsType(t,e.indexStart,e.indexCount,i),this},na.prototype.registerBeforeRender=function(e){return this.onBeforeRenderObservable.add(e),this},na.prototype.unregisterBeforeRender=function(e){return this.onBeforeRenderObservable.removeCallback(e),this},na.prototype.registerAfterRender=function(e){return this.onAfterRenderObservable.add(e),this},na.prototype.unregisterAfterRender=function(e){return this.onAfterRenderObservable.removeCallback(e),this},na.prototype._getInstancesRenderList=function(e,t){if(void 0===t&&(t=!1),this._instanceDataStorage.isFrozen&&this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch;var i,r,n,o=this.getScene(),s=o._isInIntermediateRendering(),a=s?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,h=this._instanceDataStorage.batchCache;return h.mustReturn=!1,h.renderSelf[e]=t||!a&&this.isEnabled()&&this.isVisible,h.visibleInstances[e]=null,this._instanceDataStorage.visibleInstances&&!t&&(i=this._instanceDataStorage.visibleInstances,r=o.getRenderId(),n=s?i.intermediateDefaultRenderId:i.defaultRenderId,h.visibleInstances[e]=i[r],!h.visibleInstances[e]&&n&&(h.visibleInstances[e]=i[n])),h.hardwareInstancedRendering[e]=!t&&this._instanceDataStorage.hardwareInstancedRendering&&null!==h.visibleInstances[e]&&void 0!==h.visibleInstances[e],this._instanceDataStorage.previousBatch=h},na.prototype._renderWithInstances=function(e,t,i,r,n){var o=i.visibleInstances[e._id];if(!o)return this;for(var s=this._instanceDataStorage,a=s.instancesBufferSize,h=s.instancesBuffer,l=16*(o.length+1)*4;s.instancesBufferSize<l;)s.instancesBufferSize*=2;s.instancesData&&a==s.instancesBufferSize||(s.instancesData=new Float32Array(s.instancesBufferSize/4));var u=0,c=0,d=i.renderSelf[e._id];if(this._instanceDataStorage.manualUpdate)c=(d?1:0)+o.length;else{var f=this._effectiveMesh.getWorldMatrix();if(d&&(f.copyToArray(s.instancesData,u),u+=16,c++),o)for(var p=0;p<o.length;p++)o[p].getWorldMatrix().copyToArray(s.instancesData,u),u+=16,c++}return h&&a==s.instancesBufferSize?h.updateDirectly(s.instancesData,0,c):(h&&h.dispose(),h=new Pi(n,s.instancesData,!0,16,!1,!0),s.instancesBuffer=h,this.setVerticesBuffer(h.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(h.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(h.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(h.createVertexBuffer("world3",12,4))),this._processInstancedBuffers(o,d),this.getScene()._activeIndices.addCount(e.indexCount*c,!1),this._bind(e,r,t),this._draw(e,t,c),n.unbindInstanceAttributes(),this},na.prototype._processInstancedBuffers=function(e,t){},na.prototype._processRendering=function(e,t,i,r,n,o,s){var a=this.getScene(),h=a.getEngine();if(n)this._renderWithInstances(e,i,r,t,h);else{var l=0;r.renderSelf[e._id]&&(o&&o(!1,this._effectiveMesh.getWorldMatrix(),s),l++,this._draw(e,i,this._instanceDataStorage.overridenInstanceCount));var u=r.visibleInstances[e._id];if(u){var c=u.length;l+=c;for(var d=0;d<c;d++){var f=u[d].getWorldMatrix();o&&o(!0,f,s),this._draw(e,i)}}a._activeIndices.addCount(e.indexCount*l,!1)}return this},na.prototype._rebuild=function(){this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),Qs.prototype._rebuild.call(this)},na.prototype._freeze=function(){if(this.subMeshes){for(var e=0;e<this.subMeshes.length;e++)this._getInstancesRenderList(e);this._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}},na.prototype._unFreeze=function(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null},na.prototype.render=function(e,t,i){var r=this.getScene();if(this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1,this._checkOcclusionQuery())return this;var n=this._getInstancesRenderList(e._id,!!i);if(n.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);var o=r.getEngine(),s=n.hardwareInstancedRendering[e._id],a=this._instanceDataStorage,h=e.getMaterial();if(!h)return this;if(!a.isFrozen||!this._effectiveMaterial||this._effectiveMaterial!==h){if(h._storeEffectOnSubMeshes){if(!h.isReadyForSubMesh(this,e,s))return this}else if(!h.isReady(this,s))return this;this._effectiveMaterial=h}t&&o.setAlphaMode(this._effectiveMaterial.alphaMode);for(var l,u=0,c=r._beforeRenderingMeshStage;u<c.length;u++)c[u].action(this,e,n);if(!(l=this._effectiveMaterial._storeEffectOnSubMeshes?e.effect:this._effectiveMaterial.getEffect()))return this;var d,f,p=i||this._effectiveMesh;!a.isFrozen&&this._effectiveMaterial.backFaceCulling?(d=p._getWorldMatrixDeterminant(),null==(f=this.overrideMaterialSideOrientation)&&(f=this._effectiveMaterial.sideOrientation),d<0&&(f=f===Ir.ClockWiseSideOrientation?Ir.CounterClockWiseSideOrientation:Ir.ClockWiseSideOrientation),a.sideOrientation=f):f=a.sideOrientation;var _=this._effectiveMaterial._preBind(l,f);this._effectiveMaterial.forceDepthWrite&&o.setDepthWrite(!0);var g=r.forcePointsCloud?Ir.PointFillMode:r.forceWireframe?Ir.WireFrameFillMode:this._effectiveMaterial.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),s||this._bind(e,l,g);var m=p.getWorldMatrix();this._effectiveMaterial._storeEffectOnSubMeshes?this._effectiveMaterial.bindForSubMesh(m,this,e):this._effectiveMaterial.bind(m,this),!this._effectiveMaterial.backFaceCulling&&this._effectiveMaterial.separateCullingPass&&(o.setState(!0,this._effectiveMaterial.zOffset,!1,!_),this._processRendering(e,l,g,n,s,this._onBeforeDraw,this._effectiveMaterial),o.setState(!0,this._effectiveMaterial.zOffset,!1,_)),this._processRendering(e,l,g,n,s,this._onBeforeDraw,this._effectiveMaterial),this._effectiveMaterial.unbind();for(var v=0,y=r._afterRenderingMeshStage;v<y.length;v++)y[v].action(this,e,n);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),this},na.prototype._onBeforeDraw=function(e,t,i){e&&i&&i.bindOnlyWorldMatrix(t)},na.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(Si.MatricesWeightsKind)&&(this.isVerticesDataPresent(Si.MatricesWeightsExtraKind)?this.normalizeSkinWeightsAndExtra():this.normalizeSkinFourWeights())},na.prototype.normalizeSkinFourWeights=function(){for(var e=this.getVerticesData(Si.MatricesWeightsKind),t=e.length,i=0;i<t;i+=4){var r,n=e[i]+e[i+1]+e[i+2]+e[i+3];0===n?e[i]=1:(r=1/n,e[i]*=r,e[i+1]*=r,e[i+2]*=r,e[i+3]*=r)}this.setVerticesData(Si.MatricesWeightsKind,e)},na.prototype.normalizeSkinWeightsAndExtra=function(){for(var e=this.getVerticesData(Si.MatricesWeightsExtraKind),t=this.getVerticesData(Si.MatricesWeightsKind),i=t.length,r=0;r<i;r+=4){var n,o=t[r]+t[r+1]+t[r+2]+t[r+3];0===(o+=e[r]+e[r+1]+e[r+2]+e[r+3])?t[r]=1:(n=1/o,t[r]*=n,t[r+1]*=n,t[r+2]*=n,t[r+3]*=n,e[r]*=n,e[r+1]*=n,e[r+2]*=n,e[r+3]*=n)}this.setVerticesData(Si.MatricesWeightsKind,t),this.setVerticesData(Si.MatricesWeightsKind,e)},na.prototype.validateSkinning=function(){var e=this.getVerticesData(Si.MatricesWeightsExtraKind),t=this.getVerticesData(Si.MatricesWeightsKind);if(null===t||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};for(var i=t.length,r=0,n=0,o=0,s=0,a=null===e?4:8,h=new Array,l=0;l<=a;l++)h[l]=0;for(l=0;l<i;l+=4){for(var u=t[l],c=u,d=0===c?0:1,f=1;f<a;f++){var p=f<4?t[l+f]:e[l+f-4];u<p&&r++,0!==p&&d++,c+=p,u=p}if(h[d]++,o<d&&(o=d),0===c)n++;else{var _=1/c,g=0;for(f=0;f<a;f++)g+=f<4?Math.abs(t[l+f]-t[l+f]*_):Math.abs(e[l+f-4]-e[l+f-4]*_);.001<g&&s++}}for(var m=this.skeleton.bones.length,v=this.getVerticesData(Si.MatricesIndicesKind),y=this.getVerticesData(Si.MatricesIndicesExtraKind),b=0,l=0;l<i;l++)for(f=0;f<a;f++){var T=f<4?v[f]:y[f-4];(m<=T||T<0)&&b++}return{skinned:!0,valid:0===n&&0===s&&0===b,report:"Number of Weights = "+i/4+"\nMaximum influences = "+o+"\nMissing Weights = "+n+"\nNot Sorted = "+r+"\nNot Normalized = "+s+"\nWeightCounts = ["+h+"]\nNumber of bones = "+m+"\nBad Bone Indices = "+b}},na.prototype._checkDelayState=function(){var e=this.getScene();return this._geometry?this._geometry.load(e):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(e)),this},na.prototype._queueLoad=function(t){var i=this;t._addPendingData(this);var e=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return ri.LoadFile(this.delayLoadingFile,function(e){e instanceof ArrayBuffer?i._delayLoadingFunction(e,i):i._delayLoadingFunction(JSON.parse(e),i),i.instances.forEach(function(e){e.refreshBoundingInfo(),e._syncSubMeshes()}),i.delayLoadState=1,t._removePendingData(i)},function(){},t.offlineProvider,e),this},na.prototype.isInFrustum=function(e){return 2!==this.delayLoadState&&!!Qs.prototype.isInFrustum.call(this,e)&&(this._checkDelayState(),!0)},na.prototype.setMaterialByID=function(e){for(var t=this.getScene().materials,i=t.length-1;-1<i;i--)if(t[i].id===e)return this.material=t[i],this;var r=this.getScene().multiMaterials;for(i=r.length-1;-1<i;i--)if(r[i].id===e)return this.material=r[i],this;return this},na.prototype.getAnimatables=function(){var e=new Array;return this.material&&e.push(this.material),this.skeleton&&e.push(this.skeleton),e},na.prototype.bakeTransformIntoVertices=function(e){if(!this.isVerticesDataPresent(Si.PositionKind))return this;var t=this.subMeshes.splice(0);this._resetPointsArrayCache();for(var i=this.getVerticesData(Si.PositionKind),r=new Array,n=0;n<i.length;n+=3)te.TransformCoordinates(te.FromArray(i,n),e).toArray(r,n);if(this.setVerticesData(Si.PositionKind,r,this.getVertexBuffer(Si.PositionKind).isUpdatable()),this.isVerticesDataPresent(Si.NormalKind)){for(i=this.getVerticesData(Si.NormalKind),r=[],n=0;n<i.length;n+=3)te.TransformNormal(te.FromArray(i,n),e).normalize().toArray(r,n);this.setVerticesData(Si.NormalKind,r,this.getVertexBuffer(Si.NormalKind).isUpdatable())}return e.m[0]*e.m[5]*e.m[10]<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=t,this},na.prototype.bakeCurrentTransformIntoVertices=function(e){return void 0===e&&(e=!0),this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(e),this},Object.defineProperty(na.prototype,"_positions",{get:function(){return this._geometry?this._geometry._positions:null},enumerable:!0,configurable:!0}),na.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},na.prototype._generatePointsArray=function(){return!!this._geometry&&this._geometry._generatePointsArray()},na.prototype.clone=function(e,t,i,r){return void 0===e&&(e=""),void 0===t&&(t=null),void 0===r&&(r=!0),new na(e,this.getScene(),t,this,i,r)},na.prototype.dispose=function(e,t){void 0===t&&(t=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);var i=this._internalMeshDataInfo;if(i._onBeforeDrawObservable&&i._onBeforeDrawObservable.clear(),i._onBeforeBindObservable&&i._onBeforeBindObservable.clear(),i._onBeforeRenderObservable&&i._onBeforeRenderObservable.clear(),i._onAfterRenderObservable&&i._onAfterRenderObservable.clear(),this._scene.useClonedMeshMap){if(i.meshMap)for(var r in i.meshMap)(n=i.meshMap[r])&&(n._internalMeshDataInfo._source=null,i.meshMap[r]=void 0);i._source&&i._source._internalMeshDataInfo.meshMap&&(i._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else for(var n,o=0,s=this.getScene().meshes;o<s.length;o++)(n=s[o])._internalMeshDataInfo&&n._internalMeshDataInfo._source&&n._internalMeshDataInfo._source===this&&(n._internalMeshDataInfo._source=null);i._source=null,this._disposeInstanceSpecificData(),Qs.prototype.dispose.call(this,e,t)},na.prototype._disposeInstanceSpecificData=function(){},na.prototype.applyDisplacementMap=function(e,o,s,a,h,l,u){var c=this;void 0===u&&(u=!1);var t=this.getScene();return ri.LoadImage(e,function(e){var t=e.width,i=e.height,r=Ot.CreateCanvas(t,i).getContext("2d");r.drawImage(e,0,0);var n=r.getImageData(0,0,t,i).data;c.applyDisplacementMapFromBuffer(n,t,i,o,s,h,l,u),a&&a(c)},function(){},t.offlineProvider),this},na.prototype.applyDisplacementMapFromBuffer=function(e,t,i,r,n,o,s,a){if(void 0===a&&(a=!1),!this.isVerticesDataPresent(Si.PositionKind)||!this.isVerticesDataPresent(Si.NormalKind)||!this.isVerticesDataPresent(Si.UVKind))return fe.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var h=this.getVerticesData(Si.PositionKind,!0,!0),l=this.getVerticesData(Si.NormalKind),u=this.getVerticesData(Si.UVKind),c=te.Zero(),d=te.Zero(),f=H.Zero();o=o||H.Zero(),s=s||new H(1,1);for(var p=0;p<h.length;p+=3){te.FromArrayToRef(h,p,c),te.FromArrayToRef(l,p,d),H.FromArrayToRef(u,p/3*2,f);var _=4*((Math.abs(f.x*s.x+o.x)*t%t|0)+(Math.abs(f.y*s.y+o.y)*i%i|0)*t),g=e[_]/255*.3+e[1+_]/255*.59+e[2+_]/255*.11;d.normalize(),d.scaleInPlace(r+(n-r)*g),(c=c.add(d)).toArray(h,p)}return Ri.ComputeNormals(h,this.getIndices(),l),a?(this.setVerticesData(Si.PositionKind,h),this.setVerticesData(Si.NormalKind,l)):(this.updateVerticesData(Si.PositionKind,h),this.updateVerticesData(Si.NormalKind,l)),this},na.prototype.convertToFlatShadedMesh=function(){var e,t=this.getVerticesDataKinds(),i={},r={},n={},o=!1;for(d=0;d<t.length;d++){e=t[d];var s=this.getVertexBuffer(e);e!==Si.NormalKind?(i[e]=s,r[e]=i[e].getData(),n[e]=[]):(o=s.isUpdatable(),t.splice(d,1),d--)}for(var a=this.subMeshes.slice(0),h=this.getIndices(),l=this.getTotalIndices(),u=0;u<l;u++)for(var c=h[u],d=0;d<t.length;d++)for(var f=i[e=t[d]].getStrideSize(),p=0;p<f;p++)n[e].push(r[e][c*f+p]);var _=[],g=n[Si.PositionKind];for(u=0;u<l;u+=3){h[u]=u,h[u+1]=u+1,h[u+2]=u+2;for(var m=te.FromArray(g,3*u),v=te.FromArray(g,3*(u+1)),y=te.FromArray(g,3*(u+2)),b=m.subtract(v),T=y.subtract(v),x=te.Normalize(te.Cross(b,T)),E=0;E<3;E++)_.push(x.x),_.push(x.y),_.push(x.z)}for(this.setIndices(h),this.setVerticesData(Si.NormalKind,_,o),d=0;d<t.length;d++)e=t[d],this.setVerticesData(e,n[e],i[e].isUpdatable());this.releaseSubMeshes();for(var A=0;A<a.length;A++){var M=a[A];Or.AddToMesh(M.materialIndex,M.indexStart,M.indexCount,M.indexStart,M.indexCount,this)}return this.synchronizeInstances(),this},na.prototype.convertToUnIndexedMesh=function(){var e,t=this.getVerticesDataKinds(),i={},r={},n={};for(c=0;c<t.length;c++){e=t[c];var o=this.getVertexBuffer(e);i[e]=o,r[e]=i[e].getData(),n[e]=[]}for(var s=this.subMeshes.slice(0),a=this.getIndices(),h=this.getTotalIndices(),l=0;l<h;l++)for(var u=a[l],c=0;c<t.length;c++)for(var d=i[e=t[c]].getStrideSize(),f=0;f<d;f++)n[e].push(r[e][u*d+f]);for(l=0;l<h;l+=3)a[l]=l,a[l+1]=l+1,a[l+2]=l+2;for(this.setIndices(a),c=0;c<t.length;c++)e=t[c],this.setVerticesData(e,n[e],i[e].isUpdatable());this.releaseSubMeshes();for(var p=0;p<s.length;p++){var _=s[p];Or.AddToMesh(_.materialIndex,_.indexStart,_.indexCount,_.indexStart,_.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},na.prototype.flipFaces=function(e){void 0===e&&(e=!1);var t=Ri.ExtractFromMesh(this);if(e&&this.isVerticesDataPresent(Si.NormalKind)&&t.normals)for(r=0;r<t.normals.length;r++)t.normals[r]*=-1;if(t.indices)for(var i,r=0;r<t.indices.length;r+=3)i=t.indices[r+1],t.indices[r+1]=t.indices[r+2],t.indices[r+2]=i;return t.applyToMesh(this,this.isVertexBufferUpdatable(Si.PositionKind)),this},na.prototype.increaseVertices=function(e){var t=Ri.ExtractFromMesh(this),i=t.uvs,r=t.indices,n=t.positions,o=t.normals;if(null===r||null===n||null===o||null===i)fe.Warn("VertexData contains null entries");else{for(var s,a,h=e+1,l=new Array,u=0;u<h+1;u++)l[u]=new Array;for(var c,d=new te(0,0,0),f=new te(0,0,0),p=new H(0,0),_=new Array,g=new Array,m=new Array,v=n.length,y=i.length,u=0;u<r.length;u+=3){g[0]=r[u],g[1]=r[u+1],g[2]=r[u+2];for(var b=0;b<3;b++)if(s=g[b],a=g[(b+1)%3],void 0===m[s]&&void 0===m[a]?(m[s]=new Array,m[a]=new Array):(void 0===m[s]&&(m[s]=new Array),void 0===m[a]&&(m[a]=new Array)),void 0===m[s][a]&&void 0===m[a][s]){m[s][a]=[],d.x=(n[3*a]-n[3*s])/h,d.y=(n[3*a+1]-n[3*s+1])/h,d.z=(n[3*a+2]-n[3*s+2])/h,f.x=(o[3*a]-o[3*s])/h,f.y=(o[3*a+1]-o[3*s+1])/h,f.z=(o[3*a+2]-o[3*s+2])/h,p.x=(i[2*a]-i[2*s])/h,p.y=(i[2*a+1]-i[2*s+1])/h,m[s][a].push(s);for(var T=1;T<h;T++)m[s][a].push(n.length/3),n[v]=n[3*s]+T*d.x,o[v++]=o[3*s]+T*f.x,n[v]=n[3*s+1]+T*d.y,o[v++]=o[3*s+1]+T*f.y,n[v]=n[3*s+2]+T*d.z,o[v++]=o[3*s+2]+T*f.z,i[y++]=i[2*s]+T*p.x,i[y++]=i[2*s+1]+T*p.y;m[s][a].push(a),m[a][s]=new Array,c=m[s][a].length;for(var x=0;x<c;x++)m[a][s][x]=m[s][a][c-1-x]}for(l[0][0]=r[u],l[1][0]=m[r[u]][r[u+1]][1],l[1][1]=m[r[u]][r[u+2]][1],T=2;T<h;T++)for(l[T][0]=m[r[u]][r[u+1]][T],l[T][T]=m[r[u]][r[u+2]][T],d.x=(n[3*l[T][T]]-n[3*l[T][0]])/T,d.y=(n[3*l[T][T]+1]-n[3*l[T][0]+1])/T,d.z=(n[3*l[T][T]+2]-n[3*l[T][0]+2])/T,f.x=(o[3*l[T][T]]-o[3*l[T][0]])/T,f.y=(o[3*l[T][T]+1]-o[3*l[T][0]+1])/T,f.z=(o[3*l[T][T]+2]-o[3*l[T][0]+2])/T,p.x=(i[2*l[T][T]]-i[2*l[T][0]])/T,p.y=(i[2*l[T][T]+1]-i[2*l[T][0]+1])/T,b=1;b<T;b++)l[T][b]=n.length/3,n[v]=n[3*l[T][0]]+b*d.x,o[v++]=o[3*l[T][0]]+b*f.x,n[v]=n[3*l[T][0]+1]+b*d.y,o[v++]=o[3*l[T][0]+1]+b*f.y,n[v]=n[3*l[T][0]+2]+b*d.z,o[v++]=o[3*l[T][0]+2]+b*f.z,i[y++]=i[2*l[T][0]]+b*p.x,i[y++]=i[2*l[T][0]+1]+b*p.y;for(l[h]=m[r[u+1]][r[u+2]],_.push(l[0][0],l[1][0],l[1][1]),T=1;T<h;T++){for(b=0;b<T;b++)_.push(l[T][b],l[T+1][b],l[T+1][b+1]),_.push(l[T][b],l[T+1][b+1],l[T][b+1]);_.push(l[T][b],l[T+1][b],l[T+1][b+1])}}t.indices=_,t.applyToMesh(this,this.isVertexBufferUpdatable(Si.PositionKind))}},na.prototype.forceSharedVertices=function(){var e=Ri.ExtractFromMesh(this),t=e.uvs,i=e.indices,r=e.positions,n=e.colors;if(void 0===i||void 0===r||null===i||null===r)fe.Warn("VertexData contains empty entries");else{for(var o,s,a=new Array,h=new Array,l=new Array,u=new Array,c=new Array,d=0,f=new Array,p=0;p<i.length;p+=3){s=[i[p],i[p+1],i[p+2]],c=new Array;for(var _=0;_<3;_++){c[_]="";for(var g=0;g<3;g++)Math.abs(r[3*s[_]+g])<1e-8&&(r[3*s[_]+g]=0),c[_]+=r[3*s[_]+g]+"|";c[_]=c[_].slice(0,-1)}if(c[0]!=c[1]&&c[0]!=c[2]&&c[1]!=c[2])for(_=0;_<3;_++){if((o=f.indexOf(c[_]))<0){for(f.push(c[_]),o=d++,g=0;g<3;g++)a.push(r[3*s[_]+g]);if(null!=n)for(g=0;g<4;g++)u.push(n[4*s[_]+g]);if(null!=t)for(g=0;g<2;g++)l.push(t[2*s[_]+g])}h.push(o)}}var m=new Array;Ri.ComputeNormals(a,h,m),e.positions=a,e.indices=h,e.normals=m,null!=t&&(e.uvs=l),null!=n&&(e.colors=u),e.applyToMesh(this,this.isVertexBufferUpdatable(Si.PositionKind))}},na._instancedMeshFactory=function(e,t){throw S.WarnImport("InstancedMesh")},na._PhysicsImpostorParser=function(e,t,i){throw S.WarnImport("PhysicsImpostor")},na.prototype.createInstance=function(e){return na._instancedMeshFactory(e,this)},na.prototype.synchronizeInstances=function(){for(var e=0;e<this.instances.length;e++)this.instances[e]._syncSubMeshes();return this},na.prototype.optimizeIndices=function(i){var r=this,n=this.getIndices(),e=this.getVerticesData(Si.PositionKind);if(!e||!n)return this;for(var o=new Array,t=0;t<e.length;t+=3)o.push(te.FromArray(e,t));var s=new Array;return oi.SyncAsyncForLoop(o.length,40,function(e){for(var t=o.length-1-e,i=o[t],r=0;r<t;++r){var n=o[r];if(i.equals(n)){s[t]=r;break}}},function(){for(var e=0;e<n.length;++e)n[e]=s[n[e]]||n[e];var t=r.subMeshes.slice(0);r.setIndices(n),r.subMeshes=t,i&&i(r)}),this},na.prototype.serialize=function(e){e.name=this.name,e.id=this.id,e.type=this.getClassName(),_&&_.HasTags(this)&&(e.tags=_.GetTags(this)),e.position=this.position.asArray(),this.rotationQuaternion?e.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(e.rotation=this.rotation.asArray()),e.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?e.pivotMatrix=this.getPivotMatrix().asArray():e.localMatrix=this.getPivotMatrix().asArray(),e.isEnabled=this.isEnabled(!1),e.isVisible=this.isVisible,e.infiniteDistance=this.infiniteDistance,e.pickable=this.isPickable,e.receiveShadows=this.receiveShadows,e.billboardMode=this.billboardMode,e.visibility=this.visibility,e.checkCollisions=this.checkCollisions,e.isBlocker=this.isBlocker,e.overrideMaterialSideOrientation=this.overrideMaterialSideOrientation,this.parent&&(e.parentId=this.parent.id),e.isUnIndexed=this.isUnIndexed;var t,i=this._geometry;if(i){var r=i.id;e.geometryId=r,e.subMeshes=[];for(var n=0;n<this.subMeshes.length;n++){var o=this.subMeshes[n];e.subMeshes.push({materialIndex:o.materialIndex,verticesStart:o.verticesStart,verticesCount:o.verticesCount,indexStart:o.indexStart,indexCount:o.indexCount})}}this.material?this.material.doNotSerialize||(e.materialId=this.material.id):this.material=null,this.morphTargetManager&&(e.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(e.skeletonId=this.skeleton.id),!this.getScene()._getComponent(Ur.NAME_PHYSICSENGINE)||(t=this.getPhysicsImpostor())&&(e.physicsMass=t.getParam("mass"),e.physicsFriction=t.getParam("friction"),e.physicsRestitution=t.getParam("mass"),e.physicsImpostor=t.type),this.metadata&&(e.metadata=this.metadata),e.instances=[];for(var s=0;s<this.instances.length;s++){var a,h=this.instances[s];h.doNotSerialize||(a={name:h.name,id:h.id,position:h.position.asArray(),scaling:h.scaling.asArray()},h.parent&&(a.parentId=h.parent.id),h.rotationQuaternion?a.rotationQuaternion=h.rotationQuaternion.asArray():h.rotation&&(a.rotation=h.rotation.asArray()),e.instances.push(a),Q.AppendSerializedAnimations(h,a),a.ranges=h.serializeAnimationRanges())}Q.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.layerMask=this.layerMask,e.alphaIndex=this.alphaIndex,e.hasVertexAlpha=this.hasVertexAlpha,e.overlayAlpha=this.overlayAlpha,e.overlayColor=this.overlayColor.asArray(),e.renderOverlay=this.renderOverlay,e.applyFog=this.applyFog,this.actionManager&&(e.actions=this.actionManager.serialize(this.name))},na.prototype._syncGeometryWithMorphTargetManager=function(){if(this.geometry){this._markSubMeshesAsAttributesDirty();var e=this._internalMeshDataInfo._morphTargetManager;if(e&&e.vertexCount){if(e.vertexCount!==this.getTotalVertices())return fe.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);for(var t=0;t<e.numInfluencers;t++){var i=e.getActiveTarget(t),r=i.getPositions();if(!r)return void fe.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(Si.PositionKind+t,r,!1,3);var n=i.getNormals();n&&this.geometry.setVerticesData(Si.NormalKind+t,n,!1,3);var o=i.getTangents();o&&this.geometry.setVerticesData(Si.TangentKind+t,o,!1,3);var s=i.getUVs();s&&this.geometry.setVerticesData(Si.UVKind+"_"+t,s,!1,2)}}else for(t=0;this.geometry.isVerticesDataPresent(Si.PositionKind+t);)this.geometry.removeVerticesData(Si.PositionKind+t),this.geometry.isVerticesDataPresent(Si.NormalKind+t)&&this.geometry.removeVerticesData(Si.NormalKind+t),this.geometry.isVerticesDataPresent(Si.TangentKind+t)&&this.geometry.removeVerticesData(Si.TangentKind+t),this.geometry.isVerticesDataPresent(Si.UVKind+t)&&this.geometry.removeVerticesData(Si.UVKind+"_"+t),t++}},na.Parse=function(e,t,i){var r=e.type&&"GroundMesh"===e.type?na._GroundMeshParser(e,t):new na(e.name,t);if(r.id=e.id,_&&_.AddTagsTo(r,e.tags),r.position=te.FromArray(e.position),void 0!==e.metadata&&(r.metadata=e.metadata),e.rotationQuaternion?r.rotationQuaternion=x.FromArray(e.rotationQuaternion):e.rotation&&(r.rotation=te.FromArray(e.rotation)),r.scaling=te.FromArray(e.scaling),e.localMatrix?r.setPreTransformMatrix(W.FromArray(e.localMatrix)):e.pivotMatrix&&r.setPivotMatrix(W.FromArray(e.pivotMatrix)),r.setEnabled(e.isEnabled),r.isVisible=e.isVisible,r.infiniteDistance=e.infiniteDistance,r.showBoundingBox=e.showBoundingBox,r.showSubMeshesBoundingBox=e.showSubMeshesBoundingBox,void 0!==e.applyFog&&(r.applyFog=e.applyFog),void 0!==e.pickable&&(r.isPickable=e.pickable),void 0!==e.alphaIndex&&(r.alphaIndex=e.alphaIndex),r.receiveShadows=e.receiveShadows,r.billboardMode=e.billboardMode,void 0!==e.visibility&&(r.visibility=e.visibility),r.checkCollisions=e.checkCollisions,r.overrideMaterialSideOrientation=e.overrideMaterialSideOrientation,void 0!==e.isBlocker&&(r.isBlocker=e.isBlocker),r._shouldGenerateFlatShading=e.useFlatShading,e.freezeWorldMatrix&&(r._waitingData.freezeWorldMatrix=e.freezeWorldMatrix),e.parentId&&(r._waitingParentId=e.parentId),void 0!==e.actions&&(r._waitingData.actions=e.actions),void 0!==e.overlayAlpha&&(r.overlayAlpha=e.overlayAlpha),void 0!==e.overlayColor&&(r.overlayColor=Ne.FromArray(e.overlayColor)),void 0!==e.renderOverlay&&(r.renderOverlay=e.renderOverlay),r.isUnIndexed=!!e.isUnIndexed,r.hasVertexAlpha=e.hasVertexAlpha,e.delayLoadingFile?(r.delayLoadState=4,r.delayLoadingFile=i+e.delayLoadingFile,r._boundingInfo=new Gi(te.FromArray(e.boundingBoxMinimum),te.FromArray(e.boundingBoxMaximum)),e._binaryInfo&&(r._binaryInfo=e._binaryInfo),r._delayInfo=[],e.hasUVs&&r._delayInfo.push(Si.UVKind),e.hasUVs2&&r._delayInfo.push(Si.UV2Kind),e.hasUVs3&&r._delayInfo.push(Si.UV3Kind),e.hasUVs4&&r._delayInfo.push(Si.UV4Kind),e.hasUVs5&&r._delayInfo.push(Si.UV5Kind),e.hasUVs6&&r._delayInfo.push(Si.UV6Kind),e.hasColors&&r._delayInfo.push(Si.ColorKind),e.hasMatricesIndices&&r._delayInfo.push(Si.MatricesIndicesKind),e.hasMatricesWeights&&r._delayInfo.push(Si.MatricesWeightsKind),r._delayLoadingFunction=js._ImportGeometry,Xs.ForceFullSceneLoadingForIncremental&&r._checkDelayState()):js._ImportGeometry(e,r),e.materialId?r.setMaterialByID(e.materialId):r.material=null,-1<e.morphTargetManagerId&&(r.morphTargetManager=t.getMorphTargetManagerById(e.morphTargetManagerId)),-1<e.skeletonId&&(r.skeleton=t.getLastSkeletonByID(e.skeletonId),e.numBoneInfluencers&&(r.numBoneInfluencers=e.numBoneInfluencers)),e.animations){for(var n=0;n<e.animations.length;n++){var o=e.animations[n];(l=m.GetClass("BABYLON.Animation"))&&r.animations.push(l.Parse(o))}ci.ParseAnimationRanges(r,e,t)}if(e.autoAnimate&&t.beginAnimation(r,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),e.layerMask&&!isNaN(e.layerMask)?r.layerMask=Math.abs(parseInt(e.layerMask)):r.layerMask=268435455,e.physicsImpostor&&na._PhysicsImpostorParser(t,r,e),e.lodMeshIds&&(r._waitingData.lods={ids:e.lodMeshIds,distances:e.lodDistances?e.lodDistances:null,coverages:e.lodCoverages?e.lodCoverages:null}),e.instances)for(var s=0;s<e.instances.length;s++){var a=e.instances[s],h=r.createInstance(a.name);if(a.id&&(h.id=a.id),_&&(a.tags?_.AddTagsTo(h,a.tags):_.AddTagsTo(h,e.tags)),h.position=te.FromArray(a.position),void 0!==a.metadata&&(h.metadata=a.metadata),a.parentId&&(h._waitingParentId=a.parentId),a.rotationQuaternion?h.rotationQuaternion=x.FromArray(a.rotationQuaternion):a.rotation&&(h.rotation=te.FromArray(a.rotation)),h.scaling=te.FromArray(a.scaling),null!=a.checkCollisions&&null!=a.checkCollisions&&(h.checkCollisions=a.checkCollisions),null!=a.pickable&&null!=a.pickable&&(h.isPickable=a.pickable),null!=a.showBoundingBox&&null!=a.showBoundingBox&&(h.showBoundingBox=a.showBoundingBox),null!=a.showSubMeshesBoundingBox&&null!=a.showSubMeshesBoundingBox&&(h.showSubMeshesBoundingBox=a.showSubMeshesBoundingBox),null!=a.alphaIndex&&null!=a.showSubMeshesBoundingBox&&(h.alphaIndex=a.alphaIndex),a.physicsImpostor&&na._PhysicsImpostorParser(t,h,a),a.animations){for(n=0;n<a.animations.length;n++){var l,o=a.animations[n];(l=m.GetClass("BABYLON.Animation"))&&h.animations.push(l.Parse(o))}ci.ParseAnimationRanges(h,a,t),a.autoAnimate&&t.beginAnimation(h,a.autoAnimateFrom,a.autoAnimateTo,a.autoAnimateLoop,a.autoAnimateSpeed||1)}}return r},na.CreateRibbon=function(e,t,i,r,n,o,s,a,h){throw S.WarnImport("MeshBuilder")},na.CreateDisc=function(e,t,i,r,n,o){throw void 0===r&&(r=null),S.WarnImport("MeshBuilder")},na.CreateBox=function(e,t,i,r,n){throw void 0===i&&(i=null),S.WarnImport("MeshBuilder")},na.CreateSphere=function(e,t,i,r,n,o){throw S.WarnImport("MeshBuilder")},na.CreateHemisphere=function(e,t,i,r){throw S.WarnImport("MeshBuilder")},na.CreateCylinder=function(e,t,i,r,n,o,s,a,h){throw S.WarnImport("MeshBuilder")},na.CreateTorus=function(e,t,i,r,n,o,s){throw S.WarnImport("MeshBuilder")},na.CreateTorusKnot=function(e,t,i,r,n,o,s,a,h,l){throw S.WarnImport("MeshBuilder")},na.CreateLines=function(e,t,i,r,n){throw void 0===i&&(i=null),void 0===r&&(r=!1),void 0===n&&(n=null),S.WarnImport("MeshBuilder")},na.CreateDashedLines=function(e,t,i,r,n,o,s,a){throw void 0===o&&(o=null),S.WarnImport("MeshBuilder")},na.CreatePolygon=function(e,t,i,r,n,o,s){throw void 0===s&&(s=earcut),S.WarnImport("MeshBuilder")},na.ExtrudePolygon=function(e,t,i,r,n,o,s,a){throw void 0===a&&(a=earcut),S.WarnImport("MeshBuilder")},na.ExtrudeShape=function(e,t,i,r,n,o,s,a,h,l){throw void 0===s&&(s=null),S.WarnImport("MeshBuilder")},na.ExtrudeShapeCustom=function(e,t,i,r,n,o,s,a,h,l,u,c){throw S.WarnImport("MeshBuilder")},na.CreateLathe=function(e,t,i,r,n,o,s){throw S.WarnImport("MeshBuilder")},na.CreatePlane=function(e,t,i,r,n){throw S.WarnImport("MeshBuilder")},na.CreateGround=function(e,t,i,r,n,o){throw S.WarnImport("MeshBuilder")},na.CreateTiledGround=function(e,t,i,r,n,o,s,a,h){throw S.WarnImport("MeshBuilder")},na.CreateGroundFromHeightMap=function(e,t,i,r,n,o,s,a,h,l,u){throw S.WarnImport("MeshBuilder")},na.CreateTube=function(e,t,i,r,n,o,s,a,h,l){throw S.WarnImport("MeshBuilder")},na.CreatePolyhedron=function(e,t,i){throw S.WarnImport("MeshBuilder")},na.CreateIcoSphere=function(e,t,i){throw S.WarnImport("MeshBuilder")},na.CreateDecal=function(e,t,i,r,n,o){throw S.WarnImport("MeshBuilder")},na.prototype.setPositionsForCPUSkinning=function(){var e=this._internalMeshDataInfo;if(!e._sourcePositions){var t=this.getVerticesData(Si.PositionKind);if(!t)return e._sourcePositions;e._sourcePositions=new Float32Array(t),this.isVertexBufferUpdatable(Si.PositionKind)||this.setVerticesData(Si.PositionKind,t,!0)}return e._sourcePositions},na.prototype.setNormalsForCPUSkinning=function(){var e=this._internalMeshDataInfo;if(!e._sourceNormals){var t=this.getVerticesData(Si.NormalKind);if(!t)return e._sourceNormals;e._sourceNormals=new Float32Array(t),this.isVertexBufferUpdatable(Si.NormalKind)||this.setVerticesData(Si.NormalKind,t,!0)}return e._sourceNormals},na.prototype.applySkeleton=function(e){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(Si.PositionKind))return this;if(!this.isVerticesDataPresent(Si.NormalKind))return this;if(!this.isVerticesDataPresent(Si.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(Si.MatricesWeightsKind))return this;var t,i=this._internalMeshDataInfo;i._sourcePositions||(t=this.subMeshes.slice(),this.setPositionsForCPUSkinning(),this.subMeshes=t),i._sourceNormals||this.setNormalsForCPUSkinning();var r=this.getVerticesData(Si.PositionKind);if(!r)return this;r instanceof Float32Array||(r=new Float32Array(r));var n=this.getVerticesData(Si.NormalKind);if(!n)return this;n instanceof Float32Array||(n=new Float32Array(n));var o=this.getVerticesData(Si.MatricesIndicesKind),s=this.getVerticesData(Si.MatricesWeightsKind);if(!s||!o)return this;for(var a=4<this.numBoneInfluencers,h=a?this.getVerticesData(Si.MatricesIndicesExtraKind):null,l=a?this.getVerticesData(Si.MatricesWeightsExtraKind):null,u=e.getTransformMatrices(this),c=te.Zero(),d=new W,f=new W,p=0,_=0;_<r.length;_+=3,p+=4){for(var g,m=0;m<4;m++)0<(g=s[p+m])&&(W.FromFloat32ArrayToRefScaled(u,Math.floor(16*o[p+m]),g,f),d.addToSelf(f));if(a)for(m=0;m<4;m++)0<(g=l[p+m])&&(W.FromFloat32ArrayToRefScaled(u,Math.floor(16*h[p+m]),g,f),d.addToSelf(f));te.TransformCoordinatesFromFloatsToRef(i._sourcePositions[_],i._sourcePositions[_+1],i._sourcePositions[_+2],d,c),c.toArray(r,_),te.TransformNormalFromFloatsToRef(i._sourceNormals[_],i._sourceNormals[_+1],i._sourceNormals[_+2],d,c),c.toArray(n,_),d.reset()}return this.updateVerticesData(Si.PositionKind,r),this.updateVerticesData(Si.NormalKind,n),this},na.MinMax=function(e){var i=null,r=null;return e.forEach(function(e){var t=e.getBoundingInfo().boundingBox;i&&r?(i.minimizeInPlace(t.minimumWorld),r.maximizeInPlace(t.maximumWorld)):(i=t.minimumWorld,r=t.maximumWorld)}),i&&r?{min:i,max:r}:{min:te.Zero(),max:te.Zero()}},na.Center=function(e){var t=e instanceof Array?na.MinMax(e):e;return te.Center(t.min,t.max)},na.MergeMeshes=function(e,t,i,r,n,o){var s,a,h;if(void 0===t&&(t=!0),!i)for(var l=0,u=0;u<e.length;u++)if(e[u]&&65536<=(l+=e[u].getTotalVertices()))return fe.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null;o&&(s=null,n=!1);var c=new Array,d=new Array,f=null,p=new Array,_=null;for(u=0;u<e.length;u++)if(e[u]){var g=e[u];if(g.isAnInstance)return fe.Warn("Cannot merge instance meshes."),null;var m,v=g.computeWorldMatrix(!0);if((m=Ri.ExtractFromMesh(g,!0,!0)).transform(v),f?f.merge(m,i):(f=m,_=g),n&&p.push(g.getTotalIndices()),o)if(g.material){var y=g.material;if(y instanceof qs){for(h=0;h<y.subMaterials.length;h++)c.indexOf(y.subMaterials[h])<0&&c.push(y.subMaterials[h]);for(a=0;a<g.subMeshes.length;a++)d.push(c.indexOf(y.subMaterials[g.subMeshes[a].materialIndex])),p.push(g.subMeshes[a].indexCount)}else for(c.indexOf(y)<0&&c.push(y),a=0;a<g.subMeshes.length;a++)d.push(c.indexOf(y)),p.push(g.subMeshes[a].indexCount)}else for(a=0;a<g.subMeshes.length;a++)d.push(0),p.push(g.subMeshes[a].indexCount)}if(r=r||new na(_.name+"_merged",_.getScene()),f.applyToMesh(r),r.checkCollisions=_.checkCollisions,t)for(u=0;u<e.length;u++)e[u]&&e[u].dispose();if(n||o){r.releaseSubMeshes();for(var b=u=0;u<p.length;)Or.CreateFromIndices(0,b,p[u],r),b+=p[u],u++}if(o){for((s=new qs(_.name+"_merged",_.getScene())).subMaterials=c,a=0;a<r.subMeshes.length;a++)r.subMeshes[a].materialIndex=d[a];r.material=s}else r.material=_.material;return r},na.prototype.addInstance=function(e){e._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(e)},na.prototype.removeInstance=function(e){var t,i=e._indexInSourceMeshInstanceArray;-1!=i&&(i!==this.instances.length-1&&(t=this.instances[this.instances.length-1],(this.instances[i]=t)._indexInSourceMeshInstanceArray=i),e._indexInSourceMeshInstanceArray=-1,this.instances.pop())},na.FRONTSIDE=Ri.FRONTSIDE,na.BACKSIDE=Ri.BACKSIDE,na.DOUBLESIDE=Ri.DOUBLESIDE,na.DEFAULTSIDE=Ri.DEFAULTSIDE,na.NO_CAP=0,na.CAP_START=1,na.CAP_END=2,na.CAP_ALL=3,na.NO_FLIP=0,na.FLIP_TILE=1,na.ROTATE_TILE=2,na.FLIP_ROW=3,na.ROTATE_ROW=4,na.FLIP_N_ROTATE_TILE=5,na.FLIP_N_ROTATE_ROW=6,na.CENTER=0,na.LEFT=1,na.RIGHT=2,na.TOP=3,na.BOTTOM=4,na._GroundMeshParser=function(e,t){throw S.WarnImport("GroundMesh")},na);function na(e,t,i,r,n,o){void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=null),void 0===o&&(o=!0);var s,a,h,l=Qs.call(this,e,t)||this;if(l._internalMeshDataInfo=new ia,l.delayLoadState=0,l.instances=new Array,l._creationDataStorage=null,l._geometry=null,l._instanceDataStorage=new ea,l._effectiveMaterial=null,l._shouldGenerateFlatShading=!1,l._originalBuilderSideOrientation=na.DEFAULTSIDE,l.overrideMaterialSideOrientation=null,t=l.getScene(),r){if(r._geometry&&r._geometry.applyToMesh(l),ve.DeepCopy(r,l,["name","material","skeleton","instances","parent","uniqueId","source","metadata","hasLODLevels","geometry","isBlocked","areNormalsFrozen","onBeforeDrawObservable","onBeforeRenderObservable","onAfterRenderObservable","onBeforeDraw","onAfterWorldMatrixUpdateObservable","onCollideObservable","onCollisionPositionChangeObservable","onRebuildObservable","onDisposeObservable","lightSources","morphTargetManager"],["_poseMatrix"]),l._internalMeshDataInfo._source=r,t.useClonedMeshMap&&(r._internalMeshDataInfo.meshMap||(r._internalMeshDataInfo.meshMap={}),r._internalMeshDataInfo.meshMap[l.uniqueId]=l),l._originalBuilderSideOrientation=r._originalBuilderSideOrientation,l._creationDataStorage=r._creationDataStorage,r._ranges){var u=r._ranges;for(var e in u)u.hasOwnProperty(e)&&u[e]&&l.createAnimationRange(e,u[e].from,u[e].to)}if(r.metadata&&r.metadata.clone?l.metadata=r.metadata.clone():l.metadata=r.metadata,_&&_.HasTags(r)&&_.AddTagsTo(l,_.GetTags(r,!0)),l.parent=r.parent,l.setPivotMatrix(r.getPivotMatrix()),l.id=e+"."+r.id,l.material=r.material,!n)for(var c=r.getDescendants(!0),d=0;d<c.length;d++){var f=c[d];f.clone&&f.clone(e+"."+f.name,l)}for(r.morphTargetManager&&(l.morphTargetManager=r.morphTargetManager),t.getPhysicsEngine&&(a=t.getPhysicsEngine(),o&&a&&((h=a.getImpostorForPhysicsObject(r))&&(l.physicsImpostor=h.clone(l)))),s=0;s<t.particleSystems.length;s++){var p=t.particleSystems[s];p.emitter===r&&p.clone(p.name,l)}l.refreshBoundingInfo(),l.computeWorldMatrix(!0)}return null!==i&&(l.parent=i),l._instanceDataStorage.hardwareInstancedRendering=l.getEngine().getCaps().instancedArrays,l}var oa=(Object.defineProperty(sa.prototype,"name",{get:function(){return"AutoRotation"},enumerable:!0,configurable:!0}),Object.defineProperty(sa.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(e){this._zoomStopsAnimation=e},enumerable:!0,configurable:!0}),Object.defineProperty(sa.prototype,"idleRotationSpeed",{get:function(){return this._idleRotationSpeed},set:function(e){this._idleRotationSpeed=e},enumerable:!0,configurable:!0}),Object.defineProperty(sa.prototype,"idleRotationWaitTime",{get:function(){return this._idleRotationWaitTime},set:function(e){this._idleRotationWaitTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(sa.prototype,"idleRotationSpinupTime",{get:function(){return this._idleRotationSpinupTime},set:function(e){this._idleRotationSpinupTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(sa.prototype,"rotationInProgress",{get:function(){return 0<Math.abs(this._cameraRotationSpeed)},enumerable:!0,configurable:!0}),sa.prototype.init=function(){},sa.prototype.attach=function(e){var n=this;this._attachedCamera=e;var t=this._attachedCamera.getScene();this._onPrePointerObservableObserver=t.onPrePointerObservable.add(function(e){e.type!==Xr.POINTERDOWN?e.type===Xr.POINTERUP&&(n._isPointerDown=!1):n._isPointerDown=!0}),this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add(function(){var e=be.Now,t=0;null!=n._lastFrameTime&&(t=e-n._lastFrameTime),n._lastFrameTime=e,n._applyUserInteraction();var i=e-n._lastInteractionTime-n._idleRotationWaitTime,r=Math.max(Math.min(i/n._idleRotationSpinupTime,1),0);n._cameraRotationSpeed=n._idleRotationSpeed*r,n._attachedCamera&&(n._attachedCamera.alpha-=n._cameraRotationSpeed*(t/1e3))})},sa.prototype.detach=function(){var e;this._attachedCamera&&(e=this._attachedCamera.getScene(),this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null)},sa.prototype._userIsZooming=function(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset},sa.prototype._shouldAnimationStopForInteraction=function(){if(!this._attachedCamera)return!1;var e=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(e=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?e:this._userIsZooming()},sa.prototype._applyUserInteraction=function(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=be.Now)},sa.prototype._userIsMoving=function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},sa);function sa(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}var aa=(ha.prototype.setEasingMode=function(e){var t=Math.min(Math.max(e,0),2);this._easingMode=t},ha.prototype.getEasingMode=function(){return this._easingMode},ha.prototype.easeInCore=function(e){throw new Error("You must implement this method")},ha.prototype.ease=function(e){switch(this._easingMode){case ha.EASINGMODE_EASEIN:return this.easeInCore(e);case ha.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-e)}return.5<=e?.5*(1-this.easeInCore(2*(1-e)))+.5:.5*this.easeInCore(2*e)},ha.EASINGMODE_EASEIN=0,ha.EASINGMODE_EASEOUT=1,ha.EASINGMODE_EASEINOUT=2,ha);function ha(){this._easingMode=ha.EASINGMODE_EASEIN}var la;n(ua,la=aa),ua.prototype.easeInCore=function(e){return e=Math.max(0,Math.min(1,e)),1-Math.sqrt(1-e*e)};function ua(){return null!==la&&la.apply(this,arguments)||this}var ca,da=(n(fa,ca=aa),fa.prototype.easeInCore=function(e){var t=Math.max(0,this.amplitude);return Math.pow(e,3)-e*t*Math.sin(3.141592653589793*e)},fa);function fa(e){void 0===e&&(e=1);var t=ca.call(this)||this;return t.amplitude=e,t}var pa;n(_a,pa=aa),_a.prototype.easeInCore=function(e){var t=Math.max(0,this.bounces),i=this.bounciness;i<=1&&(i=1.001);var r=Math.pow(i,t),n=1-i,o=(1-r)/n+.5*r,s=e*o,a=Math.log(-s*(1-i)+1)/Math.log(i),h=Math.floor(a),l=h+1,u=(1-Math.pow(i,h))/(n*o),c=.5*(u+(1-Math.pow(i,l))/(n*o)),d=e-c,f=c-u;return-Math.pow(1/i,t-h)/(f*f)*(d-f)*(d+f)};function _a(e,t){void 0===e&&(e=3),void 0===t&&(t=2);var i=pa.call(this)||this;return i.bounces=e,i.bounciness=t,i}var ga;n(ma,ga=aa),ma.prototype.easeInCore=function(e){return e*e*e};function ma(){return null!==ga&&ga.apply(this,arguments)||this}var va;n(ya,va=aa),ya.prototype.easeInCore=function(e){var t=Math.max(0,this.oscillations),i=Math.max(0,this.springiness),r=0==i?e:(Math.exp(i*e)-1)/(Math.exp(i)-1);return r*Math.sin((6.283185307179586*t+1.5707963267948966)*e)};function ya(e,t){void 0===e&&(e=3),void 0===t&&(t=3);var i=va.call(this)||this;return i.oscillations=e,i.springiness=t,i}var ba,Ta=(n(xa,ba=aa),xa.prototype.easeInCore=function(e){return this.exponent<=0?e:(Math.exp(this.exponent*e)-1)/(Math.exp(this.exponent)-1)},xa);function xa(e){void 0===e&&(e=2);var t=ba.call(this)||this;return t.exponent=e,t}var Ea;n(Aa,Ea=aa),Aa.prototype.easeInCore=function(e){var t=Math.max(0,this.power);return Math.pow(e,t)};function Aa(e){void 0===e&&(e=2);var t=Ea.call(this)||this;return t.power=e,t}var Ma;n(Ca,Ma=aa),Ca.prototype.easeInCore=function(e){return e*e};function Ca(){return null!==Ma&&Ma.apply(this,arguments)||this}var Pa;n(Oa,Pa=aa),Oa.prototype.easeInCore=function(e){return e*e*e*e};function Oa(){return null!==Pa&&Pa.apply(this,arguments)||this}var Sa;n(Ia,Sa=aa),Ia.prototype.easeInCore=function(e){return e*e*e*e*e};function Ia(){return null!==Sa&&Sa.apply(this,arguments)||this}var Ra;n(Da,Ra=aa),Da.prototype.easeInCore=function(e){return 1-Math.sin(1.5707963267948966*(1-e))};function Da(){return null!==Ra&&Ra.apply(this,arguments)||this}var wa,La,Fa;n(Na,wa=aa),Na.prototype.easeInCore=function(e){return ps.Interpolate(e,this.x1,this.y1,this.x2,this.y2)};function Na(e,t,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=1),void 0===r&&(r=1);var n=wa.call(this)||this;return n.x1=e,n.y1=t,n.x2=i,n.y2=r,n}(Fa=La=La||{})[Fa.STEP=1]="STEP";var Ba=(ka.prototype.clone=function(){return new ka(this.name,this.from,this.to)},ka);function ka(e,t,i){this.name=e,this.from=t,this.to=i}var Ua=(Va._PrepareAnimation=function(e,t,i,r,n,o,s,a){var h=void 0;if(!isNaN(parseFloat(n))&&isFinite(n)?h=Va.ANIMATIONTYPE_FLOAT:n instanceof x?h=Va.ANIMATIONTYPE_QUATERNION:n instanceof te?h=Va.ANIMATIONTYPE_VECTOR3:n instanceof H?h=Va.ANIMATIONTYPE_VECTOR2:n instanceof Ne?h=Va.ANIMATIONTYPE_COLOR3:n instanceof K?h=Va.ANIMATIONTYPE_COLOR4:n instanceof xn&&(h=Va.ANIMATIONTYPE_SIZE),null==h)return null;var l=new Va(e,t,i,h,s),u=[{frame:0,value:n},{frame:r,value:o}];return l.setKeys(u),void 0!==a&&l.setEasingFunction(a),l},Va.CreateAnimation=function(e,t,i,r){var n=new Va(e+"Animation",e,i,t,Va.ANIMATIONLOOPMODE_CONSTANT);return n.setEasingFunction(r),n},Va.CreateAndStartAnimation=function(e,t,i,r,n,o,s,a,h,l){var u=Va._PrepareAnimation(e,i,r,n,o,s,a,h);return u?t.getScene().beginDirectAnimation(t,[u],0,n,1===u.loopMode,1,l):null},Va.CreateAndStartHierarchyAnimation=function(e,t,i,r,n,o,s,a,h,l,u){var c=Va._PrepareAnimation(e,r,n,o,s,a,h,l);return c?t.getScene().beginDirectHierarchyAnimation(t,i,[c],0,o,1===c.loopMode,1,u):null},Va.CreateMergeAndStartAnimation=function(e,t,i,r,n,o,s,a,h,l){var u=Va._PrepareAnimation(e,i,r,n,o,s,a,h);return u?(t.animations.push(u),t.getScene().beginAnimation(t,0,n,1===u.loopMode,1,l)):null},Va.TransitionTo=function(e,t,i,r,n,o,s,a){if(void 0===a&&(a=null),s<=0)return i[e]=t,a&&a(),null;var h=n*(s/1e3);o.setKeys([{frame:0,value:i[e].clone?i[e].clone():i[e]},{frame:h,value:t}]),i.animations||(i.animations=[]),i.animations.push(o);var l=r.beginAnimation(i,0,h,!1);return l.onAnimationEnd=a,l},Object.defineProperty(Va.prototype,"runtimeAnimations",{get:function(){return this._runtimeAnimations},enumerable:!0,configurable:!0}),Object.defineProperty(Va.prototype,"hasRunningRuntimeAnimations",{get:function(){for(var e=0,t=this._runtimeAnimations;e<t.length;e++)if(!t[e].isStopped)return!0;return!1},enumerable:!0,configurable:!0}),Va.prototype.toString=function(e){var t="Name: "+this.name+", property: "+this.targetProperty;if(t+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],t+=", nKeys: "+(this._keys?this._keys.length:"none"),t+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){t+=", Ranges: {";var i=!0;for(var r in this._ranges)i&&(t+=", ",i=!1),t+=r;t+="}"}return t},Va.prototype.addEvent=function(e){this._events.push(e)},Va.prototype.removeEvents=function(e){for(var t=0;t<this._events.length;t++)this._events[t].frame===e&&(this._events.splice(t,1),t--)},Va.prototype.getEvents=function(){return this._events},Va.prototype.createRange=function(e,t,i){this._ranges[e]||(this._ranges[e]=new Ba(e,t,i))},Va.prototype.deleteRange=function(e,t){void 0===t&&(t=!0);var i=this._ranges[e];if(i){if(t)for(var r=i.from,n=i.to,o=this._keys.length-1;0<=o;o--)this._keys[o].frame>=r&&this._keys[o].frame<=n&&this._keys.splice(o,1);this._ranges[e]=null}},Va.prototype.getRange=function(e){return this._ranges[e]},Va.prototype.getKeys=function(){return this._keys},Va.prototype.getHighestFrame=function(){for(var e=0,t=0,i=this._keys.length;t<i;t++)e<this._keys[t].frame&&(e=this._keys[t].frame);return e},Va.prototype.getEasingFunction=function(){return this._easingFunction},Va.prototype.setEasingFunction=function(e){this._easingFunction=e},Va.prototype.floatInterpolateFunction=function(e,t,i){return c.Lerp(e,t,i)},Va.prototype.floatInterpolateFunctionWithTangents=function(e,t,i,r,n){return c.Hermite(e,t,i,r,n)},Va.prototype.quaternionInterpolateFunction=function(e,t,i){return x.Slerp(e,t,i)},Va.prototype.quaternionInterpolateFunctionWithTangents=function(e,t,i,r,n){return x.Hermite(e,t,i,r,n).normalize()},Va.prototype.vector3InterpolateFunction=function(e,t,i){return te.Lerp(e,t,i)},Va.prototype.vector3InterpolateFunctionWithTangents=function(e,t,i,r,n){return te.Hermite(e,t,i,r,n)},Va.prototype.vector2InterpolateFunction=function(e,t,i){return H.Lerp(e,t,i)},Va.prototype.vector2InterpolateFunctionWithTangents=function(e,t,i,r,n){return H.Hermite(e,t,i,r,n)},Va.prototype.sizeInterpolateFunction=function(e,t,i){return xn.Lerp(e,t,i)},Va.prototype.color3InterpolateFunction=function(e,t,i){return Ne.Lerp(e,t,i)},Va.prototype.color4InterpolateFunction=function(e,t,i){return K.Lerp(e,t,i)},Va.prototype._getKeyValue=function(e){return"function"==typeof e?e():e},Va.prototype._interpolate=function(e,t){if(t.loopMode===Va.ANIMATIONLOOPMODE_CONSTANT&&0<t.repeatCount)return t.highLimitValue.clone?t.highLimitValue.clone():t.highLimitValue;var i=this._keys;if(1===i.length)return this._getKeyValue(i[0].value);var r=t.key;if(i[r].frame>=e)for(;0<=r-1&&i[r].frame>=e;)r--;for(var n=r;n<i.length;n++){var o=i[n+1];if(o.frame>=e){var s=i[t.key=n],a=this._getKeyValue(s.value);if(s.interpolation===La.STEP)return a;var h=this._getKeyValue(o.value),l=void 0!==s.outTangent&&void 0!==o.inTangent,u=o.frame-s.frame,c=(e-s.frame)/u,d=this.getEasingFunction();switch(null!=d&&(c=d.ease(c)),this.dataType){case Va.ANIMATIONTYPE_FLOAT:var f=l?this.floatInterpolateFunctionWithTangents(a,s.outTangent*u,h,o.inTangent*u,c):this.floatInterpolateFunction(a,h,c);switch(t.loopMode){case Va.ANIMATIONLOOPMODE_CYCLE:case Va.ANIMATIONLOOPMODE_CONSTANT:return f;case Va.ANIMATIONLOOPMODE_RELATIVE:return t.offsetValue*t.repeatCount+f}break;case Va.ANIMATIONTYPE_QUATERNION:var p=l?this.quaternionInterpolateFunctionWithTangents(a,s.outTangent.scale(u),h,o.inTangent.scale(u),c):this.quaternionInterpolateFunction(a,h,c);switch(t.loopMode){case Va.ANIMATIONLOOPMODE_CYCLE:case Va.ANIMATIONLOOPMODE_CONSTANT:return p;case Va.ANIMATIONLOOPMODE_RELATIVE:return p.addInPlace(t.offsetValue.scale(t.repeatCount))}return p;case Va.ANIMATIONTYPE_VECTOR3:var _=l?this.vector3InterpolateFunctionWithTangents(a,s.outTangent.scale(u),h,o.inTangent.scale(u),c):this.vector3InterpolateFunction(a,h,c);switch(t.loopMode){case Va.ANIMATIONLOOPMODE_CYCLE:case Va.ANIMATIONLOOPMODE_CONSTANT:return _;case Va.ANIMATIONLOOPMODE_RELATIVE:return _.add(t.offsetValue.scale(t.repeatCount))}case Va.ANIMATIONTYPE_VECTOR2:var g=l?this.vector2InterpolateFunctionWithTangents(a,s.outTangent.scale(u),h,o.inTangent.scale(u),c):this.vector2InterpolateFunction(a,h,c);switch(t.loopMode){case Va.ANIMATIONLOOPMODE_CYCLE:case Va.ANIMATIONLOOPMODE_CONSTANT:return g;case Va.ANIMATIONLOOPMODE_RELATIVE:return g.add(t.offsetValue.scale(t.repeatCount))}case Va.ANIMATIONTYPE_SIZE:switch(t.loopMode){case Va.ANIMATIONLOOPMODE_CYCLE:case Va.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(a,h,c);case Va.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(a,h,c).add(t.offsetValue.scale(t.repeatCount))}case Va.ANIMATIONTYPE_COLOR3:switch(t.loopMode){case Va.ANIMATIONLOOPMODE_CYCLE:case Va.ANIMATIONLOOPMODE_CONSTANT:return this.color3InterpolateFunction(a,h,c);case Va.ANIMATIONLOOPMODE_RELATIVE:return this.color3InterpolateFunction(a,h,c).add(t.offsetValue.scale(t.repeatCount))}case Va.ANIMATIONTYPE_COLOR4:switch(t.loopMode){case Va.ANIMATIONLOOPMODE_CYCLE:case Va.ANIMATIONLOOPMODE_CONSTANT:return this.color4InterpolateFunction(a,h,c);case Va.ANIMATIONLOOPMODE_RELATIVE:return this.color4InterpolateFunction(a,h,c).add(t.offsetValue.scale(t.repeatCount))}case Va.ANIMATIONTYPE_MATRIX:switch(t.loopMode){case Va.ANIMATIONLOOPMODE_CYCLE:case Va.ANIMATIONLOOPMODE_CONSTANT:if(Va.AllowMatricesInterpolation)return this.matrixInterpolateFunction(a,h,c,t.workValue);case Va.ANIMATIONLOOPMODE_RELATIVE:return a}}break}}return this._getKeyValue(i[i.length-1].value)},Va.prototype.matrixInterpolateFunction=function(e,t,i,r){return Va.AllowMatrixDecomposeForInterpolation?r?(W.DecomposeLerpToRef(e,t,i,r),r):W.DecomposeLerp(e,t,i):r?(W.LerpToRef(e,t,i,r),r):W.Lerp(e,t,i)},Va.prototype.clone=function(){var e=new Va(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed,this._keys&&e.setKeys(this._keys),this._ranges)for(var t in e._ranges={},this._ranges){var i=this._ranges[t];i&&(e._ranges[t]=i.clone())}return e},Va.prototype.setKeys=function(e){this._keys=e.slice(0)},Va.prototype.serialize=function(){var e={};e.name=this.name,e.property=this.targetProperty,e.framePerSecond=this.framePerSecond,e.dataType=this.dataType,e.loopBehavior=this.loopMode,e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed;var t=this.dataType;e.keys=[];for(var i=this.getKeys(),r=0;r<i.length;r++){var n=i[r],o={};switch(o.frame=n.frame,t){case Va.ANIMATIONTYPE_FLOAT:o.values=[n.value];break;case Va.ANIMATIONTYPE_QUATERNION:case Va.ANIMATIONTYPE_MATRIX:case Va.ANIMATIONTYPE_VECTOR3:case Va.ANIMATIONTYPE_COLOR3:case Va.ANIMATIONTYPE_COLOR4:o.values=n.value.asArray()}e.keys.push(o)}for(var s in e.ranges=[],this._ranges){var a,h=this._ranges[s];h&&((a={}).name=s,a.from=h.from,a.to=h.to,e.ranges.push(a))}return e},Va._UniversalLerp=function(e,t,i){var r=e.constructor;return r.Lerp?r.Lerp(e,t,i):r.Slerp?r.Slerp(e,t,i):e.toFixed?e*(1-i)+i*t:t},Va.Parse=function(e){var t,i=new Va(e.name,e.property,e.framePerSecond,e.dataType,e.loopBehavior),r=e.dataType,n=[];for(e.enableBlending&&(i.enableBlending=e.enableBlending),e.blendingSpeed&&(i.blendingSpeed=e.blendingSpeed),t=0;t<e.keys.length;t++){var o,s,a=e.keys[t];switch(r){case Va.ANIMATIONTYPE_FLOAT:u=a.values[0],1<=a.values.length&&(o=a.values[1]),2<=a.values.length&&(s=a.values[2]);break;case Va.ANIMATIONTYPE_QUATERNION:var h,l,u=x.FromArray(a.values);8<=a.values.length&&((h=x.FromArray(a.values.slice(4,8))).equals(x.Zero())||(o=h)),12<=a.values.length&&((l=x.FromArray(a.values.slice(8,12))).equals(x.Zero())||(s=l));break;case Va.ANIMATIONTYPE_MATRIX:u=W.FromArray(a.values);break;case Va.ANIMATIONTYPE_COLOR3:u=Ne.FromArray(a.values);break;case Va.ANIMATIONTYPE_COLOR4:u=K.FromArray(a.values);break;case Va.ANIMATIONTYPE_VECTOR3:default:u=te.FromArray(a.values)}var c={};c.frame=a.frame,c.value=u,null!=o&&(c.inTangent=o),null!=s&&(c.outTangent=s),n.push(c)}if(i.setKeys(n),e.ranges)for(t=0;t<e.ranges.length;t++)u=e.ranges[t],i.createRange(u.name,u.from,u.to);return i},Va.AppendSerializedAnimations=function(e,t){Q.AppendSerializedAnimations(e,t)},Va.AllowMatricesInterpolation=!1,Va.AllowMatrixDecomposeForInterpolation=!0,Va.ANIMATIONTYPE_FLOAT=0,Va.ANIMATIONTYPE_VECTOR3=1,Va.ANIMATIONTYPE_QUATERNION=2,Va.ANIMATIONTYPE_MATRIX=3,Va.ANIMATIONTYPE_COLOR3=4,Va.ANIMATIONTYPE_COLOR4=7,Va.ANIMATIONTYPE_VECTOR2=5,Va.ANIMATIONTYPE_SIZE=6,Va.ANIMATIONLOOPMODE_RELATIVE=0,Va.ANIMATIONLOOPMODE_CYCLE=1,Va.ANIMATIONLOOPMODE_CONSTANT=2,Va);function Va(e,t,i,r,n,o){this.name=e,this.targetProperty=t,this.framePerSecond=i,this.dataType=r,this.loopMode=n,this.enableBlending=o,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=t.split("."),this.dataType=r,this.loopMode=void 0===n?Va.ANIMATIONLOOPMODE_CYCLE:n}m.RegisteredTypes["BABYLON.Animation"]=Ua,ci._AnimationRangeFactory=function(e,t,i){return new Ba(e,t,i)};var za=(Object.defineProperty(Wa.prototype,"name",{get:function(){return"Bouncing"},enumerable:!0,configurable:!0}),Object.defineProperty(Wa.prototype,"autoTransitionRange",{get:function(){return this._autoTransitionRange},set:function(e){var t,i=this;this._autoTransitionRange!==e&&(this._autoTransitionRange=e,(t=this._attachedCamera)&&(e?this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add(function(e){var t;e&&(e.computeWorldMatrix(!0),t=e.getBoundingInfo().diagonalLength,i.lowerRadiusTransitionRange=.05*t,i.upperRadiusTransitionRange=.05*t)}):this._onMeshTargetChangedObserver&&t.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver)))},enumerable:!0,configurable:!0}),Wa.prototype.init=function(){},Wa.prototype.attach=function(e){var t=this;this._attachedCamera=e,this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add(function(){t._attachedCamera&&(t._isRadiusAtLimit(t._attachedCamera.lowerRadiusLimit)&&t._applyBoundRadiusAnimation(t.lowerRadiusTransitionRange),t._isRadiusAtLimit(t._attachedCamera.upperRadiusLimit)&&t._applyBoundRadiusAnimation(t.upperRadiusTransitionRange))})},Wa.prototype.detach=function(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)},Wa.prototype._isRadiusAtLimit=function(e){return!!this._attachedCamera&&this._attachedCamera.radius===e&&!this._radiusIsAnimating},Wa.prototype._applyBoundRadiusAnimation=function(e){var t,i=this;this._attachedCamera&&(this._radiusBounceTransition||(Wa.EasingFunction.setEasingMode(Wa.EasingMode),this._radiusBounceTransition=Ua.CreateAnimation("radius",Ua.ANIMATIONTYPE_FLOAT,60,Wa.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0,(t=Ua.TransitionTo("radius",this._attachedCamera.radius+e,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,function(){return i._clearAnimationLocks()}))&&this._animatables.push(t))},Wa.prototype._clearAnimationLocks=function(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)},Wa.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()},Wa.EasingFunction=new da(.3),Wa.EasingMode=aa.EASINGMODE_EASEOUT,Wa);function Wa(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}var Ga=(Object.defineProperty(Xa.prototype,"name",{get:function(){return"Framing"},enumerable:!0,configurable:!0}),Object.defineProperty(Xa.prototype,"mode",{get:function(){return this._mode},set:function(e){this._mode=e},enumerable:!0,configurable:!0}),Object.defineProperty(Xa.prototype,"radiusScale",{get:function(){return this._radiusScale},set:function(e){this._radiusScale=e},enumerable:!0,configurable:!0}),Object.defineProperty(Xa.prototype,"positionScale",{get:function(){return this._positionScale},set:function(e){this._positionScale=e},enumerable:!0,configurable:!0}),Object.defineProperty(Xa.prototype,"defaultElevation",{get:function(){return this._defaultElevation},set:function(e){this._defaultElevation=e},enumerable:!0,configurable:!0}),Object.defineProperty(Xa.prototype,"elevationReturnTime",{get:function(){return this._elevationReturnTime},set:function(e){this._elevationReturnTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(Xa.prototype,"elevationReturnWaitTime",{get:function(){return this._elevationReturnWaitTime},set:function(e){this._elevationReturnWaitTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(Xa.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(e){this._zoomStopsAnimation=e},enumerable:!0,configurable:!0}),Object.defineProperty(Xa.prototype,"framingTime",{get:function(){return this._framingTime},set:function(e){this._framingTime=e},enumerable:!0,configurable:!0}),Xa.prototype.init=function(){},Xa.prototype.attach=function(e){var t=this;this._attachedCamera=e;var i=this._attachedCamera.getScene();Xa.EasingFunction.setEasingMode(Xa.EasingMode),this._onPrePointerObservableObserver=i.onPrePointerObservable.add(function(e){e.type!==Xr.POINTERDOWN?e.type===Xr.POINTERUP&&(t._isPointerDown=!1):t._isPointerDown=!0}),this._onMeshTargetChangedObserver=e.onMeshTargetChangedObservable.add(function(e){e&&t.zoomOnMesh(e)}),this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add(function(){t._applyUserInteraction(),t._maintainCameraAboveGround()})},Xa.prototype.detach=function(){var e;this._attachedCamera&&(e=this._attachedCamera.getScene(),this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)},Xa.prototype.zoomOnMesh=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=null),e.computeWorldMatrix(!0);var r=e.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(r.minimumWorld,r.maximumWorld,t,i)},Xa.prototype.zoomOnMeshHierarchy=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=null),e.computeWorldMatrix(!0);var r=e.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(r.min,r.max,t,i)},Xa.prototype.zoomOnMeshesHierarchy=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=null);for(var r=new te(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new te(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),o=0;o<e.length;o++){var s=e[o].getHierarchyBoundingVectors(!0);te.CheckExtends(s.min,r,n),te.CheckExtends(s.max,r,n)}this.zoomOnBoundingInfo(r,n,t,i)},Xa.prototype.zoomOnBoundingInfo=function(e,t,i,r){var n,o,s,a,h,l,u,c,d,f=this;void 0===i&&(i=!1),void 0===r&&(r=null),this._attachedCamera&&(o=(n=e.y)+(t.y-n)*this._positionScale,s=t.subtract(e).scale(.5),h=i?new te(0,o,0):(a=e.add(s),new te(a.x,o,a.z)),this._vectorTransition||(this._vectorTransition=Ua.CreateAnimation("target",Ua.ANIMATIONTYPE_VECTOR3,60,Xa.EasingFunction)),this._betaIsAnimating=!0,(l=Ua.TransitionTo("target",h,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime))&&this._animatables.push(l),u=0,this._mode===Xa.FitFrustumSidesMode?(c=this._calculateLowerRadiusFromModelBoundingSphere(e,t),this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=s.length()+this._attachedCamera.minZ),u=c):this._mode===Xa.IgnoreBoundsSizeMode&&(u=this._calculateLowerRadiusFromModelBoundingSphere(e,t),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ)),this.autoCorrectCameraLimitsAndSensibility&&(d=t.subtract(e).length(),this._attachedCamera.panningSensibility=5e3/d,this._attachedCamera.wheelPrecision=100/u),this._radiusTransition||(this._radiusTransition=Ua.CreateAnimation("radius",Ua.ANIMATIONTYPE_FLOAT,60,Xa.EasingFunction)),(l=Ua.TransitionTo("radius",u,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,function(){f.stopAllAnimations(),r&&r(),f._attachedCamera&&f._attachedCamera.useInputToRestoreState&&f._attachedCamera.storeState()}))&&this._animatables.push(l))},Xa.prototype._calculateLowerRadiusFromModelBoundingSphere=function(e,t){var i=t.subtract(e).length(),r=this._getFrustumSlope(),n=.5*i*this._radiusScale,o=n*Math.sqrt(1+1/(r.x*r.x)),s=n*Math.sqrt(1+1/(r.y*r.y)),a=Math.max(o,s),h=this._attachedCamera;return h?(h.lowerRadiusLimit&&this._mode===Xa.IgnoreBoundsSizeMode&&(a=a<h.lowerRadiusLimit?h.lowerRadiusLimit:a),h.upperRadiusLimit&&(a=a>h.upperRadiusLimit?h.upperRadiusLimit:a),a):0},Xa.prototype._maintainCameraAboveGround=function(){var e,t,i,r,n=this;this._elevationReturnTime<0||(e=be.Now-this._lastInteractionTime,t=.5*Math.PI-this._defaultElevation,i=.5*Math.PI,this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>i&&e>=this._elevationReturnWaitTime&&(this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=Ua.CreateAnimation("beta",Ua.ANIMATIONTYPE_FLOAT,60,Xa.EasingFunction)),(r=Ua.TransitionTo("beta",t,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,function(){n._clearAnimationLocks(),n.stopAllAnimations()}))&&this._animatables.push(r)))},Xa.prototype._getFrustumSlope=function(){var e=this._attachedCamera;if(!e)return H.Zero();var t=e.getScene().getEngine().getAspectRatio(e),i=Math.tan(e.fov/2);return new H(i*t,i)},Xa.prototype._clearAnimationLocks=function(){this._betaIsAnimating=!1},Xa.prototype._applyUserInteraction=function(){this.isUserIsMoving&&(this._lastInteractionTime=be.Now,this.stopAllAnimations(),this._clearAnimationLocks())},Xa.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()},Object.defineProperty(Xa.prototype,"isUserIsMoving",{get:function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},enumerable:!0,configurable:!0}),Xa.EasingFunction=new Ta,Xa.EasingMode=aa.EASINGMODE_EASEINOUT,Xa.IgnoreBoundsSizeMode=0,Xa.FitFrustumSidesMode=1,Xa);function Xa(){this._mode=Xa.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}var Ha=(ja.prototype.attachControl=function(d,f){var p=this,_=this.camera.getEngine(),g=0,m=null;this.pointA=null,this.pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=function(e,t){var i=e.event,r="touch"===i.pointerType;if(!_.isInVRExclusivePointerMode&&(e.type===Xr.POINTERMOVE||-1!==p.buttons.indexOf(i.button))){var n,o,s,a,h,l=i.srcElement||i.target;if(p._altKey=i.altKey,p._ctrlKey=i.ctrlKey,p._metaKey=i.metaKey,p._shiftKey=i.shiftKey,p._buttonsPressed=i.buttons,_.isPointerLock){var u=i.movementX||i.mozMovementX||i.webkitMovementX||i.msMovementX||0,c=i.movementY||i.mozMovementY||i.webkitMovementY||i.msMovementY||0;p.onTouch(null,u,c),p.pointA=null,p.pointB=null}else if(e.type===Xr.POINTERDOWN&&l){try{l.setPointerCapture(i.pointerId)}catch(e){}null===p.pointA?p.pointA={x:i.clientX,y:i.clientY,pointerId:i.pointerId,type:i.pointerType}:null===p.pointB&&(p.pointB={x:i.clientX,y:i.clientY,pointerId:i.pointerId,type:i.pointerType}),p.onButtonDown(i),f||(i.preventDefault(),d.focus())}else if(e.type===Xr.POINTERDOUBLETAP)p.onDoubleTap(i.pointerType);else if(e.type===Xr.POINTERUP&&l){try{l.releasePointerCapture(i.pointerId)}catch(e){}r||(p.pointB=null),_._badOS?p.pointA=p.pointB=null:p.pointB&&p.pointA&&p.pointA.pointerId==i.pointerId?(p.pointA=p.pointB,p.pointB=null):p.pointA&&p.pointB&&p.pointB.pointerId==i.pointerId?p.pointB=null:p.pointA=p.pointB=null,0===g&&!m||(p.onMultiTouch(p.pointA,p.pointB,g,0,m,null),g=0,m=null),p.onButtonUp(i),f||i.preventDefault()}else e.type===Xr.POINTERMOVE&&(f||i.preventDefault(),p.pointA&&null===p.pointB?(u=i.clientX-p.pointA.x,c=i.clientY-p.pointA.y,p.onTouch(p.pointA,u,c),p.pointA.x=i.clientX,p.pointA.y=i.clientY):p.pointA&&p.pointB&&((n=p.pointA.pointerId===i.pointerId?p.pointA:p.pointB).x=i.clientX,n.y=i.clientY,a=(o=p.pointA.x-p.pointB.x)*o+(s=p.pointA.y-p.pointB.y)*s,h={x:(p.pointA.x+p.pointB.x)/2,y:(p.pointA.y+p.pointB.y)/2,pointerId:i.pointerId,type:e.type},p.onMultiTouch(p.pointA,p.pointB,g,a,m,h),m=h,g=a))}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,Xr.POINTERDOWN|Xr.POINTERUP|Xr.POINTERMOVE),this._onLostFocus=function(){p.pointA=p.pointB=null,g=0,m=null,p.onLostFocus()},d.addEventListener("contextmenu",this.onContextMenu.bind(this),!1);var e=this.camera.getScene().getEngine().getHostWindow();e&&ri.RegisterTopRootEvents(e,[{name:"blur",handler:this._onLostFocus}])},ja.prototype.detachControl=function(e){var t;!this._onLostFocus||(t=this.camera.getScene().getEngine().getHostWindow())&&ri.UnregisterTopRootEvents(t,[{name:"blur",handler:this._onLostFocus}]),e&&this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this.onContextMenu&&e.removeEventListener("contextmenu",this.onContextMenu),this._onLostFocus=null),this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0},ja.prototype.getClassName=function(){return"BaseCameraPointersInput"},ja.prototype.getSimpleName=function(){return"pointers"},ja.prototype.onDoubleTap=function(e){},ja.prototype.onTouch=function(e,t,i){},ja.prototype.onMultiTouch=function(e,t,i,r,n,o){},ja.prototype.onContextMenu=function(e){e.preventDefault()},ja.prototype.onButtonDown=function(e){},ja.prototype.onButtonUp=function(e){},ja.prototype.onLostFocus=function(){},o([z()],ja.prototype,"buttons",void 0),ja);function ja(){this.buttons=[0,1,2]}var Ka,Ya=(n(qa,Ka=Ha),qa.prototype.getClassName=function(){return"ArcRotateCameraPointersInput"},qa.prototype.onTouch=function(e,t,i){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-t/this.panningSensibility,this.camera.inertialPanningY+=i/this.panningSensibility):(this.camera.inertialAlphaOffset-=t/this.angularSensibilityX,this.camera.inertialBetaOffset-=i/this.angularSensibilityY)},qa.prototype.onDoubleTap=function(e){this.camera.useInputToRestoreState&&this.camera.restoreState()},qa.prototype.onMultiTouch=function(e,t,i,r,n,o){var s,a,h,l,u;0===i&&null===n||0===r&&null===o||(s=this.pinchInwards?1:-1,this.multiTouchPanAndZoom?(this.useNaturalPinchZoom?this.camera.radius=this.camera.radius*Math.sqrt(i)/Math.sqrt(r):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(r-i)*this.camera.radius*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(r-i)/(this.pinchPrecision*s*(this.angularSensibilityX+this.angularSensibilityY)/2),0!==this.panningSensibility&&n&&o&&(l=o.x-n.x,u=o.y-n.y,this.camera.inertialPanningX+=-l/this.panningSensibility,this.camera.inertialPanningY+=u/this.panningSensibility)):(this._twoFingerActivityCount++,a=Math.sqrt(i),h=Math.sqrt(r),this._isPinching||this._twoFingerActivityCount<20&&Math.abs(h-a)>this.camera.pinchToPanMaxDistance?(this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(r-i)*this.camera.radius*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(r-i)/(this.pinchPrecision*s*(this.angularSensibilityX+this.angularSensibilityY)/2),this._isPinching=!0):0!==this.panningSensibility&&this.multiTouchPanning&&o&&n&&(l=o.x-n.x,u=o.y-n.y,this.camera.inertialPanningX+=-l/this.panningSensibility,this.camera.inertialPanningY+=u/this.panningSensibility)))},qa.prototype.onButtonDown=function(e){this._isPanClick=e.button===this.camera._panningMouseButton},qa.prototype.onButtonUp=function(e){this._twoFingerActivityCount=0,this._isPinching=!1},qa.prototype.onLostFocus=function(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1},o([z()],qa.prototype,"buttons",void 0),o([z()],qa.prototype,"angularSensibilityX",void 0),o([z()],qa.prototype,"angularSensibilityY",void 0),o([z()],qa.prototype,"pinchPrecision",void 0),o([z()],qa.prototype,"pinchDeltaPercentage",void 0),o([z()],qa.prototype,"useNaturalPinchZoom",void 0),o([z()],qa.prototype,"panningSensibility",void 0),o([z()],qa.prototype,"multiTouchPanning",void 0),o([z()],qa.prototype,"multiTouchPanAndZoom",void 0),qa);function qa(){var e=null!==Ka&&Ka.apply(this,arguments)||this;return e.buttons=[0,1,2],e.angularSensibilityX=1e3,e.angularSensibilityY=1e3,e.pinchPrecision=12,e.pinchDeltaPercentage=0,e.useNaturalPinchZoom=!1,e.panningSensibility=1e3,e.multiTouchPanning=!0,e.multiTouchPanAndZoom=!0,e.pinchInwards=!0,e._isPanClick=!1,e._twoFingerActivityCount=0,e._isPinching=!1,e}Is.ArcRotateCameraPointersInput=Ya;var Za=(Qa.prototype.attachControl=function(e,r){var n=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){n._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(e){var t,i=e.event;i.metaKey||(e.type===tn.KEYDOWN?(n._ctrlPressed=i.ctrlKey,n._altPressed=i.altKey,-1===n.keysUp.indexOf(i.keyCode)&&-1===n.keysDown.indexOf(i.keyCode)&&-1===n.keysLeft.indexOf(i.keyCode)&&-1===n.keysRight.indexOf(i.keyCode)&&-1===n.keysReset.indexOf(i.keyCode)||(-1===(t=n._keys.indexOf(i.keyCode))&&n._keys.push(i.keyCode),i.preventDefault&&(r||i.preventDefault()))):-1===n.keysUp.indexOf(i.keyCode)&&-1===n.keysDown.indexOf(i.keyCode)&&-1===n.keysLeft.indexOf(i.keyCode)&&-1===n.keysRight.indexOf(i.keyCode)&&-1===n.keysReset.indexOf(i.keyCode)||(0<=(t=n._keys.indexOf(i.keyCode))&&n._keys.splice(t,1),i.preventDefault&&(r||i.preventDefault())))}))},Qa.prototype.detachControl=function(e){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},Qa.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var e=this.camera,t=0;t<this._keys.length;t++){var i=this._keys[t];-1!==this.keysLeft.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX-=1/this.panningSensibility:e.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset+=1/this.zoomingSensibility:e.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX+=1/this.panningSensibility:e.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset-=1/this.zoomingSensibility:e.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(i)&&e.useInputToRestoreState&&e.restoreState()}},Qa.prototype.getClassName=function(){return"ArcRotateCameraKeyboardMoveInput"},Qa.prototype.getSimpleName=function(){return"keyboard"},o([z()],Qa.prototype,"keysUp",void 0),o([z()],Qa.prototype,"keysDown",void 0),o([z()],Qa.prototype,"keysLeft",void 0),o([z()],Qa.prototype,"keysRight",void 0),o([z()],Qa.prototype,"keysReset",void 0),o([z()],Qa.prototype,"panningSensibility",void 0),o([z()],Qa.prototype,"zoomingSensibility",void 0),o([z()],Qa.prototype,"useAltToZoom",void 0),o([z()],Qa.prototype,"angularSpeed",void 0),Qa);function Qa(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}Is.ArcRotateCameraKeyboardMoveInput=Za;var Ja=($a.prototype.computeDeltaFromMouseWheelLegacyEvent=function(e,t){var i=.01*e*this.wheelDeltaPercentage*t;return 0<e?i/(1+this.wheelDeltaPercentage):i*(1+this.wheelDeltaPercentage)},$a.prototype.attachControl=function(e,h){var l=this;this._wheel=function(e,t){if(e.type===Xr.POINTERWHEEL){var i=e.event,r=0,n=0,n=i.wheelDelta?i.wheelDelta:60*-(i.deltaY||i.detail);if(l.wheelDeltaPercentage){if(0<(r=l.computeDeltaFromMouseWheelLegacyEvent(n,l.camera.radius))){for(var o=l.camera.radius,s=l.camera.inertialRadiusOffset+r,a=0;a<20&&.001<Math.abs(s);a++)o-=s,s*=l.camera.inertia;o=c.Clamp(o,0,Number.MAX_VALUE),r=l.computeDeltaFromMouseWheelLegacyEvent(n,o)}}else r=n/(40*l.wheelPrecision);r&&(l.camera.inertialRadiusOffset+=r),i.preventDefault&&(h||i.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,Xr.POINTERWHEEL)},$a.prototype.detachControl=function(e){this._observer&&e&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},$a.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},$a.prototype.getSimpleName=function(){return"mousewheel"},o([z()],$a.prototype,"wheelPrecision",void 0),o([z()],$a.prototype,"wheelDeltaPercentage",void 0),$a);function $a(){this.wheelPrecision=3,this.wheelDeltaPercentage=0}Is.ArcRotateCameraMouseWheelInput=Ja;var eh,th=(n(ih,eh=Rs),ih.prototype.addMouseWheel=function(){return this.add(new Ja),this},ih.prototype.addPointers=function(){return this.add(new Ya),this},ih.prototype.addKeyboard=function(){return this.add(new Za),this},ih);function ih(e){return eh.call(this,e)||this}ci.AddNodeConstructor("ArcRotateCamera",function(e,t){return function(){return new nh(e,0,0,1,te.Zero(),t)}});var rh,nh=(n(oh,rh=Os),Object.defineProperty(oh.prototype,"target",{get:function(){return this._target},set:function(e){this.setTarget(e)},enumerable:!0,configurable:!0}),Object.defineProperty(oh.prototype,"position",{get:function(){return this._position},set:function(e){this.setPosition(e)},enumerable:!0,configurable:!0}),Object.defineProperty(oh.prototype,"upVector",{get:function(){return this._upVector},set:function(e){this._upToYMatrix||(this._YToUpMatrix=new W,this._upToYMatrix=new W,this._upVector=te.Zero()),e.normalize(),this._upVector.copyFrom(e),this.setMatUp()},enumerable:!0,configurable:!0}),oh.prototype.setMatUp=function(){W.RotationAlignToRef(te.UpReadOnly,this._upVector,this._YToUpMatrix),W.RotationAlignToRef(this._upVector,te.UpReadOnly,this._upToYMatrix)},Object.defineProperty(oh.prototype,"angularSensibilityX",{get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityX:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.angularSensibilityX=e)},enumerable:!0,configurable:!0}),Object.defineProperty(oh.prototype,"angularSensibilityY",{get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityY:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.angularSensibilityY=e)},enumerable:!0,configurable:!0}),Object.defineProperty(oh.prototype,"pinchPrecision",{get:function(){var e=this.inputs.attached.pointers;return e?e.pinchPrecision:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.pinchPrecision=e)},enumerable:!0,configurable:!0}),Object.defineProperty(oh.prototype,"pinchDeltaPercentage",{get:function(){var e=this.inputs.attached.pointers;return e?e.pinchDeltaPercentage:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.pinchDeltaPercentage=e)},enumerable:!0,configurable:!0}),Object.defineProperty(oh.prototype,"useNaturalPinchZoom",{get:function(){var e=this.inputs.attached.pointers;return!!e&&e.useNaturalPinchZoom},set:function(e){var t=this.inputs.attached.pointers;t&&(t.useNaturalPinchZoom=e)},enumerable:!0,configurable:!0}),Object.defineProperty(oh.prototype,"panningSensibility",{get:function(){var e=this.inputs.attached.pointers;return e?e.panningSensibility:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.panningSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(oh.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysUp=e)},enumerable:!0,configurable:!0}),Object.defineProperty(oh.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysDown=e)},enumerable:!0,configurable:!0}),Object.defineProperty(oh.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)},enumerable:!0,configurable:!0}),Object.defineProperty(oh.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysRight=e)},enumerable:!0,configurable:!0}),Object.defineProperty(oh.prototype,"wheelPrecision",{get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelPrecision:0},set:function(e){var t=this.inputs.attached.mousewheel;t&&(t.wheelPrecision=e)},enumerable:!0,configurable:!0}),Object.defineProperty(oh.prototype,"wheelDeltaPercentage",{get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelDeltaPercentage:0},set:function(e){var t=this.inputs.attached.mousewheel;t&&(t.wheelDeltaPercentage=e)},enumerable:!0,configurable:!0}),Object.defineProperty(oh.prototype,"bouncingBehavior",{get:function(){return this._bouncingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(oh.prototype,"useBouncingBehavior",{get:function(){return null!=this._bouncingBehavior},set:function(e){e!==this.useBouncingBehavior&&(e?(this._bouncingBehavior=new za,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(oh.prototype,"framingBehavior",{get:function(){return this._framingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(oh.prototype,"useFramingBehavior",{get:function(){return null!=this._framingBehavior},set:function(e){e!==this.useFramingBehavior&&(e?(this._framingBehavior=new Ga,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(oh.prototype,"autoRotationBehavior",{get:function(){return this._autoRotationBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(oh.prototype,"useAutoRotationBehavior",{get:function(){return null!=this._autoRotationBehavior},set:function(e){e!==this.useAutoRotationBehavior&&(e?(this._autoRotationBehavior=new oa,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))},enumerable:!0,configurable:!0}),oh.prototype._initCache=function(){rh.prototype._initCache.call(this),this._cache._target=new te(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=H.Zero()},oh.prototype._updateCache=function(e){e||rh.prototype._updateCache.call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},oh.prototype._getTargetPosition=function(){var e;this._targetHost&&this._targetHost.getAbsolutePosition&&(e=this._targetHost.absolutePosition,this._targetBoundingCenter?e.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(e));var t=this._getLockedTargetPosition();return t||this._target},oh.prototype.storeState=function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),rh.prototype.storeState.call(this)},oh.prototype._restoreStateValues=function(){return!(!rh.prototype._restoreStateValues.call(this)||(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0))},oh.prototype._isSynchronizedViewMatrix=function(){return!!rh.prototype._isSynchronizedViewMatrix.call(this)&&this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset)},oh.prototype.attachControl=function(e,t,i,r){var n=this;void 0===i&&(i=!0),void 0===r&&(r=2),this._useCtrlForPanning=i,this._panningMouseButton=r,this.inputs.attachElement(e,t),this._reset=function(){n.inertialAlphaOffset=0,n.inertialBetaOffset=0,n.inertialRadiusOffset=0,n.inertialPanningX=0,n.inertialPanningY=0}},oh.prototype.detachControl=function(e){this.inputs.detachElement(e),this._reset&&this._reset()},oh.prototype._checkInputs=function(){var e;this._collisionTriggered||(this.inputs.checkInputs(),0===this.inertialAlphaOffset&&0===this.inertialBetaOffset&&0===this.inertialRadiusOffset||(e=this.inertialAlphaOffset,this.beta<=0&&(e*=-1),this.getScene().useRightHandedSystem&&(e*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(e*=-1),this.alpha+=e,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<C&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<C&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*C&&(this.inertialRadiusOffset=0)),0===this.inertialPanningX&&0===this.inertialPanningY||(this._localDirection||(this._localDirection=te.Zero(),this._transformedDirection=te.Zero()),this._localDirection.copyFromFloats(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY),this._localDirection.multiplyInPlace(this.panningAxis),this._viewMatrix.invertToRef(this._cameraTransformMatrix),te.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.panningAxis.y||(this._transformedDirection.y=0),this._targetHost||(this.panningDistanceLimit?(this._transformedDirection.addInPlace(this._target),te.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection)):this._target.addInPlace(this._transformedDirection)),this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*C&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*C&&(this.inertialPanningY=0)),this._checkLimits(),rh.prototype._checkInputs.call(this))},oh.prototype._checkLimits=function(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)},oh.prototype.rebuildAnglesAndRadius=function(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||te.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4),0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha),this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()},oh.prototype.setPosition=function(e){this._position.equals(e)||(this._position.copyFrom(e),this.rebuildAnglesAndRadius())},oh.prototype.setTarget=function(e,t,i){if(void 0===t&&(t=!1),void 0===i&&(i=!1),e.getBoundingInfo)this._targetBoundingCenter=t?e.getBoundingInfo().boundingBox.centerWorld.clone():null,e.computeWorldMatrix(),this._targetHost=e,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var r=e,n=this._getTargetPosition();if(n&&!i&&n.equals(r))return;this._targetHost=null,this._target=r,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}this.rebuildAnglesAndRadius()},oh.prototype._getViewMatrix=function(){var e=Math.cos(this.alpha),t=Math.sin(this.alpha),i=Math.cos(this.beta),r=Math.sin(this.beta);0===r&&(r=1e-4);var n,o,s=this._getTargetPosition();return this._computationVector.copyFromFloats(this.radius*e*r,this.radius*i,this.radius*t*r),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||te.TransformCoordinatesToRef(this._computationVector,this._YToUpMatrix,this._computationVector),s.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions?(n=this.getScene().collisionCoordinator,this._collider||(this._collider=n.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,n.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)):(this._position.copyFrom(this._newPosition),o=this.upVector,this.allowUpsideDown&&r<0&&(o=o.negate()),this._computeViewMatrix(this._position,s,o),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)),this._currentTarget=s,this._viewMatrix},oh.prototype.zoomOn=function(e,t){void 0===t&&(t=!1),e=e||this.getScene().meshes;var i=ra.MinMax(e),r=te.Distance(i.min,i.max);this.radius=r*this.zoomOnFactor,this.focusOn({min:i.min,max:i.max,distance:r},t)},oh.prototype.focusOn=function(e,t){var i,r,n;void 0===t&&(t=!1),n=void 0===e.min?(i=e||this.getScene().meshes,r=ra.MinMax(i),te.Distance(r.min,r.max)):(r=e).distance,this._target=ra.Center(r),t||(this.maxZ=2*n)},oh.prototype.createRigCamera=function(e,t){var i=0;switch(this.cameraRigMode){case or.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case or.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case or.RIG_MODE_STEREOSCOPIC_OVERUNDER:case or.RIG_MODE_STEREOSCOPIC_INTERLACED:case or.RIG_MODE_VR:i=this._cameraRigParams.stereoHalfAngle*(0===t?1:-1);break;case or.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:i=this._cameraRigParams.stereoHalfAngle*(0===t?-1:1)}var r=new oh(e,this.alpha+i,this.beta,this.radius,this._target,this.getScene());return r._cameraRigParams={},r.isRigCamera=!0,r.rigParent=this,r},oh.prototype._updateRigCameras=function(){var e=this._rigCameras[0],t=this._rigCameras[1];switch(e.beta=t.beta=this.beta,this.cameraRigMode){case or.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case or.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case or.RIG_MODE_STEREOSCOPIC_OVERUNDER:case or.RIG_MODE_STEREOSCOPIC_INTERLACED:case or.RIG_MODE_VR:e.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,t.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case or.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:e.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}rh.prototype._updateRigCameras.call(this)},oh.prototype.dispose=function(){this.inputs.clear(),rh.prototype.dispose.call(this)},oh.prototype.getClassName=function(){return"ArcRotateCamera"},o([z()],oh.prototype,"alpha",void 0),o([z()],oh.prototype,"beta",void 0),o([z()],oh.prototype,"radius",void 0),o([Z("target")],oh.prototype,"_target",void 0),o([Z("upVector")],oh.prototype,"_upVector",void 0),o([z()],oh.prototype,"inertialAlphaOffset",void 0),o([z()],oh.prototype,"inertialBetaOffset",void 0),o([z()],oh.prototype,"inertialRadiusOffset",void 0),o([z()],oh.prototype,"lowerAlphaLimit",void 0),o([z()],oh.prototype,"upperAlphaLimit",void 0),o([z()],oh.prototype,"lowerBetaLimit",void 0),o([z()],oh.prototype,"upperBetaLimit",void 0),o([z()],oh.prototype,"lowerRadiusLimit",void 0),o([z()],oh.prototype,"upperRadiusLimit",void 0),o([z()],oh.prototype,"inertialPanningX",void 0),o([z()],oh.prototype,"inertialPanningY",void 0),o([z()],oh.prototype,"pinchToPanMaxDistance",void 0),o([z()],oh.prototype,"panningDistanceLimit",void 0),o([Z()],oh.prototype,"panningOriginTarget",void 0),o([z()],oh.prototype,"panningInertia",void 0),o([z()],oh.prototype,"zoomOnFactor",void 0),o([z()],oh.prototype,"targetScreenOffset",void 0),o([z()],oh.prototype,"allowUpsideDown",void 0),o([z()],oh.prototype,"useInputToRestoreState",void 0),oh);function oh(e,t,i,r,n,o,s){void 0===s&&(s=!0);var l=rh.call(this,e,te.Zero(),o,s)||this;return l._upVector=te.Up(),l.inertialAlphaOffset=0,l.inertialBetaOffset=0,l.inertialRadiusOffset=0,l.lowerAlphaLimit=null,l.upperAlphaLimit=null,l.lowerBetaLimit=.01,l.upperBetaLimit=Math.PI-.01,l.lowerRadiusLimit=null,l.upperRadiusLimit=null,l.inertialPanningX=0,l.inertialPanningY=0,l.pinchToPanMaxDistance=20,l.panningDistanceLimit=null,l.panningOriginTarget=te.Zero(),l.panningInertia=.9,l.zoomOnFactor=1,l.targetScreenOffset=H.Zero(),l.allowUpsideDown=!0,l.useInputToRestoreState=!0,l._viewMatrix=new W,l.panningAxis=new te(1,1,0),l.onMeshTargetChangedObservable=new le,l.checkCollisions=!1,l.collisionRadius=new te(.5,.5,.5),l._previousPosition=te.Zero(),l._collisionVelocity=te.Zero(),l._newPosition=te.Zero(),l._computationVector=te.Zero(),l._onCollisionPositionChange=function(e,t,i){void 0===i&&(i=null),i?(l.setPosition(t),l.onCollide&&l.onCollide(i)):l._previousPosition.copyFrom(l._position);var r=Math.cos(l.alpha),n=Math.sin(l.alpha),o=Math.cos(l.beta),s=Math.sin(l.beta);0===s&&(s=1e-4);var a=l._getTargetPosition();l._computationVector.copyFromFloats(l.radius*r*s,l.radius*o,l.radius*n*s),a.addToRef(l._computationVector,l._newPosition),l._position.copyFrom(l._newPosition);var h=l.upVector;l.allowUpsideDown&&l.beta<0&&(h=(h=h.clone()).negate()),l._computeViewMatrix(l._position,a,h),l._viewMatrix.addAtIndex(12,l.targetScreenOffset.x),l._viewMatrix.addAtIndex(13,l.targetScreenOffset.y),l._collisionTriggered=!1},l._target=te.Zero(),n&&l.setTarget(n),l.alpha=t,l.beta=i,l.radius=r,l.getViewMatrix(),l.inputs=new th(l),l.inputs.addKeyboard().addMouseWheel().addPointers(),l}ci.AddNodeConstructor("Light_Type_3",function(e,t){return function(){return new ah(e,te.Zero(),t)}});var sh,ah=(n(hh,sh=br),hh.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},hh.prototype.getClassName=function(){return"HemisphericLight"},hh.prototype.setDirectionToTarget=function(e){return this.direction=te.Normalize(e.subtract(te.Zero())),this.direction},hh.prototype.getShadowGenerator=function(){return null},hh.prototype.transferToEffect=function(e,t){var i=te.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",i.x,i.y,i.z,0,t),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),t),this},hh.prototype.transferToNodeMaterialEffect=function(e,t){var i=te.Normalize(this.direction);return e.setFloat3(t,i.x,i.y,i.z),this},hh.prototype.computeWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=W.Identity()),this._worldMatrix},hh.prototype.getTypeID=function(){return br.LIGHTTYPEID_HEMISPHERICLIGHT},hh.prototype.prepareLightSpecificDefines=function(e,t){e["HEMILIGHT"+t]=!0},o([Y()],hh.prototype,"groundColor",void 0),o([Z()],hh.prototype,"direction",void 0),hh);function hh(e,t,i){var r=sh.call(this,e,i)||this;return r.groundColor=new Ne(0,0,0),r.direction=t||te.Up(),r}var lh=(uh.prototype.dispose=function(){for(var e=0,t=this._workerInfos;e<t.length;e++)t[e].worker.terminate();delete this._workerInfos,delete this._pendingActions},uh.prototype.push=function(e){for(var t=0,i=this._workerInfos;t<i.length;t++){var r=i[t];if(!r.active)return void this._execute(r,e)}this._pendingActions.push(e)},uh.prototype._execute=function(t,e){var i=this;t.active=!0,e(t.worker,function(){t.active=!1;var e=i._pendingActions.shift();e&&i._execute(t,e)})},uh);function uh(e){this._pendingActions=new Array,this._workerInfos=e.map(function(e){return{worker:e,active:!1}})}function ch(e){return new Promise(function(t){DracoDecoderModule({wasmBinary:e}).then(function(e){t({module:e})})})}function dh(a,e,t,i,h){var r=new a.DecoderBuffer;r.Init(e,e.byteLength);var l,n,u=new a.Decoder;try{var o=u.GetEncodedGeometryType(r);switch(o){case a.TRIANGULAR_MESH:l=new a.Mesh,n=u.DecodeBufferToMesh(r,l);break;case a.POINT_CLOUD:l=new a.PointCloud,n=u.DecodeBufferToPointCloud(r,l);break;default:throw new Error("Invalid geometry type "+o)}if(!n.ok()||!l.ptr)throw new Error(n.error_msg());var c=l.num_points();if(o===a.TRIANGULAR_MESH){var s=l.num_faces(),d=new a.DracoInt32Array;try{for(var f=new Uint32Array(3*s),p=0;p<s;p++){u.GetFaceFromMesh(l,p,d);var _=3*p;f[0+_]=d.GetValue(0),f[1+_]=d.GetValue(1),f[2+_]=d.GetValue(2)}i(f)}finally{a.destroy(d)}}var g=function(e,t){var i=new a.DracoFloat32Array;try{u.GetAttributeFloatForAllPoints(l,t,i);var r=t.num_components();if("color"===e&&3===r){for(var n=new Float32Array(4*c),o=0,s=0;o<n.length;o+=4,s+=r)n[o+0]=i.GetValue(s+0),n[o+1]=i.GetValue(s+1),n[o+2]=i.GetValue(s+2),n[o+3]=1;h(e,n)}else{for(n=new Float32Array(c*r),o=0;o<n.length;o++)n[o]=i.GetValue(o);h(e,n)}}finally{a.destroy(i)}};if(t)for(var m in t){var v=t[m];g(m,u.GetAttributeByUniqueId(l,v))}else{var y={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"};for(var m in y){-1!==(v=u.GetAttributeId(l,a[y[m]]))&&g(m,u.GetAttribute(l,v))}}}finally{l&&a.destroy(l),a.destroy(u),a.destroy(r)}}function fh(e){return"object"!=typeof document||"string"!=typeof e?e:ri.GetAbsoluteUrl(e)}Object.defineProperty(ph,"DecoderAvailable",{get:function(){var e=ph.Configuration.decoder;return!!(e.wasmUrl&&e.wasmBinaryUrl&&"object"==typeof WebAssembly||e.fallbackUrl)},enumerable:!0,configurable:!0}),ph.GetDefaultNumWorkers=function(){return"object"==typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1},Object.defineProperty(ph,"Default",{get:function(){return ph._Default||(ph._Default=new ph),ph._Default},enumerable:!0,configurable:!0}),ph.prototype.dispose=function(){this._workerPoolPromise&&this._workerPoolPromise.then(function(e){e.dispose()}),delete this._workerPoolPromise,delete this._decoderModulePromise},ph.prototype.whenReadyAsync=function(){return this._workerPoolPromise?this._workerPoolPromise.then(function(){}):this._decoderModulePromise?this._decoderModulePromise.then(function(){}):Promise.resolve()},ph.prototype.decodeMeshAsync=function(e,h){var l=e instanceof ArrayBuffer?new Uint8Array(e):e;if(this._workerPoolPromise)return this._workerPoolPromise.then(function(e){return new Promise(function(s,a){e.push(function(t,i){var r=new Ri,n=function(e){t.removeEventListener("error",n),t.removeEventListener("message",o),a(e),i()},o=function(e){"done"===e.data?(t.removeEventListener("error",n),t.removeEventListener("message",o),s(r),i()):"indices"===e.data.id?r.indices=e.data.value:r.set(e.data.value,e.data.id)};t.addEventListener("error",n),t.addEventListener("message",o);var e=new Uint8Array(l.byteLength);e.set(new Uint8Array(l.buffer,l.byteOffset,l.byteLength)),t.postMessage({id:"decodeMesh",dataView:e,attributes:h},[e.buffer])})})});if(this._decoderModulePromise)return this._decoderModulePromise.then(function(e){var i=new Ri;return dh(e.module,l,h,function(e){i.indices=e},function(e,t){i.set(t,e)}),i});throw new Error("Draco decoder module is not available")},ph.Configuration={decoder:{wasmUrl:"https://preview.babylonjs.com/draco_wasm_wrapper_gltf.js",wasmBinaryUrl:"https://preview.babylonjs.com/draco_decoder_gltf.wasm",fallbackUrl:"https://preview.babylonjs.com/draco_decoder_gltf.js"}},ph.DefaultNumWorkers=ph.GetDefaultNumWorkers(),ph._Default=null;function ph(n){void 0===n&&(n=ph.DefaultNumWorkers);var e=ph.Configuration.decoder,a=e.wasmUrl&&e.wasmBinaryUrl&&"object"==typeof WebAssembly?{url:e.wasmUrl,wasmBinaryPromise:ri.LoadFileAsync(fh(e.wasmBinaryUrl))}:{url:e.fallbackUrl,wasmBinaryPromise:Promise.resolve(void 0)};n&&"function"==typeof Worker?this._workerPoolPromise=a.wasmBinaryPromise.then(function(e){for(var t=""+ch+dh+"("+function(){var r;onmessage=function(e){var t=e.data;switch(t.id){case"init":var i=t.decoder;i.url&&(importScripts(i.url),r=ch(i.wasmBinary)),postMessage("done");break;case"decodeMesh":if(!r)throw new Error("Draco decoder module is not available");r.then(function(e){dh(e.module,t.dataView,t.attributes,function(e){postMessage({id:"indices",value:e},[e.buffer])},function(e,t){postMessage({id:e,value:t},[t.buffer])}),postMessage("done")})}}}+")()",s=URL.createObjectURL(new Blob([t],{type:"application/javascript"})),i=new Array(n),r=0;r<i.length;r++)i[r]=new Promise(function(t,i){var r=new Worker(s),n=function(e){r.removeEventListener("error",n),r.removeEventListener("message",o),i(e)},o=function(e){"done"===e.data&&(r.removeEventListener("error",n),r.removeEventListener("message",o),t(r))};r.addEventListener("error",n),r.addEventListener("message",o),r.postMessage({id:"init",decoder:{url:fh(a.url),wasmBinary:e}})});return Promise.all(i).then(function(e){return new lh(e)})}):this._decoderModulePromise=a.wasmBinaryPromise.then(function(e){if(!a.url)throw new Error("Draco decoder module is not available");return ri.LoadScriptAsync(a.url).then(function(){return ch(e)})})}var _h=0,gh=(mh.prototype.clone=function(){return new mh(this.pos.clone(),this.normal.clone(),this.uv.clone())},mh.prototype.flip=function(){this.normal=this.normal.scale(-1)},mh.prototype.interpolate=function(e,t){return new mh(te.Lerp(this.pos,e.pos,t),te.Lerp(this.normal,e.normal,t),H.Lerp(this.uv,e.uv,t))},mh);function mh(e,t,i){this.pos=e,this.normal=t,this.uv=i}var vh=(yh.FromPoints=function(e,t,i){var r=i.subtract(e),n=t.subtract(e);if(0===r.lengthSquared()||0===n.lengthSquared())return null;var o=te.Normalize(te.Cross(r,n));return new yh(o,te.Dot(o,e))},yh.prototype.clone=function(){return new yh(this.normal.clone(),this.w)},yh.prototype.flip=function(){this.normal.scaleInPlace(-1),this.w=-this.w},yh.prototype.splitPolygon=function(e,t,i,r,n){var o,s=0,a=[];for(d=0;d<e.vertices.length;d++){var h=(o=te.Dot(this.normal,e.vertices[d].pos)-this.w)<-yh.EPSILON?2:yh.EPSILON<o?1:0;s|=h,a.push(h)}switch(s){case 0:(0<te.Dot(this.normal,e.plane.normal)?t:i).push(e);break;case 1:r.push(e);break;case 2:n.push(e);break;case 3:for(var l,u=[],c=[],d=0;d<e.vertices.length;d++){var f,p=(d+1)%e.vertices.length,_=a[d],g=a[p],m=e.vertices[d],v=e.vertices[p];2!==_&&u.push(m),1!==_&&c.push(2!==_?m.clone():m),3==(_|g)&&(o=(this.w-te.Dot(this.normal,m.pos))/te.Dot(this.normal,v.pos.subtract(m.pos)),f=m.interpolate(v,o),u.push(f),c.push(f.clone()))}3<=u.length&&(l=new bh(u,e.shared)).plane&&r.push(l),3<=c.length&&(l=new bh(c,e.shared)).plane&&n.push(l)}},yh.EPSILON=1e-5,yh);function yh(e,t){this.normal=e,this.w=t}var bh=(Th.prototype.clone=function(){return new Th(this.vertices.map(function(e){return e.clone()}),this.shared)},Th.prototype.flip=function(){this.vertices.reverse().map(function(e){e.flip()}),this.plane.flip()},Th);function Th(e,t){this.vertices=e,this.shared=t,this.plane=vh.FromPoints(e[0].pos,e[1].pos,e[2].pos)}var xh=(Eh.prototype.clone=function(){var e=new Eh;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map(function(e){return e.clone()}),e},Eh.prototype.invert=function(){for(var e=0;e<this.polygons.length;e++)this.polygons[e].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();var t=this.front;this.front=this.back,this.back=t},Eh.prototype.clipPolygons=function(e){if(!this.plane)return e.slice();for(var t=new Array,i=new Array,r=0;r<e.length;r++)this.plane.splitPolygon(e[r],t,i,t,i);return this.front&&(t=this.front.clipPolygons(t)),i=this.back?this.back.clipPolygons(i):[],t.concat(i)},Eh.prototype.clipTo=function(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)},Eh.prototype.allPolygons=function(){var e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e},Eh.prototype.build=function(e){if(e.length){this.plane||(this.plane=e[0].plane.clone());for(var t=new Array,i=new Array,r=0;r<e.length;r++)this.plane.splitPolygon(e[r],this.polygons,this.polygons,t,i);t.length&&(this.front||(this.front=new Eh),this.front.build(t)),i.length&&(this.back||(this.back=new Eh),this.back.build(i))}},Eh);function Eh(e){this.plane=null,this.front=null,this.back=null,this.polygons=new Array,e&&this.build(e)}Ah.FromMesh=function(e){var t,i,r,n,o,s,a=new Array,h=null;if(!(e instanceof ra))throw"BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";e.computeWorldMatrix(!0),r=e.getWorldMatrix(),n=e.position.clone(),o=e.rotation.clone(),e.rotationQuaternion&&(h=e.rotationQuaternion.clone()),s=e.scaling.clone();for(var l=e.getIndices(),u=e.getVerticesData(Si.PositionKind),c=e.getVerticesData(Si.NormalKind),d=e.getVerticesData(Si.UVKind),f=e.subMeshes,p=0,_=f.length;p<_;p++)for(var g=f[p].indexStart,m=f[p].indexCount+f[p].indexStart;g<m;g+=3){i=[];for(var v=0;v<3;v++){var y=new te(c[3*l[g+v]],c[3*l[g+v]+1],c[3*l[g+v]+2]),b=new H(d[2*l[g+v]],d[2*l[g+v]+1]),T=new te(u[3*l[g+v]],u[3*l[g+v]+1],u[3*l[g+v]+2]),x=te.TransformCoordinates(T,r),E=te.TransformNormal(y,r),A=new gh(x,E,b);i.push(A)}(t=new bh(i,{subMeshId:p,meshId:_h,materialIndex:f[p].materialIndex})).plane&&a.push(t)}var M=Ah.FromPolygons(a);return M.matrix=r,M.position=n,M.rotation=o,M.scaling=s,M.rotationQuaternion=h,_h++,M},Ah.FromPolygons=function(e){var t=new Ah;return t.polygons=e,t},Ah.prototype.clone=function(){var e=new Ah;return e.polygons=this.polygons.map(function(e){return e.clone()}),e.copyTransformAttributes(this),e},Ah.prototype.union=function(e){var t=new xh(this.clone().polygons),i=new xh(e.clone().polygons);return t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),Ah.FromPolygons(t.allPolygons()).copyTransformAttributes(this)},Ah.prototype.unionInPlace=function(e){var t=new xh(this.polygons),i=new xh(e.polygons);t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),this.polygons=t.allPolygons()},Ah.prototype.subtract=function(e){var t=new xh(this.clone().polygons),i=new xh(e.clone().polygons);return t.invert(),t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),t.invert(),Ah.FromPolygons(t.allPolygons()).copyTransformAttributes(this)},Ah.prototype.subtractInPlace=function(e){var t=new xh(this.polygons),i=new xh(e.polygons);t.invert(),t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),t.invert(),this.polygons=t.allPolygons()},Ah.prototype.intersect=function(e){var t=new xh(this.clone().polygons),i=new xh(e.clone().polygons);return t.invert(),i.clipTo(t),i.invert(),t.clipTo(i),i.clipTo(t),t.build(i.allPolygons()),t.invert(),Ah.FromPolygons(t.allPolygons()).copyTransformAttributes(this)},Ah.prototype.intersectInPlace=function(e){var t=new xh(this.polygons),i=new xh(e.polygons);t.invert(),i.clipTo(t),i.invert(),t.clipTo(i),i.clipTo(t),t.build(i.allPolygons()),t.invert(),this.polygons=t.allPolygons()},Ah.prototype.inverse=function(){var e=this.clone();return e.inverseInPlace(),e},Ah.prototype.inverseInPlace=function(){this.polygons.map(function(e){e.flip()})},Ah.prototype.copyTransformAttributes=function(e){return this.matrix=e.matrix,this.position=e.position,this.rotation=e.rotation,this.scaling=e.scaling,this.rotationQuaternion=e.rotationQuaternion,this},Ah.prototype.buildMeshGeometry=function(e,t,i){var r=this.matrix.clone();r.invert();var n,o,s=new ra(e,t),a=[],h=[],l=[],u=[],c=te.Zero(),d=te.Zero(),f=H.Zero(),p=this.polygons,_=[0,0,0],g={},m=0,v={};i&&p.sort(function(e,t){return e.shared.meshId===t.shared.meshId?e.shared.subMeshId-t.shared.subMeshId:e.shared.meshId-t.shared.meshId});for(var y=0,b=p.length;y<b;y++){v[(n=p[y]).shared.meshId]||(v[n.shared.meshId]={}),v[n.shared.meshId][n.shared.subMeshId]||(v[n.shared.meshId][n.shared.subMeshId]={indexStart:1/0,indexEnd:-1/0,materialIndex:n.shared.materialIndex}),o=v[n.shared.meshId][n.shared.subMeshId];for(var T=2,x=n.vertices.length;T<x;T++){_[0]=0,_[1]=T-1,_[2]=T;for(var E=0;E<3;E++){c.copyFrom(n.vertices[_[E]].pos),d.copyFrom(n.vertices[_[E]].normal),f.copyFrom(n.vertices[_[E]].uv);var A,M=te.TransformCoordinates(c,r),C=te.TransformNormal(d,r);void 0!==(A=g[M.x+","+M.y+","+M.z])&&l[3*A]===C.x&&l[3*A+1]===C.y&&l[3*A+2]===C.z&&u[2*A]===f.x&&u[2*A+1]===f.y||(a.push(M.x,M.y,M.z),u.push(f.x,f.y),l.push(d.x,d.y,d.z),A=g[M.x+","+M.y+","+M.z]=a.length/3-1),h.push(A),o.indexStart=Math.min(m,o.indexStart),o.indexEnd=Math.max(m,o.indexEnd),m++}}}if(s.setVerticesData(Si.PositionKind,a),s.setVerticesData(Si.NormalKind,l),s.setVerticesData(Si.UVKind,u),s.setIndices(h,null),i){var P,O=0;for(var S in s.subMeshes=new Array,v){for(var I in P=-1,v[S])o=v[S][I],Or.CreateFromIndices(o.materialIndex+O,o.indexStart,o.indexEnd-o.indexStart+1,s),P=Math.max(o.materialIndex,P);O+=++P}}return s},Ah.prototype.toMesh=function(e,t,i,r){void 0===t&&(t=null);var n=this.buildMeshGeometry(e,i,r);return n.material=t,n.position.copyFrom(this.position),n.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(n.rotationQuaternion=this.rotationQuaternion.clone()),n.scaling.copyFrom(this.scaling),n.computeWorldMatrix(!0),n};function Ah(){this.polygons=new Array}ra._GroundMeshParser=function(e,t){return Ch.Parse(e,t)};var Mh,Ch=(n(Ph,Mh=ra),Ph.prototype.getClassName=function(){return"GroundMesh"},Object.defineProperty(Ph.prototype,"subdivisions",{get:function(){return Math.min(this._subdivisionsX,this._subdivisionsY)},enumerable:!0,configurable:!0}),Object.defineProperty(Ph.prototype,"subdivisionsX",{get:function(){return this._subdivisionsX},enumerable:!0,configurable:!0}),Object.defineProperty(Ph.prototype,"subdivisionsY",{get:function(){return this._subdivisionsY},enumerable:!0,configurable:!0}),Ph.prototype.optimize=function(e,t){void 0===t&&(t=32),this._subdivisionsX=e,this._subdivisionsY=e,this.subdivide(e),this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(t)},Ph.prototype.getHeightAtCoordinates=function(e,t){var i=this.getWorldMatrix(),r=P.Matrix[5];i.invertToRef(r);var n=P.Vector3[8];if(te.TransformCoordinatesFromFloatsToRef(e,0,t,r,n),e=n.x,t=n.z,e<this._minX||e>this._maxX||t<this._minZ||t>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var o=this._getFacetAt(e,t),s=-(o.x*e+o.z*t+o.w)/o.y;return te.TransformCoordinatesFromFloatsToRef(0,s,0,i,n),n.y},Ph.prototype.getNormalAtCoordinates=function(e,t){var i=new te(0,1,0);return this.getNormalAtCoordinatesToRef(e,t,i),i},Ph.prototype.getNormalAtCoordinatesToRef=function(e,t,i){var r=this.getWorldMatrix(),n=P.Matrix[5];r.invertToRef(n);var o=P.Vector3[8];if(te.TransformCoordinatesFromFloatsToRef(e,0,t,n,o),e=o.x,t=o.z,e<this._minX||e>this._maxX||t<this._minZ||t>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var s=this._getFacetAt(e,t);return te.TransformNormalFromFloatsToRef(s.x,s.y,s.z,r,i),this},Ph.prototype.updateCoordinateHeights=function(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this},Ph.prototype._getFacetAt=function(e,t){var i=Math.floor((e+this._maxX)*this._subdivisionsX/this._width),r=Math.floor(-(t+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),n=this._heightQuads[r*this._subdivisionsX+i],o=t<n.slope.x*e+n.slope.y?n.facet1:n.facet2;return o},Ph.prototype._initHeightQuads=function(){var e=this._subdivisionsX,t=this._subdivisionsY;this._heightQuads=new Array;for(var i=0;i<t;i++)for(var r=0;r<e;r++){var n={slope:H.Zero(),facet1:new j(0,0,0,0),facet2:new j(0,0,0,0)};this._heightQuads[i*e+r]=n}return this},Ph.prototype._computeHeightQuads=function(){var e=this.getVerticesData(Si.PositionKind);if(!e)return this;for(var t,i,r,n,o,s,a,h=P.Vector3[3],l=P.Vector3[2],u=P.Vector3[1],c=P.Vector3[0],d=P.Vector3[4],f=P.Vector3[5],p=P.Vector3[6],_=P.Vector3[7],g=P.Vector3[8],m=this._subdivisionsX,v=this._subdivisionsY,y=0;y<v;y++)for(var b=0;b<m;b++){t=3*b,i=y*(m+1)*3,r=(y+1)*(m+1)*3,h.x=e[i+t],h.y=e[i+t+1],h.z=e[i+t+2],l.x=e[i+t+3],l.y=e[i+t+4],l.z=e[i+t+5],u.x=e[r+t],u.y=e[r+t+1],u.z=e[r+t+2],c.x=e[r+t+3],c.y=e[r+t+4],c.z=e[r+t+5],n=(c.z-h.z)/(c.x-h.x),o=h.z-n*h.x,l.subtractToRef(h,d),u.subtractToRef(h,f),c.subtractToRef(h,p),te.CrossToRef(p,f,_),te.CrossToRef(d,p,g),_.normalize(),g.normalize(),s=-(_.x*h.x+_.y*h.y+_.z*h.z),a=-(g.x*l.x+g.y*l.y+g.z*l.z);var T=this._heightQuads[y*m+b];T.slope.copyFromFloats(n,o),T.facet1.copyFromFloats(_.x,_.y,_.z,s),T.facet2.copyFromFloats(g.x,g.y,g.z,a)}return this},Ph.prototype.serialize=function(e){Mh.prototype.serialize.call(this,e),e.subdivisionsX=this._subdivisionsX,e.subdivisionsY=this._subdivisionsY,e.minX=this._minX,e.maxX=this._maxX,e.minZ=this._minZ,e.maxZ=this._maxZ,e.width=this._width,e.height=this._height},Ph.Parse=function(e,t){var i=new Ph(e.name,t);return i._subdivisionsX=e.subdivisionsX||1,i._subdivisionsY=e.subdivisionsY||1,i._minX=e.minX,i._maxX=e.maxX,i._minZ=e.minZ,i._maxZ=e.maxZ,i._width=e.width,i._height=e.height,i},Ph);function Ph(e,t){var i=Mh.call(this,e,t)||this;return i.generateOctree=!1,i}var Oh;n(Sh,Oh=ra),Sh.prototype.getClassName=function(){return"TrailMesh"},Sh.prototype._createMesh=function(){for(var e=new Ri,t=[],i=[],r=[],n=te.Zero(),n=this._generator instanceof Zi&&this._generator._boundingInfo?this._generator._boundingInfo.boundingBox.centerWorld:this._generator.position,o=2*Math.PI/this._sectionPolygonPointsCount,s=0;s<this._sectionPolygonPointsCount;s++)t.push(n.x+Math.cos(s*o)*this._diameter,n.y+Math.sin(s*o)*this._diameter,n.z);for(s=1;s<=this._length;s++){for(var a=0;a<this._sectionPolygonPointsCount;a++)t.push(n.x+Math.cos(a*o)*this._diameter,n.y+Math.sin(a*o)*this._diameter,n.z);for(var h=t.length/3-2*this._sectionPolygonPointsCount,a=0;a<this._sectionPolygonPointsCount-1;a++)r.push(h+a,h+a+this._sectionPolygonPointsCount,h+a+this._sectionPolygonPointsCount+1),r.push(h+a,h+a+this._sectionPolygonPointsCount+1,h+a+1);r.push(h+this._sectionPolygonPointsCount-1,h+this._sectionPolygonPointsCount-1+this._sectionPolygonPointsCount,h+this._sectionPolygonPointsCount),r.push(h+this._sectionPolygonPointsCount-1,h+this._sectionPolygonPointsCount,h)}Ri.ComputeNormals(t,r,i),e.positions=t,e.normals=i,e.indices=r,e.applyToMesh(this,!0),this._autoStart&&this.start()},Sh.prototype.start=function(){var e=this;this._running||(this._running=!0,this._beforeRenderObserver=this.getScene().onBeforeRenderObservable.add(function(){e.update()}))},Sh.prototype.stop=function(){this._beforeRenderObserver&&this._running&&(this._running=!1,this.getScene().onBeforeRenderObservable.remove(this._beforeRenderObserver))},Sh.prototype.update=function(){var e=this.getVerticesData(Si.PositionKind),t=this.getVerticesData(Si.NormalKind),i=this._generator.getWorldMatrix();if(e&&t){for(var r=3*this._sectionPolygonPointsCount;r<e.length;r++)e[r-3*this._sectionPolygonPointsCount]=e[r]-t[r]/this._length*this._diameter;for(r=3*this._sectionPolygonPointsCount;r<t.length;r++)t[r-3*this._sectionPolygonPointsCount]=t[r];for(var n=e.length-3*this._sectionPolygonPointsCount,o=2*Math.PI/this._sectionPolygonPointsCount,r=0;r<this._sectionPolygonPointsCount;r++)this._sectionVectors[r].copyFromFloats(Math.cos(r*o)*this._diameter,Math.sin(r*o)*this._diameter,0),this._sectionNormalVectors[r].copyFromFloats(Math.cos(r*o),Math.sin(r*o),0),te.TransformCoordinatesToRef(this._sectionVectors[r],i,this._sectionVectors[r]),te.TransformNormalToRef(this._sectionNormalVectors[r],i,this._sectionNormalVectors[r]);for(r=0;r<this._sectionPolygonPointsCount;r++)e[n+3*r]=this._sectionVectors[r].x,e[n+3*r+1]=this._sectionVectors[r].y,e[n+3*r+2]=this._sectionVectors[r].z,t[n+3*r]=this._sectionNormalVectors[r].x,t[n+3*r+1]=this._sectionNormalVectors[r].y,t[n+3*r+2]=this._sectionNormalVectors[r].z;this.updateVerticesData(Si.PositionKind,e,!0,!1),this.updateVerticesData(Si.NormalKind,t,!0,!1)}},Sh.prototype.clone=function(e,t){return void 0===e&&(e=""),new Sh(e,void 0===t?this._generator:t,this.getScene(),this._diameter,this._length,this._autoStart)},Sh.prototype.serialize=function(e){Oh.prototype.serialize.call(this,e)},Sh.Parse=function(e,t){return new Sh(e.name,e._generator,t,e._diameter,e._length,e._autoStart)};function Sh(e,t,i,r,n,o){void 0===r&&(r=1),void 0===n&&(n=60),void 0===o&&(o=!0);var s=Oh.call(this,e,i)||this;s._sectionPolygonPointsCount=4,s._running=!1,s._autoStart=o,s._generator=t,s._diameter=r,s._length=n,s._sectionVectors=[],s._sectionNormalVectors=[];for(var a=0;a<s._sectionPolygonPointsCount;a++)s._sectionVectors[a]=te.Zero(),s._sectionNormalVectors[a]=te.Zero();return s._createMesh(),s}ra._instancedMeshFactory=function(e,t){var i=new Rh(e,t);if(t.instancedBuffers)for(var r in i.instancedBuffers={},t.instancedBuffers)i.instancedBuffers[r]=t.instancedBuffers[r];return i};var Ih,Rh=(n(Dh,Ih=Zi),Dh.prototype.getClassName=function(){return"InstancedMesh"},Object.defineProperty(Dh.prototype,"lightSources",{get:function(){return this._sourceMesh._lightSources},enumerable:!0,configurable:!0}),Dh.prototype._resyncLightSources=function(){},Dh.prototype._resyncLightSource=function(e){},Dh.prototype._removeLightSource=function(e,t){},Object.defineProperty(Dh.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!0,configurable:!0}),Object.defineProperty(Dh.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!0,configurable:!0}),Object.defineProperty(Dh.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!0,configurable:!0}),Object.defineProperty(Dh.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(Dh.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},set:function(e){this._sourceMesh&&e!==this._sourceMesh.renderingGroupId&&fe.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")},enumerable:!0,configurable:!0}),Dh.prototype.getTotalVertices=function(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0},Dh.prototype.getTotalIndices=function(){return this._sourceMesh.getTotalIndices()},Object.defineProperty(Dh.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!0,configurable:!0}),Dh.prototype.isReady=function(e){return void 0===e&&(e=!1),this._sourceMesh.isReady(e,!0)},Dh.prototype.getVerticesData=function(e,t){return this._sourceMesh.getVerticesData(e,t)},Dh.prototype.setVerticesData=function(e,t,i,r){return this.sourceMesh&&this.sourceMesh.setVerticesData(e,t,i,r),this.sourceMesh},Dh.prototype.updateVerticesData=function(e,t,i,r){return this.sourceMesh&&this.sourceMesh.updateVerticesData(e,t,i,r),this.sourceMesh},Dh.prototype.setIndices=function(e,t){return void 0===t&&(t=null),this.sourceMesh&&this.sourceMesh.setIndices(e,t),this.sourceMesh},Dh.prototype.isVerticesDataPresent=function(e){return this._sourceMesh.isVerticesDataPresent(e)},Dh.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(Dh.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!0,configurable:!0}),Dh.prototype.refreshBoundingInfo=function(e){if(void 0===e&&(e=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var t=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getPositionData(e),t),this},Dh.prototype._preActivate=function(){return this._currentLOD&&this._currentLOD._preActivate(),this},Dh.prototype._activate=function(e,t){if(this._sourceMesh.subMeshes||fe.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(0<this._currentLOD._getWorldMatrixDeterminant()!=0<this._getWorldMatrixDeterminant())return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,e),t){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0}return!1},Dh.prototype._postActivate=function(){this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)},Dh.prototype.getWorldMatrix=function(){if(this._currentLOD&&this._currentLOD.billboardMode!==gi.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){var e=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,P.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),P.Matrix[0].copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(P.Vector3[7]),this._currentLOD._masterMesh=e,P.Matrix[0]}return Ih.prototype.getWorldMatrix.call(this)},Object.defineProperty(Dh.prototype,"isAnInstance",{get:function(){return!0},enumerable:!0,configurable:!0}),Dh.prototype.getLOD=function(e){if(!e)return this;var t=this.getBoundingInfo();return this._currentLOD=this.sourceMesh.getLOD(e,t.boundingSphere),this._currentLOD===this.sourceMesh?this.sourceMesh:this._currentLOD},Dh.prototype._preActivateForIntermediateRendering=function(e){return this.sourceMesh._preActivateForIntermediateRendering(e)},Dh.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh);return this},Dh.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},Dh.prototype.clone=function(e,t,i){void 0===t&&(t=null);var r=this._sourceMesh.createInstance(e);if(ve.DeepCopy(this,r,["name","subMeshes","uniqueId","parent"],[]),this.refreshBoundingInfo(),t&&(r.parent=t),!i)for(var n=0;n<this.getScene().meshes.length;n++){var o=this.getScene().meshes[n];o.parent===this&&o.clone(o.name,r)}return r.computeWorldMatrix(!0),r},Dh.prototype.dispose=function(e,t){void 0===t&&(t=!1),this._sourceMesh.removeInstance(this),Ih.prototype.dispose.call(this,e,t)},Dh);function Dh(e,t){var i=Ih.call(this,e,t.getScene())||this;i._indexInSourceMeshInstanceArray=-1,t.addInstance(i),i._sourceMesh=t,i._unIndexed=t._unIndexed,i.position.copyFrom(t.position),i.rotation.copyFrom(t.rotation),i.scaling.copyFrom(t.scaling),t.rotationQuaternion&&(i.rotationQuaternion=t.rotationQuaternion.clone()),i.animations=t.animations;for(var r=0,n=t.getAnimationRanges();r<n.length;r++){var o=n[r];null!=o&&i.createAnimationRange(o.name,o.from,o.to)}return i.infiniteDistance=t.infiniteDistance,i.setPivotMatrix(t.getPivotMatrix()),i.refreshBoundingInfo(),i._syncSubMeshes(),i}ra.prototype.registerInstancedBuffer=function(e,t){if(this.removeVerticesData(e),!this.instancedBuffers){this.instancedBuffers={};for(var i=0,r=this.instances;i<r.length;i++){r[i].instancedBuffers={}}this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{}}}this.instancedBuffers[e]=null,this._userInstancedBuffersStorage.strides[e]=t,this._userInstancedBuffersStorage.sizes[e]=32*t,this._userInstancedBuffersStorage.data[e]=new Float32Array(this._userInstancedBuffersStorage.sizes[e]),this._userInstancedBuffersStorage.vertexBuffers[e]=new Si(this.getEngine(),this._userInstancedBuffersStorage.data[e],e,!0,!1,t,!0),this.setVerticesBuffer(this._userInstancedBuffersStorage.vertexBuffers[e]);for(var n=0,o=this.instances;n<o.length;n++){o[n].instancedBuffers[e]=null}},ra.prototype._processInstancedBuffers=function(e,t){var i=e.length;for(var r in this.instancedBuffers){for(var n=this._userInstancedBuffersStorage.sizes[r],o=this._userInstancedBuffersStorage.strides[r],s=(i+1)*o;n<s;)n*=2;this._userInstancedBuffersStorage.data[r].length!=n&&(this._userInstancedBuffersStorage.data[r]=new Float32Array(n),this._userInstancedBuffersStorage.sizes[r]=n,this._userInstancedBuffersStorage.vertexBuffers[r]&&(this._userInstancedBuffersStorage.vertexBuffers[r].dispose(),this._userInstancedBuffersStorage.vertexBuffers[r]=null));var a=this._userInstancedBuffersStorage.data[r],h=0;t&&(h+=o,(l=this.instancedBuffers[r]).toArray?l.toArray(a,h):l.copyToArray(a,h));for(var l,u=0;u<i;u++){(l=e[u].instancedBuffers[r]).toArray?l.toArray(a,h):l.copyToArray(a,h),h+=o}this._userInstancedBuffersStorage.vertexBuffers[r]?this._userInstancedBuffersStorage.vertexBuffers[r].updateDirectly(a,0):(this._userInstancedBuffersStorage.vertexBuffers[r]=new Si(this.getEngine(),this._userInstancedBuffersStorage.data[r],r,!0,!1,o,!0),this.setVerticesBuffer(this._userInstancedBuffersStorage.vertexBuffers[r]))}},ra.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(var e in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[e]&&this._userInstancedBuffersStorage.vertexBuffers[e].dispose();this.instancedBuffers={}};var wh,Lh=(n(Fh,wh=Ir),Object.defineProperty(Fh.prototype,"shaderPath",{get:function(){return this._shaderPath},set:function(e){this._shaderPath=e},enumerable:!0,configurable:!0}),Object.defineProperty(Fh.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),Fh.prototype.getClassName=function(){return"ShaderMaterial"},Fh.prototype.needAlphaBlending=function(){return this.alpha<1||this._options.needAlphaBlending},Fh.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},Fh.prototype._checkUniform=function(e){-1===this._options.uniforms.indexOf(e)&&this._options.uniforms.push(e)},Fh.prototype.setTexture=function(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._textures[e]=t,this},Fh.prototype.setTextureArray=function(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._checkUniform(e),this._textureArrays[e]=t,this},Fh.prototype.setFloat=function(e,t){return this._checkUniform(e),this._floats[e]=t,this},Fh.prototype.setInt=function(e,t){return this._checkUniform(e),this._ints[e]=t,this},Fh.prototype.setFloats=function(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this},Fh.prototype.setColor3=function(e,t){return this._checkUniform(e),this._colors3[e]=t,this},Fh.prototype.setColor3Array=function(e,t){return this._checkUniform(e),this._colors3Arrays[e]=t.reduce(function(e,t){return t.toArray(e,e.length),e},[]),this},Fh.prototype.setColor4=function(e,t){return this._checkUniform(e),this._colors4[e]=t,this},Fh.prototype.setColor4Array=function(e,t){return this._checkUniform(e),this._colors4Arrays[e]=t.reduce(function(e,t){return t.toArray(e,e.length),e},[]),this},Fh.prototype.setVector2=function(e,t){return this._checkUniform(e),this._vectors2[e]=t,this},Fh.prototype.setVector3=function(e,t){return this._checkUniform(e),this._vectors3[e]=t,this},Fh.prototype.setVector4=function(e,t){return this._checkUniform(e),this._vectors4[e]=t,this},Fh.prototype.setMatrix=function(e,t){return this._checkUniform(e),this._matrices[e]=t,this},Fh.prototype.setMatrices=function(e,t){this._checkUniform(e);for(var i=new Float32Array(16*t.length),r=0;r<t.length;r++)t[r].copyToArray(i,16*r);return this._matrixArrays[e]=i,this},Fh.prototype.setMatrix3x3=function(e,t){return this._checkUniform(e),this._matrices3x3[e]=t,this},Fh.prototype.setMatrix2x2=function(e,t){return this._checkUniform(e),this._matrices2x2[e]=t,this},Fh.prototype.setArray2=function(e,t){return this._checkUniform(e),this._vectors2Arrays[e]=t,this},Fh.prototype.setArray3=function(e,t){return this._checkUniform(e),this._vectors3Arrays[e]=t,this},Fh.prototype.setArray4=function(e,t){return this._checkUniform(e),this._vectors4Arrays[e]=t,this},Fh.prototype._checkCache=function(e,t){return!e||!this._effect||-1!==this._effect.defines.indexOf("#define INSTANCES")===t},Fh.prototype.isReadyForSubMesh=function(e,t,i){return this.isReady(e,i)},Fh.prototype.isReady=function(e,t){if(this._effect&&this.isFrozen&&this._effect._wasPreviouslyReady)return!0;var i=this.getScene(),r=i.getEngine();if(!this.checkReadyOnEveryCall&&this._renderId===i.getRenderId()&&this._checkCache(e,t))return!0;var n=[],o=[],s=new ns;r.getCaps().multiview&&i.activeCamera&&i.activeCamera.outputRenderTarget&&1<i.activeCamera.outputRenderTarget.getViewCount()&&(this._multiview=!0,n.push("#define MULTIVIEW"),-1!==this._options.uniforms.indexOf("viewProjection")&&-1===this._options.uniforms.push("viewProjectionR")&&this._options.uniforms.push("viewProjectionR"));for(var a=0;a<this._options.defines.length;a++)n.push(this._options.defines[a]);for(var h,a=0;a<this._options.attributes.length;a++)o.push(this._options.attributes[a]);for(var l in e&&e.isVerticesDataPresent(Si.ColorKind)&&(o.push(Si.ColorKind),n.push("#define VERTEXCOLOR")),t&&(n.push("#define INSTANCES"),bn.PushAttributesForInstances(o)),e&&e.useBones&&e.computeBonesUsingShaders&&e.skeleton?(o.push(Si.MatricesIndicesKind),o.push(Si.MatricesWeightsKind),4<e.numBoneInfluencers&&(o.push(Si.MatricesIndicesExtraKind),o.push(Si.MatricesWeightsExtraKind)),h=e.skeleton,n.push("#define NUM_BONE_INFLUENCERS "+e.numBoneInfluencers),s.addCPUSkinningFallback(0,e),h.isUsingTextureForMatrices?(n.push("#define BONETEXTURE"),-1===this._options.uniforms.indexOf("boneTextureWidth")&&this._options.uniforms.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(n.push("#define BonesPerMesh "+(h.bones.length+1)),-1===this._options.uniforms.indexOf("mBones")&&this._options.uniforms.push("mBones"))):n.push("#define NUM_BONE_INFLUENCERS 0"),this._textures)if(!this._textures[l].isReady())return!1;e&&this._shouldTurnAlphaTestOn(e)&&n.push("#define ALPHATEST");var u=this._effect,c=n.join("\n");return this._effect=r.createEffect(this._shaderPath,{attributes:o,uniformsNames:this._options.uniforms,uniformBuffersNames:this._options.uniformBuffers,samplers:this._options.samplers,defines:c,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError},r),!!this._effect.isReady()&&(u!==this._effect&&i.resetCachedMaterial(),this._renderId=i.getRenderId(),this._effect._wasPreviouslyReady=!0)},Fh.prototype.bindOnlyWorldMatrix=function(e){var t=this.getScene();this._effect&&(-1!==this._options.uniforms.indexOf("world")&&this._effect.setMatrix("world",e),-1!==this._options.uniforms.indexOf("worldView")&&(e.multiplyToRef(t.getViewMatrix(),this._cachedWorldViewMatrix),this._effect.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(e.multiplyToRef(t.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),this._effect.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)))},Fh.prototype.bind=function(e,t){if(this.bindOnlyWorldMatrix(e),this._effect&&this.getScene().getCachedMaterial()!==this){var i;for(i in-1!==this._options.uniforms.indexOf("view")&&this._effect.setMatrix("view",this.getScene().getViewMatrix()),-1!==this._options.uniforms.indexOf("projection")&&this._effect.setMatrix("projection",this.getScene().getProjectionMatrix()),-1!==this._options.uniforms.indexOf("viewProjection")&&(this._effect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._multiview&&this._effect.setMatrix("viewProjectionR",this.getScene()._transformMatrixR)),this.getScene().activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&this._effect.setVector3("cameraPosition",this.getScene().activeCamera.globalPosition),bn.BindBonesParameters(t,this._effect),this._textures)this._effect.setTexture(i,this._textures[i]);for(i in this._textureArrays)this._effect.setTextureArray(i,this._textureArrays[i]);for(i in this._ints)this._effect.setInt(i,this._ints[i]);for(i in this._floats)this._effect.setFloat(i,this._floats[i]);for(i in this._floatsArrays)this._effect.setArray(i,this._floatsArrays[i]);for(i in this._colors3)this._effect.setColor3(i,this._colors3[i]);for(i in this._colors3Arrays)this._effect.setArray3(i,this._colors3Arrays[i]);for(i in this._colors4){var r=this._colors4[i];this._effect.setFloat4(i,r.r,r.g,r.b,r.a)}for(i in this._colors4Arrays)this._effect.setArray4(i,this._colors4Arrays[i]);for(i in this._vectors2)this._effect.setVector2(i,this._vectors2[i]);for(i in this._vectors3)this._effect.setVector3(i,this._vectors3[i]);for(i in this._vectors4)this._effect.setVector4(i,this._vectors4[i]);for(i in this._matrices)this._effect.setMatrix(i,this._matrices[i]);for(i in this._matrixArrays)this._effect.setMatrices(i,this._matrixArrays[i]);for(i in this._matrices3x3)this._effect.setMatrix3x3(i,this._matrices3x3[i]);for(i in this._matrices2x2)this._effect.setMatrix2x2(i,this._matrices2x2[i]);for(i in this._vectors2Arrays)this._effect.setArray2(i,this._vectors2Arrays[i]);for(i in this._vectors3Arrays)this._effect.setArray3(i,this._vectors3Arrays[i]);for(i in this._vectors4Arrays)this._effect.setArray4(i,this._vectors4Arrays[i])}this._afterBind(t)},Fh.prototype.getActiveTextures=function(){var e=wh.prototype.getActiveTextures.call(this);for(var t in this._textures)e.push(this._textures[t]);for(var t in this._textureArrays)for(var i=this._textureArrays[t],r=0;r<i.length;r++)e.push(i[r]);return e},Fh.prototype.hasTexture=function(e){if(wh.prototype.hasTexture.call(this,e))return!0;for(var t in this._textures)if(this._textures[t]===e)return!0;for(var t in this._textureArrays)for(var i=this._textureArrays[t],r=0;r<i.length;r++)if(i[r]===e)return!0;return!1},Fh.prototype.clone=function(e){var i=this,t=Q.Clone(function(){return new Fh(e,i.getScene(),i._shaderPath,i._options)},this);for(var r in t.name=e,t.id=e,"object"==typeof t._shaderPath&&(t._shaderPath=l({},t._shaderPath)),this._options=l({},this._options),Object.keys(this._options).forEach(function(e){var t=i._options[e];Array.isArray(t)&&(i._options[e]=t.slice(0))}),this._textures)t.setTexture(r,this._textures[r]);for(var r in this._floats)t.setFloat(r,this._floats[r]);for(var r in this._floatsArrays)t.setFloats(r,this._floatsArrays[r]);for(var r in this._colors3)t.setColor3(r,this._colors3[r]);for(var r in this._colors4)t.setColor4(r,this._colors4[r]);for(var r in this._vectors2)t.setVector2(r,this._vectors2[r]);for(var r in this._vectors3)t.setVector3(r,this._vectors3[r]);for(var r in this._vectors4)t.setVector4(r,this._vectors4[r]);for(var r in this._matrices)t.setMatrix(r,this._matrices[r]);for(var r in this._matrices3x3)t.setMatrix3x3(r,this._matrices3x3[r]);for(var r in this._matrices2x2)t.setMatrix2x2(r,this._matrices2x2[r]);return t},Fh.prototype.dispose=function(e,t,i){if(t){var r;for(r in this._textures)this._textures[r].dispose();for(r in this._textureArrays)for(var n=this._textureArrays[r],o=0;o<n.length;o++)n[o].dispose()}this._textures={},wh.prototype.dispose.call(this,e,t,i)},Fh.prototype.serialize=function(){var e,t=Q.Serialize(this);for(e in t.customType="BABYLON.ShaderMaterial",t.options=this._options,t.shaderPath=this._shaderPath,t.textures={},this._textures)t.textures[e]=this._textures[e].serialize();for(e in t.textureArrays={},this._textureArrays){t.textureArrays[e]=[];for(var i=this._textureArrays[e],r=0;r<i.length;r++)t.textureArrays[e].push(i[r].serialize())}for(e in t.floats={},this._floats)t.floats[e]=this._floats[e];for(e in t.FloatArrays={},this._floatsArrays)t.FloatArrays[e]=this._floatsArrays[e];for(e in t.colors3={},this._colors3)t.colors3[e]=this._colors3[e].asArray();for(e in t.colors3Arrays={},this._colors3Arrays)t.colors3Arrays[e]=this._colors3Arrays[e];for(e in t.colors4={},this._colors4)t.colors4[e]=this._colors4[e].asArray();for(e in t.colors4Arrays={},this._colors4Arrays)t.colors4Arrays[e]=this._colors4Arrays[e];for(e in t.vectors2={},this._vectors2)t.vectors2[e]=this._vectors2[e].asArray();for(e in t.vectors3={},this._vectors3)t.vectors3[e]=this._vectors3[e].asArray();for(e in t.vectors4={},this._vectors4)t.vectors4[e]=this._vectors4[e].asArray();for(e in t.matrices={},this._matrices)t.matrices[e]=this._matrices[e].asArray();for(e in t.matrixArray={},this._matrixArrays)t.matrixArray[e]=this._matrixArrays[e];for(e in t.matrices3x3={},this._matrices3x3)t.matrices3x3[e]=this._matrices3x3[e];for(e in t.matrices2x2={},this._matrices2x2)t.matrices2x2[e]=this._matrices2x2[e];for(e in t.vectors2Arrays={},this._vectors2Arrays)t.vectors2Arrays[e]=this._vectors2Arrays[e];for(e in t.vectors3Arrays={},this._vectors3Arrays)t.vectors3Arrays[e]=this._vectors3Arrays[e];for(e in t.vectors4Arrays={},this._vectors4Arrays)t.vectors4Arrays[e]=this._vectors4Arrays[e];return t},Fh.Parse=function(e,t,i){var r,n=Q.Parse(function(){return new Fh(e.name,t,e.shaderPath,e.options)},e,t,i);for(r in e.textures)n.setTexture(r,Pn.Parse(e.textures[r],t,i));for(r in e.textureArrays){for(var o=e.textureArrays[r],s=new Array,a=0;a<o.length;a++)s.push(Pn.Parse(o[a],t,i));n.setTextureArray(r,s)}for(r in e.floats)n.setFloat(r,e.floats[r]);for(r in e.floatsArrays)n.setFloats(r,e.floatsArrays[r]);for(r in e.colors3)n.setColor3(r,Ne.FromArray(e.colors3[r]));for(r in e.colors3Arrays){var h=e.colors3Arrays[r].reduce(function(e,t,i){return i%3==0?e.push([t]):e[e.length-1].push(t),e},[]).map(function(e){return Ne.FromArray(e)});n.setColor3Array(r,h)}for(r in e.colors4)n.setColor4(r,K.FromArray(e.colors4[r]));for(r in e.colors4Arrays)h=e.colors4Arrays[r].reduce(function(e,t,i){return i%4==0?e.push([t]):e[e.length-1].push(t),e},[]).map(function(e){return K.FromArray(e)}),n.setColor4Array(r,h);for(r in e.vectors2)n.setVector2(r,H.FromArray(e.vectors2[r]));for(r in e.vectors3)n.setVector3(r,te.FromArray(e.vectors3[r]));for(r in e.vectors4)n.setVector4(r,j.FromArray(e.vectors4[r]));for(r in e.matrices)n.setMatrix(r,W.FromArray(e.matrices[r]));for(r in e.matrixArray)n._matrixArrays[r]=new Float32Array(e.matrixArray[r]);for(r in e.matrices3x3)n.setMatrix3x3(r,e.matrices3x3[r]);for(r in e.matrices2x2)n.setMatrix2x2(r,e.matrices2x2[r]);for(r in e.vectors2Arrays)n.setArray2(r,e.vectors2Arrays[r]);for(r in e.vectors3Arrays)n.setArray3(r,e.vectors3Arrays[r]);for(r in e.vectors4Arrays)n.setArray4(r,e.vectors4Arrays[r]);return n},Fh);function Fh(e,t,i,r){void 0===r&&(r={});var n=wh.call(this,e,t)||this;return n._textures={},n._textureArrays={},n._floats={},n._ints={},n._floatsArrays={},n._colors3={},n._colors3Arrays={},n._colors4={},n._colors4Arrays={},n._vectors2={},n._vectors3={},n._vectors4={},n._matrices={},n._matrixArrays={},n._matrices3x3={},n._matrices2x2={},n._vectors2Arrays={},n._vectors3Arrays={},n._vectors4Arrays={},n._cachedWorldViewMatrix=new W,n._cachedWorldViewProjectionMatrix=new W,n._multiview=!1,n._shaderPath=i,n._options=l({needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],defines:[]},r),n}m.RegisteredTypes["BABYLON.ShaderMaterial"]=Lh;var Nh,Bh="colorPixelShader",kh="#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#else\nuniform vec4 color;\n#endif\n#include<clipPlaneFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\n#ifdef VERTEXCOLOR\ngl_FragColor=vColor;\n#else\ngl_FragColor=color;\n#endif\n}",Uh=(st.ShadersStore[Bh]=kh,"colorVertexShader"),Vh="\nattribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<clipPlaneVertexDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef MULTIVIEW\nuniform mat4 viewProjectionR;\n#endif\n\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR == 0u) {\ngl_Position=viewProjection*worldPos;\n} else {\ngl_Position=viewProjectionR*worldPos;\n}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\n#include<clipPlaneVertex>\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n}",zh=(st.ShadersStore[Uh]=Vh,n(Wh,Nh=ra),Wh.prototype._addClipPlaneDefine=function(e){var t="#define "+e;-1===this._colorShader.options.defines.indexOf(t)&&this._colorShader.options.defines.push(t)},Wh.prototype._removeClipPlaneDefine=function(e){var t="#define "+e,i=this._colorShader.options.defines.indexOf(t);-1!==i&&this._colorShader.options.defines.splice(i,1)},Wh.prototype.isReady=function(){var e=this.getScene();return e.clipPlane?this._addClipPlaneDefine("CLIPPLANE"):this._removeClipPlaneDefine("CLIPPLANE"),e.clipPlane2?this._addClipPlaneDefine("CLIPPLANE2"):this._removeClipPlaneDefine("CLIPPLANE2"),e.clipPlane3?this._addClipPlaneDefine("CLIPPLANE3"):this._removeClipPlaneDefine("CLIPPLANE3"),e.clipPlane4?this._addClipPlaneDefine("CLIPPLANE4"):this._removeClipPlaneDefine("CLIPPLANE4"),e.clipPlane5?this._addClipPlaneDefine("CLIPPLANE5"):this._removeClipPlaneDefine("CLIPPLANE5"),e.clipPlane6?this._addClipPlaneDefine("CLIPPLANE6"):this._removeClipPlaneDefine("CLIPPLANE6"),!!this._colorShader.isReady()&&Nh.prototype.isReady.call(this)},Wh.prototype.getClassName=function(){return"LinesMesh"},Object.defineProperty(Wh.prototype,"material",{get:function(){return this._colorShader},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(Wh.prototype,"checkCollisions",{get:function(){return!1},enumerable:!0,configurable:!0}),Wh.prototype._bind=function(e,t,i){if(!this._geometry)return this;var r,n,o,s,a=this._colorShader.getEffect(),h=this.isUnIndexed?null:this._geometry.getIndexBuffer();return this._geometry._bind(a,h),this.useVertexColor||(n=(r=this.color).r,o=r.g,s=r.b,this.color4.set(n,o,s,this.alpha),this._colorShader.setColor4("color",this.color4)),bn.BindClipPlane(a,this.getScene()),this},Wh.prototype._draw=function(e,t,i){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;var r=this.getScene().getEngine();return this._unIndexed?r.drawArraysType(Ir.LineListDrawMode,e.verticesStart,e.verticesCount,i):r.drawElementsType(Ir.LineListDrawMode,e.indexStart,e.indexCount,i),this},Wh.prototype.dispose=function(e){this._colorShader.dispose(!1,!1,!0),Nh.prototype.dispose.call(this,e)},Wh.prototype.clone=function(e,t,i){return void 0===t&&(t=null),new Wh(e,this.getScene(),t,this,i)},Wh.prototype.createInstance=function(e){return new Xh(e,this)},Wh);function Wh(e,t,i,r,n,o,s){void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=null);var a=Nh.call(this,e,t,i,r,n)||this;a.useVertexColor=o,a.useVertexAlpha=s,a.color=new Ne(1,1,1),a.alpha=1,r&&(a.color=r.color.clone(),a.alpha=r.alpha,a.useVertexColor=r.useVertexColor,a.useVertexAlpha=r.useVertexAlpha),a.intersectionThreshold=.1;var h={attributes:[Si.PositionKind,"world0","world1","world2","world3"],uniforms:["vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","world","viewProjection"],needAlphaBlending:!0,defines:[]};return!1===s&&(h.needAlphaBlending=!1),o?(h.defines.push("#define VERTEXCOLOR"),h.attributes.push(Si.ColorKind)):(h.uniforms.push("color"),a.color4=new K),a._colorShader=new Lh("colorShader",a.getScene(),"color",h),a}var Gh,Xh=(n(Hh,Gh=Rh),Hh.prototype.getClassName=function(){return"InstancedLinesMesh"},Hh);function Hh(e,t){var i=Gh.call(this,e,t)||this;return i.intersectionThreshold=t.intersectionThreshold,i}Ri.CreateRibbon=function(e){var t,i=e.pathArray,r=e.closeArray||!1,n=e.closePath||!1,o=e.invertUV||!1,s=Math.floor(i[0].length/2),a=s<(a=e.offset||s)?s:Math.floor(a),h=0===e.sideOrientation?0:e.sideOrientation||Ri.DEFAULTSIDE,l=e.uvs,u=e.colors,c=[],d=[],f=[],p=[],_=[],g=[],m=[],v=[],y=[],b=[];if(i.length<2){for(var T=[],x=[],E=0;E<i[0].length-a;E++)T.push(i[0][E]),x.push(i[0][E+a]);i=[T,x]}var A,M,C,P,O,S=0,I=n?1:0,R=i[0].length;for(X=0;X<i.length;X++){for(m[X]=0,_[X]=[0],R=R<(M=(A=i[X]).length)?R:M,t=0;t<M;)c.push(A[t].x,A[t].y,A[t].z),0<t&&(C=A[t].subtract(A[t-1]).length()+m[X],_[X].push(C),m[X]=C),t++;n&&(t--,c.push(A[0].x,A[0].y,A[0].z),C=A[t].subtract(A[0]).length()+m[X],_[X].push(C),m[X]=C),y[X]=M+I,b[X]=S,S+=M+I}var D,w,L=null,F=null;for(E=0;E<R+I;E++){for(v[E]=0,g[E]=[0],X=0;X<i.length-1;X++)P=i[X],O=i[X+1],C=(F=E===R?(L=P[0],O[0]):(L=P[E],O[E])).subtract(L).length()+v[E],g[E].push(C),v[E]=C;r&&F&&L&&(P=i[X],O=i[0],E===R&&(F=O[0]),C=F.subtract(L).length()+v[E],v[E]=C)}if(l)for(X=0;X<l.length;X++)p.push(l[X].x,l[X].y);else for(X=0;X<i.length;X++)for(E=0;E<R+I;E++)D=0!=m[X]?_[X][E]/m[X]:0,w=0!=v[E]?g[E][X]/v[E]:0,o?p.push(w,D):p.push(D,w);for(var N=X=0,B=y[X]-1,k=y[X+1]-1,U=B<k?B:k,V=b[1]-b[0],z=r?y.length:y.length-1;N<=U&&X<z;)d.push(N,N+V,N+1),d.push(N+V+1,N+1,N+V),(N+=1)===U&&(k=++X===y.length-1?(V=b[0]-b[X],B=y[X]-1,y[0]-1):(V=b[X+1]-b[X],B=y[X]-1,y[X+1]-1),N=b[X],U=B<k?B+N:k+N);if(Ri.ComputeNormals(c,d,f),n)for(var W,G=0,X=0;X<i.length;X++)W=3*b[X],G=X+1<i.length?3*(b[X+1]-1):f.length-3,f[W]=.5*(f[W]+f[G]),f[1+W]=.5*(f[1+W]+f[G+1]),f[2+W]=.5*(f[2+W]+f[G+2]),f[G]=f[W],f[G+1]=f[1+W],f[G+2]=f[2+W];Ri._ComputeSides(h,c,d,f,p,e.frontUVs,e.backUVs);var H=null;if(u){H=new Float32Array(4*u.length);for(var j=0;j<u.length;j++)H[4*j]=u[j].r,H[4*j+1]=u[j].g,H[4*j+2]=u[j].b,H[4*j+3]=u[j].a}var K=new Ri,Y=new Float32Array(c),q=new Float32Array(f),Z=new Float32Array(p);return K.indices=d,K.positions=Y,K.normals=q,K.uvs=Z,H&&K.set(H,Si.ColorKind),n&&(K._idx=b),K},ra.CreateRibbon=function(e,t,i,r,n,o,s,a,h){return void 0===i&&(i=!1),void 0===s&&(s=!1),jh.CreateRibbon(e,{pathArray:t,closeArray:i,closePath:r,offset:n,updatable:s,sideOrientation:a,instance:h},o)};var jh=(Kh.CreateRibbon=function(e,t,i){void 0===i&&(i=null);var c=t.pathArray,r=t.closeArray,n=t.closePath,o=ra._GetDefaultSideOrientation(t.sideOrientation),d=t.instance,s=t.updatable;if(d){var f=P.Vector3[0].setAll(Number.MAX_VALUE),p=P.Vector3[1].setAll(-Number.MAX_VALUE),a=d.getVerticesData(Si.PositionKind);if(function(e){for(var t=c[0].length,i=d,r=0,n=i._originalBuilderSideOrientation===ra.DOUBLESIDE?2:1,o=1;o<=n;++o)for(var s=0;s<c.length;++s){for(var a=c[s],h=a.length,t=t<h?t:h,l=0;l<t;++l){var u=a[l];e[r]=u.x,e[r+1]=u.y,e[r+2]=u.z,f.minimizeInPlaceFromFloats(u.x,u.y,u.z),p.maximizeInPlaceFromFloats(u.x,u.y,u.z),r+=3}i._creationDataStorage&&i._creationDataStorage.closePath&&(u=a[0],e[r]=u.x,e[r+1]=u.y,e[r+2]=u.z,r+=3)}}(a),d._boundingInfo?d._boundingInfo.reConstruct(f,p,d._worldMatrix):d._boundingInfo=new Gi(f,p,d._worldMatrix),d.updateVerticesData(Si.PositionKind,a,!1,!1),t.colors){for(var h=d.getVerticesData(Si.ColorKind),l=0,u=0;l<t.colors.length;l++,u+=4){var _=t.colors[l];h[u]=_.r,h[u+1]=_.g,h[u+2]=_.b,h[u+3]=_.a}d.updateVerticesData(Si.ColorKind,h,!1,!1)}if(t.uvs){for(var g=d.getVerticesData(Si.UVKind),m=0;m<t.uvs.length;m++)g[2*m]=t.uvs[m].x,g[2*m+1]=t.uvs[m].y;d.updateVerticesData(Si.UVKind,g,!1,!1)}if(!d.areNormalsFrozen||d.isFacetDataEnabled){var v=d.getIndices(),y=d.getVerticesData(Si.NormalKind),b=d.isFacetDataEnabled?d.getFacetDataParameters():null;if(Ri.ComputeNormals(a,v,y,b),d._creationDataStorage&&d._creationDataStorage.closePath)for(var T,x=0,E=0;E<c.length;E++)T=3*d._creationDataStorage.idx[E],x=E+1<c.length?3*(d._creationDataStorage.idx[E+1]-1):y.length-3,y[T]=.5*(y[T]+y[x]),y[1+T]=.5*(y[1+T]+y[x+1]),y[2+T]=.5*(y[2+T]+y[x+2]),y[x]=y[T],y[x+1]=y[1+T],y[x+2]=y[2+T];d.areNormalsFrozen||d.updateVerticesData(Si.NormalKind,y,!1,!1)}return d}var A=new ra(e,i);A._originalBuilderSideOrientation=o,A._creationDataStorage=new $s;var M=Ri.CreateRibbon(t);return n&&(A._creationDataStorage.idx=M._idx),A._creationDataStorage.closePath=n,A._creationDataStorage.closeArray=r,M.applyToMesh(A,s),A},Kh);function Kh(){}Ri.CreateDisc=function(e){var t=new Array,i=new Array,r=new Array,n=new Array,o=e.radius||.5,s=e.tessellation||64,a=(!e.arc||!(e.arc<=0||1<e.arc))&&e.arc||1,h=0===e.sideOrientation?0:e.sideOrientation||Ri.DEFAULTSIDE;t.push(0,0,0),n.push(.5,.5);for(var l=2*Math.PI*a,u=l/s,c=0;c<l;c+=u){var d=Math.cos(c),f=Math.sin(c),p=(d+1)/2,_=(1-f)/2;t.push(o*d,o*f,0),n.push(p,_)}1===a&&(t.push(t[3],t[4],t[5]),n.push(n[2],n[3]));for(var g=t.length/3,m=1;m<g-1;m++)i.push(m+1,0,m);Ri.ComputeNormals(t,i,r),Ri._ComputeSides(h,t,i,r,n,e.frontUVs,e.backUVs);var v=new Ri;return v.indices=i,v.positions=t,v.normals=r,v.uvs=n,v},ra.CreateDisc=function(e,t,i,r,n,o){void 0===r&&(r=null);var s={radius:t,tessellation:i,sideOrientation:o,updatable:n};return Yh.CreateDisc(e,s,r)};var Yh=(qh.CreateDisc=function(e,t,i){void 0===i&&(i=null);var r=new ra(e,i);return t.sideOrientation=ra._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,Ri.CreateDisc(t).applyToMesh(r,t.updatable),r},qh);function qh(){}Ri.CreateBox=function(e){var t=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],i=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],r=[],n=e.width||e.size||1,o=e.height||e.size||1,s=e.depth||e.size||1,a=e.wrap||!1,h=void 0===e.topBaseAt?1:e.topBaseAt,l=void 0===e.bottomBaseAt?0:e.bottomBaseAt,u=[2,0,3,1][h=(h+4)%4],c=[2,0,1,3][l=(l+4)%4],d=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(a){t=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],d=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];for(var f=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],p=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]],_=[17,18,19,16],g=[22,23,20,21];0<u;)f.unshift(f.pop()),_.unshift(_.pop()),u--;for(;0<c;)p.unshift(p.pop()),g.unshift(g.pop()),c--;f=f.flat(),p=p.flat(),d=d.concat(f).concat(p),t.push(_[0],_[2],_[3],_[0],_[1],_[2]),t.push(g[0],g[2],g[3],g[0],g[1],g[2])}for(var m=[n/2,o/2,s/2],v=d.reduce(function(e,t,i){return e.concat(t*m[i%3])},[]),y=0===e.sideOrientation?0:e.sideOrientation||Ri.DEFAULTSIDE,b=e.faceUV||new Array(6),T=e.faceColors,x=[],E=0;E<6;E++)void 0===b[E]&&(b[E]=new j(0,0,1,1)),T&&void 0===T[E]&&(T[E]=new K(1,1,1,1));for(var A=0;A<6;A++)if(r.push(b[A].z,b[A].w),r.push(b[A].x,b[A].w),r.push(b[A].x,b[A].y),r.push(b[A].z,b[A].y),T)for(var M=0;M<4;M++)x.push(T[A].r,T[A].g,T[A].b,T[A].a);Ri._ComputeSides(y,v,t,i,r,e.frontUVs,e.backUVs);var C,P=new Ri;return P.indices=t,P.positions=v,P.normals=i,P.uvs=r,T&&(C=y===Ri.DOUBLESIDE?x.concat(x):x,P.colors=C),P},ra.CreateBox=function(e,t,i,r,n){void 0===i&&(i=null);var o={size:t,sideOrientation:n,updatable:r};return Zh.CreateBox(e,o,i)};var Zh=(Qh.CreateBox=function(e,t,i){void 0===i&&(i=null);var r=new ra(e,i);return t.sideOrientation=ra._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,Ri.CreateBox(t).applyToMesh(r,t.updatable),r},Qh);function Qh(){}Ri.CreateTiledBox=function(e){for(var t=e.faceUV||new Array(6),i=e.faceColors,r=e.pattern||ra.NO_FLIP,n=e.width||e.size||1,o=e.height||e.size||1,s=e.depth||e.size||1,a=e.tileWidth||e.tileSize||1,h=e.tileHeight||e.tileSize||1,l=e.alignHorizontal||0,u=e.alignVertical||0,c=0===e.sideOrientation?0:e.sideOrientation||Ri.DEFAULTSIDE,d=0;d<6;d++)void 0===t[d]&&(t[d]=new j(0,0,1,1)),i&&void 0===i[d]&&(i[d]=new K(1,1,1,1));for(var f=n/2,p=o/2,_=s/2,g=[],d=0;d<2;d++)g[d]=Ri.CreateTiledPlane({pattern:r,tileWidth:a,tileHeight:h,width:n,height:o,alignVertical:u,alignHorizontal:l,sideOrientation:c});for(d=2;d<4;d++)g[d]=Ri.CreateTiledPlane({pattern:r,tileWidth:a,tileHeight:h,width:s,height:o,alignVertical:u,alignHorizontal:l,sideOrientation:c});var m=u;u===ra.BOTTOM?m=ra.TOP:u===ra.TOP&&(m=ra.BOTTOM);for(d=4;d<6;d++)g[d]=Ri.CreateTiledPlane({pattern:r,tileWidth:a,tileHeight:h,width:n,height:s,alignVertical:m,alignHorizontal:l,sideOrientation:c});for(var v,y=[],b=[],T=[],x=[],E=[],A=[],M=[],C=[],P=0,d=0;d<6;d++){var O=g[d].positions.length;A[d]=[],M[d]=[];for(var S=0;S<O/3;S++)A[d].push(new te(g[d].positions[3*S],g[d].positions[3*S+1],g[d].positions[3*S+2])),M[d].push(new te(g[d].normals[3*S],g[d].normals[3*S+1],g[d].normals[3*S+2]));v=g[d].uvs.length,C[d]=[];for(var I=0;I<v;I+=2)C[d][I]=t[d].x+(t[d].z-t[d].x)*g[d].uvs[I],C[d][I+1]=t[d].y+(t[d].w-t[d].y)*g[d].uvs[I+1];if(T=T.concat(C[d]),x=x.concat(g[d].indices.map(function(e){return e+P})),P+=A[d].length,i)for(var R=0;R<4;R++)E.push(i[d].r,i[d].g,i[d].b,i[d].a)}var D=new te(0,0,_),w=W.RotationY(Math.PI),y=A[0].map(function(e){return te.TransformNormal(e,w).add(D)}).map(function(e){return[e.x,e.y,e.z]}).reduce(function(e,t){return e.concat(t)},[]),b=M[0].map(function(e){return te.TransformNormal(e,w)}).map(function(e){return[e.x,e.y,e.z]}).reduce(function(e,t){return e.concat(t)},[]);y=y.concat(A[1].map(function(e){return e.subtract(D)}).map(function(e){return[e.x,e.y,e.z]}).reduce(function(e,t){return e.concat(t)},[])),b=b.concat(M[1].map(function(e){return[e.x,e.y,e.z]}).reduce(function(e,t){return e.concat(t)},[]));var L=new te(f,0,0),F=W.RotationY(-Math.PI/2);y=y.concat(A[2].map(function(e){return te.TransformNormal(e,F).add(L)}).map(function(e){return[e.x,e.y,e.z]}).reduce(function(e,t){return e.concat(t)},[])),b=b.concat(M[2].map(function(e){return te.TransformNormal(e,F)}).map(function(e){return[e.x,e.y,e.z]}).reduce(function(e,t){return e.concat(t)},[]));var N=W.RotationY(Math.PI/2);y=y.concat(A[3].map(function(e){return te.TransformNormal(e,N).subtract(L)}).map(function(e){return[e.x,e.y,e.z]}).reduce(function(e,t){return e.concat(t)},[])),b=b.concat(M[3].map(function(e){return te.TransformNormal(e,N)}).map(function(e){return[e.x,e.y,e.z]}).reduce(function(e,t){return e.concat(t)},[]));var B=new te(0,p,0),k=W.RotationX(Math.PI/2);y=y.concat(A[4].map(function(e){return te.TransformNormal(e,k).add(B)}).map(function(e){return[e.x,e.y,e.z]}).reduce(function(e,t){return e.concat(t)},[])),b=b.concat(M[4].map(function(e){return te.TransformNormal(e,k)}).map(function(e){return[e.x,e.y,e.z]}).reduce(function(e,t){return e.concat(t)},[]));var U=W.RotationX(-Math.PI/2);y=y.concat(A[5].map(function(e){return te.TransformNormal(e,U).subtract(B)}).map(function(e){return[e.x,e.y,e.z]}).reduce(function(e,t){return e.concat(t)},[])),b=b.concat(M[5].map(function(e){return te.TransformNormal(e,U)}).map(function(e){return[e.x,e.y,e.z]}).reduce(function(e,t){return e.concat(t)},[])),Ri._ComputeSides(c,y,x,b,T);var V,z=new Ri;return z.indices=x,z.positions=y,z.normals=b,z.uvs=T,i&&(V=c===Ri.DOUBLESIDE?E.concat(E):E,z.colors=V),z};var Jh=($h.CreateTiledBox=function(e,t,i){void 0===i&&(i=null);var r=new ra(e,i);return t.sideOrientation=ra._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,Ri.CreateTiledBox(t).applyToMesh(r,t.updatable),r},$h);function $h(){}Ri.CreateSphere=function(e){for(var t=e.segments||32,i=e.diameterX||e.diameter||1,r=e.diameterY||e.diameter||1,n=e.diameterZ||e.diameter||1,o=(!e.arc||!(e.arc<=0||1<e.arc))&&e.arc||1,s=!(e.slice&&e.slice<=0)&&e.slice||1,a=0===e.sideOrientation?0:e.sideOrientation||Ri.DEFAULTSIDE,h=new te(i/2,r/2,n/2),l=2+t,u=2*l,c=[],d=[],f=[],p=[],_=0;_<=l;_++){for(var g=_/l,m=g*Math.PI*s,v=0;v<=u;v++){var y=v/u,b=y*Math.PI*2*o,T=W.RotationZ(-m),x=W.RotationY(b),E=te.TransformCoordinates(te.Up(),T),A=te.TransformCoordinates(E,x),M=A.multiply(h),C=A.divide(h).normalize();d.push(M.x,M.y,M.z),f.push(C.x,C.y,C.z),p.push(y,g)}if(0<_)for(var P=d.length/3,O=P-2*(1+u);O+u+2<P;O++)c.push(O),c.push(O+1),c.push(O+u+1),c.push(O+u+1),c.push(O+1),c.push(O+u+2)}Ri._ComputeSides(a,d,c,f,p,e.frontUVs,e.backUVs);var S=new Ri;return S.indices=c,S.positions=d,S.normals=f,S.uvs=p,S},ra.CreateSphere=function(e,t,i,r,n,o){var s={segments:t,diameterX:i,diameterY:i,diameterZ:i,sideOrientation:o,updatable:n};return el.CreateSphere(e,s,r)};var el=(tl.CreateSphere=function(e,t,i){void 0===i&&(i=null);var r=new ra(e,i);return t.sideOrientation=ra._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,Ri.CreateSphere(t).applyToMesh(r,t.updatable),r},tl);function tl(){}Ri.CreateCylinder=function(e){for(var p=e.height||2,_=0===e.diameterTop?0:e.diameterTop||e.diameter||1,g=0===e.diameterBottom?0:e.diameterBottom||e.diameter||1,_=_||1e-5,g=g||1e-5,m=e.tessellation||24,t=e.subdivisions||1,i=!!e.hasRings,r=!!e.enclose,n=0===e.cap?0:e.cap||ra.CAP_ALL,v=(!e.arc||!(e.arc<=0||1<e.arc))&&e.arc||1,o=0===e.sideOrientation?0:e.sideOrientation||Ri.DEFAULTSIDE,y=e.faceUV||new Array(3),b=e.faceColors,T=2+(1+(1!==v&&r?2:0))*(i?t:1),s=0;s<T;s++)b&&void 0===b[s]&&(b[s]=new K(1,1,1,1));for(s=0;s<T;s++)y&&void 0===y[s]&&(y[s]=new j(0,0,1,1));for(var a,h,l,u,c,x=new Array,E=new Array,A=new Array,M=new Array,C=new Array,d=2*Math.PI*v/m,f=(g-_)/2/p,P=te.Zero(),O=te.Zero(),S=te.Zero(),I=te.Zero(),R=te.Zero(),D=fi.Y,w=1,L=0,F=0,N=0;N<=t;N++)for(l=((h=N/t)*(_-g)+g)/2,c=i&&0!==N&&N!==t?2:1,u=0;u<c;u++){for(i&&(w+=u),r&&(w+=2*u),W=0;W<=m;W++)a=W*d,P.x=Math.cos(-a)*l,P.y=-p/2+h*p,P.z=Math.sin(-a)*l,0===_&&N===t?(O.x=A[A.length-3*(m+1)],O.y=A[A.length-3*(m+1)+1],O.z=A[A.length-3*(m+1)+2]):(O.x=P.x,O.z=P.z,O.y=Math.sqrt(O.x*O.x+O.z*O.z)*f,O.normalize()),0===W&&(S.copyFrom(P),I.copyFrom(O)),E.push(P.x,P.y,P.z),A.push(O.x,O.y,O.z),F=i?L!==w?y[w].y:y[w].w:y[w].y+(y[w].w-y[w].y)*h,M.push(y[w].x+(y[w].z-y[w].x)*W/m,F),b&&C.push(b[w].r,b[w].g,b[w].b,b[w].a);1!==v&&r&&(E.push(P.x,P.y,P.z),E.push(0,P.y,0),E.push(0,P.y,0),E.push(S.x,S.y,S.z),te.CrossToRef(D,O,R),R.normalize(),A.push(R.x,R.y,R.z,R.x,R.y,R.z),te.CrossToRef(I,D,R),R.normalize(),A.push(R.x,R.y,R.z,R.x,R.y,R.z),F=i?L!==w?y[w+1].y:y[w+1].w:y[w+1].y+(y[w+1].w-y[w+1].y)*h,M.push(y[w+1].x,F),M.push(y[w+1].z,F),F=i?L!==w?y[w+2].y:y[w+2].w:y[w+2].y+(y[w+2].w-y[w+2].y)*h,M.push(y[w+2].x,F),M.push(y[w+2].z,F),b&&(C.push(b[w+1].r,b[w+1].g,b[w+1].b,b[w+1].a),C.push(b[w+1].r,b[w+1].g,b[w+1].b,b[w+1].a),C.push(b[w+2].r,b[w+2].g,b[w+2].b,b[w+2].a),C.push(b[w+2].r,b[w+2].g,b[w+2].b,b[w+2].a))),L!==w&&(L=w)}var B=1!==v&&r?m+4:m;for(w=N=0;w<t;w++){for(var k=0,U=0,V=0,z=0,W=0;W<m;W++)k=N*(B+1)+W,U=(N+1)*(B+1)+W,V=N*(B+1)+(W+1),z=(N+1)*(B+1)+(W+1),x.push(k,U,V),x.push(z,V,U);1!==v&&r&&(x.push(k+2,U+2,V+2),x.push(z+2,V+2,U+2),x.push(k+4,U+4,V+4),x.push(z+4,V+4,U+4)),N=i?N+2:N+1}function G(e){var t=e?_/2:g/2;if(0!=t){var i,r=e?y[T-1]:y[0],n=null;b&&(n=e?b[T-1]:b[0]);var o=E.length/3,s=e?p/2:-p/2,a=new te(0,s,0);E.push(a.x,a.y,a.z),A.push(0,e?1:-1,0),M.push(r.x+.5*(r.z-r.x),r.y+.5*(r.w-r.y)),n&&C.push(n.r,n.g,n.b,n.a);for(var h=new H(.5,.5),l=0;l<=m;l++){i=2*Math.PI*l*v/m;var u=Math.cos(-i),c=Math.sin(-i),d=new te(u*t,s,c*t),f=new H(u*h.x+.5,c*h.y+.5);E.push(d.x,d.y,d.z),A.push(0,e?1:-1,0),M.push(r.x+(r.z-r.x)*f.x,r.y+(r.w-r.y)*f.y),n&&C.push(n.r,n.g,n.b,n.a)}for(l=0;l<m;l++)e?(x.push(o),x.push(o+(l+2)),x.push(o+(l+1))):(x.push(o),x.push(o+(l+1)),x.push(o+(l+2)))}}n!==ra.CAP_START&&n!==ra.CAP_ALL||G(!1),n!==ra.CAP_END&&n!==ra.CAP_ALL||G(!0),Ri._ComputeSides(o,E,x,A,M,e.frontUVs,e.backUVs);var X=new Ri;return X.indices=x,X.positions=E,X.normals=A,X.uvs=M,b&&(X.colors=C),X},ra.CreateCylinder=function(e,t,i,r,n,o,s,a,h){void 0!==s&&s instanceof _n||(void 0!==s&&(h=a||ra.DEFAULTSIDE,a=s),s=o,o=1);var l={height:t,diameterTop:i,diameterBottom:r,tessellation:n,subdivisions:o,sideOrientation:h,updatable:a};return il.CreateCylinder(e,l,s)};var il=(rl.CreateCylinder=function(e,t,i){var r=new ra(e,i);return t.sideOrientation=ra._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,Ri.CreateCylinder(t).applyToMesh(r,t.updatable),r},rl);function rl(){}Ri.CreateTorus=function(e){for(var t=[],i=[],r=[],n=[],o=e.diameter||1,s=e.thickness||.5,a=e.tessellation||16,h=0===e.sideOrientation?0:e.sideOrientation||Ri.DEFAULTSIDE,l=a+1,u=0;u<=a;u++)for(var c=u/a,d=u*Math.PI*2/a-Math.PI/2,f=W.Translation(o/2,0,0).multiply(W.RotationY(d)),p=0;p<=a;p++){var _=1-p/a,g=p*Math.PI*2/a+Math.PI,m=Math.cos(g),v=Math.sin(g),y=(T=new te(m,v,0)).scale(s/2),b=new H(c,_),y=te.TransformCoordinates(y,f),T=te.TransformNormal(T,f);i.push(y.x,y.y,y.z),r.push(T.x,T.y,T.z),n.push(b.x,b.y);var x=(u+1)%l,E=(p+1)%l;t.push(u*l+p),t.push(u*l+E),t.push(x*l+p),t.push(u*l+E),t.push(x*l+E),t.push(x*l+p)}Ri._ComputeSides(h,i,t,r,n,e.frontUVs,e.backUVs);var A=new Ri;return A.indices=t,A.positions=i,A.normals=r,A.uvs=n,A},ra.CreateTorus=function(e,t,i,r,n,o,s){var a={diameter:t,thickness:i,tessellation:r,sideOrientation:s,updatable:o};return nl.CreateTorus(e,a,n)};var nl=(ol.CreateTorus=function(e,t,i){var r=new ra(e,i);return t.sideOrientation=ra._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,Ri.CreateTorus(t).applyToMesh(r,t.updatable),r},ol);function ol(){}Ri.CreateTorusKnot=function(e){for(var t,i=new Array,r=new Array,n=new Array,o=new Array,h=e.radius||2,s=e.tube||.5,a=e.radialSegments||32,l=e.tubularSegments||32,u=e.p||2,c=e.q||3,d=0===e.sideOrientation?0:e.sideOrientation||Ri.DEFAULTSIDE,f=function(e){var t=Math.cos(e),i=Math.sin(e),r=c/u*e,n=Math.cos(r),o=h*(2+n)*.5*t,s=h*(2+n)*i*.5,a=h*Math.sin(r)*.5;return new te(o,s,a)},p=0;p<=a;p++){var _=p%a/a*2*u*Math.PI,g=f(_),m=f(.01+_),v=m.subtract(g),y=m.add(g),b=te.Cross(v,y),y=te.Cross(b,v);for(b.normalize(),y.normalize(),t=0;t<l;t++){var T=t%l/l*2*Math.PI,x=-s*Math.cos(T),E=s*Math.sin(T);r.push(g.x+x*y.x+E*b.x),r.push(g.y+x*y.y+E*b.y),r.push(g.z+x*y.z+E*b.z),o.push(p/a),o.push(t/l)}}for(p=0;p<a;p++)for(t=0;t<l;t++){var A=(t+1)%l,M=p*l+t,C=(p+1)*l+t,P=(p+1)*l+A,O=p*l+A;i.push(O),i.push(C),i.push(M),i.push(O),i.push(P),i.push(C)}Ri.ComputeNormals(r,i,n),Ri._ComputeSides(d,r,i,n,o,e.frontUVs,e.backUVs);var S=new Ri;return S.indices=i,S.positions=r,S.normals=n,S.uvs=o,S},ra.CreateTorusKnot=function(e,t,i,r,n,o,s,a,h,l){var u={radius:t,tube:i,radialSegments:r,tubularSegments:n,p:o,q:s,sideOrientation:l,updatable:h};return sl.CreateTorusKnot(e,u,a)};var sl=(al.CreateTorusKnot=function(e,t,i){var r=new ra(e,i);return t.sideOrientation=ra._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,Ri.CreateTorusKnot(t).applyToMesh(r,t.updatable),r},al);function al(){}Ri.CreateLineSystem=function(e){for(var t=[],i=[],r=e.lines,n=e.colors,o=[],s=0,a=0;a<r.length;a++)for(var h,l=r[a],u=0;u<l.length;u++){i.push(l[u].x,l[u].y,l[u].z),n&&(h=n[a],o.push(h[u].r,h[u].g,h[u].b,h[u].a)),0<u&&(t.push(s-1),t.push(s)),s++}var c=new Ri;return c.indices=t,c.positions=i,n&&(c.colors=o),c},Ri.CreateDashedLines=function(e){for(var t,i,r,n,o=e.dashSize||3,s=e.gapSize||1,a=e.dashNb||200,h=e.points,l=new Array,u=new Array,c=te.Zero(),d=0,f=0,p=0,p=0;p<h.length-1;p++)h[p+1].subtractToRef(h[p],c),d+=c.length();for(r=o*(i=d/a)/(o+s),p=0;p<h.length-1;p++){h[p+1].subtractToRef(h[p],c),t=Math.floor(c.length()/i),c.normalize();for(var _=0;_<t;_++)n=i*_,l.push(h[p].x+n*c.x,h[p].y+n*c.y,h[p].z+n*c.z),l.push(h[p].x+(n+r)*c.x,h[p].y+(n+r)*c.y,h[p].z+(n+r)*c.z),u.push(f,f+1),f+=2}var g=new Ri;return g.positions=l,g.indices=u,g},ra.CreateLines=function(e,t,i,r,n){void 0===i&&(i=null),void 0===r&&(r=!1),void 0===n&&(n=null);var o={points:t,updatable:r,instance:n};return hl.CreateLines(e,o,i)},ra.CreateDashedLines=function(e,t,i,r,n,o,s,a){void 0===o&&(o=null);var h={points:t,dashSize:i,gapSize:r,dashNb:n,updatable:s,instance:a};return hl.CreateDashedLines(e,h,o)};var hl=(ll.CreateLineSystem=function(e,t,i){var r=t.instance,n=t.lines,o=t.colors;if(r){var s,a,h=r.getVerticesData(Si.PositionKind);o&&(s=r.getVerticesData(Si.ColorKind));for(var l=0,u=0,c=0;c<n.length;c++)for(var d=n[c],f=0;f<d.length;f++)h[l]=d[f].x,h[l+1]=d[f].y,h[l+2]=d[f].z,o&&s&&(a=o[c],s[u]=a[f].r,s[u+1]=a[f].g,s[u+2]=a[f].b,s[u+3]=a[f].a,u+=4),l+=3;return r.updateVerticesData(Si.PositionKind,h,!1,!1),o&&s&&r.updateVerticesData(Si.ColorKind,s,!1,!1),r}var p=new zh(e,i,null,void 0,void 0,!!o,t.useVertexAlpha);return Ri.CreateLineSystem(t).applyToMesh(p,t.updatable),p},ll.CreateLines=function(e,t,i){void 0===i&&(i=null);var r=t.colors?[t.colors]:null;return ll.CreateLineSystem(e,{lines:[t.points],updatable:t.updatable,instance:t.instance,colors:r,useVertexAlpha:t.useVertexAlpha},i)},ll.CreateDashedLines=function(e,t,i){void 0===i&&(i=null);var d=t.points,f=t.instance,r=t.gapSize||1,n=t.dashSize||3;if(f)return f.updateMeshPositions(function(e){for(var t,i,r,n=te.Zero(),o=e.length/6,s=0,a=0,h=0,l=0,h=0;h<d.length-1;h++)d[h+1].subtractToRef(d[h],n),s+=n.length();i=s/o;var u=f._creationDataStorage.dashSize,c=u*i/(u+f._creationDataStorage.gapSize);for(h=0;h<d.length-1;h++)for(d[h+1].subtractToRef(d[h],n),t=Math.floor(n.length()/i),n.normalize(),l=0;l<t&&a<e.length;)r=i*l,e[a]=d[h].x+r*n.x,e[a+1]=d[h].y+r*n.y,e[a+2]=d[h].z+r*n.z,e[a+3]=d[h].x+(r+c)*n.x,e[a+4]=d[h].y+(r+c)*n.y,e[a+5]=d[h].z+(r+c)*n.z,a+=6,l++;for(;a<e.length;)e[a]=d[h].x,e[a+1]=d[h].y,e[a+2]=d[h].z,a+=3},!1),f;var o=new zh(e,i,null,void 0,void 0,void 0,t.useVertexAlpha);return Ri.CreateDashedLines(t).applyToMesh(o,t.updatable),o._creationDataStorage=new $s,o._creationDataStorage.dashSize=n,o._creationDataStorage.gapSize=r,o},ll);function ll(){}var ul,cl=(n(dl,ul=H),dl);function dl(e,t){var i=ul.call(this,e.x,e.y)||this;return i.index=t,i}var fl=(pl.prototype.add=function(e){var i=this,r=new Array;return e.forEach(function(e){var t;0!==r.length&&e.equalsWithEpsilon(r[0])||(t=new cl(e,i.elements.length),r.push(t),i.elements.push(t))}),r},pl.prototype.computeBounds=function(){var t=new H(this.elements[0].x,this.elements[0].y),i=new H(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(e){e.x<t.x?t.x=e.x:e.x>i.x&&(i.x=e.x),e.y<t.y?t.y=e.y:e.y>i.y&&(i.y=e.y)}),{min:t,max:i,width:i.x-t.x,height:i.y-t.y}},pl);function pl(){this.elements=new Array}_l.Rectangle=function(e,t,i,r){return[new H(e,t),new H(i,t),new H(i,r),new H(e,r)]},_l.Circle=function(e,t,i,r){void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=32);for(var n=new Array,o=0,s=2*Math.PI/r,a=0;a<r;a++)n.push(new H(t+Math.cos(o)*e,i+Math.sin(o)*e)),o-=s;return n},_l.Parse=function(e){for(var t=e.split(/[^-+eE\.\d]+/).map(parseFloat).filter(function(e){return!isNaN(e)}),i=[],r=0;r<(2147483646&t.length);r+=2)i.push(new H(t[r],t[r+1]));return i},_l.StartingAt=function(e,t){return ys.StartingAt(e,t)};function _l(){}var gl=(ml.prototype._addToepoint=function(e){for(var t=0,i=e;t<i.length;t++){var r=i[t];this._epoints.push(r.x,r.y)}},ml.prototype.addHole=function(e){this._points.add(e);var t=new fl;return t.add(e),this._holes.push(t),this._eholes.push(this._epoints.length/2),this._addToepoint(e),this},ml.prototype.build=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=0);var i=new ra(this._name,this._scene),r=this.buildVertexData(t);return i.setVerticesData(Si.PositionKind,r.positions,e),i.setVerticesData(Si.NormalKind,r.normals,e),i.setVerticesData(Si.UVKind,r.uvs,e),i.setIndices(r.indices),i},ml.prototype.buildVertexData=function(t){var i=this;void 0===t&&(t=0);var e=new Ri,r=new Array,n=new Array,o=new Array,s=this._points.computeBounds();this._points.elements.forEach(function(e){r.push(0,1,0),n.push(e.x,0,e.y),o.push((e.x-s.min.x)/s.width,(e.y-s.min.y)/s.height)});for(var a=new Array,h=this.bjsEarcut(this._epoints,this._eholes,2),l=0;l<h.length;l++)a.push(h[l]);if(0<t){var u=n.length/3;this._points.elements.forEach(function(e){r.push(0,-1,0),n.push(e.x,-t,e.y),o.push(1-(e.x-s.min.x)/s.width,1-(e.y-s.min.y)/s.height)});for(var c=a.length,l=0;l<c;l+=3){var d=a[l+0],f=a[l+1],p=a[l+2];a.push(p+u),a.push(f+u),a.push(d+u)}this.addSide(n,r,o,a,s,this._outlinepoints,t,!1),this._holes.forEach(function(e){i.addSide(n,r,o,a,s,e,t,!0)})}return e.indices=a,e.positions=n,e.normals=r,e.uvs=o,e},ml.prototype.addSide=function(e,t,i,r,n,o,s,a){for(var h=e.length/3,l=0,u=0;u<o.elements.length;u++){var c=o.elements[u],d=u+1>o.elements.length-1?o.elements[0]:o.elements[u+1];e.push(c.x,0,c.y),e.push(c.x,-s,c.y),e.push(d.x,0,d.y),e.push(d.x,-s,d.y);var f=new te(c.x,0,c.y),p=new te(d.x,0,d.y).subtract(f),_=new te(0,1,0),g=(g=te.Cross(p,_)).normalize();i.push(l/n.width,0),i.push(l/n.width,1),l+=p.length(),i.push(l/n.width,0),i.push(l/n.width,1),a?(t.push(g.x,g.y,g.z),t.push(g.x,g.y,g.z),t.push(g.x,g.y,g.z),t.push(g.x,g.y,g.z),r.push(h),r.push(h+2),r.push(h+1),r.push(h+1),r.push(h+2),r.push(h+3)):(t.push(-g.x,-g.y,-g.z),t.push(-g.x,-g.y,-g.z),t.push(-g.x,-g.y,-g.z),t.push(-g.x,-g.y,-g.z),r.push(h),r.push(h+1),r.push(h+2),r.push(h+1),r.push(h+3),r.push(h+2)),h+=4}},ml);function ml(e,t,i,r){var n;void 0===r&&(r=earcut),this._points=new fl,this._outlinepoints=new fl,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=r,this._name=e,this._scene=i||Mi.LastCreatedScene,n=t instanceof ys?t.getPoints():t,this._addToepoint(n),this._points.add(n),this._outlinepoints.add(n),void 0===this.bjsEarcut&&fe.Warn("Earcut was not found, the polygon will not be built.")}Ri.CreatePolygon=function(e,t,i,r,n,o){for(var s=i||new Array(3),a=r,h=[],l=0;l<3;l++)void 0===s[l]&&(s[l]=new j(0,0,1,1)),a&&void 0===a[l]&&(a[l]=new K(1,1,1,1));for(var u,c=e.getVerticesData(Si.PositionKind),d=e.getVerticesData(Si.NormalKind),f=e.getVerticesData(Si.UVKind),p=e.getIndices(),_=0,g=0;g<d.length;g+=3)Math.abs(d[g+1])<.001&&(_=1),Math.abs(d[g+1]-1)<.001&&(_=0),Math.abs(d[g+1]+1)<.001&&(_=2),f[2*(u=g/3)]=(1-f[2*u])*s[_].x+f[2*u]*s[_].z,f[2*u+1]=(1-f[2*u+1])*s[_].y+f[2*u+1]*s[_].w,a&&h.push(a[_].r,a[_].g,a[_].b,a[_].a);Ri._ComputeSides(t,c,p,d,f,n,o);var m,v=new Ri;return v.indices=p,v.positions=c,v.normals=d,v.uvs=f,a&&(m=t===Ri.DOUBLESIDE?h.concat(h):h,v.colors=m),v},ra.CreatePolygon=function(e,t,i,r,n,o,s){void 0===s&&(s=earcut);var a={shape:t,holes:r,updatable:n,sideOrientation:o};return vl.CreatePolygon(e,a,i,s)},ra.ExtrudePolygon=function(e,t,i,r,n,o,s,a){void 0===a&&(a=earcut);var h={shape:t,holes:n,depth:i,updatable:o,sideOrientation:s};return vl.ExtrudePolygon(e,h,r,a)};var vl=(yl.CreatePolygon=function(e,t,i,r){void 0===i&&(i=null),void 0===r&&(r=earcut),t.sideOrientation=ra._GetDefaultSideOrientation(t.sideOrientation);for(var n=t.shape,o=t.holes||[],s=t.depth||0,a=[],h=[],l=0;l<n.length;l++)a[l]=new H(n[l].x,n[l].z);a[0].equalsWithEpsilon(a[a.length-1],1e-8)&&a.pop();for(var u=new gl(e,a,i||Ae.LastCreatedScene,r),c=0;c<o.length;c++){h=[];for(var d=0;d<o[c].length;d++)h.push(new H(o[c][d].x,o[c][d].z));u.addHole(h)}var f=u.build(t.updatable,s);return f._originalBuilderSideOrientation=t.sideOrientation,Ri.CreatePolygon(f,t.sideOrientation,t.faceUV,t.faceColors,t.frontUVs,t.backUVs).applyToMesh(f,t.updatable),f},yl.ExtrudePolygon=function(e,t,i,r){return void 0===i&&(i=null),void 0===r&&(r=earcut),yl.CreatePolygon(e,t,i,r)},yl);function yl(){}ra.ExtrudeShape=function(e,t,i,r,n,o,s,a,h,l){void 0===s&&(s=null);var u={shape:t,path:i,scale:r,rotation:n,cap:0===o?0:o||ra.NO_CAP,sideOrientation:h,instance:l,updatable:a};return bl.ExtrudeShape(e,u,s)},ra.ExtrudeShapeCustom=function(e,t,i,r,n,o,s,a,h,l,u,c){var d={shape:t,path:i,scaleFunction:r,rotationFunction:n,ribbonCloseArray:o,ribbonClosePath:s,cap:0===a?0:a||ra.NO_CAP,sideOrientation:u,instance:c,updatable:l};return bl.ExtrudeShapeCustom(e,d,h)};var bl=(Tl.ExtrudeShape=function(e,t,i){void 0===i&&(i=null);var r=t.path,n=t.shape,o=t.scale||1,s=t.rotation||0,a=0===t.cap?0:t.cap||ra.NO_CAP,h=t.updatable,l=ra._GetDefaultSideOrientation(t.sideOrientation),u=t.instance||null,c=t.invertUV||!1;return Tl._ExtrudeShapeGeneric(e,n,r,o,s,null,null,!1,!1,a,!1,i,!!h,l,u,c,t.frontUVs||null,t.backUVs||null)},Tl.ExtrudeShapeCustom=function(e,t,i){void 0===i&&(i=null);var r=t.path,n=t.shape,o=t.scaleFunction||function(){return 1},s=t.rotationFunction||function(){return 0},a=t.ribbonCloseArray||!1,h=t.ribbonClosePath||!1,l=0===t.cap?0:t.cap||ra.NO_CAP,u=t.updatable,c=ra._GetDefaultSideOrientation(t.sideOrientation),d=t.instance,f=t.invertUV||!1;return Tl._ExtrudeShapeGeneric(e,n,r,null,null,o,s,a,h,l,!0,i,!!u,c,d||null,f,t.frontUVs||null,t.backUVs||null)},Tl._ExtrudeShapeGeneric=function(e,t,i,r,n,o,s,a,h,l,u,c,d,f,p,_,g,m){function v(e,t,i,r,n,o,s,a,h,l){for(var u=i.getTangents(),c=i.getNormals(),d=i.getBinormals(),f=i.getDistances(),p=0,_=l&&a?a:function(){return null!==o?o:0},g=l&&s?s:function(){return null!==n?n:1},m=h===ra.NO_CAP||h===ra.CAP_END?0:2,v=P.Matrix[0],y=0;y<t.length;y++){for(var b=new Array,T=_(y,f[y]),x=g(y,f[y]),E=0;E<e.length;E++){W.RotationAxisToRef(u[y],p,v);var A=u[y].scale(e[E].z).add(c[y].scale(e[E].x)).add(d[y].scale(e[E].y)),M=b[E]?b[E]:te.Zero();te.TransformCoordinatesToRef(A,v,M),M.scaleInPlace(x).addInPlace(t[y]),b[E]=M}r[m]=b,p+=T,m++}function C(e){for(var t=Array(),i=te.Zero(),r=0;r<e.length;r++)i.addInPlace(e[r]);for(i.scaleInPlace(1/e.length),r=0;r<e.length;r++)t.push(i);return t}switch(h){case ra.NO_CAP:break;case ra.CAP_START:r[0]=C(r[2]),r[1]=r[2];break;case ra.CAP_END:r[m]=r[m-1],r[m+1]=C(r[m-1]);break;case ra.CAP_ALL:r[0]=C(r[2]),r[1]=r[2],r[m]=r[m-1],r[m+1]=C(r[m-1])}return r}if(p){var y=p._creationDataStorage,b=y.path3D.update(i),T=v(t,i,y.path3D,y.pathArray,r,n,o,s,y.cap,u);return p=ra.CreateRibbon("",T,!1,!1,0,c||void 0,!1,0,p)}T=v(t,i,b=new Ts(i),new Array,r,n,o,s,l=l<0||3<l?0:l,u);var x=jh.CreateRibbon(e,{pathArray:T,closeArray:a,closePath:h,updatable:d,sideOrientation:f,invertUV:_,frontUVs:g||void 0,backUVs:m||void 0},c);return x._creationDataStorage.pathArray=T,x._creationDataStorage.path3D=b,x._creationDataStorage.cap=l,x},Tl);function Tl(){}ra.CreateLathe=function(e,t,i,r,n,o,s){var a={shape:t,radius:i,tessellation:r,sideOrientation:s,updatable:o};return xl.CreateLathe(e,a,n)};var xl=(El.CreateLathe=function(e,t,i){void 0===i&&(i=null);for(var r,n=!t.arc||t.arc<=0||1<t.arc?1:t.arc,o=void 0===t.closed||t.closed,s=t.shape,a=t.radius||1,h=t.tessellation||64,l=t.clip||0,u=t.updatable,c=ra._GetDefaultSideOrientation(t.sideOrientation),d=t.cap||ra.NO_CAP,f=2*Math.PI,p=new Array,_=t.invertUV||!1,g=0,m=0,v=f/h*n,y=new Array,g=0;g<=h-l;g++){for(y=[],d!=ra.CAP_START&&d!=ra.CAP_ALL||(y.push(new te(0,s[0].y,0)),y.push(new te(Math.cos(g*v)*s[0].x*a,s[0].y,Math.sin(g*v)*s[0].x*a))),m=0;m<s.length;m++)r=new te(Math.cos(g*v)*s[m].x*a,s[m].y,Math.sin(g*v)*s[m].x*a),y.push(r);d!=ra.CAP_END&&d!=ra.CAP_ALL||(y.push(new te(Math.cos(g*v)*s[s.length-1].x*a,s[s.length-1].y,Math.sin(g*v)*s[s.length-1].x*a)),y.push(new te(0,s[s.length-1].y,0))),p.push(y)}return jh.CreateRibbon(e,{pathArray:p,closeArray:o,sideOrientation:c,updatable:u,invertUV:_,frontUVs:t.frontUVs,backUVs:t.backUVs},i)},El);function El(){}Ri.CreatePlane=function(e){var t=[],i=[],r=[],n=[],o=e.width||e.size||1,s=e.height||e.size||1,a=0===e.sideOrientation?0:e.sideOrientation||Ri.DEFAULTSIDE,h=o/2,l=s/2;i.push(-h,-l,0),r.push(0,0,-1),n.push(0,0),i.push(h,-l,0),r.push(0,0,-1),n.push(1,0),i.push(h,l,0),r.push(0,0,-1),n.push(1,1),i.push(-h,l,0),r.push(0,0,-1),n.push(0,1),t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),Ri._ComputeSides(a,i,t,r,n,e.frontUVs,e.backUVs);var u=new Ri;return u.indices=t,u.positions=i,u.normals=r,u.uvs=n,u},ra.CreatePlane=function(e,t,i,r,n){var o={size:t,width:t,height:t,sideOrientation:n,updatable:r};return Al.CreatePlane(e,o,i)};var Al=(Ml.CreatePlane=function(e,t,i){void 0===i&&(i=null);var r=new ra(e,i);return t.sideOrientation=ra._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,Ri.CreatePlane(t).applyToMesh(r,t.updatable),t.sourcePlane&&(r.translate(t.sourcePlane.normal,-t.sourcePlane.d),r.setDirection(t.sourcePlane.normal.scale(-1))),r},Ml);function Ml(){}Ri.CreateTiledPlane=function(e){var t=e.pattern||ra.NO_FLIP,i=e.tileWidth||e.tileSize||1,r=e.tileHeight||e.tileSize||1,n=e.alignHorizontal||0,o=e.alignVertical||0,s=e.width||e.size||1,a=Math.floor(s/i),h=s-a*i,l=e.height||e.size||1,u=Math.floor(l/r),c=l-u*r,d=i*a/2,f=r*u/2,p=0,_=0,g=0,m=0,v=0,y=0;if(0<h||0<c){g=-d,m=-f;v=d,y=f;switch(n){case ra.CENTER:g-=h/=2,v+=h;break;case ra.LEFT:v+=h,p=-h/2;break;case ra.RIGHT:g-=h,p=h/2}switch(o){case ra.CENTER:m-=c/=2,y+=c;break;case ra.BOTTOM:y+=c,_=-c/2;break;case ra.TOP:m-=c,_=c/2}}var b=[],T=[],x=[];x[0]=[0,0,1,0,1,1,0,1],x[1]=[0,0,1,0,1,1,0,1],t!==ra.ROTATE_TILE&&t!==ra.ROTATE_ROW||(x[1]=[1,1,0,1,0,0,1,0]),t!==ra.FLIP_TILE&&t!==ra.FLIP_ROW||(x[1]=[1,0,0,0,0,1,1,1]),t!==ra.FLIP_N_ROTATE_TILE&&t!==ra.FLIP_N_ROTATE_ROW||(x[1]=[0,1,1,1,1,0,0,0]);for(var E=[],A=[],M=[],C=0,P=0;P<u;P++)for(var O=0;O<a;O++)b.push(O*i-d+p,P*r-f+_,0),b.push((O+1)*i-d+p,P*r-f+_,0),b.push((O+1)*i-d+p,(P+1)*r-f+_,0),b.push(O*i-d+p,(P+1)*r-f+_,0),M.push(C,C+1,C+3,C+1,C+2,C+3),E=t===ra.FLIP_TILE||t===ra.ROTATE_TILE||t===ra.FLIP_N_ROTATE_TILE?E.concat(x[(O%2+P%2)%2]):t===ra.FLIP_ROW||t===ra.ROTATE_ROW||t===ra.FLIP_N_ROTATE_ROW?E.concat(x[P%2]):E.concat(x[0]),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),C+=4;if(0<h||0<c){var S=0<c&&(o===ra.CENTER||o===ra.TOP),I=0<c&&(o===ra.CENTER||o===ra.BOTTOM),R=0<h&&(n===ra.CENTER||n===ra.RIGHT),D=0<h&&(n===ra.CENTER||n===ra.LEFT),w=[];if(S&&R&&(b.push(g+p,m+_,0),b.push(-d+p,m+_,0),b.push(-d+p,m+c+_,0),b.push(g+p,m+c+_,0),M.push(C,C+1,C+3,C+1,C+2,C+3),C+=4,w=[F=1-h/i,N=1-c/r,B=1,N,B,k=1,F,k],t===ra.ROTATE_ROW&&(w=[1-F,1-N,1-B,1-N,1-B,1-k,1-F,1-k]),t===ra.FLIP_ROW&&(w=[1-F,N,1-B,N,1-B,k,1-F,k]),t===ra.FLIP_N_ROTATE_ROW&&(w=[F,1-N,B,1-N,B,1-k,F,1-k]),E=E.concat(w),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),S&&D&&(b.push(d+p,m+_,0),b.push(v+p,m+_,0),b.push(v+p,m+c+_,0),b.push(d+p,m+c+_,0),M.push(C,C+1,C+3,C+1,C+2,C+3),C+=4,w=[F=0,N=1-c/r,B=h/i,N,B,k=1,F,k],(t===ra.ROTATE_ROW||t===ra.ROTATE_TILE&&a%2==0)&&(w=[1-F,1-N,1-B,1-N,1-B,1-k,1-F,1-k]),(t===ra.FLIP_ROW||t===ra.FLIP_TILE&&a%2==0)&&(w=[1-F,N,1-B,N,1-B,k,1-F,k]),(t===ra.FLIP_N_ROTATE_ROW||t===ra.FLIP_N_ROTATE_TILE&&a%2==0)&&(w=[F,1-N,B,1-N,B,1-k,F,1-k]),E=E.concat(w),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),I&&R&&(b.push(g+p,f+_,0),b.push(-d+p,f+_,0),b.push(-d+p,y+_,0),b.push(g+p,y+_,0),M.push(C,C+1,C+3,C+1,C+2,C+3),C+=4,w=[F=1-h/i,N=0,B=1,N,B,k=c/r,F,k],(t===ra.ROTATE_ROW&&u%2==1||t===ra.ROTATE_TILE&&u%1==0)&&(w=[1-F,1-N,1-B,1-N,1-B,1-k,1-F,1-k]),(t===ra.FLIP_ROW&&u%2==1||t===ra.FLIP_TILE&&u%2==0)&&(w=[1-F,N,1-B,N,1-B,k,1-F,k]),(t===ra.FLIP_N_ROTATE_ROW&&u%2==1||t===ra.FLIP_N_ROTATE_TILE&&u%2==0)&&(w=[F,1-N,B,1-N,B,1-k,F,1-k]),E=E.concat(w),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),I&&D&&(b.push(d+p,f+_,0),b.push(v+p,f+_,0),b.push(v+p,y+_,0),b.push(d+p,y+_,0),M.push(C,C+1,C+3,C+1,C+2,C+3),C+=4,w=[F=0,N=0,B=h/i,N,B,k=c/r,F,k],(t===ra.ROTATE_ROW&&u%2==1||t===ra.ROTATE_TILE&&(u+a)%2==1)&&(w=[1-F,1-N,1-B,1-N,1-B,1-k,1-F,1-k]),(t===ra.FLIP_ROW&&u%2==1||t===ra.FLIP_TILE&&(u+a)%2==1)&&(w=[1-F,N,1-B,N,1-B,k,1-F,k]),(t===ra.FLIP_N_ROTATE_ROW&&u%2==1||t===ra.FLIP_N_ROTATE_TILE&&(u+a)%2==1)&&(w=[F,1-N,B,1-N,B,1-k,F,1-k]),E=E.concat(w),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),S){var L=[],F=0,N=1-c/r,B=1,k=1;L[0]=[F,N,B,N,B,k,F,k],L[1]=[F,N,B,N,B,k,F,k],t!==ra.ROTATE_TILE&&t!==ra.ROTATE_ROW||(L[1]=[1-F,1-N,1-B,1-N,1-B,1-k,1-F,1-k]),t!==ra.FLIP_TILE&&t!==ra.FLIP_ROW||(L[1]=[1-F,N,1-B,N,1-B,k,1-F,k]),t!==ra.FLIP_N_ROTATE_TILE&&t!==ra.FLIP_N_ROTATE_ROW||(L[1]=[F,1-N,B,1-N,B,1-k,F,1-k]);for(O=0;O<a;O++)b.push(O*i-d+p,m+_,0),b.push((O+1)*i-d+p,m+_,0),b.push((O+1)*i-d+p,m+c+_,0),b.push(O*i-d+p,m+c+_,0),M.push(C,C+1,C+3,C+1,C+2,C+3),C+=4,E=t===ra.FLIP_TILE||t===ra.ROTATE_TILE||t===ra.FLIP_N_ROTATE_TILE?E.concat(L[(O+1)%2]):t===ra.FLIP_ROW||t===ra.ROTATE_ROW||t===ra.FLIP_N_ROTATE_ROW?E.concat(L[1]):E.concat(L[0]),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(I){var U=[];B=1,k=c/r,U[N=F=0]=[F,N,B,N,B,k,F,k],U[1]=[F,N,B,N,B,k,F,k],t!==ra.ROTATE_TILE&&t!==ra.ROTATE_ROW||(U[1]=[1-F,1-N,1-B,1-N,1-B,1-k,1-F,1-k]),t!==ra.FLIP_TILE&&t!==ra.FLIP_ROW||(U[1]=[1-F,N,1-B,N,1-B,k,1-F,k]),t!==ra.FLIP_N_ROTATE_TILE&&t!==ra.FLIP_N_ROTATE_ROW||(U[1]=[F,1-N,B,1-N,B,1-k,F,1-k]);for(O=0;O<a;O++)b.push(O*i-d+p,y-c+_,0),b.push((O+1)*i-d+p,y-c+_,0),b.push((O+1)*i-d+p,y+_,0),b.push(O*i-d+p,y+_,0),M.push(C,C+1,C+3,C+1,C+2,C+3),C+=4,E=t===ra.FLIP_TILE||t===ra.ROTATE_TILE||t===ra.FLIP_N_ROTATE_TILE?E.concat(U[(O+u)%2]):t===ra.FLIP_ROW||t===ra.ROTATE_ROW||t===ra.FLIP_N_ROTATE_ROW?E.concat(U[u%2]):E.concat(U[0]),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(R){var V=[];F=1-h/i,k=B=1,V[N=0]=[F,N,B,N,B,k,F,k],V[1]=[F,N,B,N,B,k,F,k],t!==ra.ROTATE_TILE&&t!==ra.ROTATE_ROW||(V[1]=[1-F,1-N,1-B,1-N,1-B,1-k,1-F,1-k]),t!==ra.FLIP_TILE&&t!==ra.FLIP_ROW||(V[1]=[1-F,N,1-B,N,1-B,k,1-F,k]),t!==ra.FLIP_N_ROTATE_TILE&&t!==ra.FLIP_N_ROTATE_ROW||(V[1]=[F,1-N,B,1-N,B,1-k,F,1-k]);for(P=0;P<u;P++)b.push(g+p,P*r-f+_,0),b.push(g+h+p,P*r-f+_,0),b.push(g+h+p,(P+1)*r-f+_,0),b.push(g+p,(P+1)*r-f+_,0),M.push(C,C+1,C+3,C+1,C+2,C+3),C+=4,E=t===ra.FLIP_TILE||t===ra.ROTATE_TILE||t===ra.FLIP_N_ROTATE_TILE?E.concat(V[(P+1)%2]):t===ra.FLIP_ROW||t===ra.ROTATE_ROW||t===ra.FLIP_N_ROTATE_ROW?E.concat(V[P%2]):E.concat(V[0]),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(D){var z=[];B=h/r,k=1,z[N=F=0]=[F,N,B,N,B,k,F,k],z[1]=[F,N,B,N,B,k,F,k],t!==ra.ROTATE_TILE&&t!==ra.ROTATE_ROW||(z[1]=[1-F,1-N,1-B,1-N,1-B,1-k,1-F,1-k]),t!==ra.FLIP_TILE&&t!==ra.FLIP_ROW||(z[1]=[1-F,N,1-B,N,1-B,k,1-F,k]),t!==ra.FLIP_N_ROTATE_TILE&&t!==ra.FLIP_N_ROTATE_ROW||(z[1]=[F,1-N,B,1-N,B,1-k,F,1-k]);for(P=0;P<u;P++)b.push(v-h+p,P*r-f+_,0),b.push(v+p,P*r-f+_,0),b.push(v+p,(P+1)*r-f+_,0),b.push(v-h+p,(P+1)*r-f+_,0),M.push(C,C+1,C+3,C+1,C+2,C+3),C+=4,E=t===ra.FLIP_TILE||t===ra.ROTATE_TILE||t===ra.FLIP_N_ROTATE_TILE?E.concat(z[(P+a)%2]):t===ra.FLIP_ROW||t===ra.ROTATE_ROW||t===ra.FLIP_N_ROTATE_ROW?E.concat(z[P%2]):E.concat(z[0]),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}var W=0===e.sideOrientation?0:e.sideOrientation||Ri.DEFAULTSIDE;Ri._ComputeSides(W,b,M,T,E,e.frontUVs,e.backUVs);var G=new Ri;G.indices=M,G.positions=b,G.normals=T,G.uvs=E;var X=W===Ri.DOUBLESIDE?A.concat(A):A;return G.colors=X,G};var Cl=(Pl.CreateTiledPlane=function(e,t,i){void 0===i&&(i=null);var r=new ra(e,i);return t.sideOrientation=ra._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,Ri.CreateTiledPlane(t).applyToMesh(r,t.updatable),r},Pl);function Pl(){}Ri.CreateGround=function(e){for(var t,i=[],r=[],n=[],o=[],s=e.width||1,a=e.height||1,h=e.subdivisionsX||e.subdivisions||1,l=e.subdivisionsY||e.subdivisions||1,u=0;u<=l;u++)for(t=0;t<=h;t++){var c=new te(t*s/h-s/2,0,(l-u)*a/l-a/2),d=new te(0,1,0);r.push(c.x,c.y,c.z),n.push(d.x,d.y,d.z),o.push(t/h,1-u/l)}for(u=0;u<l;u++)for(t=0;t<h;t++)i.push(t+1+(u+1)*(h+1)),i.push(t+1+u*(h+1)),i.push(t+u*(h+1)),i.push(t+(u+1)*(h+1)),i.push(t+1+(u+1)*(h+1)),i.push(t+u*(h+1));var f=new Ri;return f.indices=i,f.positions=r,f.normals=n,f.uvs=o,f},Ri.CreateTiledGround=function(e){var l,u,t,i,r=void 0!==e.xmin&&null!==e.xmin?e.xmin:-1,n=void 0!==e.zmin&&null!==e.zmin?e.zmin:-1,o=void 0!==e.xmax&&null!==e.xmax?e.xmax:1,s=void 0!==e.zmax&&null!==e.zmax?e.zmax:1,a=e.subdivisions||{w:1,h:1},c=e.precision||{w:1,h:1},d=new Array,f=new Array,p=new Array,_=new Array;a.h=a.h<1?1:a.h,a.w=a.w<1?1:a.w,c.w=c.w<1?1:c.w,c.h=c.h<1?1:c.h;var h=(o-r)/a.w,g=(s-n)/a.h;for(t=0;t<a.h;t++)for(i=0;i<a.w;i++)!function(e,t,i,r){var n=f.length/3,o=c.w+1;for(l=0;l<c.h;l++)for(u=0;u<c.w;u++){var s=[n+u+l*o,n+(u+1)+l*o,n+(u+1)+(l+1)*o,n+u+(l+1)*o];d.push(s[1]),d.push(s[2]),d.push(s[3]),d.push(s[0]),d.push(s[1]),d.push(s[3])}var a=te.Zero(),h=new te(0,1,0);for(l=0;l<=c.h;l++)for(a.z=l*(r-t)/c.h+t,u=0;u<=c.w;u++)a.x=u*(i-e)/c.w+e,a.y=0,f.push(a.x,a.y,a.z),p.push(h.x,h.y,h.z),_.push(u/c.w,l/c.h)}(r+i*h,n+t*g,r+(i+1)*h,n+(t+1)*g);var m=new Ri;return m.indices=d,m.positions=f,m.normals=p,m.uvs=_,m},Ri.CreateGroundFromHeightMap=function(e){var t,i,r,n=[],o=[],s=[],a=[],h=e.colorFilter||new Ne(.3,.59,.11),l=e.alphaFilter||0,u=!1;for(e.minHeight>e.maxHeight&&(u=!0,r=e.maxHeight,e.maxHeight=e.minHeight,e.minHeight=r),t=0;t<=e.subdivisions;t++)for(i=0;i<=e.subdivisions;i++){var c=new te(i*e.width/e.subdivisions-e.width/2,0,(e.subdivisions-t)*e.height/e.subdivisions-e.height/2),d=4*(((c.x+e.width/2)/e.width*(e.bufferWidth-1)|0)+((1-(c.z+e.height/2)/e.height)*(e.bufferHeight-1)|0)*e.bufferWidth),f=e.buffer[d]/255,p=e.buffer[1+d]/255,_=e.buffer[2+d]/255,g=e.buffer[3+d]/255;u&&(f=1-f,p=1-p,_=1-_);var m=f*h.r+p*h.g+_*h.b;c.y=l<=g?e.minHeight+(e.maxHeight-e.minHeight)*m:e.minHeight-C,o.push(c.x,c.y,c.z),s.push(0,0,0),a.push(i/e.subdivisions,1-t/e.subdivisions)}for(t=0;t<e.subdivisions;t++)for(i=0;i<e.subdivisions;i++){var v=i+1+(t+1)*(e.subdivisions+1),y=i+1+t*(e.subdivisions+1),b=i+t*(e.subdivisions+1),T=i+(t+1)*(e.subdivisions+1),x=o[3*v+1]>=e.minHeight,E=o[3*y+1]>=e.minHeight,A=o[3*b+1]>=e.minHeight;x&&E&&A&&(n.push(v),n.push(y),n.push(b)),o[3*T+1]>=e.minHeight&&x&&A&&(n.push(T),n.push(v),n.push(b))}Ri.ComputeNormals(o,n,s);var M=new Ri;return M.indices=n,M.positions=o,M.normals=s,M.uvs=a,M},ra.CreateGround=function(e,t,i,r,n,o){var s={width:t,height:i,subdivisions:r,updatable:o};return Ol.CreateGround(e,s,n)},ra.CreateTiledGround=function(e,t,i,r,n,o,s,a,h){var l={xmin:t,zmin:i,xmax:r,zmax:n,subdivisions:o,precision:s,updatable:h};return Ol.CreateTiledGround(e,l,a)},ra.CreateGroundFromHeightMap=function(e,t,i,r,n,o,s,a,h,l,u){var c={width:i,height:r,subdivisions:n,minHeight:o,maxHeight:s,updatable:h,onReady:l,alphaFilter:u};return Ol.CreateGroundFromHeightMap(e,t,c,a)};var Ol=(Sl.CreateGround=function(e,t,i){var r=new Ch(e,i);return r._setReady(!1),r._subdivisionsX=t.subdivisionsX||t.subdivisions||1,r._subdivisionsY=t.subdivisionsY||t.subdivisions||1,r._width=t.width||1,r._height=t.height||1,r._maxX=r._width/2,r._maxZ=r._height/2,r._minX=-r._maxX,r._minZ=-r._maxZ,Ri.CreateGround(t).applyToMesh(r,t.updatable),r._setReady(!0),r},Sl.CreateTiledGround=function(e,t,i){void 0===i&&(i=null);var r=new ra(e,i);return Ri.CreateTiledGround(t).applyToMesh(r,t.updatable),r},Sl.CreateGroundFromHeightMap=function(e,t,i,o){void 0===o&&(o=null);var s=i.width||10,a=i.height||10,h=i.subdivisions||1,l=i.minHeight||0,u=i.maxHeight||1,c=i.colorFilter||new Ne(.3,.59,.11),d=i.alphaFilter||0,f=i.updatable,p=i.onReady;o=o||Ae.LastCreatedScene;var _=new Ch(e,o);return _._subdivisionsX=h,_._subdivisionsY=h,_._width=s,_._height=a,_._maxX=_._width/2,_._maxZ=_._height/2,_._minX=-_._maxX,_._minZ=-_._maxZ,_._setReady(!1),ri.LoadImage(t,function(e){var t,i=e.width,r=e.height,n=Ot.CreateCanvas(i,r).getContext("2d");if(!n)throw new Error("Unable to get 2d context for CreateGroundFromHeightMap");o.isDisposed||(n.drawImage(e,0,0),t=n.getImageData(0,0,i,r).data,Ri.CreateGroundFromHeightMap({width:s,height:a,subdivisions:h,minHeight:l,maxHeight:u,colorFilter:c,buffer:t,bufferWidth:i,bufferHeight:r,alphaFilter:d}).applyToMesh(_,f),p&&p(_),_._setReady(!0))},function(){},o.offlineProvider),_},Sl);function Sl(){}ra.CreateTube=function(e,t,i,r,n,o,s,a,h,l){var u={path:t,radius:i,tessellation:r,radiusFunction:n,arc:1,cap:o,updatable:a,sideOrientation:h,instance:l};return Il.CreateTube(e,u,s)};var Il=(Rl.CreateTube=function(e,t,i){void 0===i&&(i=null);var r=t.path,n=t.instance,o=1;void 0!==t.radius?o=t.radius:n&&(o=n._creationDataStorage.radius);var s=t.tessellation||64,a=t.radiusFunction||null,h=t.cap||ra.NO_CAP,l=t.invertUV||!1,u=t.updatable,c=ra._GetDefaultSideOrientation(t.sideOrientation);function d(n,e,t,i,r,o,s,a){for(var h,l,u,c,d=e.getTangents(),f=e.getNormals(),p=e.getDistances(),_=2*Math.PI/r*a,g=o||function(){return i},m=P.Matrix[0],v=s===ra.NO_CAP||s===ra.CAP_END?0:2,y=0;y<n.length;y++){l=g(y,p[y]),h=Array(),u=f[y];for(var b=0;b<r;b++)W.RotationAxisToRef(d[y],_*b,m),c=h[b]?h[b]:te.Zero(),te.TransformCoordinatesToRef(u,m,c),c.scaleInPlace(l).addInPlace(n[y]),h[b]=c;t[v]=h,v++}function T(e,t){for(var i=Array(),r=0;r<e;r++)i.push(n[t]);return i}switch(s){case ra.NO_CAP:break;case ra.CAP_START:t[0]=T(r,0),t[1]=t[2].slice(0);break;case ra.CAP_END:t[v]=t[v-1].slice(0),t[v+1]=T(r,n.length-1);break;case ra.CAP_ALL:t[0]=T(r,0),t[1]=t[2].slice(0),t[v]=t[v-1].slice(0),t[v+1]=T(r,n.length-1)}return t}if(t.arc=(!t.arc||!(t.arc<=0||1<t.arc))&&t.arc||1,n){var f,p=n._creationDataStorage,_=t.arc||p.arc,g=d(r,f=p.path3D.update(r),p.pathArray,o,p.tessellation,a,p.cap,_),n=jh.CreateRibbon("",{pathArray:g,instance:n});return p.path3D=f,p.pathArray=g,p.arc=_,p.radius=o,n}g=d(r,f=new Ts(r),new Array,o,s,a,h=h<0||3<h?0:h,t.arc);var m=jh.CreateRibbon(e,{pathArray:g,closePath:!0,closeArray:!1,updatable:u,sideOrientation:c,invertUV:l,frontUVs:t.frontUVs,backUVs:t.backUVs},i);return m._creationDataStorage.pathArray=g,m._creationDataStorage.path3D=f,m._creationDataStorage.tessellation=s,m._creationDataStorage.cap=h,m._creationDataStorage.arc=t.arc,m._creationDataStorage.radius=o,m},Rl);function Rl(){}Ri.CreatePolyhedron=function(e){var t=[];t[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},t[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},t[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},t[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},t[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},t[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},t[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},t[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},t[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},t[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},t[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},t[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},t[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},t[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},t[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};var i,r,n,o=(!e.type||!(e.type<0||e.type>=t.length))&&e.type||0,s=e.size,a=e.sizeX||s||1,h=e.sizeY||s||1,l=e.sizeZ||s||1,u=e.custom||t[o],c=u.face.length,d=e.faceUV||new Array(c),f=e.faceColors,p=void 0===e.flat||e.flat,_=0===e.sideOrientation?0:e.sideOrientation||Ri.DEFAULTSIDE,g=new Array,m=new Array,v=new Array,y=new Array,b=new Array,T=0,x=0,E=new Array,A=0,M=0;if(p)for(M=0;M<c;M++)f&&void 0===f[M]&&(f[M]=new K(1,1,1,1)),d&&void 0===d[M]&&(d[M]=new j(0,0,1,1));if(p)for(M=0;M<c;M++){for(var C=u.face[M].length,P=2*Math.PI/C,O=.5*Math.tan(P/2),S=.5,A=0;A<C;A++)g.push(u.vertex[u.face[M][A]][0]*a,u.vertex[u.face[M][A]][1]*h,u.vertex[u.face[M][A]][2]*l),E.push(T),T++,i=d[M].x+(d[M].z-d[M].x)*(.5+O),r=d[M].y+(d[M].w-d[M].y)*(S-.5),y.push(i,r),n=O*Math.cos(P)-S*Math.sin(P),S=O*Math.sin(P)+S*Math.cos(P),O=n,f&&b.push(f[M].r,f[M].g,f[M].b,f[M].a);for(A=0;A<C-2;A++)m.push(E[0+x],E[A+2+x],E[A+1+x]);x+=C}else{for(A=0;A<u.vertex.length;A++)g.push(u.vertex[A][0]*a,u.vertex[A][1]*h,u.vertex[A][2]*l),y.push(0,0);for(M=0;M<c;M++)for(A=0;A<u.face[M].length-2;A++)m.push(u.face[M][0],u.face[M][A+2],u.face[M][A+1])}Ri.ComputeNormals(g,m,v),Ri._ComputeSides(_,g,m,v,y,e.frontUVs,e.backUVs);var I=new Ri;return I.positions=g,I.indices=m,I.normals=v,I.uvs=y,f&&p&&(I.colors=b),I},ra.CreatePolyhedron=function(e,t,i){return Dl.CreatePolyhedron(e,t,i)};var Dl=(wl.CreatePolyhedron=function(e,t,i){void 0===i&&(i=null);var r=new ra(e,i);return t.sideOrientation=ra._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,Ri.CreatePolyhedron(t).applyToMesh(r,t.updatable),r},wl);function wl(){}Ri.CreateIcoSphere=function(e){for(var t=e.sideOrientation||Ri.DEFAULTSIDE,i=e.radius||1,f=void 0===e.flat||e.flat,p=e.subdivisions||4,_=e.radiusX||i,g=e.radiusY||i,m=e.radiusZ||i,r=(1+Math.sqrt(5))/2,n=[-1,r,-0,1,r,0,-1,-r,0,1,-r,0,0,-1,-r,0,1,-r,0,-1,r,0,1,r,r,0,1,r,0,-1,-r,0,1,-r,0,-1],o=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],s=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],a=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],h=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],v=new Array,y=new Array,b=new Array,T=new Array,x=0,E=new Array(3),A=new Array(3),l=0;l<3;l++)E[l]=te.Zero(),A[l]=H.Zero();for(var u=0;u<20;u++){for(l=0;l<3;l++){var c=o[3*u+l];E[l].copyFromFloats(n[3*s[c]],n[3*s[c]+1],n[3*s[c]+2]),E[l].normalize().scaleInPlace(i),A[l].copyFromFloats(a[2*c]*(138/1024)+60/1024+h[u]*(-40/1024),a[2*c+1]*(239/1024)+26/1024+h[u]*(20/1024))}for(var d=function(e,t,i,r){var n,o,s,a=te.Lerp(E[0],E[2],t/p),h=te.Lerp(E[1],E[2],t/p),l=p===t?E[2]:te.Lerp(a,h,e/(p-t));l.normalize(),(s=f?(n=te.Lerp(E[0],E[2],r/p),o=te.Lerp(E[1],E[2],r/p),te.Lerp(n,o,i/(p-r))):new te(l.x,l.y,l.z)).x/=_,s.y/=g,s.z/=m,s.normalize();var u=H.Lerp(A[0],A[2],t/p),c=H.Lerp(A[1],A[2],t/p),d=p===t?A[2]:H.Lerp(u,c,e/(p-t));y.push(l.x*_,l.y*g,l.z*m),b.push(s.x,s.y,s.z),T.push(d.x,d.y),v.push(x),x++},M=0;M<p;M++)for(var C=0;C+M<p;C++)d(C,M,C+1/3,M+1/3),d(C+1,M,C+1/3,M+1/3),d(C,M+1,C+1/3,M+1/3),C+M+1<p&&(d(C+1,M,C+2/3,M+2/3),d(C+1,M+1,C+2/3,M+2/3),d(C,M+1,C+2/3,M+2/3))}Ri._ComputeSides(t,y,v,b,T,e.frontUVs,e.backUVs);var P=new Ri;return P.indices=v,P.positions=y,P.normals=b,P.uvs=T,P},ra.CreateIcoSphere=function(e,t,i){return Ll.CreateIcoSphere(e,t,i)};var Ll=(Fl.CreateIcoSphere=function(e,t,i){void 0===i&&(i=null);var r=new ra(e,i);return t.sideOrientation=ra._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,Ri.CreateIcoSphere(t).applyToMesh(r,t.updatable),r},Fl);function Fl(){}ra.CreateDecal=function(e,t,i,r,n,o){var s={position:i,normal:r,size:n,angle:o};return Nl.CreateDecal(e,t,s)};var Nl=(Bl.CreateDecal=function(e,t,i){var r,n,o,s=t.getIndices(),a=t.getVerticesData(Si.PositionKind),h=t.getVerticesData(Si.NormalKind),l=i.position||te.Zero(),u=i.normal||te.Up(),f=i.size||te.One(),c=i.angle||0;u||(r=new te(0,0,1),n=t.getScene().activeCamera,o=te.TransformCoordinates(r,n.getWorldMatrix()),u=n.globalPosition.subtract(o));var d=-Math.atan2(u.z,u.x)-Math.PI/2,p=Math.sqrt(u.x*u.x+u.z*u.z),_=Math.atan2(u.y,p),g=W.RotationYawPitchRoll(d,_,c).multiply(W.Translation(l.x,l.y,l.z)),m=W.Invert(g),v=t.getWorldMatrix().multiply(m),y=new Ri;y.indices=[],y.positions=[],y.normals=[],y.uvs=[];for(var b=0,T=function(e){var t=new As;if(!s||!a||!h)return t;var i=s[e];return t.position=new te(a[3*i],a[3*i+1],a[3*i+2]),t.position=te.TransformCoordinates(t.position,v),t.normal=new te(h[3*i],h[3*i+1],h[3*i+2]),t.normal=te.TransformNormal(t.normal,v),t},x=function(e,r){if(0===e.length)return e;for(var n=.5*Math.abs(te.Dot(f,r)),t=function(e,t){var i=te.GetClipFactor(e.position,t.position,r,n);return new As(te.Lerp(e.position,t.position,i),te.Lerp(e.normal,t.normal,i))},i=new Array,o=0;o<e.length;o+=3){var s=null,a=null,h=null,l=null,u=0<te.Dot(e[o].position,r)-n,c=0<te.Dot(e[o+1].position,r)-n,d=0<te.Dot(e[o+2].position,r)-n;switch((u?1:0)+(c?1:0)+(d?1:0)){case 0:i.push(e[o]),i.push(e[o+1]),i.push(e[o+2]);break;case 1:if(u&&(s=e[o+1],a=e[o+2],h=t(e[o],s),l=t(e[o],a)),c){s=e[o],a=e[o+2],h=t(e[o+1],s),l=t(e[o+1],a),i.push(h),i.push(a.clone()),i.push(s.clone()),i.push(a.clone()),i.push(h.clone()),i.push(l);break}d&&(s=e[o],a=e[o+1],h=t(e[o+2],s),l=t(e[o+2],a)),s&&a&&h&&l&&(i.push(s.clone()),i.push(a.clone()),i.push(h),i.push(l),i.push(h.clone()),i.push(a.clone()));break;case 2:u||(a=t(s=e[o].clone(),e[o+1]),h=t(s,e[o+2]),i.push(s),i.push(a),i.push(h)),c||(a=t(s=e[o+1].clone(),e[o+2]),h=t(s,e[o]),i.push(s),i.push(a),i.push(h)),d||(a=t(s=e[o+2].clone(),e[o]),h=t(s,e[o+1]),i.push(s),i.push(a),i.push(h))}}return i},E=0;E<s.length;E+=3){var A=new Array;if(A.push(T(E)),A.push(T(E+1)),A.push(T(E+2)),0!==(A=x(A=x(A=x(A=x(A=x(A=x(A,new te(1,0,0)),new te(-1,0,0)),new te(0,1,0)),new te(0,-1,0)),new te(0,0,1)),new te(0,0,-1))).length)for(var M=0;M<A.length;M++){var C=A[M];y.indices.push(b),C.position.toArray(y.positions,3*b),C.normal.toArray(y.normals,3*b),y.uvs.push(.5+C.position.x/f.x),y.uvs.push(.5+C.position.y/f.y),b++}}var P=new ra(e,t.getScene());return y.applyToMesh(P),P.position=l.clone(),P.rotation=new te(_,d,c),P},Bl);function Bl(){}var kl=(Ul.CreateBox=function(e,t,i){return void 0===i&&(i=null),Zh.CreateBox(e,t,i)},Ul.CreateTiledBox=function(e,t,i){return void 0===i&&(i=null),Jh.CreateTiledBox(e,t,i)},Ul.CreateSphere=function(e,t,i){return void 0===i&&(i=null),el.CreateSphere(e,t,i)},Ul.CreateDisc=function(e,t,i){return void 0===i&&(i=null),Yh.CreateDisc(e,t,i)},Ul.CreateIcoSphere=function(e,t,i){return void 0===i&&(i=null),Ll.CreateIcoSphere(e,t,i)},Ul.CreateRibbon=function(e,t,i){return void 0===i&&(i=null),jh.CreateRibbon(e,t,i)},Ul.CreateCylinder=function(e,t,i){return void 0===i&&(i=null),il.CreateCylinder(e,t,i)},Ul.CreateTorus=function(e,t,i){return void 0===i&&(i=null),nl.CreateTorus(e,t,i)},Ul.CreateTorusKnot=function(e,t,i){return void 0===i&&(i=null),sl.CreateTorusKnot(e,t,i)},Ul.CreateLineSystem=function(e,t,i){return hl.CreateLineSystem(e,t,i)},Ul.CreateLines=function(e,t,i){return void 0===i&&(i=null),hl.CreateLines(e,t,i)},Ul.CreateDashedLines=function(e,t,i){return void 0===i&&(i=null),hl.CreateDashedLines(e,t,i)},Ul.ExtrudeShape=function(e,t,i){return void 0===i&&(i=null),bl.ExtrudeShape(e,t,i)},Ul.ExtrudeShapeCustom=function(e,t,i){return void 0===i&&(i=null),bl.ExtrudeShapeCustom(e,t,i)},Ul.CreateLathe=function(e,t,i){return void 0===i&&(i=null),xl.CreateLathe(e,t,i)},Ul.CreateTiledPlane=function(e,t,i){return void 0===i&&(i=null),Cl.CreateTiledPlane(e,t,i)},Ul.CreatePlane=function(e,t,i){return void 0===i&&(i=null),Al.CreatePlane(e,t,i)},Ul.CreateGround=function(e,t,i){return void 0===i&&(i=null),Ol.CreateGround(e,t,i)},Ul.CreateTiledGround=function(e,t,i){return void 0===i&&(i=null),Ol.CreateTiledGround(e,t,i)},Ul.CreateGroundFromHeightMap=function(e,t,i,r){return void 0===r&&(r=null),Ol.CreateGroundFromHeightMap(e,t,i,r)},Ul.CreatePolygon=function(e,t,i,r){return void 0===i&&(i=null),void 0===r&&(r=earcut),vl.CreatePolygon(e,t,i,r)},Ul.ExtrudePolygon=function(e,t,i,r){return void 0===i&&(i=null),void 0===r&&(r=earcut),vl.ExtrudePolygon(e,t,i,r)},Ul.CreateTube=function(e,t,i){return void 0===i&&(i=null),Il.CreateTube(e,t,i)},Ul.CreatePolyhedron=function(e,t,i){return void 0===i&&(i=null),Dl.CreatePolyhedron(e,t,i)},Ul.CreateDecal=function(e,t,i){return Nl.CreateDecal(e,t,i)},Ul);function Ul(){}var Vl,zl,Wl=(Gl.prototype.addTask=function(e){this._simplificationArray.push(e)},Gl.prototype.executeNext=function(){var e=this._simplificationArray.pop();e?(this.running=!0,this.runSimplification(e)):this.running=!1},Gl.prototype.runSimplification=function(r){var n,i=this;r.parallelProcessing?r.settings.forEach(function(t){i.getSimplifier(r).simplify(t,function(e){r.mesh.addLODLevel(t.distance,e),e.isVisible=!0,t.quality===r.settings[r.settings.length-1].quality&&r.successCallback&&r.successCallback(),i.executeNext()})}):(n=this.getSimplifier(r),oi.Run(r.settings.length,function(e){var t,i;t=r.settings[e.index],i=function(){e.executeNext()},n.simplify(t,function(e){r.mesh.addLODLevel(t.distance,e),e.isVisible=!0,i()})},function(){r.successCallback&&r.successCallback(),i.executeNext()}))},Gl.prototype.getSimplifier=function(e){switch(e.simplificationType){case Vl.QUADRATIC:default:return new Zl(e.mesh)}},Gl);function Gl(){this.running=!1,this._simplificationArray=[]}(zl=Vl=Vl||{})[zl.QUADRATIC=0]="QUADRATIC";var Xl=function(e){this.vertices=e,this.error=new Array(4),this.deleted=!1,this.isDirty=!1,this.deletePending=!1,this.borderFactor=0},Hl=(jl.prototype.updatePosition=function(e){this.position.copyFrom(e)},jl);function jl(e,t){this.position=e,this.id=t,this.isBorder=!0,this.q=new Kl,this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}var Kl=(Yl.prototype.det=function(e,t,i,r,n,o,s,a,h){return this.data[e]*this.data[n]*this.data[h]+this.data[i]*this.data[r]*this.data[a]+this.data[t]*this.data[o]*this.data[s]-this.data[i]*this.data[n]*this.data[s]-this.data[e]*this.data[o]*this.data[a]-this.data[t]*this.data[r]*this.data[h]},Yl.prototype.addInPlace=function(e){for(var t=0;t<10;++t)this.data[t]+=e.data[t]},Yl.prototype.addArrayInPlace=function(e){for(var t=0;t<10;++t)this.data[t]+=e[t]},Yl.prototype.add=function(e){for(var t=new Yl,i=0;i<10;++i)t.data[i]=this.data[i]+e.data[i];return t},Yl.FromData=function(e,t,i,r){return new Yl(Yl.DataFromNumbers(e,t,i,r))},Yl.DataFromNumbers=function(e,t,i,r){return[e*e,e*t,e*i,e*r,t*t,t*i,t*r,i*i,i*r,r*r]},Yl);function Yl(e){this.data=new Array(10);for(var t=0;t<10;++t)e&&e[t]?this.data[t]=e[t]:this.data[t]=0}var ql=function(e,t){this.vertexId=e,this.triangleId=t},Zl=(Ql.prototype.simplify=function(t,e){var i=this;this.initDecimatedMesh(),oi.Run(this._mesh.subMeshes.length,function(e){i.initWithMesh(e.index,function(){i.runDecimation(t,e.index,function(){e.executeNext()})},t.optimizeMesh)},function(){setTimeout(function(){e(i._reconstructedMesh)},0)})},Ql.prototype.runDecimation=function(e,t,i){var _=this,r=~~(this.triangles.length*e.quality),g=0,n=this.triangles.length;oi.Run(this.decimationIterations,function(e){var t,i;n-g<=r?e.breakLoop():(t=e.index,i=function(){e.executeNext()},setTimeout(function(){t%5==0&&_.updateMesh(0===t);for(var e=0;e<_.triangles.length;++e)_.triangles[e].isDirty=!1;var p=1e-9*Math.pow(t+3,_.aggressiveness);oi.SyncAsyncForLoop(_.triangles.length,_.syncIterations,function(e){var t=~~((_.triangles.length/2+e)%_.triangles.length),i=_.triangles[t];if(i&&!(i.error[3]>p||i.deleted||i.isDirty))for(var r=0;r<3;++r)if(i.error[r]<p){var n=[],o=[],s=i.vertices[r],a=i.vertices[(r+1)%3];if(s.isBorder||a.isBorder)continue;var h=te.Zero();_.calculateError(s,a,h);var l=new Array;if(_.isFlipped(s,a,h,n,l))continue;if(_.isFlipped(a,s,h,o,l))continue;if(n.indexOf(!0)<0||o.indexOf(!0)<0)continue;var u=new Array;if(l.forEach(function(e){-1===u.indexOf(e)&&(e.deletePending=!0,u.push(e))}),u.length%2!=0)continue;s.q=a.q.add(s.q),s.updatePosition(h);var c=_.references.length;g=_.updateTriangles(s,s,n,g),g=_.updateTriangles(s,a,o,g);var d=_.references.length-c;if(d<=s.triangleCount){if(d)for(var f=0;f<d;f++)_.references[s.triangleStart+f]=_.references[c+f]}else s.triangleStart=c;s.triangleCount=d;break}},i,function(){return n-g<=r})},0))},function(){setTimeout(function(){_.reconstructMesh(t),i()},0)})},Ql.prototype.initWithMesh=function(e,t,n){var l=this;this.vertices=[],this.triangles=[];var o=this._mesh.getVerticesData(Si.PositionKind),u=this._mesh.getIndices(),c=this._mesh.subMeshes[e],d=[],i=c.verticesCount;oi.SyncAsyncForLoop(i,this.syncIterations/4>>0,function(e){var t,i,r;o&&(t=e+c.verticesStart,(r=function(e){if(n)for(var t=0;t<l.vertices.length;++t)if(l.vertices[t].position.equals(e))return l.vertices[t];return null}(i=te.FromArray(o,3*t))||new Hl(i,l.vertices.length)).originalOffsets.push(t),r.id===l.vertices.length&&l.vertices.push(r),d.push(r.id))},function(){oi.SyncAsyncForLoop(c.indexCount/3,l.syncIterations,function(e){var t,i,r,n,o,s,a,h;u&&(t=3*(c.indexStart/3+e),i=u[0+t],r=u[1+t],n=u[2+t],o=l.vertices[d[i-c.verticesStart]],s=l.vertices[d[r-c.verticesStart]],a=l.vertices[d[n-c.verticesStart]],(h=new Xl([o,s,a])).originalOffset=t,l.triangles.push(h))},function(){l.init(t)})})},Ql.prototype.init=function(e){var r=this;oi.SyncAsyncForLoop(this.triangles.length,this.syncIterations,function(e){var t=r.triangles[e];t.normal=te.Cross(t.vertices[1].position.subtract(t.vertices[0].position),t.vertices[2].position.subtract(t.vertices[0].position)).normalize();for(var i=0;i<3;i++)t.vertices[i].q.addArrayInPlace(Kl.DataFromNumbers(t.normal.x,t.normal.y,t.normal.z,-te.Dot(t.normal,t.vertices[0].position)))},function(){oi.SyncAsyncForLoop(r.triangles.length,r.syncIterations,function(e){for(var t=r.triangles[e],i=0;i<3;++i)t.error[i]=r.calculateError(t.vertices[i],t.vertices[(i+1)%3]);t.error[3]=Math.min(t.error[0],t.error[1],t.error[2])},function(){e()})})},Ql.prototype.reconstructMesh=function(e){for(var r,t,i=[],n=0;n<this.vertices.length;++n)this.vertices[n].triangleCount=0;for(n=0;n<this.triangles.length;++n)if(!this.triangles[n].deleted){for(r=this.triangles[n],t=0;t<3;++t)r.vertices[t].triangleCount=1;i.push(r)}var o=this._reconstructedMesh.getVerticesData(Si.PositionKind)||[],s=this._reconstructedMesh.getVerticesData(Si.NormalKind)||[],a=this._reconstructedMesh.getVerticesData(Si.UVKind)||[],h=this._reconstructedMesh.getVerticesData(Si.ColorKind)||[],l=this._mesh.getVerticesData(Si.NormalKind),u=this._mesh.getVerticesData(Si.UVKind),c=this._mesh.getVerticesData(Si.ColorKind),d=0;for(n=0;n<this.vertices.length;++n){var f=this.vertices[n];f.id=d,f.triangleCount&&f.originalOffsets.forEach(function(e){l&&(o.push(f.position.x),o.push(f.position.y),o.push(f.position.z),s.push(l[3*e]),s.push(l[3*e+1]),s.push(l[3*e+2]),u&&u.length&&(a.push(u[2*e]),a.push(u[2*e+1])),c&&c.length&&(h.push(c[4*e]),h.push(c[4*e+1]),h.push(c[4*e+2]),h.push(c[4*e+3])),++d)})}var p=this._reconstructedMesh.getTotalIndices(),_=this._reconstructedMesh.getTotalVertices(),g=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var m=this._reconstructedMesh.getIndices(),v=this._mesh.getIndices();for(n=0;n<i.length;++n)r=i[n],[0,1,2].forEach(function(e){var t=v[r.originalOffset+e],i=r.vertices[e].originalOffsets.indexOf(t);i<0&&(i=0),m.push(r.vertices[e].id+i+_)});this._reconstructedMesh.setIndices(m),this._reconstructedMesh.setVerticesData(Si.PositionKind,o),this._reconstructedMesh.setVerticesData(Si.NormalKind,s),0<a.length&&this._reconstructedMesh.setVerticesData(Si.UVKind,a),0<h.length&&this._reconstructedMesh.setVerticesData(Si.ColorKind,h);var y=this._mesh.subMeshes[e];0<e&&(this._reconstructedMesh.subMeshes=[],g.forEach(function(e){Or.AddToMesh(e.materialIndex,e.verticesStart,e.verticesCount,e.indexStart,e.indexCount,e.getMesh())}),Or.AddToMesh(y.materialIndex,_,d,p,3*i.length,this._reconstructedMesh))},Ql.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new ra(this._mesh.name+"Decimated",this._mesh.getScene()),this._reconstructedMesh.material=this._mesh.material,this._reconstructedMesh.parent=this._mesh.parent,this._reconstructedMesh.isVisible=!1,this._reconstructedMesh.renderingGroupId=this._mesh.renderingGroupId},Ql.prototype.isFlipped=function(e,t,i,r,n){for(var o=0;o<e.triangleCount;++o){var s=this.triangles[this.references[e.triangleStart+o].triangleId];if(!s.deleted){var a=this.references[e.triangleStart+o].vertexId,h=s.vertices[(a+1)%3],l=s.vertices[(a+2)%3];if(h!==t&&l!==t){var u=(u=h.position.subtract(i)).normalize(),c=(c=l.position.subtract(i)).normalize();if(.999<Math.abs(te.Dot(u,c)))return!0;var d=te.Cross(u,c).normalize();if(r[o]=!1,te.Dot(d,s.normal)<.2)return!0}else r[o]=!0,n.push(s)}}return!1},Ql.prototype.updateTriangles=function(e,t,i,r){for(var n=r,o=0;o<t.triangleCount;++o){var s=this.references[t.triangleStart+o],a=this.triangles[s.triangleId];a.deleted||(i[o]&&a.deletePending?(a.deleted=!0,n++):(a.vertices[s.vertexId]=e,a.isDirty=!0,a.error[0]=this.calculateError(a.vertices[0],a.vertices[1])+a.borderFactor/2,a.error[1]=this.calculateError(a.vertices[1],a.vertices[2])+a.borderFactor/2,a.error[2]=this.calculateError(a.vertices[2],a.vertices[0])+a.borderFactor/2,a.error[3]=Math.min(a.error[0],a.error[1],a.error[2]),this.references.push(s)))}return n},Ql.prototype.identifyBorder=function(){for(var e=0;e<this.vertices.length;++e){for(var t=[],i=[],r=this.vertices[e],n=0;n<r.triangleCount;++n)for(var o=this.triangles[this.references[r.triangleStart+n].triangleId],s=0;s<3;s++){for(var a=0,h=o.vertices[s];a<t.length&&i[a]!==h.id;)++a;a===t.length?(t.push(1),i.push(h.id)):t[a]++}for(n=0;n<t.length;++n)1===t[n]?this.vertices[i[n]].isBorder=!0:this.vertices[i[n]].isBorder=!1}},Ql.prototype.updateMesh=function(e){var t,i,r;if(void 0===e&&(e=!1),!e){for(var n=[],o=0;o<this.triangles.length;++o)this.triangles[o].deleted||n.push(this.triangles[o]);this.triangles=n}for(o=0;o<this.vertices.length;++o)this.vertices[o].triangleCount=0,this.vertices[o].triangleStart=0;for(o=0;o<this.triangles.length;++o)for(t=this.triangles[o],i=0;i<3;++i)(r=t.vertices[i]).triangleCount++;var s=0;for(o=0;o<this.vertices.length;++o)this.vertices[o].triangleStart=s,s+=this.vertices[o].triangleCount,this.vertices[o].triangleCount=0;var a=new Array(3*this.triangles.length);for(o=0;o<this.triangles.length;++o)for(t=this.triangles[o],i=0;i<3;++i)a[(r=t.vertices[i]).triangleStart+r.triangleCount]=new ql(i,o),r.triangleCount++;this.references=a,e&&this.identifyBorder()},Ql.prototype.vertexError=function(e,t){var i=t.x,r=t.y,n=t.z;return e.data[0]*i*i+2*e.data[1]*i*r+2*e.data[2]*i*n+2*e.data[3]*i+e.data[4]*r*r+2*e.data[5]*r*n+2*e.data[6]*r+e.data[7]*n*n+2*e.data[8]*n+e.data[9]},Ql.prototype.calculateError=function(e,t,i){var r,n,o,s,a=e.q.add(t.q),h=e.isBorder&&t.isBorder,l=0,u=a.det(0,1,2,1,4,5,2,5,7);return 0===u||h?(r=e.position.add(t.position).divide(new te(2,2,2)),n=this.vertexError(a,e.position),o=this.vertexError(a,t.position),s=this.vertexError(a,r),(l=Math.min(n,o,s))===n?i&&i.copyFrom(e.position):l===o?i&&i.copyFrom(t.position):i&&i.copyFrom(r)):((i=i||te.Zero()).x=-1/u*a.det(1,2,3,4,5,6,5,7,8),i.y=1/u*a.det(0,2,3,1,5,6,2,7,8),i.z=-1/u*a.det(0,1,3,1,4,6,2,5,8),l=this.vertexError(a,i)),l},Ql);function Ql(e){this._mesh=e,this.syncIterations=5e3,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=C}Object.defineProperty(_n.prototype,"simplificationQueue",{get:function(){var e;return this._simplificationQueue||(this._simplificationQueue=new Wl,(e=this._getComponent(Ur.NAME_SIMPLIFICATIONQUEUE))||(e=new Jl(this),this._addComponent(e))),this._simplificationQueue},set:function(e){this._simplificationQueue=e},enumerable:!0,configurable:!0}),ra.prototype.simplify=function(e,t,i,r){return void 0===t&&(t=!0),void 0===i&&(i=Vl.QUADRATIC),this.getScene().simplificationQueue.addTask({settings:e,parallelProcessing:t,mesh:this,simplificationType:i,successCallback:r}),this};var Jl=($l.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(Ur.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE,this,this._beforeCameraUpdate)},$l.prototype.rebuild=function(){},$l.prototype.dispose=function(){},$l.prototype._beforeCameraUpdate=function(){this.scene._simplificationQueue&&!this.scene._simplificationQueue.running&&this.scene._simplificationQueue.executeNext()},$l);function $l(e){this.name=Ur.NAME_SIMPLIFICATIONQUEUE,this.scene=e}ra.CreateHemisphere=function(e,t,i,r){var n={segments:t,diameter:i};return eu.CreateHemisphere(e,n,r)};var eu=(tu.CreateHemisphere=function(e,t,i){t.diameter||(t.diameter=1),t.segments||(t.segments=16);var r=el.CreateSphere("",{slice:.5,diameter:t.diameter,segments:t.segments},i),n=ra.CreateDisc("",t.diameter/2,3*t.segments+(4-t.segments),i);n.rotation.x=-Math.PI/2,n.parent=r;var o=ra.MergeMeshes([n,r],!0);return o.name=e,o},tu);function tu(){}var iu,ru="gridPixelShader",nu="#extension GL_OES_standard_derivatives : enable\n#define SQRT2 1.41421356\n#define PI 3.14159\nprecision highp float;\nuniform vec3 mainColor;\nuniform vec3 lineColor;\nuniform vec4 gridControl;\nuniform vec3 gridOffset;\n\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n#include<fogFragmentDeclaration>\n\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\nfloat getVisibility(float position) {\n\nfloat majorGridFrequency=gridControl.y;\nif (floor(position+0.5) == floor(position/majorGridFrequency+0.5)*majorGridFrequency)\n{\nreturn 1.0;\n}\nreturn gridControl.z;\n}\nfloat getAnisotropicAttenuation(float differentialLength) {\nconst float maxNumberOfLines=10.0;\nreturn clamp(1.0/(differentialLength+1.0)-1.0/maxNumberOfLines,0.0,1.0);\n}\nfloat isPointOnLine(float position,float differentialLength) {\nfloat fractionPartOfPosition=position-floor(position+0.5);\nfractionPartOfPosition/=differentialLength;\nfractionPartOfPosition=clamp(fractionPartOfPosition,-1.,1.);\nfloat result=0.5+0.5*cos(fractionPartOfPosition*PI);\nreturn result;\n}\nfloat contributionOnAxis(float position) {\nfloat differentialLength=length(vec2(dFdx(position),dFdy(position)));\ndifferentialLength*=SQRT2;\n\nfloat result=isPointOnLine(position,differentialLength);\n\nfloat visibility=getVisibility(position);\nresult*=visibility;\n\nfloat anisotropicAttenuation=getAnisotropicAttenuation(differentialLength);\nresult*=anisotropicAttenuation;\nreturn result;\n}\nfloat normalImpactOnAxis(float x) {\nfloat normalImpact=clamp(1.0-3.0*abs(x*x*x),0.0,1.0);\nreturn normalImpact;\n}\nvoid main(void) {\n\nfloat gridRatio=gridControl.x;\nvec3 gridPos=(vPosition+gridOffset.xyz)/gridRatio;\n\nfloat x=contributionOnAxis(gridPos.x);\nfloat y=contributionOnAxis(gridPos.y);\nfloat z=contributionOnAxis(gridPos.z);\n\nvec3 normal=normalize(vNormal);\nx*=normalImpactOnAxis(normal.x);\ny*=normalImpactOnAxis(normal.y);\nz*=normalImpactOnAxis(normal.z);\n\nfloat grid=clamp(x+y+z,0.,1.);\n\nvec3 color=mix(mainColor,lineColor,grid);\n#ifdef FOG\n#include<fogFragment>\n#endif\nfloat opacity=1.0;\n#ifdef TRANSPARENT\nopacity=clamp(grid,0.08,gridControl.w*grid);\n#endif\n#ifdef OPACITY\nopacity*=texture2D(opacitySampler,vOpacityUV).a;\n#endif\n\ngl_FragColor=vec4(color.rgb,opacity);\n#ifdef TRANSPARENT\n#ifdef PREMULTIPLYALPHA\ngl_FragColor.rgb*=opacity;\n#endif\n#else\n#endif\n}",ou=(st.ShadersStore[ru]=nu,"gridVertexShader"),su="precision highp float;\n\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#include<instancesDeclaration>\n\nuniform mat4 projection;\nuniform mat4 view;\n\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n#include<fogVertexDeclaration>\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\nvoid main(void) {\n#include<instancesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\n#include<fogVertex>\nvec4 cameraSpacePosition=view*worldPos;\ngl_Position=projection*cameraSpacePosition;\n#ifdef OPACITY\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\nvPosition=position;\nvNormal=normal;\n}",au=(st.ShadersStore[ou]=su,n(hu,iu=lr),hu);function hu(){var e=iu.call(this)||this;return e.OPACITY=!1,e.TRANSPARENT=!1,e.FOG=!1,e.PREMULTIPLYALPHA=!1,e.UV1=!1,e.UV2=!1,e.INSTANCES=!1,e.rebuild(),e}var lu,uu=(n(cu,lu=vn),cu.prototype.needAlphaBlending=function(){return this.opacity<1||this._opacityTexture&&this._opacityTexture.isReady()},cu.prototype.needAlphaBlendingForMesh=function(e){return this.needAlphaBlending()},cu.prototype.isReadyForSubMesh=function(e,t,i){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t._materialDefines=new au);var r,n,o=t._materialDefines,s=this.getScene();if(!this.checkReadyOnEveryCall&&t.effect&&this._renderId===s.getRenderId())return!0;if(o.TRANSPARENT!==this.opacity<1&&(o.TRANSPARENT=!o.TRANSPARENT,o.markAsUnprocessed()),o.PREMULTIPLYALPHA!=this.preMultiplyAlpha&&(o.PREMULTIPLYALPHA=!o.PREMULTIPLYALPHA,o.markAsUnprocessed()),o._areTexturesDirty&&(o._needUVs=!1,s.texturesEnabled&&this._opacityTexture&&Sn.OpacityTextureEnabled)){if(!this._opacityTexture.isReady())return!1;o._needUVs=!0,o.OPACITY=!0}return bn.PrepareDefinesForMisc(e,s,!1,!1,this.fogEnabled,!1,o),bn.PrepareDefinesForFrameBoundValues(s,s.getEngine(),o,!!i),o.isDirty&&(o.markAsProcessed(),s.resetCachedMaterial(),bn.PrepareDefinesForAttributes(e,o,!1,!1),r=[Si.PositionKind,Si.NormalKind],o.UV1&&r.push(Si.UVKind),o.UV2&&r.push(Si.UV2Kind),bn.PrepareAttributesForInstances(r,o),n=o.toString(),t.setEffect(s.getEngine().createEffect("grid",r,["projection","mainColor","lineColor","gridControl","gridOffset","vFogInfos","vFogColor","world","view","opacityMatrix","vOpacityInfos"],["opacitySampler"],n,void 0,this.onCompiled,this.onError),o)),!(!t.effect||!t.effect.isReady())&&(this._renderId=s.getRenderId(),t.effect._wasPreviouslyReady=!0)},cu.prototype.bindForSubMesh=function(e,t,i){var r,n=this.getScene(),o=i._materialDefines;!o||(r=i.effect)&&(this._activeEffect=r,o.INSTANCES||this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("view",n.getViewMatrix()),this._activeEffect.setMatrix("projection",n.getProjectionMatrix()),this._mustRebind(n,r)&&(this._activeEffect.setColor3("mainColor",this.mainColor),this._activeEffect.setColor3("lineColor",this.lineColor),this._activeEffect.setVector3("gridOffset",this.gridOffset),this._gridControl.x=this.gridRatio,this._gridControl.y=Math.round(this.majorUnitFrequency),this._gridControl.z=this.minorUnitVisibility,this._gridControl.w=this.opacity,this._activeEffect.setVector4("gridControl",this._gridControl),this._opacityTexture&&Sn.OpacityTextureEnabled&&(this._activeEffect.setTexture("opacitySampler",this._opacityTexture),this._activeEffect.setFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),this._activeEffect.setMatrix("opacityMatrix",this._opacityTexture.getTextureMatrix()))),bn.BindFogParameters(n,t,this._activeEffect),this._afterBind(t,this._activeEffect))},cu.prototype.dispose=function(e){lu.prototype.dispose.call(this,e)},cu.prototype.clone=function(e){var t=this;return Q.Clone(function(){return new cu(e,t.getScene())},this)},cu.prototype.serialize=function(){var e=Q.Serialize(this);return e.customType="BABYLON.GridMaterial",e},cu.prototype.getClassName=function(){return"GridMaterial"},cu.Parse=function(e,t,i){return Q.Parse(function(){return new cu(e.name,t)},e,t,i)},o([Y()],cu.prototype,"mainColor",void 0),o([Y()],cu.prototype,"lineColor",void 0),o([z()],cu.prototype,"gridRatio",void 0),o([Y()],cu.prototype,"gridOffset",void 0),o([z()],cu.prototype,"majorUnitFrequency",void 0),o([z()],cu.prototype,"minorUnitVisibility",void 0),o([z()],cu.prototype,"opacity",void 0),o([z()],cu.prototype,"preMultiplyAlpha",void 0),o([X("opacityTexture")],cu.prototype,"_opacityTexture",void 0),o([V("_markAllSubMeshesAsTexturesDirty")],cu.prototype,"opacityTexture",void 0),cu);function cu(e,t){var i=lu.call(this,e,t)||this;return i.mainColor=Ne.Black(),i.lineColor=Ne.Teal(),i.gridRatio=1,i.gridOffset=te.Zero(),i.majorUnitFrequency=10,i.minorUnitVisibility=.33,i.opacity=1,i.preMultiplyAlpha=!1,i._gridControl=new j(i.gridRatio,i.majorUnitFrequency,i.minorUnitVisibility,i.opacity),i}m.RegisteredTypes["BABYLON.GridMaterial"]=uu;var du=(Object.defineProperty(fu.prototype,"isPercentage",{get:function(){return this.unit===fu.UNITMODE_PERCENTAGE},enumerable:!0,configurable:!0}),Object.defineProperty(fu.prototype,"isPixel",{get:function(){return this.unit===fu.UNITMODE_PIXEL},enumerable:!0,configurable:!0}),Object.defineProperty(fu.prototype,"internalValue",{get:function(){return this._value},enumerable:!0,configurable:!0}),fu.prototype.getValueInPixel=function(e,t){return this.isPixel?this.getValue(e):this.getValue(e)*t},fu.prototype.updateInPlace=function(e,t){return void 0===t&&(t=fu.UNITMODE_PIXEL),this._value=e,this.unit=t,this},fu.prototype.getValue=function(e){if(e&&!this.ignoreAdaptiveScaling&&this.unit!==fu.UNITMODE_PERCENTAGE){var t=0,i=0;if(e.idealWidth&&(t=this._value*e.getSize().width/e.idealWidth),e.idealHeight&&(i=this._value*e.getSize().height/e.idealHeight),e.useSmallestIdeal&&e.idealWidth&&e.idealHeight)return window.innerWidth<window.innerHeight?t:i;if(e.idealWidth)return t;if(e.idealHeight)return i}return this._value},fu.prototype.toString=function(e,t){switch(this.unit){case fu.UNITMODE_PERCENTAGE:var i=100*this.getValue(e);return(t?i.toFixed(t):i)+"%";case fu.UNITMODE_PIXEL:var r=this.getValue(e);return(t?r.toFixed(t):r)+"px"}return this.unit.toString()},fu.prototype.fromString=function(e){var t=fu._Regex.exec(e.toString());if(!t||0===t.length)return!1;var i=parseFloat(t[1]),r=this._originalUnit;if(this.negativeValueAllowed||i<0&&(i=0),4===t.length)switch(t[3]){case"px":r=fu.UNITMODE_PIXEL;break;case"%":r=fu.UNITMODE_PERCENTAGE,i/=100}return(i!==this._value||r!==this.unit)&&(this._value=i,this.unit=r,!0)},Object.defineProperty(fu,"UNITMODE_PERCENTAGE",{get:function(){return fu._UNITMODE_PERCENTAGE},enumerable:!0,configurable:!0}),Object.defineProperty(fu,"UNITMODE_PIXEL",{get:function(){return fu._UNITMODE_PIXEL},enumerable:!0,configurable:!0}),fu._Regex=/(^-?\d*(\.\d+)?)(%|px)?/,fu._UNITMODE_PERCENTAGE=0,fu._UNITMODE_PIXEL=1,fu);function fu(e,t,i){void 0===t&&(t=fu.UNITMODE_PIXEL),void 0===i&&(i=!0),this.unit=t,this.negativeValueAllowed=i,this._value=1,this.ignoreAdaptiveScaling=!1,this._value=e,this._originalUnit=t}var pu=[new H(0,0),new H(0,0),new H(0,0),new H(0,0)],_u=[new H(0,0),new H(0,0),new H(0,0),new H(0,0)],gu=new H(0,0),mu=new H(0,0),vu=(yu.prototype.copyFrom=function(e){this.left=e.left,this.top=e.top,this.width=e.width,this.height=e.height},yu.prototype.copyFromFloats=function(e,t,i,r){this.left=e,this.top=t,this.width=i,this.height=r},yu.CombineToRef=function(e,t,i){var r=Math.min(e.left,t.left),n=Math.min(e.top,t.top),o=Math.max(e.left+e.width,t.left+t.width),s=Math.max(e.top+e.height,t.top+t.height);i.left=r,i.top=n,i.width=o-r,i.height=s-n},yu.prototype.transformToRef=function(e,t){pu[0].copyFromFloats(this.left,this.top),pu[1].copyFromFloats(this.left+this.width,this.top),pu[2].copyFromFloats(this.left+this.width,this.top+this.height),pu[3].copyFromFloats(this.left,this.top+this.height),gu.copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE),mu.copyFromFloats(0,0);for(var i=0;i<4;i++)e.transformCoordinates(pu[i].x,pu[i].y,_u[i]),gu.x=Math.floor(Math.min(gu.x,_u[i].x)),gu.y=Math.floor(Math.min(gu.y,_u[i].y)),mu.x=Math.ceil(Math.max(mu.x,_u[i].x)),mu.y=Math.ceil(Math.max(mu.y,_u[i].y));t.left=gu.x,t.top=gu.y,t.width=mu.x-gu.x,t.height=mu.y-gu.y},yu.prototype.isEqualsTo=function(e){return this.left===e.left&&this.top===e.top&&this.width===e.width&&this.height===e.height},yu.Empty=function(){return new yu(0,0,0,0)},yu);function yu(e,t,i,r){this.left=e,this.top=t,this.width=i,this.height=r}var bu,Tu=(n(xu,bu=H),xu);function xu(e,t){void 0===t&&(t=0);var i=bu.call(this,e.x,e.y)||this;return i.buttonIndex=t,i}var Eu=(Au.prototype.fromValues=function(e,t,i,r,n,o){return this.m[0]=e,this.m[1]=t,this.m[2]=i,this.m[3]=r,this.m[4]=n,this.m[5]=o,this},Au.prototype.determinant=function(){return this.m[0]*this.m[3]-this.m[1]*this.m[2]},Au.prototype.invertToRef=function(e){var t=this.m[0],i=this.m[1],r=this.m[2],n=this.m[3],o=this.m[4],s=this.m[5],a=this.determinant();if(a<C*C)return e.m[0]=0,e.m[1]=0,e.m[2]=0,e.m[3]=0,e.m[4]=0,e.m[5]=0,this;var h=1/a,l=r*s-n*o,u=i*o-t*s;return e.m[0]=n*h,e.m[1]=-i*h,e.m[2]=-r*h,e.m[3]=t*h,e.m[4]=l*h,e.m[5]=u*h,this},Au.prototype.multiplyToRef=function(e,t){var i=this.m[0],r=this.m[1],n=this.m[2],o=this.m[3],s=this.m[4],a=this.m[5],h=e.m[0],l=e.m[1],u=e.m[2],c=e.m[3],d=e.m[4],f=e.m[5];return t.m[0]=i*h+r*u,t.m[1]=i*l+r*c,t.m[2]=n*h+o*u,t.m[3]=n*l+o*c,t.m[4]=s*h+a*u+d,t.m[5]=s*l+a*c+f,this},Au.prototype.transformCoordinates=function(e,t,i){return i.x=e*this.m[0]+t*this.m[2]+this.m[4],i.y=e*this.m[1]+t*this.m[3]+this.m[5],this},Au.Identity=function(){return new Au(1,0,0,1,0,0)},Au.TranslationToRef=function(e,t,i){i.fromValues(1,0,0,1,e,t)},Au.ScalingToRef=function(e,t,i){i.fromValues(e,0,0,t,0,0)},Au.RotationToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.fromValues(r,i,-i,r,0,0)},Au.ComposeToRef=function(e,t,i,r,n,o,s){Au.TranslationToRef(e,t,Au._TempPreTranslationMatrix),Au.ScalingToRef(r,n,Au._TempScalingMatrix),Au.RotationToRef(i,Au._TempRotationMatrix),Au.TranslationToRef(-e,-t,Au._TempPostTranslationMatrix),Au._TempPreTranslationMatrix.multiplyToRef(Au._TempScalingMatrix,Au._TempCompose0),Au._TempCompose0.multiplyToRef(Au._TempRotationMatrix,Au._TempCompose1),o?(Au._TempCompose1.multiplyToRef(Au._TempPostTranslationMatrix,Au._TempCompose2),Au._TempCompose2.multiplyToRef(o,s)):Au._TempCompose1.multiplyToRef(Au._TempPostTranslationMatrix,s)},Au._TempPreTranslationMatrix=Au.Identity(),Au._TempPostTranslationMatrix=Au.Identity(),Au._TempRotationMatrix=Au.Identity(),Au._TempScalingMatrix=Au.Identity(),Au._TempCompose0=Au.Identity(),Au._TempCompose1=Au.Identity(),Au._TempCompose2=Au.Identity(),Au);function Au(e,t,i,r,n,o){this.m=new Float32Array(6),this.fromValues(e,t,i,r,n,o)}var Mu=(Object.defineProperty(Cu.prototype,"shadowOffsetX",{get:function(){return this._shadowOffsetX},set:function(e){this._shadowOffsetX!==e&&(this._shadowOffsetX=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"shadowOffsetY",{get:function(){return this._shadowOffsetY},set:function(e){this._shadowOffsetY!==e&&(this._shadowOffsetY=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"shadowBlur",{get:function(){return this._shadowBlur},set:function(e){this._shadowBlur!==e&&(this._shadowBlur=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"shadowColor",{get:function(){return this._shadowColor},set:function(e){this._shadowColor!==e&&(this._shadowColor=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"typeName",{get:function(){return this._getTypeName()},enumerable:!0,configurable:!0}),Cu.prototype.getClassName=function(){return this._getTypeName()},Object.defineProperty(Cu.prototype,"host",{get:function(){return this._host},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"fontOffset",{get:function(){return this._fontOffset},set:function(e){this._fontOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha!==e&&(this._alphaSet=!0,this._alpha=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"isHighlighted",{get:function(){return this._isHighlighted},set:function(e){this._isHighlighted!==e&&(this._isHighlighted=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"scaleX",{get:function(){return this._scaleX},set:function(e){this._scaleX!==e&&(this._scaleX=e,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"scaleY",{get:function(){return this._scaleY},set:function(e){this._scaleY!==e&&(this._scaleY=e,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation!==e&&(this._rotation=e,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"transformCenterY",{get:function(){return this._transformCenterY},set:function(e){this._transformCenterY!==e&&(this._transformCenterY=e,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"transformCenterX",{get:function(){return this._transformCenterX},set:function(e){this._transformCenterX!==e&&(this._transformCenterX=e,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"horizontalAlignment",{get:function(){return this._horizontalAlignment},set:function(e){this._horizontalAlignment!==e&&(this._horizontalAlignment=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"verticalAlignment",{get:function(){return this._verticalAlignment},set:function(e){this._verticalAlignment!==e&&(this._verticalAlignment=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(e){this._width.toString(this._host)!==e&&this._width.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"widthInPixels",{get:function(){return this._width.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(e){isNaN(e)||(this.width=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"height",{get:function(){return this._height.toString(this._host)},set:function(e){this._height.toString(this._host)!==e&&this._height.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"heightInPixels",{get:function(){return this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.height=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"fontFamily",{get:function(){return this._fontSet?this._fontFamily:""},set:function(e){this._fontFamily!==e&&(this._fontFamily=e,this._resetFontCache())},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(e){this._fontStyle!==e&&(this._fontStyle=e,this._resetFontCache())},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(e){this._fontWeight!==e&&(this._fontWeight=e,this._resetFontCache())},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"style",{get:function(){return this._style},set:function(e){var t=this;this._style&&(this._style.onChangedObservable.remove(this._styleObserver),this._styleObserver=null),this._style=e,this._style&&(this._styleObserver=this._style.onChangedObservable.add(function(){t._markAsDirty(),t._resetFontCache()})),this._markAsDirty(),this._resetFontCache()},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"_isFontSizeInPercentage",{get:function(){return this._fontSize.isPercentage},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"fontSizeInPixels",{get:function(){var e=this._style?this._style._fontSize:this._fontSize;return e.isPixel?e.getValue(this._host):e.getValueInPixel(this._host,this._tempParentMeasure.height||this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.fontSize=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"fontSize",{get:function(){return this._fontSize.toString(this._host)},set:function(e){this._fontSize.toString(this._host)!==e&&this._fontSize.fromString(e)&&(this._markAsDirty(),this._resetFontCache())},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"color",{get:function(){return this._color},set:function(e){this._color!==e&&(this._color=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"zIndex",{get:function(){return this._zIndex},set:function(e){this.zIndex!==e&&(this._zIndex=e,this.parent&&this.parent._reOrderControl(this))},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"notRenderable",{get:function(){return this._doNotRender},set:function(e){this._doNotRender!==e&&(this._doNotRender=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"isVisible",{get:function(){return this._isVisible},set:function(e){this._isVisible!==e&&(this._isVisible=e,this._markAsDirty(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"linkedMesh",{get:function(){return this._linkedMesh},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"paddingLeft",{get:function(){return this._paddingLeft.toString(this._host)},set:function(e){this._paddingLeft.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"paddingLeftInPixels",{get:function(){return this._paddingLeft.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(e){isNaN(e)||(this.paddingLeft=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"paddingRight",{get:function(){return this._paddingRight.toString(this._host)},set:function(e){this._paddingRight.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"paddingRightInPixels",{get:function(){return this._paddingRight.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(e){isNaN(e)||(this.paddingRight=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"paddingTop",{get:function(){return this._paddingTop.toString(this._host)},set:function(e){this._paddingTop.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"paddingTopInPixels",{get:function(){return this._paddingTop.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.paddingTop=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"paddingBottom",{get:function(){return this._paddingBottom.toString(this._host)},set:function(e){this._paddingBottom.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"paddingBottomInPixels",{get:function(){return this._paddingBottom.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.paddingBottom=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"left",{get:function(){return this._left.toString(this._host)},set:function(e){this._left.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"leftInPixels",{get:function(){return this._left.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(e){isNaN(e)||(this.left=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"top",{get:function(){return this._top.toString(this._host)},set:function(e){this._top.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"topInPixels",{get:function(){return this._top.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.top=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"linkOffsetX",{get:function(){return this._linkOffsetX.toString(this._host)},set:function(e){this._linkOffsetX.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"linkOffsetXInPixels",{get:function(){return this._linkOffsetX.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(e){isNaN(e)||(this.linkOffsetX=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"linkOffsetY",{get:function(){return this._linkOffsetY.toString(this._host)},set:function(e){this._linkOffsetY.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"linkOffsetYInPixels",{get:function(){return this._linkOffsetY.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.linkOffsetY=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"centerX",{get:function(){return this._currentMeasure.left+this._currentMeasure.width/2},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"centerY",{get:function(){return this._currentMeasure.top+this._currentMeasure.height/2},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"disabledColor",{get:function(){return this._disabledColor},set:function(e){this._disabledColor!==e&&(this._disabledColor=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Cu.prototype,"disabledColorItem",{get:function(){return this._disabledColorItem},set:function(e){this._disabledColorItem!==e&&(this._disabledColorItem=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Cu.prototype._getTypeName=function(){return"Control"},Cu.prototype.getAscendantOfClass=function(e){return this.parent?this.parent.getClassName()===e?this.parent:this.parent.getAscendantOfClass(e):null},Cu.prototype._resetFontCache=function(){this._fontSet=!0,this._markAsDirty()},Cu.prototype.isAscendant=function(e){return!!this.parent&&(this.parent===e||this.parent.isAscendant(e))},Cu.prototype.getLocalCoordinates=function(e){var t=H.Zero();return this.getLocalCoordinatesToRef(e,t),t},Cu.prototype.getLocalCoordinatesToRef=function(e,t){return t.x=e.x-this._currentMeasure.left,t.y=e.y-this._currentMeasure.top,this},Cu.prototype.getParentLocalCoordinates=function(e){var t=H.Zero();return t.x=e.x-this._cachedParentMeasure.left,t.y=e.y-this._cachedParentMeasure.top,t},Cu.prototype.moveToVector3=function(e,t){var i,r;this._host&&this.parent===this._host._rootContainer?(this.horizontalAlignment=Cu.HORIZONTAL_ALIGNMENT_LEFT,this.verticalAlignment=Cu.VERTICAL_ALIGNMENT_TOP,i=this._host._getGlobalViewport(t),r=te.Project(e,W.Identity(),t.getTransformMatrix(),i),this._moveToProjectedPosition(r),r.z<0||1<r.z?this.notRenderable=!0:this.notRenderable=!1):ri.Error("Cannot move a control to a vector3 if the control is not at root level")},Cu.prototype.getDescendantsToRef=function(e,t,i){void 0===t&&(t=!1)},Cu.prototype.getDescendants=function(e,t){var i=new Array;return this.getDescendantsToRef(i,e,t),i},Cu.prototype.linkWithMesh=function(e){var t;!this._host||this.parent&&this.parent!==this._host._rootContainer?e&&ri.Error("Cannot link a control to a mesh if the control is not at root level"):-1===(t=this._host._linkedControls.indexOf(this))?e&&(this.horizontalAlignment=Cu.HORIZONTAL_ALIGNMENT_LEFT,this.verticalAlignment=Cu.VERTICAL_ALIGNMENT_TOP,this._linkedMesh=e,this._host._linkedControls.push(this)):(this._linkedMesh=e)||this._host._linkedControls.splice(t,1)},Cu.prototype._moveToProjectedPosition=function(e){var t=this._left.getValue(this._host),i=this._top.getValue(this._host),r=e.x+this._linkOffsetX.getValue(this._host)-this._currentMeasure.width/2,n=e.y+this._linkOffsetY.getValue(this._host)-this._currentMeasure.height/2;this._left.ignoreAdaptiveScaling&&this._top.ignoreAdaptiveScaling&&(Math.abs(r-t)<.5&&(r=t),Math.abs(n-i)<.5&&(n=i)),this.left=r+"px",this.top=n+"px",this._left.ignoreAdaptiveScaling=!0,this._top.ignoreAdaptiveScaling=!0,this._markAsDirty()},Cu.prototype._offsetLeft=function(e){this._isDirty=!0,this._currentMeasure.left+=e},Cu.prototype._offsetTop=function(e){this._isDirty=!0,this._currentMeasure.top+=e},Cu.prototype._markMatrixAsDirty=function(){this._isMatrixDirty=!0,this._flagDescendantsAsMatrixDirty()},Cu.prototype._flagDescendantsAsMatrixDirty=function(){},Cu.prototype._intersectsRect=function(e){return this._currentMeasure.transformToRef(this._transformMatrix,this._tmpMeasureA),!(this._tmpMeasureA.left>=e.left+e.width||this._tmpMeasureA.top>=e.top+e.height||this._tmpMeasureA.left+this._tmpMeasureA.width<=e.left||this._tmpMeasureA.top+this._tmpMeasureA.height<=e.top)},Cu.prototype.invalidateRect=function(){var e,t,i,r,n,o,s;this._transform(),this.host&&this.host.useInvalidateRectOptimization&&(this._currentMeasure.transformToRef(this._transformMatrix,this._tmpMeasureA),vu.CombineToRef(this._tmpMeasureA,this._prevCurrentMeasureTransformedIntoGlobalSpace,this._tmpMeasureA),this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY?(e=this.shadowOffsetX,t=this.shadowOffsetY,i=this.shadowBlur,r=Math.min(Math.min(e,0)-2*i,0),n=Math.max(Math.max(e,0)+2*i,0),o=Math.min(Math.min(t,0)-2*i,0),s=Math.max(Math.max(t,0)+2*i,0),this.host.invalidateRect(Math.floor(this._tmpMeasureA.left+r),Math.floor(this._tmpMeasureA.top+o),Math.ceil(this._tmpMeasureA.left+this._tmpMeasureA.width+n),Math.ceil(this._tmpMeasureA.top+this._tmpMeasureA.height+s))):this.host.invalidateRect(Math.floor(this._tmpMeasureA.left),Math.floor(this._tmpMeasureA.top),Math.ceil(this._tmpMeasureA.left+this._tmpMeasureA.width),Math.ceil(this._tmpMeasureA.top+this._tmpMeasureA.height)))},Cu.prototype._markAsDirty=function(e){void 0===e&&(e=!1),(this._isVisible||e)&&(this._isDirty=!0,this._host&&this._host.markAsDirty())},Cu.prototype._markAllAsDirty=function(){this._markAsDirty(),this._font&&this._prepareFont()},Cu.prototype._link=function(e){this._host=e,this._host&&(this.uniqueId=this._host.getScene().getUniqueId())},Cu.prototype._transform=function(e){var t,i;!this._isMatrixDirty&&1===this._scaleX&&1===this._scaleY&&0===this._rotation||(t=this._currentMeasure.width*this._transformCenterX+this._currentMeasure.left,i=this._currentMeasure.height*this._transformCenterY+this._currentMeasure.top,e&&(e.translate(t,i),e.rotate(this._rotation),e.scale(this._scaleX,this._scaleY),e.translate(-t,-i)),!this._isMatrixDirty&&this._cachedOffsetX===t&&this._cachedOffsetY===i||(this._cachedOffsetX=t,this._cachedOffsetY=i,this._isMatrixDirty=!1,this._flagDescendantsAsMatrixDirty(),Eu.ComposeToRef(-t,-i,this._rotation,this._scaleX,this._scaleY,this.parent?this.parent._transformMatrix:null,this._transformMatrix),this._transformMatrix.invertToRef(this._invertTransformMatrix)))},Cu.prototype._renderHighlight=function(e){this.isHighlighted&&(e.save(),e.strokeStyle="#4affff",e.lineWidth=2,this._renderHighlightSpecific(e),e.restore())},Cu.prototype._renderHighlightSpecific=function(e){e.strokeRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)},Cu.prototype._applyStates=function(e){this._isFontSizeInPercentage&&(this._fontSet=!0),this._fontSet&&(this._prepareFont(),this._fontSet=!1),this._font&&(e.font=this._font),this._color&&(e.fillStyle=this._color),Cu.AllowAlphaInheritance?e.globalAlpha*=this._alpha:this._alphaSet&&(e.globalAlpha=this.parent?this.parent.alpha*this._alpha:this._alpha)},Cu.prototype._layout=function(e,t){if(!this.isDirty&&(!this.isVisible||this.notRenderable))return!1;if(this._isDirty||!this._cachedParentMeasure.isEqualsTo(e)){this.host._numLayoutCalls++,this._currentMeasure.transformToRef(this._transformMatrix,this._prevCurrentMeasureTransformedIntoGlobalSpace),t.save(),this._applyStates(t);for(var i=0;this._rebuildLayout=!1,this._processMeasures(e,t),i++,this._rebuildLayout&&i<3;);3<=i&&fe.Error("Layout cycle detected in GUI (Control name="+this.name+", uniqueId="+this.uniqueId+")"),t.restore(),this.invalidateRect(),this._evaluateClippingState(e)}return this._wasDirty=this._isDirty,!(this._isDirty=!1)},Cu.prototype._processMeasures=function(e,t){this._currentMeasure.copyFrom(e),this._preMeasure(e,t),this._measure(),this._computeAlignment(e,t),this._currentMeasure.left=0|this._currentMeasure.left,this._currentMeasure.top=0|this._currentMeasure.top,this._currentMeasure.width=0|this._currentMeasure.width,this._currentMeasure.height=0|this._currentMeasure.height,this._additionalProcessing(e,t),this._cachedParentMeasure.copyFrom(e),this.onDirtyObservable.hasObservers()&&this.onDirtyObservable.notifyObservers(this)},Cu.prototype._evaluateClippingState=function(e){if(this.parent&&this.parent.clipChildren){if(this._currentMeasure.left>e.left+e.width)return void(this._isClipped=!0);if(this._currentMeasure.left+this._currentMeasure.width<e.left)return void(this._isClipped=!0);if(this._currentMeasure.top>e.top+e.height)return void(this._isClipped=!0);if(this._currentMeasure.top+this._currentMeasure.height<e.top)return void(this._isClipped=!0)}this._isClipped=!1},Cu.prototype._measure=function(){this._width.isPixel?this._currentMeasure.width=this._width.getValue(this._host):this._currentMeasure.width*=this._width.getValue(this._host),this._height.isPixel?this._currentMeasure.height=this._height.getValue(this._host):this._currentMeasure.height*=this._height.getValue(this._host)},Cu.prototype._computeAlignment=function(e,t){var i=this._currentMeasure.width,r=this._currentMeasure.height,n=e.width,o=e.height,s=0,a=0;switch(this.horizontalAlignment){case Cu.HORIZONTAL_ALIGNMENT_LEFT:s=0;break;case Cu.HORIZONTAL_ALIGNMENT_RIGHT:s=n-i;break;case Cu.HORIZONTAL_ALIGNMENT_CENTER:s=(n-i)/2}switch(this.verticalAlignment){case Cu.VERTICAL_ALIGNMENT_TOP:a=0;break;case Cu.VERTICAL_ALIGNMENT_BOTTOM:a=o-r;break;case Cu.VERTICAL_ALIGNMENT_CENTER:a=(o-r)/2}this._paddingLeft.isPixel?(this._currentMeasure.left+=this._paddingLeft.getValue(this._host),this._currentMeasure.width-=this._paddingLeft.getValue(this._host)):(this._currentMeasure.left+=n*this._paddingLeft.getValue(this._host),this._currentMeasure.width-=n*this._paddingLeft.getValue(this._host)),this._paddingRight.isPixel?this._currentMeasure.width-=this._paddingRight.getValue(this._host):this._currentMeasure.width-=n*this._paddingRight.getValue(this._host),this._paddingTop.isPixel?(this._currentMeasure.top+=this._paddingTop.getValue(this._host),this._currentMeasure.height-=this._paddingTop.getValue(this._host)):(this._currentMeasure.top+=o*this._paddingTop.getValue(this._host),this._currentMeasure.height-=o*this._paddingTop.getValue(this._host)),this._paddingBottom.isPixel?this._currentMeasure.height-=this._paddingBottom.getValue(this._host):this._currentMeasure.height-=o*this._paddingBottom.getValue(this._host),this._left.isPixel?this._currentMeasure.left+=this._left.getValue(this._host):this._currentMeasure.left+=n*this._left.getValue(this._host),this._top.isPixel?this._currentMeasure.top+=this._top.getValue(this._host):this._currentMeasure.top+=o*this._top.getValue(this._host),this._currentMeasure.left+=s,this._currentMeasure.top+=a},Cu.prototype._preMeasure=function(e,t){},Cu.prototype._additionalProcessing=function(e,t){},Cu.prototype._clipForChildren=function(e){},Cu.prototype._clip=function(e,t){var i,r,n,o,s,a,h,l;e.beginPath(),Cu._ClipMeasure.copyFrom(this._currentMeasure),t&&(t.transformToRef(this._invertTransformMatrix,this._tmpMeasureA),(i=new vu(0,0,0,0)).left=Math.max(this._tmpMeasureA.left,this._currentMeasure.left),i.top=Math.max(this._tmpMeasureA.top,this._currentMeasure.top),i.width=Math.min(this._tmpMeasureA.left+this._tmpMeasureA.width,this._currentMeasure.left+this._currentMeasure.width)-i.left,i.height=Math.min(this._tmpMeasureA.top+this._tmpMeasureA.height,this._currentMeasure.top+this._currentMeasure.height)-i.top,Cu._ClipMeasure.copyFrom(i)),this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY?(r=this.shadowOffsetX,n=this.shadowOffsetY,o=this.shadowBlur,s=Math.min(Math.min(r,0)-2*o,0),a=Math.max(Math.max(r,0)+2*o,0),h=Math.min(Math.min(n,0)-2*o,0),l=Math.max(Math.max(n,0)+2*o,0),e.rect(Cu._ClipMeasure.left+s,Cu._ClipMeasure.top+h,Cu._ClipMeasure.width+a-s,Cu._ClipMeasure.height+l-h)):e.rect(Cu._ClipMeasure.left,Cu._ClipMeasure.top,Cu._ClipMeasure.width,Cu._ClipMeasure.height),e.clip()},Cu.prototype._render=function(e,t){return!this.isVisible||this.notRenderable||this._isClipped?this._isDirty=!1:(this.host._numRenderCalls++,e.save(),this._applyStates(e),this._transform(e),this.clipContent&&this._clip(e,t),this.onBeforeDrawObservable.hasObservers()&&this.onBeforeDrawObservable.notifyObservers(this),this.useBitmapCache&&!this._wasDirty&&this._cacheData?e.putImageData(this._cacheData,this._currentMeasure.left,this._currentMeasure.top):this._draw(e,t),this.useBitmapCache&&this._wasDirty&&(this._cacheData=e.getImageData(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._renderHighlight(e),this.onAfterDrawObservable.hasObservers()&&this.onAfterDrawObservable.notifyObservers(this),e.restore(),!0)},Cu.prototype._draw=function(e,t){},Cu.prototype.contains=function(e,t){return this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y,!(e<this._currentMeasure.left||e>this._currentMeasure.left+this._currentMeasure.width||t<this._currentMeasure.top||t>this._currentMeasure.top+this._currentMeasure.height||(this.isPointerBlocker&&(this._host._shouldBlockPointer=!0),0))},Cu.prototype._processPicking=function(e,t,i,r,n,o,s){return!(!this._isEnabled||!this.isHitTestVisible||!this.isVisible||this._doNotRender||!this.contains(e,t)||(this._processObservables(i,e,t,r,n,o,s),0))},Cu.prototype._onPointerMove=function(e,t,i){this.onPointerMoveObservable.notifyObservers(t,-1,e,this)&&null!=this.parent&&this.parent._onPointerMove(e,t,i)},Cu.prototype._onPointerEnter=function(e){return!(!this._isEnabled||0<this._enterCount||(-1===this._enterCount&&(this._enterCount=0),this._enterCount++,this.onPointerEnterObservable.notifyObservers(this,-1,e,this)&&null!=this.parent&&this.parent._onPointerEnter(e),0))},Cu.prototype._onPointerOut=function(e,t){var i;void 0===t&&(t=!1),(t||this._isEnabled&&e!==this)&&(i=!(this._enterCount=0),e.isAscendant(this)||(i=this.onPointerOutObservable.notifyObservers(this,-1,e,this)),i&&null!=this.parent&&this.parent._onPointerOut(e,t))},Cu.prototype._onPointerDown=function(e,t,i,r){return this._onPointerEnter(this),0===this._downCount&&(this._downCount++,this._downPointerIds[i]=!0,this.onPointerDownObservable.notifyObservers(new Tu(t,r),-1,e,this)&&null!=this.parent&&this.parent._onPointerDown(e,t,i,r),!0)},Cu.prototype._onPointerUp=function(e,t,i,r,n){var o;this._isEnabled&&(this._downCount=0,delete this._downPointerIds[i],(o=n)&&(0<this._enterCount||-1===this._enterCount)&&(o=this.onPointerClickObservable.notifyObservers(new Tu(t,r),-1,e,this)),this.onPointerUpObservable.notifyObservers(new Tu(t,r),-1,e,this)&&null!=this.parent&&this.parent._onPointerUp(e,t,i,r,o))},Cu.prototype._forcePointerUp=function(e){if(void 0===e&&(e=null),null!==e)this._onPointerUp(this,H.Zero(),e,0,!0);else for(var t in this._downPointerIds)this._onPointerUp(this,H.Zero(),+t,0,!0)},Cu.prototype._onWheelScroll=function(e,t){this._isEnabled&&this.onWheelObservable.notifyObservers(new H(e,t))&&null!=this.parent&&this.parent._onWheelScroll(e,t)},Cu.prototype._processObservables=function(e,t,i,r,n,o,s){if(!this._isEnabled)return!1;if(this._dummyVector2.copyFromFloats(t,i),e!==Xr.POINTERMOVE)return e===Xr.POINTERDOWN?(this._onPointerDown(this,this._dummyVector2,r,n),this._host._registerLastControlDown(this,r),this._host._lastPickedControl=this,!0):e===Xr.POINTERUP?(this._host._lastControlDown[r]&&this._host._lastControlDown[r]._onPointerUp(this,this._dummyVector2,r,n,!0),delete this._host._lastControlDown[r],!0):!(e!==Xr.POINTERWHEEL||!this._host._lastControlOver[r]||(this._host._lastControlOver[r]._onWheelScroll(o,s),0));this._onPointerMove(this,this._dummyVector2,r);var a=this._host._lastControlOver[r];return a&&a!==this&&a._onPointerOut(this),a!==this&&this._onPointerEnter(this),this._host._lastControlOver[r]=this,!0},Cu.prototype._prepareFont=function(){(this._font||this._fontSet)&&(this._style?this._font=this._style.fontStyle+" "+this._style.fontWeight+" "+this.fontSizeInPixels+"px "+this._style.fontFamily:this._font=this._fontStyle+" "+this._fontWeight+" "+this.fontSizeInPixels+"px "+this._fontFamily,this._fontOffset=Cu._GetFontOffset(this._font))},Cu.prototype.dispose=function(){this.onDirtyObservable.clear(),this.onBeforeDrawObservable.clear(),this.onAfterDrawObservable.clear(),this.onPointerDownObservable.clear(),this.onPointerEnterObservable.clear(),this.onPointerMoveObservable.clear(),this.onPointerOutObservable.clear(),this.onPointerUpObservable.clear(),this.onPointerClickObservable.clear(),this.onWheelObservable.clear(),this._styleObserver&&this._style&&(this._style.onChangedObservable.remove(this._styleObserver),this._styleObserver=null),this.parent&&(this.parent.removeControl(this),this.parent=null),this._host&&-1<this._host._linkedControls.indexOf(this)&&this.linkWithMesh(null)},Object.defineProperty(Cu,"HORIZONTAL_ALIGNMENT_LEFT",{get:function(){return Cu._HORIZONTAL_ALIGNMENT_LEFT},enumerable:!0,configurable:!0}),Object.defineProperty(Cu,"HORIZONTAL_ALIGNMENT_RIGHT",{get:function(){return Cu._HORIZONTAL_ALIGNMENT_RIGHT},enumerable:!0,configurable:!0}),Object.defineProperty(Cu,"HORIZONTAL_ALIGNMENT_CENTER",{get:function(){return Cu._HORIZONTAL_ALIGNMENT_CENTER},enumerable:!0,configurable:!0}),Object.defineProperty(Cu,"VERTICAL_ALIGNMENT_TOP",{get:function(){return Cu._VERTICAL_ALIGNMENT_TOP},enumerable:!0,configurable:!0}),Object.defineProperty(Cu,"VERTICAL_ALIGNMENT_BOTTOM",{get:function(){return Cu._VERTICAL_ALIGNMENT_BOTTOM},enumerable:!0,configurable:!0}),Object.defineProperty(Cu,"VERTICAL_ALIGNMENT_CENTER",{get:function(){return Cu._VERTICAL_ALIGNMENT_CENTER},enumerable:!0,configurable:!0}),Cu._GetFontOffset=function(e){if(Cu._FontHeightSizes[e])return Cu._FontHeightSizes[e];var t=document.createElement("span");t.innerHTML="Hg",t.style.font=e;var i=document.createElement("div");i.style.display="inline-block",i.style.width="1px",i.style.height="0px",i.style.verticalAlign="bottom";var r=document.createElement("div");r.appendChild(t),r.appendChild(i),document.body.appendChild(r);var n=0,o=0;try{o=i.getBoundingClientRect().top-t.getBoundingClientRect().top,i.style.verticalAlign="baseline",n=i.getBoundingClientRect().top-t.getBoundingClientRect().top}finally{document.body.removeChild(r)}var s={ascent:n,height:o,descent:o-n};return Cu._FontHeightSizes[e]=s},Cu.drawEllipse=function(e,t,i,r,n){n.translate(e,t),n.scale(i,r),n.beginPath(),n.arc(0,0,1,0,2*Math.PI),n.closePath(),n.scale(1/i,1/r),n.translate(-e,-t)},Cu.AllowAlphaInheritance=!1,Cu._ClipMeasure=new vu(0,0,0,0),Cu._HORIZONTAL_ALIGNMENT_LEFT=0,Cu._HORIZONTAL_ALIGNMENT_RIGHT=1,Cu._HORIZONTAL_ALIGNMENT_CENTER=2,Cu._VERTICAL_ALIGNMENT_TOP=0,Cu._VERTICAL_ALIGNMENT_BOTTOM=1,Cu._VERTICAL_ALIGNMENT_CENTER=2,Cu._FontHeightSizes={},Cu.AddHeader=function(){},Cu);function Cu(e){this.name=e,this._alpha=1,this._alphaSet=!1,this._zIndex=0,this._currentMeasure=vu.Empty(),this._fontFamily="Arial",this._fontStyle="",this._fontWeight="",this._fontSize=new du(18,du.UNITMODE_PIXEL,!1),this._width=new du(1,du.UNITMODE_PERCENTAGE,!1),this._height=new du(1,du.UNITMODE_PERCENTAGE,!1),this._color="",this._style=null,this._horizontalAlignment=Cu.HORIZONTAL_ALIGNMENT_CENTER,this._verticalAlignment=Cu.VERTICAL_ALIGNMENT_CENTER,this._isDirty=!0,this._wasDirty=!1,this._tempParentMeasure=vu.Empty(),this._prevCurrentMeasureTransformedIntoGlobalSpace=vu.Empty(),this._cachedParentMeasure=vu.Empty(),this._paddingLeft=new du(0),this._paddingRight=new du(0),this._paddingTop=new du(0),this._paddingBottom=new du(0),this._left=new du(0),this._top=new du(0),this._scaleX=1,this._scaleY=1,this._rotation=0,this._transformCenterX=.5,this._transformCenterY=.5,this._transformMatrix=Eu.Identity(),this._invertTransformMatrix=Eu.Identity(),this._transformedPosition=H.Zero(),this._isMatrixDirty=!0,this._isVisible=!0,this._isHighlighted=!1,this._fontSet=!1,this._dummyVector2=H.Zero(),this._downCount=0,this._enterCount=-1,this._doNotRender=!1,this._downPointerIds={},this._isEnabled=!0,this._disabledColor="#9a9a9a",this._disabledColorItem="#6a6a6a",this._rebuildLayout=!1,this._customData={},this._isClipped=!1,this._automaticSize=!1,this.metadata=null,this.isHitTestVisible=!0,this.isPointerBlocker=!1,this.isFocusInvisible=!1,this.clipChildren=!0,this.clipContent=!0,this.useBitmapCache=!1,this._shadowOffsetX=0,this._shadowOffsetY=0,this._shadowBlur=0,this._shadowColor="black",this.hoverCursor="",this._linkOffsetX=new du(0),this._linkOffsetY=new du(0),this.onWheelObservable=new le,this.onPointerMoveObservable=new le,this.onPointerOutObservable=new le,this.onPointerDownObservable=new le,this.onPointerUpObservable=new le,this.onPointerClickObservable=new le,this.onPointerEnterObservable=new le,this.onDirtyObservable=new le,this.onBeforeDrawObservable=new le,this.onAfterDrawObservable=new le,this._tmpMeasureA=new vu(0,0,0,0)}m.RegisteredTypes["BABYLON.GUI.Control"]=Mu;var Pu,Ou=(n(Su,Pu=Mu),Object.defineProperty(Su.prototype,"adaptHeightToChildren",{get:function(){return this._adaptHeightToChildren},set:function(e){this._adaptHeightToChildren!==e&&((this._adaptHeightToChildren=e)&&(this.height="100%"),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Su.prototype,"adaptWidthToChildren",{get:function(){return this._adaptWidthToChildren},set:function(e){this._adaptWidthToChildren!==e&&((this._adaptWidthToChildren=e)&&(this.width="100%"),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Su.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Su.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),Su.prototype._getTypeName=function(){return"Container"},Su.prototype._flagDescendantsAsMatrixDirty=function(){for(var e=0,t=this.children;e<t.length;e++)t[e]._markMatrixAsDirty()},Su.prototype.getChildByName=function(e){for(var t=0,i=this.children;t<i.length;t++){var r=i[t];if(r.name===e)return r}return null},Su.prototype.getChildByType=function(e,t){for(var i=0,r=this.children;i<r.length;i++){var n=r[i];if(n.typeName===t)return n}return null},Su.prototype.containsControl=function(e){return-1!==this.children.indexOf(e)},Su.prototype.addControl=function(e){return e&&(-1!==this._children.indexOf(e)||(e._link(this._host),e._markAllAsDirty(),this._reOrderControl(e),this._markAsDirty())),this},Su.prototype.clearControls=function(){for(var e=0,t=this.children.slice();e<t.length;e++){var i=t[e];this.removeControl(i)}return this},Su.prototype.removeControl=function(e){var t=this._children.indexOf(e);return-1!==t&&(this._children.splice(t,1),e.parent=null),e.linkWithMesh(null),this._host&&this._host._cleanControlAfterRemoval(e),this._markAsDirty(),this},Su.prototype._reOrderControl=function(e){this.removeControl(e);for(var t=!1,i=0;i<this._children.length;i++)if(this._children[i].zIndex>e.zIndex){this._children.splice(i,0,e),t=!0;break}t||this._children.push(e),(e.parent=this)._markAsDirty()},Su.prototype._offsetLeft=function(e){Pu.prototype._offsetLeft.call(this,e);for(var t=0,i=this._children;t<i.length;t++)i[t]._offsetLeft(e)},Su.prototype._offsetTop=function(e){Pu.prototype._offsetTop.call(this,e);for(var t=0,i=this._children;t<i.length;t++)i[t]._offsetTop(e)},Su.prototype._markAllAsDirty=function(){Pu.prototype._markAllAsDirty.call(this);for(var e=0;e<this._children.length;e++)this._children[e]._markAllAsDirty()},Su.prototype._localDraw=function(e){this._background&&(e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),e.fillStyle=this._background,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height),e.restore())},Su.prototype._link=function(e){Pu.prototype._link.call(this,e);for(var t=0,i=this._children;t<i.length;t++)i[t]._link(e)},Su.prototype._beforeLayout=function(){},Su.prototype._processMeasures=function(e,t){!this._isDirty&&this._cachedParentMeasure.isEqualsTo(e)||(Pu.prototype._processMeasures.call(this,e,t),this._evaluateClippingState(e))},Su.prototype._layout=function(e,t){if(!this.isDirty&&(!this.isVisible||this.notRenderable))return!1;this.host._numLayoutCalls++,this._isDirty&&this._currentMeasure.transformToRef(this._transformMatrix,this._prevCurrentMeasureTransformedIntoGlobalSpace);var i=0;t.save(),this._applyStates(t),this._beforeLayout();do{var r=-1,n=-1;if(this._rebuildLayout=!1,this._processMeasures(e,t),!this._isClipped){for(var o=0,s=this._children;o<s.length;o++){var a=s[o];a._tempParentMeasure.copyFrom(this._measureForChildren),a._layout(this._measureForChildren,t)&&(this.adaptWidthToChildren&&a._width.isPixel&&(r=Math.max(r,a._currentMeasure.width)),this.adaptHeightToChildren&&a._height.isPixel&&(n=Math.max(n,a._currentMeasure.height)))}this.adaptWidthToChildren&&0<=r&&this.width!==r+"px"&&(this.width=r+"px",this._rebuildLayout=!0),this.adaptHeightToChildren&&0<=n&&this.height!==n+"px"&&(this.height=n+"px",this._rebuildLayout=!0),this._postMeasure()}i++}while(this._rebuildLayout&&i<this.maxLayoutCycle);return 3<=i&&this.logLayoutCycleErrors&&fe.Error("Layout cycle detected in GUI (Container name="+this.name+", uniqueId="+this.uniqueId+")"),t.restore(),this._isDirty&&(this.invalidateRect(),this._isDirty=!1),!0},Su.prototype._postMeasure=function(){},Su.prototype._draw=function(e,t){this._localDraw(e),this.clipChildren&&this._clipForChildren(e);for(var i=0,r=this._children;i<r.length;i++){var n=r[i];t&&!n._intersectsRect(t)||n._render(e,t)}},Su.prototype.getDescendantsToRef=function(e,t,i){if(void 0===t&&(t=!1),this.children)for(var r=0;r<this.children.length;r++){var n=this.children[r];i&&!i(n)||e.push(n),t||n.getDescendantsToRef(e,!1,i)}},Su.prototype._processPicking=function(e,t,i,r,n,o,s){if(!this._isEnabled||!this.isVisible||this.notRenderable)return!1;if(!Pu.prototype.contains.call(this,e,t))return!1;for(var a=this._children.length-1;0<=a;a--){var h=this._children[a];if(h._processPicking(e,t,i,r,n,o,s))return h.hoverCursor&&this._host._changeCursor(h.hoverCursor),!0}return!!this.isHitTestVisible&&this._processObservables(i,e,t,r,n,o,s)},Su.prototype._additionalProcessing=function(e,t){Pu.prototype._additionalProcessing.call(this,e,t),this._measureForChildren.copyFrom(this._currentMeasure)},Su.prototype.dispose=function(){Pu.prototype.dispose.call(this);for(var e=this.children.length-1;0<=e;e--)this.children[e].dispose()},Su);function Su(e){var t=Pu.call(this,e)||this;return t.name=e,t._children=new Array,t._measureForChildren=vu.Empty(),t._background="",t._adaptWidthToChildren=!1,t._adaptHeightToChildren=!1,t.logLayoutCycleErrors=!1,t.maxLayoutCycle=3,t}m.RegisteredTypes["BABYLON.GUI.Container"]=Ou;var Iu,Ru,Du,wu=(n(Lu,Iu=Ou),Object.defineProperty(Lu.prototype,"thickness",{get:function(){return this._thickness},set:function(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Lu.prototype,"cornerRadius",{get:function(){return this._cornerRadius},set:function(e){e<0&&(e=0),this._cornerRadius!==e&&(this._cornerRadius=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Lu.prototype._getTypeName=function(){return"Rectangle"},Lu.prototype._localDraw=function(e){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._background&&(e.fillStyle=this._background,this._cornerRadius?(this._drawRoundedRect(e,this._thickness/2),e.fill()):e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._thickness&&((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this.color&&(e.strokeStyle=this.color),e.lineWidth=this._thickness,this._cornerRadius?(this._drawRoundedRect(e,this._thickness/2),e.stroke()):e.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness)),e.restore()},Lu.prototype._additionalProcessing=function(e,t){Iu.prototype._additionalProcessing.call(this,e,t),this._measureForChildren.width-=2*this._thickness,this._measureForChildren.height-=2*this._thickness,this._measureForChildren.left+=this._thickness,this._measureForChildren.top+=this._thickness},Lu.prototype._drawRoundedRect=function(e,t){void 0===t&&(t=0);var i=this._currentMeasure.left+t,r=this._currentMeasure.top+t,n=this._currentMeasure.width-2*t,o=this._currentMeasure.height-2*t,s=Math.min(o/2-2,Math.min(n/2-2,this._cornerRadius));e.beginPath(),e.moveTo(i+s,r),e.lineTo(i+n-s,r),e.quadraticCurveTo(i+n,r,i+n,r+s),e.lineTo(i+n,r+o-s),e.quadraticCurveTo(i+n,r+o,i+n-s,r+o),e.lineTo(i+s,r+o),e.quadraticCurveTo(i,r+o,i,r+o-s),e.lineTo(i,r+s),e.quadraticCurveTo(i,r,i+s,r),e.closePath()},Lu.prototype._clipForChildren=function(e){this._cornerRadius&&(this._drawRoundedRect(e,this._thickness),e.clip())},Lu);function Lu(e){var t=Iu.call(this,e)||this;return t.name=e,t._thickness=1,t._cornerRadius=0,t}m.RegisteredTypes["BABYLON.GUI.Rectangle"]=wu,(Du=Ru=Ru||{})[Du.Clip=0]="Clip",Du[Du.WordWrap=1]="WordWrap",Du[Du.Ellipsis=2]="Ellipsis";var Fu,Nu=(n(Bu,Fu=Mu),Object.defineProperty(Bu.prototype,"lines",{get:function(){return this._lines},enumerable:!0,configurable:!0}),Object.defineProperty(Bu.prototype,"resizeToFit",{get:function(){return this._resizeToFit},set:function(e){this._resizeToFit!==e&&(this._resizeToFit=e,this._resizeToFit&&(this._width.ignoreAdaptiveScaling=!0,this._height.ignoreAdaptiveScaling=!0),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Bu.prototype,"textWrapping",{get:function(){return this._textWrapping},set:function(e){this._textWrapping!==e&&(this._textWrapping=+e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Bu.prototype,"text",{get:function(){return this._text},set:function(e){this._text!==e&&(this._text=e,this._markAsDirty(),this.onTextChangedObservable.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(Bu.prototype,"textHorizontalAlignment",{get:function(){return this._textHorizontalAlignment},set:function(e){this._textHorizontalAlignment!==e&&(this._textHorizontalAlignment=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Bu.prototype,"textVerticalAlignment",{get:function(){return this._textVerticalAlignment},set:function(e){this._textVerticalAlignment!==e&&(this._textVerticalAlignment=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Bu.prototype,"lineSpacing",{get:function(){return this._lineSpacing.toString(this._host)},set:function(e){this._lineSpacing.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(Bu.prototype,"outlineWidth",{get:function(){return this._outlineWidth},set:function(e){this._outlineWidth!==e&&(this._outlineWidth=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Bu.prototype,"outlineColor",{get:function(){return this._outlineColor},set:function(e){this._outlineColor!==e&&(this._outlineColor=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Bu.prototype._getTypeName=function(){return"TextBlock"},Bu.prototype._processMeasures=function(e,t){this._fontOffset||(this._fontOffset=Mu._GetFontOffset(t.font)),Fu.prototype._processMeasures.call(this,e,t),this._lines=this._breakLines(this._currentMeasure.width,t),this.onLinesReadyObservable.notifyObservers(this);for(var i,r,n,o=0,s=0;s<this._lines.length;s++){var a=this._lines[s];a.width>o&&(o=a.width)}this._resizeToFit&&(this._textWrapping!==Ru.Clip||(i=this.paddingLeftInPixels+this.paddingRightInPixels+o)!==this._width.internalValue&&(this._width.updateInPlace(i,du.UNITMODE_PIXEL),this._rebuildLayout=!0),r=this.paddingTopInPixels+this.paddingBottomInPixels+this._fontOffset.height*this._lines.length,0<this._lines.length&&0!==this._lineSpacing.internalValue&&(n=0,n=this._lineSpacing.isPixel?this._lineSpacing.getValue(this._host):this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height),r+=(this._lines.length-1)*n),r!==this._height.internalValue&&(this._height.updateInPlace(r,du.UNITMODE_PIXEL),this._rebuildLayout=!0))},Bu.prototype._drawText=function(e,t,i,r){var n=this._currentMeasure.width,o=0;switch(this._textHorizontalAlignment){case Mu.HORIZONTAL_ALIGNMENT_LEFT:o=0;break;case Mu.HORIZONTAL_ALIGNMENT_RIGHT:o=n-t;break;case Mu.HORIZONTAL_ALIGNMENT_CENTER:o=(n-t)/2}(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(r.shadowColor=this.shadowColor,r.shadowBlur=this.shadowBlur,r.shadowOffsetX=this.shadowOffsetX,r.shadowOffsetY=this.shadowOffsetY),this.outlineWidth&&r.strokeText(e,this._currentMeasure.left+o,i),r.fillText(e,this._currentMeasure.left+o,i)},Bu.prototype._draw=function(e,t){e.save(),this._applyStates(e),this._renderLines(e),e.restore()},Bu.prototype._applyStates=function(e){Fu.prototype._applyStates.call(this,e),this.outlineWidth&&(e.lineWidth=this.outlineWidth,e.strokeStyle=this.outlineColor)},Bu.prototype._breakLines=function(e,t){var i=[],r=this.text.split("\n");if(this._textWrapping===Ru.Ellipsis)for(var n=0,o=r;n<o.length;n++){var s=o[n];i.push(this._parseLineEllipsis(s,e,t))}else if(this._textWrapping===Ru.WordWrap)for(var a=0,h=r;a<h.length;a++)s=h[a],i.push.apply(i,this._parseLineWordWrap(s,e,t));else for(var l=0,u=r;l<u.length;l++)s=u[l],i.push(this._parseLine(s,t));return i},Bu.prototype._parseLine=function(e,t){return void 0===e&&(e=""),{text:e,width:t.measureText(e).width}},Bu.prototype._parseLineEllipsis=function(e,t,i){void 0===e&&(e="");var r=i.measureText(e).width;for(t<r&&(e+="");2<e.length&&t<r;)e=e.slice(0,-2)+"",r=i.measureText(e).width;return{text:e,width:r}},Bu.prototype._parseLineWordWrap=function(e,t,i){void 0===e&&(e="");for(var r=[],n=e.split(" "),o=0,s=0;s<n.length;s++){var a=0<s?e+" "+n[s]:n[0],h=i.measureText(a).width;t<h&&0<s?(r.push({text:e,width:o}),e=n[s],o=i.measureText(e).width):(o=h,e=a)}return r.push({text:e,width:o}),r},Bu.prototype._renderLines=function(e){var t=this._currentMeasure.height,i=0;switch(this._textVerticalAlignment){case Mu.VERTICAL_ALIGNMENT_TOP:i=this._fontOffset.ascent;break;case Mu.VERTICAL_ALIGNMENT_BOTTOM:i=t-this._fontOffset.height*(this._lines.length-1)-this._fontOffset.descent;break;case Mu.VERTICAL_ALIGNMENT_CENTER:i=this._fontOffset.ascent+(t-this._fontOffset.height*this._lines.length)/2}i+=this._currentMeasure.top;for(var r=0;r<this._lines.length;r++){var n=this._lines[r];0!==r&&0!==this._lineSpacing.internalValue&&(this._lineSpacing.isPixel?i+=this._lineSpacing.getValue(this._host):i+=this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)),this._drawText(n.text,n.width,i,e),i+=this._fontOffset.height}},Bu.prototype.computeExpectedHeight=function(){if(this.text&&this.widthInPixels){var e=document.createElement("canvas").getContext("2d");if(e){this._applyStates(e),this._fontOffset||(this._fontOffset=Mu._GetFontOffset(e.font));var t,i=this._lines?this._lines:this._breakLines(this.widthInPixels-this.paddingLeftInPixels-this.paddingRightInPixels,e),r=this.paddingTopInPixels+this.paddingBottomInPixels+this._fontOffset.height*i.length;return 0<i.length&&0!==this._lineSpacing.internalValue&&(t=0,t=this._lineSpacing.isPixel?this._lineSpacing.getValue(this._host):this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height),r+=(i.length-1)*t),r}}return 0},Bu.prototype.dispose=function(){Fu.prototype.dispose.call(this),this.onTextChangedObservable.clear()},Bu);function Bu(e,t){void 0===t&&(t="");var i=Fu.call(this,e)||this;return i.name=e,i._text="",i._textWrapping=Ru.Clip,i._textHorizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_CENTER,i._textVerticalAlignment=Mu.VERTICAL_ALIGNMENT_CENTER,i._resizeToFit=!1,i._lineSpacing=new du(0),i._outlineWidth=0,i._outlineColor="white",i.onTextChangedObservable=new le,i.onLinesReadyObservable=new le,i.text=t,i}m.RegisteredTypes["BABYLON.GUI.TextBlock"]=Nu;var ku,Uu=(n(Vu,ku=Mu),Object.defineProperty(Vu.prototype,"isLoaded",{get:function(){return this._loaded},enumerable:!0,configurable:!0}),Object.defineProperty(Vu.prototype,"populateNinePatchSlicesFromImage",{get:function(){return this._populateNinePatchSlicesFromImage},set:function(e){this._populateNinePatchSlicesFromImage!==e&&(this._populateNinePatchSlicesFromImage=e,this._populateNinePatchSlicesFromImage&&this._loaded&&this._extractNinePatchSliceDataFromImage())},enumerable:!0,configurable:!0}),Object.defineProperty(Vu.prototype,"detectPointerOnOpaqueOnly",{get:function(){return this._detectPointerOnOpaqueOnly},set:function(e){this._detectPointerOnOpaqueOnly!==e&&(this._detectPointerOnOpaqueOnly=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Vu.prototype,"sliceLeft",{get:function(){return this._sliceLeft},set:function(e){this._sliceLeft!==e&&(this._sliceLeft=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Vu.prototype,"sliceRight",{get:function(){return this._sliceRight},set:function(e){this._sliceRight!==e&&(this._sliceRight=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Vu.prototype,"sliceTop",{get:function(){return this._sliceTop},set:function(e){this._sliceTop!==e&&(this._sliceTop=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Vu.prototype,"sliceBottom",{get:function(){return this._sliceBottom},set:function(e){this._sliceBottom!==e&&(this._sliceBottom=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Vu.prototype,"sourceLeft",{get:function(){return this._sourceLeft},set:function(e){this._sourceLeft!==e&&(this._sourceLeft=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Vu.prototype,"sourceTop",{get:function(){return this._sourceTop},set:function(e){this._sourceTop!==e&&(this._sourceTop=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Vu.prototype,"sourceWidth",{get:function(){return this._sourceWidth},set:function(e){this._sourceWidth!==e&&(this._sourceWidth=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Vu.prototype,"sourceHeight",{get:function(){return this._sourceHeight},set:function(e){this._sourceHeight!==e&&(this._sourceHeight=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Vu.prototype,"isSVG",{get:function(){return this._isSVG},enumerable:!0,configurable:!0}),Object.defineProperty(Vu.prototype,"svgAttributesComputationCompleted",{get:function(){return this._svgAttributesComputationCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(Vu.prototype,"autoScale",{get:function(){return this._autoScale},set:function(e){this._autoScale!==e&&(this._autoScale=e)&&this._loaded&&this.synchronizeSizeWithContent()},enumerable:!0,configurable:!0}),Object.defineProperty(Vu.prototype,"stretch",{get:function(){return this._stretch},set:function(e){this._stretch!==e&&(this._stretch=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Vu.prototype._rotate90=function(e,t){void 0===t&&(t=!1);var i=document.createElement("canvas"),r=i.getContext("2d"),n=this._domImage.width,o=this._domImage.height;i.width=o,i.height=n,r.translate(i.width/2,i.height/2),r.rotate(e*Math.PI/2),r.drawImage(this._domImage,0,0,n,o,-n/2,-o/2,n,o);var s=i.toDataURL("image/jpg"),a=new Vu(this.name+"rotated",s);return t&&(a._stretch=this._stretch,a._autoScale=this._autoScale,a._cellId=this._cellId,a._cellWidth=e%1?this._cellHeight:this._cellWidth,a._cellHeight=e%1?this._cellWidth:this._cellHeight),this._handleRotationForSVGImage(this,a,e),a},Vu.prototype._handleRotationForSVGImage=function(e,t,i){var r=this;e._isSVG&&(e._svgAttributesComputationCompleted?(this._rotate90SourceProperties(e,t,i),this._markAsDirty()):e.onSVGAttributesComputedObservable.addOnce(function(){r._rotate90SourceProperties(e,t,i),r._markAsDirty()}))},Vu.prototype._rotate90SourceProperties=function(e,t,i){var r,n,o=e.sourceLeft,s=e.sourceTop,a=e.domImage.width,h=e.domImage.height,l=o,u=s,c=e.sourceWidth,d=e.sourceHeight;if(0!=i){var f=i<0?-1:1;i%=4;for(var p=0;p<Math.abs(i);++p)l=-(s-h/2)*f+h/2,u=(o-a/2)*f+a/2,c=(r=[d,c])[0],d=r[1],i<0?u-=d:l-=c,o=l,s=u,a=(n=[h,a])[0],h=n[1]}t.sourceLeft=l,t.sourceTop=u,t.sourceWidth=c,t.sourceHeight=d},Object.defineProperty(Vu.prototype,"domImage",{get:function(){return this._domImage},set:function(e){var t=this;this._domImage=e,this._loaded=!1,this._domImage.width?this._onImageLoaded():this._domImage.onload=function(){t._onImageLoaded()}},enumerable:!0,configurable:!0}),Vu.prototype._onImageLoaded=function(){this._imageWidth=this._domImage.width,this._imageHeight=this._domImage.height,this._loaded=!0,this._populateNinePatchSlicesFromImage&&this._extractNinePatchSliceDataFromImage(),this._autoScale&&this.synchronizeSizeWithContent(),this.onImageLoadedObservable.notifyObservers(this),this._markAsDirty()},Vu.prototype._extractNinePatchSliceDataFromImage=function(){this._workingCanvas||(this._workingCanvas=document.createElement("canvas"));var e=this._workingCanvas,t=e.getContext("2d"),i=this._domImage.width,r=this._domImage.height;e.width=i,e.height=r,t.drawImage(this._domImage,0,0,i,r);var n=t.getImageData(0,0,i,r);this._sliceLeft=-1,this._sliceRight=-1;for(var o=0;o<i;o++)if(127<(s=n.data[4*o+3])&&-1===this._sliceLeft)this._sliceLeft=o;else if(s<127&&-1<this._sliceLeft){this._sliceRight=o;break}this._sliceTop=-1,this._sliceBottom=-1;for(var s,a=0;a<r;a++)if(127<(s=n.data[a*i*4+3])&&-1===this._sliceTop)this._sliceTop=a;else if(s<127&&-1<this._sliceTop){this._sliceBottom=a;break}},Object.defineProperty(Vu.prototype,"source",{set:function(e){var t=this;this._source!==e&&(this._loaded=!1,e=(this._source=e)&&this._svgCheck(e),this._domImage=document.createElement("img"),this._domImage.onload=function(){t._onImageLoaded()},e&&(ri.SetCorsBehavior(e,this._domImage),this._domImage.src=e))},enumerable:!0,configurable:!0}),Vu.prototype._svgCheck=function(e){var t=this;if(window.SVGSVGElement&&-1!==e.search(/.svg#/gi)&&e.indexOf("#")===e.lastIndexOf("#")){this._isSVG=!0;var i=e.split("#")[0],r=e.split("#")[1],n=document.body.querySelector('object[data="'+i+'"]');if(n){var o=n.contentDocument;if(o&&o.documentElement){var s=o.documentElement.getAttribute("viewBox"),a=Number(o.documentElement.getAttribute("width")),h=Number(o.documentElement.getAttribute("height"));if(o.getElementById(r)&&s&&a&&h)return this._getSVGAttribs(n,r),e}n.addEventListener("load",function(){t._getSVGAttribs(n,r)})}else{var l=document.createElement("object");l.data=i,l.type="image/svg+xml",l.width="0%",l.height="0%",document.body.appendChild(l),l.onload=function(){var e=document.body.querySelector('object[data="'+i+'"]');e&&t._getSVGAttribs(e,r)}}return i}return e},Vu.prototype._getSVGAttribs=function(e,t){var i,r,n,o,s,a,h,l,u,c,d,f=e.contentDocument;f&&f.documentElement&&(i=f.documentElement.getAttribute("viewBox"),r=Number(f.documentElement.getAttribute("width")),n=Number(f.documentElement.getAttribute("height")),o=f.getElementById(t),i&&r&&n&&o&&(s=Number(i.split(" ")[2]),a=Number(i.split(" ")[3]),h=o.getBBox(),u=l=1,d=c=0,o.transform&&o.transform.baseVal.consolidate()&&(l=o.transform.baseVal.consolidate().matrix.a,u=o.transform.baseVal.consolidate().matrix.d,c=o.transform.baseVal.consolidate().matrix.e,d=o.transform.baseVal.consolidate().matrix.f),this.sourceLeft=(l*h.x+c)*r/s,this.sourceTop=(u*h.y+d)*n/a,this.sourceWidth=h.width*l*(r/s),this.sourceHeight=h.height*u*(n/a),this._svgAttributesComputationCompleted=!0,this.onSVGAttributesComputedObservable.notifyObservers(this)))},Object.defineProperty(Vu.prototype,"cellWidth",{get:function(){return this._cellWidth},set:function(e){this._cellWidth!==e&&(this._cellWidth=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Vu.prototype,"cellHeight",{get:function(){return this._cellHeight},set:function(e){this._cellHeight!==e&&(this._cellHeight=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Vu.prototype,"cellId",{get:function(){return this._cellId},set:function(e){this._cellId!==e&&(this._cellId=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Vu.prototype.contains=function(e,t){if(!ku.prototype.contains.call(this,e,t))return!1;if(!this._detectPointerOnOpaqueOnly||!this._workingCanvas)return!0;var i=this._workingCanvas.getContext("2d"),r=0|this._currentMeasure.width,n=0|this._currentMeasure.height;return 0<i.getImageData(0,0,r,n).data[4*((e=e-this._currentMeasure.left|0)+(t=t-this._currentMeasure.top|0)*this._currentMeasure.width)+3]},Vu.prototype._getTypeName=function(){return"Image"},Vu.prototype.synchronizeSizeWithContent=function(){this._loaded&&(this.width=this._domImage.width+"px",this.height=this._domImage.height+"px")},Vu.prototype._processMeasures=function(e,t){if(this._loaded)switch(this._stretch){case Vu.STRETCH_NONE:case Vu.STRETCH_FILL:case Vu.STRETCH_UNIFORM:case Vu.STRETCH_NINE_PATCH:break;case Vu.STRETCH_EXTEND:this._autoScale&&this.synchronizeSizeWithContent(),this.parent&&this.parent.parent&&(this.parent.adaptWidthToChildren=!0,this.parent.adaptHeightToChildren=!0)}ku.prototype._processMeasures.call(this,e,t)},Vu.prototype._prepareWorkingCanvasForOpaqueDetection=function(){var e,t,i,r;this._detectPointerOnOpaqueOnly&&(this._workingCanvas||(this._workingCanvas=document.createElement("canvas")),e=this._workingCanvas,t=this._currentMeasure.width,i=this._currentMeasure.height,r=e.getContext("2d"),e.width=t,e.height=i,r.clearRect(0,0,t,i))},Vu.prototype._drawImage=function(e,t,i,r,n,o,s,a,h){e.drawImage(this._domImage,t,i,r,n,o,s,a,h),this._detectPointerOnOpaqueOnly&&(e=this._workingCanvas.getContext("2d")).drawImage(this._domImage,t,i,r,n,o-this._currentMeasure.left,s-this._currentMeasure.top,a,h)},Vu.prototype._draw=function(e){var t,i,r,n,o,s,a;if(e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),a=-1==this.cellId?(n=this._sourceLeft,o=this._sourceTop,s=this._sourceWidth?this._sourceWidth:this._imageWidth,this._sourceHeight?this._sourceHeight:this._imageHeight):(t=this._domImage.naturalWidth/this.cellWidth,i=this.cellId/t>>0,r=this.cellId%t,n=this.cellWidth*r,o=this.cellHeight*i,s=this.cellWidth,this.cellHeight),this._prepareWorkingCanvasForOpaqueDetection(),this._applyStates(e),this._loaded)switch(this._stretch){case Vu.STRETCH_NONE:case Vu.STRETCH_FILL:this._drawImage(e,n,o,s,a,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height);break;case Vu.STRETCH_UNIFORM:var h=this._currentMeasure.width/s,l=this._currentMeasure.height/a,u=Math.min(h,l),c=(this._currentMeasure.width-s*u)/2,d=(this._currentMeasure.height-a*u)/2;this._drawImage(e,n,o,s,a,this._currentMeasure.left+c,this._currentMeasure.top+d,s*u,a*u);break;case Vu.STRETCH_EXTEND:this._drawImage(e,n,o,s,a,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height);break;case Vu.STRETCH_NINE_PATCH:this._renderNinePatch(e)}e.restore()},Vu.prototype._renderCornerPatch=function(e,t,i,r,n,o,s){this._drawImage(e,t,i,r,n,this._currentMeasure.left+o,this._currentMeasure.top+s,r,n)},Vu.prototype._renderNinePatch=function(e){var t=this._imageHeight,i=this._sliceLeft,r=this._sliceTop,n=this._imageHeight-this._sliceBottom,o=this._imageWidth-this._sliceRight,s=0,a=0;this._populateNinePatchSlicesFromImage&&(a=s=1,t-=2,--i,--r,--n,--o);var h=this._sliceRight-this._sliceLeft,l=this._currentMeasure.width-o-this.sliceLeft,u=this._currentMeasure.height-t+this._sliceBottom;this._renderCornerPatch(e,s,a,i,r,0,0),this._renderCornerPatch(e,s,this._sliceBottom,i,t-this._sliceBottom,0,u),this._renderCornerPatch(e,this._sliceRight,a,o,r,this._currentMeasure.width-o,0),this._renderCornerPatch(e,this._sliceRight,this._sliceBottom,o,t-this._sliceBottom,this._currentMeasure.width-o,u),this._drawImage(e,this._sliceLeft,this._sliceTop,h,this._sliceBottom-this._sliceTop,this._currentMeasure.left+i,this._currentMeasure.top+r,l,u-r),this._drawImage(e,s,this._sliceTop,i,this._sliceBottom-this._sliceTop,this._currentMeasure.left,this._currentMeasure.top+r,i,u-r),this._drawImage(e,this._sliceRight,this._sliceTop,i,this._sliceBottom-this._sliceTop,this._currentMeasure.left+this._currentMeasure.width-o,this._currentMeasure.top+r,i,u-r),this._drawImage(e,this._sliceLeft,a,h,r,this._currentMeasure.left+i,this._currentMeasure.top,l,r),this._drawImage(e,this._sliceLeft,this._sliceBottom,h,n,this._currentMeasure.left+i,this._currentMeasure.top+u,l,n)},Vu.prototype.dispose=function(){ku.prototype.dispose.call(this),this.onImageLoadedObservable.clear(),this.onSVGAttributesComputedObservable.clear()},Vu.STRETCH_NONE=0,Vu.STRETCH_FILL=1,Vu.STRETCH_UNIFORM=2,Vu.STRETCH_EXTEND=3,Vu.STRETCH_NINE_PATCH=4,Vu);function Vu(e,t){void 0===t&&(t=null);var i=ku.call(this,e)||this;return i.name=e,i._workingCanvas=null,i._loaded=!1,i._stretch=Vu.STRETCH_FILL,i._autoScale=!1,i._sourceLeft=0,i._sourceTop=0,i._sourceWidth=0,i._sourceHeight=0,i._svgAttributesComputationCompleted=!1,i._isSVG=!1,i._cellWidth=0,i._cellHeight=0,i._cellId=-1,i._populateNinePatchSlicesFromImage=!1,i.onImageLoadedObservable=new le,i.onSVGAttributesComputedObservable=new le,i.source=t,i}m.RegisteredTypes["BABYLON.GUI.Image"]=Uu;var zu,Wu=(n(Gu,zu=wu),Object.defineProperty(Gu.prototype,"image",{get:function(){return this._image},enumerable:!0,configurable:!0}),Object.defineProperty(Gu.prototype,"textBlock",{get:function(){return this._textBlock},enumerable:!0,configurable:!0}),Gu.prototype._getTypeName=function(){return"Button"},Gu.prototype._processPicking=function(e,t,i,r,n,o,s){if(!this._isEnabled||!this.isHitTestVisible||!this.isVisible||this.notRenderable)return!1;if(!zu.prototype.contains.call(this,e,t))return!1;if(this.delegatePickingToChildren){for(var a=!1,h=this._children.length-1;0<=h;h--){var l=this._children[h];if(l.isEnabled&&l.isHitTestVisible&&l.isVisible&&!l.notRenderable&&l.contains(e,t)){a=!0;break}}if(!a)return!1}return this._processObservables(i,e,t,r,n,o,s),!0},Gu.prototype._onPointerEnter=function(e){return!!zu.prototype._onPointerEnter.call(this,e)&&(this.pointerEnterAnimation&&this.pointerEnterAnimation(),!0)},Gu.prototype._onPointerOut=function(e,t){void 0===t&&(t=!1),this.pointerOutAnimation&&this.pointerOutAnimation(),zu.prototype._onPointerOut.call(this,e,t)},Gu.prototype._onPointerDown=function(e,t,i,r){return!!zu.prototype._onPointerDown.call(this,e,t,i,r)&&(this.pointerDownAnimation&&this.pointerDownAnimation(),!0)},Gu.prototype._onPointerUp=function(e,t,i,r,n){this.pointerUpAnimation&&this.pointerUpAnimation(),zu.prototype._onPointerUp.call(this,e,t,i,r,n)},Gu.CreateImageButton=function(e,t,i){var r=new Gu(e),n=new Nu(e+"_button",t);n.textWrapping=!0,n.textHorizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_CENTER,n.paddingLeft="20%",r.addControl(n);var o=new Uu(e+"_icon",i);return o.width="20%",o.stretch=Uu.STRETCH_UNIFORM,o.horizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_LEFT,r.addControl(o),r._image=o,r._textBlock=n,r},Gu.CreateImageOnlyButton=function(e,t){var i=new Gu(e),r=new Uu(e+"_icon",t);return r.stretch=Uu.STRETCH_FILL,r.horizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_LEFT,i.addControl(r),i._image=r,i},Gu.CreateSimpleButton=function(e,t){var i=new Gu(e),r=new Nu(e+"_button",t);return r.textWrapping=!0,r.textHorizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_CENTER,i.addControl(r),i._textBlock=r,i},Gu.CreateImageWithCenterTextButton=function(e,t,i){var r=new Gu(e),n=new Uu(e+"_icon",i);n.stretch=Uu.STRETCH_FILL,r.addControl(n);var o=new Nu(e+"_button",t);return o.textWrapping=!0,o.textHorizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_CENTER,r.addControl(o),r._image=n,r._textBlock=o,r},Gu);function Gu(e){var t=zu.call(this,e)||this;t.name=e,t.delegatePickingToChildren=!1,t.thickness=1,t.isPointerBlocker=!0;var i=null;return t.pointerEnterAnimation=function(){i=t.alpha,t.alpha-=.1},t.pointerOutAnimation=function(){null!==i&&(t.alpha=i)},t.pointerDownAnimation=function(){t.scaleX-=.05,t.scaleY-=.05},t.pointerUpAnimation=function(){t.scaleX+=.05,t.scaleY+=.05},t}m.RegisteredTypes["BABYLON.GUI.Button"]=Wu;var Xu,Hu=(n(ju,Xu=Ou),Object.defineProperty(ju.prototype,"isVertical",{get:function(){return this._isVertical},set:function(e){this._isVertical!==e&&(this._isVertical=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(ju.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(e){this._doNotTrackManualChanges||(this._manualWidth=!0),this._width.toString(this._host)!==e&&this._width.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(ju.prototype,"height",{get:function(){return this._height.toString(this._host)},set:function(e){this._doNotTrackManualChanges||(this._manualHeight=!0),this._height.toString(this._host)!==e&&this._height.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),ju.prototype._getTypeName=function(){return"StackPanel"},ju.prototype._preMeasure=function(e,t){for(var i=0,r=this._children;i<r.length;i++){var n=r[i];this._isVertical?n.verticalAlignment=Mu.VERTICAL_ALIGNMENT_TOP:n.horizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_LEFT}Xu.prototype._preMeasure.call(this,e,t)},ju.prototype._additionalProcessing=function(e,t){Xu.prototype._additionalProcessing.call(this,e,t),this._measureForChildren.copyFrom(e),this._measureForChildren.left=this._currentMeasure.left,this._measureForChildren.top=this._currentMeasure.top,this.isVertical&&!this._manualWidth||(this._measureForChildren.width=this._currentMeasure.width),(this.isVertical||this._manualHeight)&&(this._measureForChildren.height=this._currentMeasure.height)},ju.prototype._postMeasure=function(){for(var e=0,t=0,i=0,r=this._children;i<r.length;i++){var n=r[i];n.isVisible&&!n.notRenderable&&(this._isVertical?(n.top!==t+"px"&&(n.top=t+"px",this._rebuildLayout=!0,n._top.ignoreAdaptiveScaling=!0),n._height.isPercentage&&!n._automaticSize?this.ignoreLayoutWarnings||ri.Warn("Control (Name:"+n.name+", UniqueId:"+n.uniqueId+") is using height in percentage mode inside a vertical StackPanel"):t+=n._currentMeasure.height+n.paddingTopInPixels+n.paddingBottomInPixels):(n.left!==e+"px"&&(n.left=e+"px",this._rebuildLayout=!0,n._left.ignoreAdaptiveScaling=!0),n._width.isPercentage&&!n._automaticSize?this.ignoreLayoutWarnings||ri.Warn("Control (Name:"+n.name+", UniqueId:"+n.uniqueId+") is using width in percentage mode inside a horizontal StackPanel"):e+=n._currentMeasure.width+n.paddingLeftInPixels+n.paddingRightInPixels))}var o,s,a=!(this._doNotTrackManualChanges=!0),h=!1;!this._manualHeight&&this._isVertical&&(o=this.height,this.height=t+"px",h=o!==this.height||!this._height.ignoreAdaptiveScaling),this._manualWidth||this._isVertical||(s=this.width,this.width=e+"px",a=s!==this.width||!this._width.ignoreAdaptiveScaling),h&&(this._height.ignoreAdaptiveScaling=!0),a&&(this._width.ignoreAdaptiveScaling=!0),this._doNotTrackManualChanges=!1,(a||h)&&(this._rebuildLayout=!0),Xu.prototype._postMeasure.call(this)},ju);function ju(e){var t=Xu.call(this,e)||this;return t.name=e,t._isVertical=!0,t._manualWidth=!1,t._manualHeight=!1,t._doNotTrackManualChanges=!1,t.ignoreLayoutWarnings=!1,t}m.RegisteredTypes["BABYLON.GUI.StackPanel"]=Hu;var Ku,Yu=(n(qu,Ku=Mu),Object.defineProperty(qu.prototype,"thickness",{get:function(){return this._thickness},set:function(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(qu.prototype,"checkSizeRatio",{get:function(){return this._checkSizeRatio},set:function(e){e=Math.max(Math.min(1,e),0),this._checkSizeRatio!==e&&(this._checkSizeRatio=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(qu.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(qu.prototype,"isChecked",{get:function(){return this._isChecked},set:function(e){this._isChecked!==e&&(this._isChecked=e,this._markAsDirty(),this.onIsCheckedChangedObservable.notifyObservers(e))},enumerable:!0,configurable:!0}),qu.prototype._getTypeName=function(){return"Checkbox"},qu.prototype._draw=function(e,t){e.save(),this._applyStates(e);var i,r,n=this._currentMeasure.width-this._thickness,o=this._currentMeasure.height-this._thickness;(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),e.fillStyle=this._isEnabled?this._background:this._disabledColor,e.fillRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,n,o),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._isChecked&&(e.fillStyle=this._isEnabled?this.color:this._disabledColorItem,i=n*this._checkSizeRatio,r=o*this._checkSizeRatio,e.fillRect(this._currentMeasure.left+this._thickness/2+(n-i)/2,this._currentMeasure.top+this._thickness/2+(o-r)/2,i,r)),e.strokeStyle=this.color,e.lineWidth=this._thickness,e.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,n,o),e.restore()},qu.prototype._onPointerDown=function(e,t,i,r){return!!Ku.prototype._onPointerDown.call(this,e,t,i,r)&&(this.isChecked=!this.isChecked,!0)},qu.AddCheckBoxWithHeader=function(e,t){var i=new Hu;i.isVertical=!1,i.height="30px";var r=new qu;r.width="20px",r.height="20px",r.isChecked=!0,r.color="green",r.onIsCheckedChangedObservable.add(t),i.addControl(r);var n=new Nu;return n.text=e,n.width="180px",n.paddingLeft="5px",n.textHorizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_LEFT,n.color="white",i.addControl(n),i},qu);function qu(e){var t=Ku.call(this,e)||this;return t.name=e,t._isChecked=!1,t._background="black",t._checkSizeRatio=.8,t._thickness=1,t.onIsCheckedChangedObservable=new le,t.isPointerBlocker=!0,t}m.RegisteredTypes["BABYLON.GUI.Checkbox"]=Yu;var Zu=(Qu.COPY=1,Qu.CUT=2,Qu.PASTE=3,Qu);function Qu(){}var Ju=($u.GetTypeFromCharacter=function(e){switch(e){case 67:return Zu.COPY;case 86:return Zu.PASTE;case 88:return Zu.CUT;default:return-1}},$u);function $u(e,t){this.type=e,this.event=t}var ec,tc=(n(ic,ec=Mu),Object.defineProperty(ic.prototype,"maxWidth",{get:function(){return this._maxWidth.toString(this._host)},set:function(e){this._maxWidth.toString(this._host)!==e&&this._maxWidth.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(ic.prototype,"maxWidthInPixels",{get:function(){return this._maxWidth.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!0,configurable:!0}),Object.defineProperty(ic.prototype,"highligherOpacity",{get:function(){return this._highligherOpacity},set:function(e){this._highligherOpacity!==e&&(this._highligherOpacity=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(ic.prototype,"onFocusSelectAll",{get:function(){return this._onFocusSelectAll},set:function(e){this._onFocusSelectAll!==e&&(this._onFocusSelectAll=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(ic.prototype,"textHighlightColor",{get:function(){return this._textHighlightColor},set:function(e){this._textHighlightColor!==e&&(this._textHighlightColor=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(ic.prototype,"margin",{get:function(){return this._margin.toString(this._host)},set:function(e){this._margin.toString(this._host)!==e&&this._margin.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(ic.prototype,"marginInPixels",{get:function(){return this._margin.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!0,configurable:!0}),Object.defineProperty(ic.prototype,"autoStretchWidth",{get:function(){return this._autoStretchWidth},set:function(e){this._autoStretchWidth!==e&&(this._autoStretchWidth=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(ic.prototype,"thickness",{get:function(){return this._thickness},set:function(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(ic.prototype,"focusedBackground",{get:function(){return this._focusedBackground},set:function(e){this._focusedBackground!==e&&(this._focusedBackground=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(ic.prototype,"focusedColor",{get:function(){return this._focusedColor},set:function(e){this._focusedColor!==e&&(this._focusedColor=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(ic.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(ic.prototype,"placeholderColor",{get:function(){return this._placeholderColor},set:function(e){this._placeholderColor!==e&&(this._placeholderColor=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(ic.prototype,"placeholderText",{get:function(){return this._placeholderText},set:function(e){this._placeholderText!==e&&(this._placeholderText=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(ic.prototype,"deadKey",{get:function(){return this._deadKey},set:function(e){this._deadKey=e},enumerable:!0,configurable:!0}),Object.defineProperty(ic.prototype,"highlightedText",{get:function(){return this._highlightedText},set:function(e){this._highlightedText!==e&&(this._highlightedText=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(ic.prototype,"addKey",{get:function(){return this._addKey},set:function(e){this._addKey=e},enumerable:!0,configurable:!0}),Object.defineProperty(ic.prototype,"currentKey",{get:function(){return this._currentKey},set:function(e){this._currentKey=e},enumerable:!0,configurable:!0}),Object.defineProperty(ic.prototype,"text",{get:function(){return this._text},set:function(e){var t=e.toString();this._text!==t&&(this._text=t,this._markAsDirty(),this.onTextChangedObservable.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(ic.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(e){this._width.toString(this._host)!==e&&(this._width.fromString(e)&&this._markAsDirty(),this.autoStretchWidth=!1)},enumerable:!0,configurable:!0}),ic.prototype.onBlur=function(){this._isFocused=!1,this._scrollLeft=null,this._cursorOffset=0,clearTimeout(this._blinkTimeout),this._markAsDirty(),this.onBlurObservable.notifyObservers(this),this._host.unRegisterClipboardEvents(),this._onClipboardObserver&&this._host.onClipboardObservable.remove(this._onClipboardObserver);var e=this._host.getScene();this._onPointerDblTapObserver&&e&&e.onPointerObservable.remove(this._onPointerDblTapObserver)},ic.prototype.onFocus=function(){var t=this;if(this._isEnabled){if(this._scrollLeft=null,this._isFocused=!0,this._blinkIsEven=!1,this._cursorOffset=0,this._markAsDirty(),this.onFocusObservable.notifyObservers(this),-1!==navigator.userAgent.indexOf("Mobile")&&!this.disableMobilePrompt){var e=prompt(this.promptMessage);return null!==e&&(this.text=e),void(this._host.focusedControl=null)}this._host.registerClipboardEvents(),this._onClipboardObserver=this._host.onClipboardObservable.add(function(e){switch(e.type){case Zu.COPY:t._onCopyText(e.event),t.onTextCopyObservable.notifyObservers(t);break;case Zu.CUT:t._onCutText(e.event),t.onTextCutObservable.notifyObservers(t);break;case Zu.PASTE:t._onPasteText(e.event),t.onTextPasteObservable.notifyObservers(t);break;default:return}});var i=this._host.getScene();i&&(this._onPointerDblTapObserver=i.onPointerObservable.add(function(e){t._isFocused&&e.type===Xr.POINTERDOUBLETAP&&t._processDblClick(e)})),this._onFocusSelectAll&&this._selectAllText()}},ic.prototype._getTypeName=function(){return"InputText"},ic.prototype.keepsFocusWith=function(){return this._connectedVirtualKeyboard?[this._connectedVirtualKeyboard]:null},ic.prototype.processKey=function(e,t,i){if(!i||!i.ctrlKey&&!i.metaKey||67!==e&&86!==e&&88!==e){if(i&&(i.ctrlKey||i.metaKey)&&65===e)return this._selectAllText(),void i.preventDefault();switch(e){case 32:t=" ";break;case 191:i&&i.preventDefault();break;case 8:if(this._text&&0<this._text.length){if(this._isTextHighlightOn)return this.text=this._text.slice(0,this._startHighlightIndex)+this._text.slice(this._endHighlightIndex),this._isTextHighlightOn=!1,this._cursorOffset=this.text.length-this._startHighlightIndex,this._blinkIsEven=!1,void(i&&i.preventDefault());0===this._cursorOffset?this.text=this._text.substr(0,this._text.length-1):0<(n=this._text.length-this._cursorOffset)&&(this.text=this._text.slice(0,n-1)+this._text.slice(n))}return void(i&&i.preventDefault());case 46:if(this._isTextHighlightOn){this.text=this._text.slice(0,this._startHighlightIndex)+this._text.slice(this._endHighlightIndex);for(var r=this._endHighlightIndex-this._startHighlightIndex;0<r&&0<this._cursorOffset;)this._cursorOffset--;return this._isTextHighlightOn=!1,this._cursorOffset=this.text.length-this._startHighlightIndex,void(i&&i.preventDefault())}var n;return this._text&&0<this._text.length&&0<this._cursorOffset&&(n=this._text.length-this._cursorOffset,this.text=this._text.slice(0,n)+this._text.slice(n+1),this._cursorOffset--),void(i&&i.preventDefault());case 13:return this._host.focusedControl=null,void(this._isTextHighlightOn=!1);case 35:return this._cursorOffset=0,this._blinkIsEven=!1,this._isTextHighlightOn=!1,void this._markAsDirty();case 36:return this._cursorOffset=this._text.length,this._blinkIsEven=!1,this._isTextHighlightOn=!1,void this._markAsDirty();case 37:if(this._cursorOffset++,this._cursorOffset>this._text.length&&(this._cursorOffset=this._text.length),i&&i.shiftKey){if(this._blinkIsEven=!1,i.ctrlKey||i.metaKey){if(!this._isTextHighlightOn){if(this._text.length===this._cursorOffset)return;this._endHighlightIndex=this._text.length-this._cursorOffset+1}return this._startHighlightIndex=0,this._cursorIndex=this._text.length-this._endHighlightIndex,this._cursorOffset=this._text.length,this._isTextHighlightOn=!0,void this._markAsDirty()}return this._isTextHighlightOn?-1===this._cursorIndex&&(this._cursorIndex=this._text.length-this._endHighlightIndex,this._cursorOffset=0===this._startHighlightIndex?this._text.length:this._text.length-this._startHighlightIndex+1):(this._isTextHighlightOn=!0,this._cursorIndex=this._cursorOffset>=this._text.length?this._text.length:this._cursorOffset-1),this._cursorIndex<this._cursorOffset?(this._endHighlightIndex=this._text.length-this._cursorIndex,this._startHighlightIndex=this._text.length-this._cursorOffset):this._cursorIndex>this._cursorOffset?(this._endHighlightIndex=this._text.length-this._cursorOffset,this._startHighlightIndex=this._text.length-this._cursorIndex):this._isTextHighlightOn=!1,void this._markAsDirty()}return this._isTextHighlightOn&&(this._cursorOffset=this._text.length-this._startHighlightIndex,this._isTextHighlightOn=!1),i&&(i.ctrlKey||i.metaKey)&&(this._cursorOffset=this.text.length,i.preventDefault()),this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._cursorIndex=-1,void this._markAsDirty();case 39:if(this._cursorOffset--,this._cursorOffset<0&&(this._cursorOffset=0),i&&i.shiftKey){if(this._blinkIsEven=!1,i.ctrlKey||i.metaKey){if(!this._isTextHighlightOn){if(0===this._cursorOffset)return;this._startHighlightIndex=this._text.length-this._cursorOffset-1}return this._endHighlightIndex=this._text.length,this._isTextHighlightOn=!0,this._cursorIndex=this._text.length-this._startHighlightIndex,this._cursorOffset=0,void this._markAsDirty()}return this._isTextHighlightOn?-1===this._cursorIndex&&(this._cursorIndex=this._text.length-this._startHighlightIndex,this._cursorOffset=this._text.length===this._endHighlightIndex?0:this._text.length-this._endHighlightIndex-1):(this._isTextHighlightOn=!0,this._cursorIndex=this._cursorOffset<=0?0:this._cursorOffset+1),this._cursorIndex<this._cursorOffset?(this._endHighlightIndex=this._text.length-this._cursorIndex,this._startHighlightIndex=this._text.length-this._cursorOffset):this._cursorIndex>this._cursorOffset?(this._endHighlightIndex=this._text.length-this._cursorOffset,this._startHighlightIndex=this._text.length-this._cursorIndex):this._isTextHighlightOn=!1,void this._markAsDirty()}return this._isTextHighlightOn&&(this._cursorOffset=this._text.length-this._endHighlightIndex,this._isTextHighlightOn=!1),i&&(i.ctrlKey||i.metaKey)&&(this._cursorOffset=0,i.preventDefault()),this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._cursorIndex=-1,void this._markAsDirty();case 222:i&&i.preventDefault(),this._cursorIndex=-1,this.deadKey=!0}var o;t&&(-1===e||32===e||47<e&&e<64||64<e&&e<91||159<e&&e<193||218<e&&e<223||95<e&&e<112)&&(this._currentKey=t,this.onBeforeKeyAddObservable.notifyObservers(this),t=this._currentKey,this._addKey&&(this._isTextHighlightOn?(this.text=this._text.slice(0,this._startHighlightIndex)+t+this._text.slice(this._endHighlightIndex),this._cursorOffset=this.text.length-(this._startHighlightIndex+1),this._isTextHighlightOn=!1,this._blinkIsEven=!1,this._markAsDirty()):0===this._cursorOffset?this.text+=t:(o=this._text.length-this._cursorOffset,this.text=this._text.slice(0,o)+t+this._text.slice(o))))}},ic.prototype._updateValueFromCursorIndex=function(e){if(this._blinkIsEven=!1,-1===this._cursorIndex)this._cursorIndex=e;else if(this._cursorIndex<this._cursorOffset)this._endHighlightIndex=this._text.length-this._cursorIndex,this._startHighlightIndex=this._text.length-this._cursorOffset;else{if(!(this._cursorIndex>this._cursorOffset))return this._isTextHighlightOn=!1,void this._markAsDirty();this._endHighlightIndex=this._text.length-this._cursorOffset,this._startHighlightIndex=this._text.length-this._cursorIndex}this._isTextHighlightOn=!0,this._markAsDirty()},ic.prototype._processDblClick=function(e){this._startHighlightIndex=this._text.length-this._cursorOffset,this._endHighlightIndex=this._startHighlightIndex;for(var t,i=/\w+/g;t=this._endHighlightIndex<this._text.length&&-1!==this._text[this._endHighlightIndex].search(i)?++this._endHighlightIndex:0,0<this._startHighlightIndex&&-1!==this._text[this._startHighlightIndex-1].search(i)&&--this._startHighlightIndex||t;);this._cursorOffset=this.text.length-this._startHighlightIndex,this.onTextHighlightObservable.notifyObservers(this),this._isTextHighlightOn=!0,this._clickedCoordinate=null,this._blinkIsEven=!0,this._cursorIndex=-1,this._markAsDirty()},ic.prototype._selectAllText=function(){this._blinkIsEven=!0,this._isTextHighlightOn=!0,this._startHighlightIndex=0,this._endHighlightIndex=this._text.length,this._cursorOffset=this._text.length,this._cursorIndex=-1,this._markAsDirty()},ic.prototype.processKeyboard=function(e){this.processKey(e.keyCode,e.key,e),this.onKeyboardEventProcessedObservable.notifyObservers(e)},ic.prototype._onCopyText=function(e){this._isTextHighlightOn=!1;try{e.clipboardData&&e.clipboardData.setData("text/plain",this._highlightedText)}catch(e){}this._host.clipboardData=this._highlightedText},ic.prototype._onCutText=function(e){if(this._highlightedText){this.text=this._text.slice(0,this._startHighlightIndex)+this._text.slice(this._endHighlightIndex),this._isTextHighlightOn=!1,this._cursorOffset=this.text.length-this._startHighlightIndex;try{e.clipboardData&&e.clipboardData.setData("text/plain",this._highlightedText)}catch(e){}this._host.clipboardData=this._highlightedText,this._highlightedText=""}},ic.prototype._onPasteText=function(e){var t="",t=e.clipboardData&&-1!==e.clipboardData.types.indexOf("text/plain")?e.clipboardData.getData("text/plain"):this._host.clipboardData,i=this._text.length-this._cursorOffset;this.text=this._text.slice(0,i)+t+this._text.slice(i)},ic.prototype._draw=function(e,t){var i=this;e.save(),this._applyStates(e),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._isFocused?this._focusedBackground&&(e.fillStyle=this._isEnabled?this._focusedBackground:this._disabledColor,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)):this._background&&(e.fillStyle=this._isEnabled?this._background:this._disabledColor,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._fontOffset||(this._fontOffset=Mu._GetFontOffset(e.font));var r=this._currentMeasure.left+this._margin.getValueInPixel(this._host,this._tempParentMeasure.width);this.color&&(e.fillStyle=this.color);var n=this._beforeRenderText(this._text);this._isFocused||this._text||!this._placeholderText||(n=this._placeholderText,this._placeholderColor&&(e.fillStyle=this._placeholderColor)),this._textWidth=e.measureText(n).width;var o=2*this._margin.getValueInPixel(this._host,this._tempParentMeasure.width);this._autoStretchWidth&&(this.width=Math.min(this._maxWidth.getValueInPixel(this._host,this._tempParentMeasure.width),this._textWidth+o)+"px");var s,a,h,l,u,c,d,f=this._fontOffset.ascent+(this._currentMeasure.height-this._fontOffset.height)/2,p=this._width.getValueInPixel(this._host,this._tempParentMeasure.width)-o;if(e.save(),e.beginPath(),e.rect(r,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,2+p,this._currentMeasure.height),e.clip(),this._isFocused&&this._textWidth>p?(s=r-this._textWidth+p,this._scrollLeft||(this._scrollLeft=s)):this._scrollLeft=r,e.fillText(n,this._scrollLeft,this._currentMeasure.top+f),this._isFocused){if(this._clickedCoordinate){for(var _=this._scrollLeft+this._textWidth-this._clickedCoordinate,g=0,m=this._cursorOffset=0;this._cursorOffset&&(m=Math.abs(_-g)),this._cursorOffset++,(g=e.measureText(n.substr(n.length-this._cursorOffset,this._cursorOffset)).width)<_&&n.length>=this._cursorOffset;);Math.abs(_-g)>m&&this._cursorOffset--,this._blinkIsEven=!1,this._clickedCoordinate=null}this._blinkIsEven||(a=this.text.substr(this._text.length-this._cursorOffset),h=e.measureText(a).width,(l=this._scrollLeft+this._textWidth-h)<r?(this._scrollLeft+=r-l,l=r,this._markAsDirty()):r+p<l&&(this._scrollLeft+=r+p-l,l=r+p,this._markAsDirty()),this._isTextHighlightOn||e.fillRect(l,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,2,this._fontOffset.height)),clearTimeout(this._blinkTimeout),this._blinkTimeout=setTimeout(function(){i._blinkIsEven=!i._blinkIsEven,i._markAsDirty()},500),this._isTextHighlightOn&&(clearTimeout(this._blinkTimeout),u=e.measureText(this.text.substring(this._startHighlightIndex)).width,c=this._scrollLeft+this._textWidth-u,this._highlightedText=this.text.substring(this._startHighlightIndex,this._endHighlightIndex),d=e.measureText(this.text.substring(this._startHighlightIndex,this._endHighlightIndex)).width,c<r&&(d=(d-=r-c)||e.measureText(this.text.charAt(this.text.length-this._cursorOffset)).width,c=r),e.globalAlpha=this._highligherOpacity,e.fillStyle=this._textHighlightColor,e.fillRect(c,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,d,this._fontOffset.height),e.globalAlpha=1)}e.restore(),this._thickness&&(this._isFocused?this.focusedColor&&(e.strokeStyle=this.focusedColor):this.color&&(e.strokeStyle=this.color),e.lineWidth=this._thickness,e.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness)),e.restore()},ic.prototype._onPointerDown=function(e,t,i,r){return!(!ec.prototype._onPointerDown.call(this,e,t,i,r)||(this._clickedCoordinate=t.x,this._isTextHighlightOn=!1,this._highlightedText="",this._cursorIndex=-1,this._isPointerDown=!0,(this._host._capturingControl[i]=this)._host.focusedControl===this?(clearTimeout(this._blinkTimeout),this._markAsDirty(),0):!this._isEnabled||(this._host.focusedControl=this,0)))},ic.prototype._onPointerMove=function(e,t,i){this._host.focusedControl===this&&this._isPointerDown&&(this._clickedCoordinate=t.x,this._markAsDirty(),this._updateValueFromCursorIndex(this._cursorOffset)),ec.prototype._onPointerMove.call(this,e,t,i)},ic.prototype._onPointerUp=function(e,t,i,r,n){this._isPointerDown=!1,delete this._host._capturingControl[i],ec.prototype._onPointerUp.call(this,e,t,i,r,n)},ic.prototype._beforeRenderText=function(e){return e},ic.prototype.dispose=function(){ec.prototype.dispose.call(this),this.onBlurObservable.clear(),this.onFocusObservable.clear(),this.onTextChangedObservable.clear(),this.onTextCopyObservable.clear(),this.onTextCutObservable.clear(),this.onTextPasteObservable.clear(),this.onTextHighlightObservable.clear(),this.onKeyboardEventProcessedObservable.clear()},ic);function ic(e,t){void 0===t&&(t="");var i=ec.call(this,e)||this;return i.name=e,i._text="",i._placeholderText="",i._background="#222222",i._focusedBackground="#000000",i._focusedColor="white",i._placeholderColor="gray",i._thickness=1,i._margin=new du(10,du.UNITMODE_PIXEL),i._autoStretchWidth=!0,i._maxWidth=new du(1,du.UNITMODE_PERCENTAGE,!1),i._isFocused=!1,i._blinkIsEven=!1,i._cursorOffset=0,i._deadKey=!1,i._addKey=!0,i._currentKey="",i._isTextHighlightOn=!1,i._textHighlightColor="#d5e0ff",i._highligherOpacity=.4,i._highlightedText="",i._startHighlightIndex=0,i._endHighlightIndex=0,i._cursorIndex=-1,i._onFocusSelectAll=!1,i._isPointerDown=!1,i.promptMessage="Please enter text:",i.disableMobilePrompt=!1,i.onTextChangedObservable=new le,i.onBeforeKeyAddObservable=new le,i.onFocusObservable=new le,i.onBlurObservable=new le,i.onTextHighlightObservable=new le,i.onTextCopyObservable=new le,i.onTextCutObservable=new le,i.onTextPasteObservable=new le,i.onKeyboardEventProcessedObservable=new le,i.text=t,i.isPointerBlocker=!0,i}m.RegisteredTypes["BABYLON.GUI.InputText"]=tc;var rc,nc=(n(oc,rc=Ou),Object.defineProperty(oc.prototype,"columnCount",{get:function(){return this._columnDefinitions.length},enumerable:!0,configurable:!0}),Object.defineProperty(oc.prototype,"rowCount",{get:function(){return this._rowDefinitions.length},enumerable:!0,configurable:!0}),Object.defineProperty(oc.prototype,"children",{get:function(){return this._childControls},enumerable:!0,configurable:!0}),Object.defineProperty(oc.prototype,"cells",{get:function(){return this._cells},enumerable:!0,configurable:!0}),oc.prototype.getRowDefinition=function(e){return e<0||e>=this._rowDefinitions.length?null:this._rowDefinitions[e]},oc.prototype.getColumnDefinition=function(e){return e<0||e>=this._columnDefinitions.length?null:this._columnDefinitions[e]},oc.prototype.addRowDefinition=function(e,t){return void 0===t&&(t=!1),this._rowDefinitions.push(new du(e,t?du.UNITMODE_PIXEL:du.UNITMODE_PERCENTAGE)),this._markAsDirty(),this},oc.prototype.addColumnDefinition=function(e,t){return void 0===t&&(t=!1),this._columnDefinitions.push(new du(e,t?du.UNITMODE_PIXEL:du.UNITMODE_PERCENTAGE)),this._markAsDirty(),this},oc.prototype.setRowDefinition=function(e,t,i){if(void 0===i&&(i=!1),e<0||e>=this._rowDefinitions.length)return this;var r=this._rowDefinitions[e];return r&&r.isPixel===i&&r.internalValue===t||(this._rowDefinitions[e]=new du(t,i?du.UNITMODE_PIXEL:du.UNITMODE_PERCENTAGE),this._markAsDirty()),this},oc.prototype.setColumnDefinition=function(e,t,i){if(void 0===i&&(i=!1),e<0||e>=this._columnDefinitions.length)return this;var r=this._columnDefinitions[e];return r&&r.isPixel===i&&r.internalValue===t||(this._columnDefinitions[e]=new du(t,i?du.UNITMODE_PIXEL:du.UNITMODE_PERCENTAGE),this._markAsDirty()),this},oc.prototype.getChildrenAt=function(e,t){var i=this._cells[e+":"+t];return i?i.children:null},oc.prototype.getChildCellInfo=function(e){return e._tag},oc.prototype._removeCell=function(e,t){if(e){rc.prototype.removeControl.call(this,e);for(var i=0,r=e.children;i<r.length;i++){var n=r[i],o=this._childControls.indexOf(n);-1!==o&&this._childControls.splice(o,1)}delete this._cells[t]}},oc.prototype._offsetCell=function(e,t){if(this._cells[t]){this._cells[e]=this._cells[t];for(var i=0,r=this._cells[e].children;i<r.length;i++)r[i]._tag=e;delete this._cells[t]}},oc.prototype.removeColumnDefinition=function(e){if(e<0||e>=this._columnDefinitions.length)return this;for(var t=0;t<this._rowDefinitions.length;t++){var i=t+":"+e,r=this._cells[i];this._removeCell(r,i)}for(t=0;t<this._rowDefinitions.length;t++)for(var n=e+1;n<this._columnDefinitions.length;n++){var o=t+":"+(n-1),i=t+":"+n;this._offsetCell(o,i)}return this._columnDefinitions.splice(e,1),this._markAsDirty(),this},oc.prototype.removeRowDefinition=function(e){if(e<0||e>=this._rowDefinitions.length)return this;for(var t=0;t<this._columnDefinitions.length;t++){var i=e+":"+t,r=this._cells[i];this._removeCell(r,i)}for(t=0;t<this._columnDefinitions.length;t++)for(var n=e+1;n<this._rowDefinitions.length;n++){var o=n-1+":"+t,i=n+":"+t;this._offsetCell(o,i)}return this._rowDefinitions.splice(e,1),this._markAsDirty(),this},oc.prototype.addControl=function(e,t,i){if(void 0===t&&(t=0),void 0===i&&(i=0),0===this._rowDefinitions.length&&this.addRowDefinition(1,!1),0===this._columnDefinitions.length&&this.addColumnDefinition(1,!1),-1!==this._childControls.indexOf(e))return ri.Warn("Control (Name:"+e.name+", UniqueId:"+e.uniqueId+") is already associated with this grid. You must remove it before reattaching it"),this;var r=Math.min(t,this._rowDefinitions.length-1)+":"+Math.min(i,this._columnDefinitions.length-1),n=this._cells[r];return n||(n=new Ou(r),(this._cells[r]=n).horizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_LEFT,n.verticalAlignment=Mu.VERTICAL_ALIGNMENT_TOP,rc.prototype.addControl.call(this,n)),n.addControl(e),this._childControls.push(e),e._tag=r,(e.parent=this)._markAsDirty(),this},oc.prototype.removeControl=function(e){var t=this._childControls.indexOf(e);-1!==t&&this._childControls.splice(t,1);var i=this._cells[e._tag];return i&&(i.removeControl(e),e._tag=null),this._markAsDirty(),this},oc.prototype._getTypeName=function(){return"Grid"},oc.prototype._getGridDefinitions=function(e){for(var t=[],i=[],r=[],n=[],o=this._currentMeasure.width,s=0,a=this._currentMeasure.height,h=0,l=0,u=0,c=this._rowDefinitions;u<c.length;u++)(g=c[u]).isPixel?(a-=_=g.getValue(this._host),i[l]=_):h+=g.internalValue,l++;for(var d=0,l=0,f=0,p=this._rowDefinitions;f<p.length;f++){var _,g=p[f];n.push(d),g.isPixel?d+=g.getValue(this._host):(d+=_=g.internalValue/h*a,i[l]=_),l++}for(var m=l=0,v=this._columnDefinitions;m<v.length;m++)(g=v[m]).isPixel?(o-=x=g.getValue(this._host),t[l]=x):s+=g.internalValue,l++;for(var y=0,b=l=0,T=this._columnDefinitions;b<T.length;b++){var x,g=T[b];r.push(y),g.isPixel?y+=g.getValue(this._host):(y+=x=g.internalValue/s*o,t[l]=x),l++}e(r,n,t,i)},oc.prototype._additionalProcessing=function(e,t){var l=this;this._getGridDefinitions(function(e,t,i,r){for(var n in l._cells){var o,s,a,h;l._cells.hasOwnProperty(n)&&(o=n.split(":"),s=parseInt(o[0]),a=parseInt(o[1]),(h=l._cells[n]).left=e[a]+"px",h.top=t[s]+"px",h.width=i[a]+"px",h.height=r[s]+"px",h._left.ignoreAdaptiveScaling=!0,h._top.ignoreAdaptiveScaling=!0,h._width.ignoreAdaptiveScaling=!0,h._height.ignoreAdaptiveScaling=!0)}}),rc.prototype._additionalProcessing.call(this,e,t)},oc.prototype._flagDescendantsAsMatrixDirty=function(){for(var e in this._cells)this._cells.hasOwnProperty(e)&&this._cells[e]._markMatrixAsDirty()},oc.prototype._renderHighlightSpecific=function(a){var h=this;rc.prototype._renderHighlightSpecific.call(this,a),this._getGridDefinitions(function(e,t,i,r){for(var n=0;n<e.length;n++){var o=h._currentMeasure.left+e[n]+i[n];a.beginPath(),a.moveTo(o,h._currentMeasure.top),a.lineTo(o,h._currentMeasure.top+h._currentMeasure.height),a.stroke()}for(n=0;n<t.length;n++){var s=h._currentMeasure.top+t[n]+r[n];a.beginPath(),a.moveTo(h._currentMeasure.left,s),a.lineTo(h._currentMeasure.left+h._currentMeasure.width,s),a.stroke()}}),a.restore()},oc.prototype.dispose=function(){rc.prototype.dispose.call(this);for(var e=0,t=this._childControls;e<t.length;e++)t[e].dispose();this._childControls=[]},oc);function oc(e){var t=rc.call(this,e)||this;return t.name=e,t._rowDefinitions=new Array,t._columnDefinitions=new Array,t._cells={},t._childControls=new Array,t}m.RegisteredTypes["BABYLON.GUI.Grid"]=nc;var sc,ac=(n(hc,sc=Mu),Object.defineProperty(hc.prototype,"value",{get:function(){return this._value},set:function(e){this._value.equals(e)||(this._value.copyFrom(e),this._value.toHSVToRef(this._tmpColor),this._h=this._tmpColor.r,this._s=Math.max(this._tmpColor.g,1e-5),this._v=Math.max(this._tmpColor.b,1e-5),this._markAsDirty(),this._value.r<=hc._Epsilon&&(this._value.r=0),this._value.g<=hc._Epsilon&&(this._value.g=0),this._value.b<=hc._Epsilon&&(this._value.b=0),this._value.r>=1-hc._Epsilon&&(this._value.r=1),this._value.g>=1-hc._Epsilon&&(this._value.g=1),this._value.b>=1-hc._Epsilon&&(this._value.b=1),this.onValueChangedObservable.notifyObservers(this._value))},enumerable:!0,configurable:!0}),Object.defineProperty(hc.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(e){this._width.toString(this._host)!==e&&this._width.fromString(e)&&(this._height.fromString(e),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(hc.prototype,"height",{get:function(){return this._height.toString(this._host)},set:function(e){this._height.toString(this._host)!==e&&this._height.fromString(e)&&(this._width.fromString(e),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(hc.prototype,"size",{get:function(){return this.width},set:function(e){this.width=e},enumerable:!0,configurable:!0}),hc.prototype._getTypeName=function(){return"ColorPicker"},hc.prototype._preMeasure=function(e,t){e.width<e.height?this._currentMeasure.height=e.width:this._currentMeasure.width=e.height},hc.prototype._updateSquareProps=function(){var e=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),t=2*(e-.2*e)/Math.sqrt(2),i=e-.5*t;this._squareLeft=this._currentMeasure.left+i,this._squareTop=this._currentMeasure.top+i,this._squareSize=t},hc.prototype._drawGradientSquare=function(e,t,i,r,n,o){var s=o.createLinearGradient(t,i,r+t,i);s.addColorStop(0,"#fff"),s.addColorStop(1,"hsl("+e+", 100%, 50%)"),o.fillStyle=s,o.fillRect(t,i,r,n);var a=o.createLinearGradient(t,i,t,n+i);a.addColorStop(0,"rgba(0,0,0,0)"),a.addColorStop(1,"#000"),o.fillStyle=a,o.fillRect(t,i,r,n)},hc.prototype._drawCircle=function(e,t,i,r){r.beginPath(),r.arc(e,t,i+1,0,2*Math.PI,!1),r.lineWidth=3,r.strokeStyle="#333333",r.stroke(),r.beginPath(),r.arc(e,t,i,0,2*Math.PI,!1),r.lineWidth=3,r.strokeStyle="#ffffff",r.stroke()},hc.prototype._createColorWheelCanvas=function(e,t){var i=document.createElement("canvas");i.width=2*e,i.height=2*e;for(var r=i.getContext("2d"),n=r.getImageData(0,0,2*e,2*e),o=n.data,s=this._tmpColor,a=e*e,h=e-t,l=h*h,u=-e;u<e;u++)for(var c=-e;c<e;c++){var d,f,p,_,g,m=u*u+c*c;a<m||m<l||(d=Math.sqrt(m),f=Math.atan2(c,u),Ne.HSVtoRGBToRef(180*f/Math.PI+180,d/e,1,s),o[p=4*(u+e+2*(c+e)*e)]=255*s.r,o[1+p]=255*s.g,o[2+p]=255*s.b,_=.2,_=e<50?.2:150<e?.04:-.16*(e-50)/100+.2,g=(d-h)/(e-h),o[3+p]=g<_?g/_*255:1-_<g?255*(1-(g-(1-_))/_):255)}return r.putImageData(n,0,0),i},hc.prototype._draw=function(e){e.save(),this._applyStates(e);var t=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),i=.2*t,r=this._currentMeasure.left,n=this._currentMeasure.top;this._colorWheelCanvas&&this._colorWheelCanvas.width==2*t||(this._colorWheelCanvas=this._createColorWheelCanvas(t,i)),this._updateSquareProps(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY,e.fillRect(this._squareLeft,this._squareTop,this._squareSize,this._squareSize)),e.drawImage(this._colorWheelCanvas,r,n),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._drawGradientSquare(this._h,this._squareLeft,this._squareTop,this._squareSize,this._squareSize,e);var o=this._squareLeft+this._squareSize*this._s,s=this._squareTop+this._squareSize*(1-this._v);this._drawCircle(o,s,.04*t,e);var a=t-.5*i,o=r+t+Math.cos((this._h-180)*Math.PI/180)*a,s=n+t+Math.sin((this._h-180)*Math.PI/180)*a;this._drawCircle(o,s,.35*i,e),e.restore()},hc.prototype._updateValueFromPointer=function(e,t){var i,r,n;this._pointerStartedOnWheel?(r=(i=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height))+this._currentMeasure.left,n=i+this._currentMeasure.top,this._h=180*Math.atan2(t-n,e-r)/Math.PI+180):this._pointerStartedOnSquare&&(this._updateSquareProps(),this._s=(e-this._squareLeft)/this._squareSize,this._v=1-(t-this._squareTop)/this._squareSize,this._s=Math.min(this._s,1),this._s=Math.max(this._s,hc._Epsilon),this._v=Math.min(this._v,1),this._v=Math.max(this._v,hc._Epsilon)),Ne.HSVtoRGBToRef(this._h,this._s,this._v,this._tmpColor),this.value=this._tmpColor},hc.prototype._isPointOnSquare=function(e,t){this._updateSquareProps();var i=this._squareLeft,r=this._squareTop,n=this._squareSize;return i<=e&&e<=i+n&&r<=t&&t<=r+n},hc.prototype._isPointOnWheel=function(e,t){var i=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),r=i-.2*i,n=e-(i+this._currentMeasure.left),o=t-(i+this._currentMeasure.top),s=n*n+o*o;return s<=i*i&&r*r<=s},hc.prototype._onPointerDown=function(e,t,i,r){if(!sc.prototype._onPointerDown.call(this,e,t,i,r))return!1;this._pointerIsDown=!0,this._pointerStartedOnSquare=!1,this._pointerStartedOnWheel=!1,this._invertTransformMatrix.transformCoordinates(t.x,t.y,this._transformedPosition);var n=this._transformedPosition.x,o=this._transformedPosition.y;return this._isPointOnSquare(n,o)?this._pointerStartedOnSquare=!0:this._isPointOnWheel(n,o)&&(this._pointerStartedOnWheel=!0),this._updateValueFromPointer(n,o),(this._host._capturingControl[i]=this)._lastPointerDownID=i,!0},hc.prototype._onPointerMove=function(e,t,i){var r,n;i==this._lastPointerDownID&&(this._invertTransformMatrix.transformCoordinates(t.x,t.y,this._transformedPosition),r=this._transformedPosition.x,n=this._transformedPosition.y,this._pointerIsDown&&this._updateValueFromPointer(r,n),sc.prototype._onPointerMove.call(this,e,t,i))},hc.prototype._onPointerUp=function(e,t,i,r,n){this._pointerIsDown=!1,delete this._host._capturingControl[i],sc.prototype._onPointerUp.call(this,e,t,i,r,n)},hc.ShowPickerDialogAsync=function(Le,Fe){return new Promise(function(t,e){Fe.pickerWidth=Fe.pickerWidth||"640px",Fe.pickerHeight=Fe.pickerHeight||"400px",Fe.headerHeight=Fe.headerHeight||"35px",Fe.lastColor=Fe.lastColor||"#000000",Fe.swatchLimit=Fe.swatchLimit||20,Fe.numSwatchesPerLine=Fe.numSwatchesPerLine||10;var i,r,n,o,s,f,p,a,h,l,u,c,d,_,g,m,v,y,b=Fe.swatchLimit/Fe.numSwatchesPerLine,T=parseFloat(Fe.pickerWidth)/Fe.numSwatchesPerLine,x=Math.floor(.25*T),E=x*(Fe.numSwatchesPerLine+1),A=Math.floor((parseFloat(Fe.pickerWidth)-E)/Fe.numSwatchesPerLine),M=A*b+x*(1+b),C=(parseInt(Fe.pickerHeight)+M+Math.floor(.25*A)).toString()+"px",P="#c0c0c0",O="#535353",S="#414141",I="515151",R="#555555",D="#454545",w=Ne.FromHexString("#dddddd"),L=w.r+w.g+w.b,F="#aaaaaa",N="#ffffff",B=["R","G","B"],k="#454545",U="#f0f0f0",V=!1;function z(e,t){y=t;var i,r=e.toHexString();m.background=r,h.name!=y&&(h.text=Math.floor(255*e.r).toString()),l.name!=y&&(l.text=Math.floor(255*e.g).toString()),u.name!=y&&(u.text=Math.floor(255*e.b).toString()),c.name!=y&&(c.text=e.r.toString()),d.name!=y&&(d.text=e.g.toString()),_.name!=y&&(_.text=e.b.toString()),g.name!=y&&(i=r.split("#"),g.text=i[1]),a.name!=y&&(a.value=e)}function W(e,t){var i,r=e.text;/[^0-9]/g.test(r)?e.text=v:(""!=r&&(Math.floor(parseInt(r))<0?r="0":255<Math.floor(parseInt(r))?r="255":isNaN(parseInt(r))&&(r="0")),y==e.name&&(v=r),""!=r&&(r=parseInt(r).toString(),e.text=r,i=Ne.FromHexString(m.background),y==e.name&&z("r"==t?new Ne(parseInt(r)/255,i.g,i.b):"g"==t?new Ne(i.r,parseInt(r)/255,i.b):new Ne(i.r,i.g,parseInt(r)/255),e.name)))}function G(e,t){var i,r=e.text;/[^0-9\.]/g.test(r)?e.text=v:(""!=r&&"."!=r&&0!=parseFloat(r)&&(parseFloat(r)<0?r="0.0":1<parseFloat(r)?r="1.0":isNaN(parseFloat(r))&&(r="0.0")),y==e.name&&(v=r),""!=r&&"."!=r&&0!=parseFloat(r)?(r=parseFloat(r).toString(),e.text=r):r="0.0",i=Ne.FromHexString(m.background),y==e.name&&z("r"==t?new Ne(parseFloat(r),i.g,i.b):"g"==t?new Ne(i.r,parseFloat(r),i.b):new Ne(i.r,i.g,parseFloat(r)),e.name))}function X(){if(Fe.savedColors&&Fe.savedColors[f]){var e;e=V?"b":"";var t=Wu.CreateSimpleButton("Swatch_"+f,e);t.fontFamily="BabylonJSglyphs";var i=Ne.FromHexString(Fe.savedColors[f]),r=i.r+i.g+i.b;t.color=L<r?F:N,t.fontSize=Math.floor(.7*A),t.textBlock.verticalAlignment=Mu.VERTICAL_ALIGNMENT_CENTER,t.height=t.width=A.toString()+"px",t.background=Fe.savedColors[f],t.thickness=2;var n=f;return t.pointerDownAnimation=function(){t.thickness=4},t.pointerUpAnimation=function(){t.thickness=3},t.pointerEnterAnimation=function(){t.thickness=3},t.pointerOutAnimation=function(){t.thickness=2},t.onPointerClickObservable.add(function(){var e;V?(e=n,Fe.savedColors&&Fe.savedColors.splice(e,1),Fe.savedColors&&0==Fe.savedColors.length&&(K(!1),V=!1),j("",Pe)):Fe.savedColors&&z(Ne.FromHexString(Fe.savedColors[n]),t.name)}),t}return null}function H(e){if(void 0!==e&&(V=e),V){for(var t=0;t<p.children.length;t++)p.children[t].textBlock.text="b";void 0!==r&&(r.textBlock.text="Done")}else{for(t=0;t<p.children.length;t++)p.children[t].textBlock.text="";void 0!==r&&(r.textBlock.text="Edit")}}function j(e,t){if(Fe.savedColors){""!=e&&Fe.savedColors.push(e),f=0,p.clearControls();var i,r=Math.ceil(Fe.savedColors.length/Fe.numSwatchesPerLine);if(i=0==r?0:r+1,p.rowCount!=r+i){for(var n=p.rowCount,o=0;o<n;o++)p.removeRowDefinition(0);for(o=0;o<r+i;o++)o%2?p.addRowDefinition(A,!0):p.addRowDefinition(x,!0)}p.height=(A*r+i*x).toString()+"px";for(var s,a=1,h=1;a<r+i;a+=2,h++){s=Fe.savedColors.length>h*Fe.numSwatchesPerLine?Fe.numSwatchesPerLine:Fe.savedColors.length-(h-1)*Fe.numSwatchesPerLine;for(var l,u=Math.min(Math.max(s,0),Fe.numSwatchesPerLine),c=0,d=1;c<u;c++)c>Fe.numSwatchesPerLine||null!=(l=X())&&(p.addControl(l,a,d),d+=2,f++)}Fe.savedColors.length>=Fe.swatchLimit?Y(t,!0):Y(t,!1)}}function K(e){e?((r=Wu.CreateSimpleButton("butEdit","Edit")).width=n,r.height=o,r.left=Math.floor(.1*parseInt(n)).toString()+"px",r.top=(-1*parseFloat(r.left)).toString()+"px",r.verticalAlignment=Mu.VERTICAL_ALIGNMENT_BOTTOM,r.horizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_LEFT,r.thickness=2,r.color=P,r.fontSize=i,r.background=O,r.onPointerEnterObservable.add(function(){r.background=S}),r.onPointerOutObservable.add(function(){r.background=O}),r.pointerDownAnimation=function(){r.background=I},r.pointerUpAnimation=function(){r.background=S},r.onPointerClickObservable.add(function(){V=!V,H()}),ue.addControl(r,1,0)):ue.removeControl(r)}function Y(e,t){t?(e.color=R,e.background=D):(e.color=P,e.background=O)}function q(e){Fe.savedColors&&0<Fe.savedColors.length?t({savedColors:Fe.savedColors,pickedColor:e}):t({pickedColor:e}),Le.removeControl(Q)}var Z,Q=new nc;if(Q.name="Dialog Container",Q.width=Fe.pickerWidth,Fe.savedColors?(Q.height=C,Z=parseInt(Fe.pickerHeight)/parseInt(C),Q.addRowDefinition(Z,!1),Q.addRowDefinition(1-Z,!1)):(Q.height=Fe.pickerHeight,Q.addRowDefinition(1,!1)),Le.addControl(Q),Fe.savedColors){(p=new nc).name="Swatch Drawer",p.verticalAlignment=Mu.VERTICAL_ALIGNMENT_TOP,p.background=O,p.width=Fe.pickerWidth;var J,$=Fe.savedColors.length/Fe.numSwatchesPerLine;J=0==$?0:1+$,p.height=(A*$+J*x).toString()+"px",p.top=Math.floor(.25*A).toString()+"px";for(var ee=0;ee<2*Math.ceil(Fe.savedColors.length/Fe.numSwatchesPerLine)+1;ee++)ee%2!=0?p.addRowDefinition(A,!0):p.addRowDefinition(x,!0);for(ee=0;ee<2*Fe.numSwatchesPerLine+1;ee++)ee%2!=0?p.addColumnDefinition(A,!0):p.addColumnDefinition(x,!0);Q.addControl(p,1,0)}var te=new nc;te.name="Picker Panel",te.height=Fe.pickerHeight;var ie=parseInt(Fe.headerHeight)/parseInt(Fe.pickerHeight),re=[ie,1-ie];te.addRowDefinition(re[0],!1),te.addRowDefinition(re[1],!1),Q.addControl(te,0,0);var ne=new wu;ne.name="Dialogue Header Bar",ne.background="#cccccc",ne.thickness=0,te.addControl(ne,0,0);var oe=Wu.CreateSimpleButton("closeButton","a");oe.fontFamily="BabylonJSglyphs";var se=Ne.FromHexString(ne.background),ae=new Ne(1-se.r,1-se.g,1-se.b);oe.color=ae.toHexString(),oe.fontSize=Math.floor(.6*parseInt(Fe.headerHeight)),oe.textBlock.textVerticalAlignment=Mu.VERTICAL_ALIGNMENT_CENTER,oe.horizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_RIGHT,oe.height=oe.width=Fe.headerHeight,oe.background=ne.background,oe.thickness=0,oe.pointerDownAnimation=function(){},oe.pointerUpAnimation=function(){oe.background=ne.background},oe.pointerEnterAnimation=function(){oe.color=ne.background,oe.background="red"},oe.pointerOutAnimation=function(){oe.color=ae.toHexString(),oe.background=ne.background},oe.onPointerClickObservable.add(function(){q(xe.background)}),te.addControl(oe,0,0);var he=new nc;he.name="Dialogue Body",he.background=O;var le=[.4375,.5625];he.addRowDefinition(1,!1),he.addColumnDefinition(le[0],!1),he.addColumnDefinition(le[1],!1),te.addControl(he,1,0);var ue=new nc;ue.name="Picker Grid",ue.addRowDefinition(.85,!1),ue.addRowDefinition(.15,!1),he.addControl(ue,0,0),(a=new hc).name="GUI Color Picker",Fe.pickerHeight<Fe.pickerWidth?a.width=.89:a.height=.89,a.value=Ne.FromHexString(Fe.lastColor),a.horizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_CENTER,a.verticalAlignment=Mu.VERTICAL_ALIGNMENT_CENTER,a.onPointerDownObservable.add(function(){y=a.name,v="",H(!1)}),a.onValueChangedObservable.add(function(e){y==a.name&&z(e,a.name)}),ue.addControl(a,0,0);var ce=new nc;ce.name="Dialogue Right Half",ce.horizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_LEFT;var de=[.514,.486];ce.addRowDefinition(de[0],!1),ce.addRowDefinition(de[1],!1),he.addControl(ce,1,1);var fe=new nc;fe.name="Swatches and Buttons";var pe=[.417,.583];fe.addRowDefinition(1,!1),fe.addColumnDefinition(pe[0],!1),fe.addColumnDefinition(pe[1],!1),ce.addControl(fe,0,0);var _e=new nc;_e.name="New and Current Swatches";var ge=[.04,.16,.64,.16];_e.addRowDefinition(ge[0],!1),_e.addRowDefinition(ge[1],!1),_e.addRowDefinition(ge[2],!1),_e.addRowDefinition(ge[3],!1),fe.addControl(_e,0,0);var me=new nc;me.name="Active Swatches",me.width=.67,me.addRowDefinition(.5,!1),me.addRowDefinition(.5,!1),_e.addControl(me,2,0);var ve,ye=Math.floor(parseInt(Fe.pickerWidth)*le[1]*pe[0]*.11),be=Math.floor(parseInt(Fe.pickerHeight)*re[1]*de[0]*ge[1]*.5);ve=Fe.pickerWidth>Fe.pickerHeight?be:ye;var Te=new Nu;Te.text="new",Te.name="New Color Label",Te.color=P,Te.fontSize=ve,_e.addControl(Te,1,0),(m=new wu).name="New Color Swatch",m.background=Fe.lastColor,m.thickness=0,me.addControl(m,0,0);var xe=Wu.CreateSimpleButton("currentSwatch","");xe.background=Fe.lastColor,xe.thickness=0,xe.onPointerClickObservable.add(function(){z(Ne.FromHexString(xe.background),xe.name),H(!1)}),xe.pointerDownAnimation=function(){},xe.pointerUpAnimation=function(){},xe.pointerEnterAnimation=function(){},xe.pointerOutAnimation=function(){},me.addControl(xe,1,0);var Ee=new wu;Ee.name="Swatch Outline",Ee.width=.67,Ee.thickness=2,Ee.color="#404040",Ee.isHitTestVisible=!1,_e.addControl(Ee,2,0);var Ae=new Nu;Ae.name="Current Color Label",Ae.text="current",Ae.color=P,Ae.fontSize=ve,_e.addControl(Ae,3,0);var Me=new nc;Me.name="Button Grid",Me.height=.8,Me.addRowDefinition(1/3,!1),Me.addRowDefinition(1/3,!1),Me.addRowDefinition(1/3,!1),fe.addControl(Me,0,1),n=Math.floor(parseInt(Fe.pickerWidth)*le[1]*pe[1]*.67).toString()+"px",o=Math.floor(parseInt(Fe.pickerHeight)*re[1]*de[0]*(parseFloat(Me.height.toString())/100)*(1/3)*.7).toString()+"px",i=parseFloat(n)>parseFloat(o)?Math.floor(.45*parseFloat(o)):Math.floor(.11*parseFloat(n));var Ce=Wu.CreateSimpleButton("butOK","OK");Ce.width=n,Ce.height=o,Ce.verticalAlignment=Mu.VERTICAL_ALIGNMENT_CENTER,Ce.thickness=2,Ce.color=P,Ce.fontSize=i,Ce.background=O,Ce.onPointerEnterObservable.add(function(){Ce.background=S}),Ce.onPointerOutObservable.add(function(){Ce.background=O}),Ce.pointerDownAnimation=function(){Ce.background=I},Ce.pointerUpAnimation=function(){Ce.background=S},Ce.onPointerClickObservable.add(function(){H(!1),q(m.background)}),Me.addControl(Ce,0,0);var Pe,Oe=Wu.CreateSimpleButton("butCancel","Cancel");Oe.width=n,Oe.height=o,Oe.verticalAlignment=Mu.VERTICAL_ALIGNMENT_CENTER,Oe.thickness=2,Oe.color=P,Oe.fontSize=i,Oe.background=O,Oe.onPointerEnterObservable.add(function(){Oe.background=S}),Oe.onPointerOutObservable.add(function(){Oe.background=O}),Oe.pointerDownAnimation=function(){Oe.background=I},Oe.pointerUpAnimation=function(){Oe.background=S},Oe.onPointerClickObservable.add(function(){H(!1),q(xe.background)}),Me.addControl(Oe,1,0),Fe.savedColors&&((Pe=Wu.CreateSimpleButton("butSave","Save")).width=n,Pe.height=o,Pe.verticalAlignment=Mu.VERTICAL_ALIGNMENT_CENTER,Pe.thickness=2,Pe.fontSize=i,Fe.savedColors.length<Fe.swatchLimit?(Pe.color=P,Pe.background=O):Y(Pe,!0),Pe.onPointerEnterObservable.add(function(){Fe.savedColors&&Fe.savedColors.length<Fe.swatchLimit&&(Pe.background=S)}),Pe.onPointerOutObservable.add(function(){Fe.savedColors&&Fe.savedColors.length<Fe.swatchLimit&&(Pe.background=O)}),Pe.pointerDownAnimation=function(){Fe.savedColors&&Fe.savedColors.length<Fe.swatchLimit&&(Pe.background=I)},Pe.pointerUpAnimation=function(){Fe.savedColors&&Fe.savedColors.length<Fe.swatchLimit&&(Pe.background=S)},Pe.onPointerClickObservable.add(function(){Fe.savedColors&&(0==Fe.savedColors.length&&K(!0),Fe.savedColors.length<Fe.swatchLimit&&j(m.background,Pe),H(!1))}),0<Fe.savedColors.length&&K(!0),Me.addControl(Pe,2,0));var Se=new nc;Se.name="Dialog Lower Right",Se.addRowDefinition(.02,!1),Se.addRowDefinition(.63,!1),Se.addRowDefinition(.21,!1),Se.addRowDefinition(.14,!1),ce.addControl(Se,1,0),s=Ne.FromHexString(Fe.lastColor);var Ie=new nc;for(Ie.name="RGB Values",Ie.width=.82,Ie.verticalAlignment=Mu.VERTICAL_ALIGNMENT_CENTER,Ie.addRowDefinition(1/3,!1),Ie.addRowDefinition(1/3,!1),Ie.addRowDefinition(1/3,!1),Ie.addColumnDefinition(.1,!1),Ie.addColumnDefinition(.2,!1),Ie.addColumnDefinition(.7,!1),Se.addControl(Ie,1,0),ee=0;ee<B.length;ee++)(Re=new Nu).text=B[ee],Re.color=P,Re.fontSize=i,Ie.addControl(Re,ee,0);(h=new tc).width=.83,h.height=.72,h.name="rIntField",h.fontSize=i,h.text=(255*s.r).toString(),h.color=U,h.background=k,h.onFocusObservable.add(function(){y=h.name,v=h.text,H(!1)}),h.onBlurObservable.add(function(){""==h.text&&(h.text="0"),W(h,"r"),y==h.name&&(y="")}),h.onTextChangedObservable.add(function(){y==h.name&&W(h,"r")}),Ie.addControl(h,0,1),(l=new tc).width=.83,l.height=.72,l.name="gIntField",l.fontSize=i,l.text=(255*s.g).toString(),l.color=U,l.background=k,l.onFocusObservable.add(function(){y=l.name,v=l.text,H(!1)}),l.onBlurObservable.add(function(){""==l.text&&(l.text="0"),W(l,"g"),y==l.name&&(y="")}),l.onTextChangedObservable.add(function(){y==l.name&&W(l,"g")}),Ie.addControl(l,1,1),(u=new tc).width=.83,u.height=.72,u.name="bIntField",u.fontSize=i,u.text=(255*s.b).toString(),u.color=U,u.background=k,u.onFocusObservable.add(function(){y=u.name,v=u.text,H(!1)}),u.onBlurObservable.add(function(){""==u.text&&(u.text="0"),W(u,"b"),y==u.name&&(y="")}),u.onTextChangedObservable.add(function(){y==u.name&&W(u,"b")}),Ie.addControl(u,2,1),(c=new tc).width=.95,c.height=.72,c.name="rDecField",c.fontSize=i,c.text=s.r.toString(),c.color=U,c.background=k,c.onFocusObservable.add(function(){y=c.name,v=c.text,H(!1)}),c.onBlurObservable.add(function(){0!=parseFloat(c.text)&&""!=c.text||(c.text="0",G(c,"r")),y==c.name&&(y="")}),c.onTextChangedObservable.add(function(){y==c.name&&G(c,"r")}),Ie.addControl(c,0,2),(d=new tc).width=.95,d.height=.72,d.name="gDecField",d.fontSize=i,d.text=s.g.toString(),d.color=U,d.background=k,d.onFocusObservable.add(function(){y=d.name,v=d.text,H(!1)}),d.onBlurObservable.add(function(){0!=parseFloat(d.text)&&""!=d.text||(d.text="0",G(d,"g")),y==d.name&&(y="")}),d.onTextChangedObservable.add(function(){y==d.name&&G(d,"g")}),Ie.addControl(d,1,2),(_=new tc).width=.95,_.height=.72,_.name="bDecField",_.fontSize=i,_.text=s.b.toString(),_.color=U,_.background=k,_.onFocusObservable.add(function(){y=_.name,v=_.text,H(!1)}),_.onBlurObservable.add(function(){0!=parseFloat(_.text)&&""!=_.text||(_.text="0",G(_,"b")),y==_.name&&(y="")}),_.onTextChangedObservable.add(function(){y==_.name&&G(_,"b")}),Ie.addControl(_,2,2);var Re,De=new nc;De.name="Hex Value",De.width=.82,De.addRowDefinition(1,!1),De.addColumnDefinition(.1,!1),De.addColumnDefinition(.9,!1),Se.addControl(De,2,0),(Re=new Nu).text="#",Re.color=P,Re.fontSize=i,De.addControl(Re,0,0),(g=new tc).width=.96,g.height=.72,g.name="hexField",g.horizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_CENTER,g.fontSize=i;var we=Fe.lastColor.split("#");g.text=we[1],g.color=U,g.background=k,g.onFocusObservable.add(function(){y=g.name,v=g.text,H(!1)}),g.onBlurObservable.add(function(){var e;3==g.text.length&&(e=g.text.split(""),g.text=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),""==g.text&&(g.text="000000",z(Ne.FromHexString(g.text),"b")),y==g.name&&(y="")}),g.onTextChangedObservable.add(function(){var e,t=g.text,i=/[^0-9A-F]/i.test(t);if((6<g.text.length||i)&&y==g.name)g.text=v;else{if(g.text.length<6)for(var r=6-g.text.length,n=0;n<r;n++)t="0"+t;3==g.text.length&&(t=(e=g.text.split(""))[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t="#"+t,y==g.name&&(v=g.text,z(Ne.FromHexString(t),g.name))}}),De.addControl(g,0,1),Fe.savedColors&&0<Fe.savedColors.length&&j("",Pe)})},hc._Epsilon=1e-6,hc);function hc(e){var t=sc.call(this,e)||this;return t.name=e,t._value=Ne.Red(),t._tmpColor=new Ne,t._pointerStartedOnSquare=!1,t._pointerStartedOnWheel=!1,t._squareLeft=0,t._squareTop=0,t._squareSize=0,t._h=360,t._s=1,t._v=1,t._lastPointerDownID=-1,t.onValueChangedObservable=new le,t._pointerIsDown=!1,t.value=new Ne(.88,.1,.1),t.size="200px",t.isPointerBlocker=!0,t}m.RegisteredTypes["BABYLON.GUI.ColorPicker"]=ac;var lc,uc=(n(cc,lc=Ou),Object.defineProperty(cc.prototype,"thickness",{get:function(){return this._thickness},set:function(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())},enumerable:!0,configurable:!0}),cc.prototype._getTypeName=function(){return"Ellipse"},cc.prototype._localDraw=function(e){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),Mu.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._thickness/2,this._currentMeasure.height/2-this._thickness/2,e),this._background&&(e.fillStyle=this._background,e.fill()),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._thickness&&(this.color&&(e.strokeStyle=this.color),e.lineWidth=this._thickness,e.stroke()),e.restore()},cc.prototype._additionalProcessing=function(e,t){lc.prototype._additionalProcessing.call(this,e,t),this._measureForChildren.width-=2*this._thickness,this._measureForChildren.height-=2*this._thickness,this._measureForChildren.left+=this._thickness,this._measureForChildren.top+=this._thickness},cc.prototype._clipForChildren=function(e){Mu.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2,this._currentMeasure.height/2,e),e.clip()},cc);function cc(e){var t=lc.call(this,e)||this;return t.name=e,t._thickness=1,t}m.RegisteredTypes["BABYLON.GUI.Ellipse"]=uc;var dc,fc=(n(pc,dc=tc),pc.prototype._beforeRenderText=function(e){for(var t="",i=0;i<e.length;i++)t+="";return t},pc);function pc(){return null!==dc&&dc.apply(this,arguments)||this}m.RegisteredTypes["BABYLON.GUI.InputPassword"]=fc;var _c,gc=(n(mc,_c=Mu),Object.defineProperty(mc.prototype,"dash",{get:function(){return this._dash},set:function(e){this._dash!==e&&(this._dash=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(mc.prototype,"connectedControl",{get:function(){return this._connectedControl},set:function(e){var t=this;this._connectedControl!==e&&(this._connectedControlDirtyObserver&&this._connectedControl&&(this._connectedControl.onDirtyObservable.remove(this._connectedControlDirtyObserver),this._connectedControlDirtyObserver=null),e&&(this._connectedControlDirtyObserver=e.onDirtyObservable.add(function(){return t._markAsDirty()})),this._connectedControl=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(mc.prototype,"x1",{get:function(){return this._x1.toString(this._host)},set:function(e){this._x1.toString(this._host)!==e&&this._x1.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(mc.prototype,"y1",{get:function(){return this._y1.toString(this._host)},set:function(e){this._y1.toString(this._host)!==e&&this._y1.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(mc.prototype,"x2",{get:function(){return this._x2.toString(this._host)},set:function(e){this._x2.toString(this._host)!==e&&this._x2.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(mc.prototype,"y2",{get:function(){return this._y2.toString(this._host)},set:function(e){this._y2.toString(this._host)!==e&&this._y2.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(mc.prototype,"lineWidth",{get:function(){return this._lineWidth},set:function(e){this._lineWidth!==e&&(this._lineWidth=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(mc.prototype,"horizontalAlignment",{set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(mc.prototype,"verticalAlignment",{set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(mc.prototype,"_effectiveX2",{get:function(){return(this._connectedControl?this._connectedControl.centerX:0)+this._x2.getValue(this._host)},enumerable:!0,configurable:!0}),Object.defineProperty(mc.prototype,"_effectiveY2",{get:function(){return(this._connectedControl?this._connectedControl.centerY:0)+this._y2.getValue(this._host)},enumerable:!0,configurable:!0}),mc.prototype._getTypeName=function(){return"Line"},mc.prototype._draw=function(e){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._applyStates(e),e.strokeStyle=this.color,e.lineWidth=this._lineWidth,e.setLineDash(this._dash),e.beginPath(),e.moveTo(this._cachedParentMeasure.left+this._x1.getValue(this._host),this._cachedParentMeasure.top+this._y1.getValue(this._host)),e.lineTo(this._cachedParentMeasure.left+this._effectiveX2,this._cachedParentMeasure.top+this._effectiveY2),e.stroke(),e.restore()},mc.prototype._measure=function(){this._currentMeasure.width=Math.abs(this._x1.getValue(this._host)-this._effectiveX2)+this._lineWidth,this._currentMeasure.height=Math.abs(this._y1.getValue(this._host)-this._effectiveY2)+this._lineWidth},mc.prototype._computeAlignment=function(e,t){this._currentMeasure.left=e.left+Math.min(this._x1.getValue(this._host),this._effectiveX2)-this._lineWidth/2,this._currentMeasure.top=e.top+Math.min(this._y1.getValue(this._host),this._effectiveY2)-this._lineWidth/2},mc.prototype.moveToVector3=function(e,t,i){var r,n;void 0===i&&(i=!1),this._host&&this.parent===this._host._rootContainer?(r=this._host._getGlobalViewport(t),n=te.Project(e,W.Identity(),t.getTransformMatrix(),r),this._moveToProjectedPosition(n,i),n.z<0||1<n.z?this.notRenderable=!0:this.notRenderable=!1):ri.Error("Cannot move a control to a vector3 if the control is not at root level")},mc.prototype._moveToProjectedPosition=function(e,t){void 0===t&&(t=!1);var i=e.x+this._linkOffsetX.getValue(this._host)+"px",r=e.y+this._linkOffsetY.getValue(this._host)+"px";t?(this.x2=i,this.y2=r,this._x2.ignoreAdaptiveScaling=!0,this._y2.ignoreAdaptiveScaling=!0):(this.x1=i,this.y1=r,this._x1.ignoreAdaptiveScaling=!0,this._y1.ignoreAdaptiveScaling=!0)},mc);function mc(e){var t=_c.call(this,e)||this;return t.name=e,t._lineWidth=1,t._x1=new du(0),t._y1=new du(0),t._x2=new du(0),t._y2=new du(0),t._dash=new Array,t._automaticSize=!0,t.isHitTestVisible=!1,t._horizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_LEFT,t._verticalAlignment=Mu.VERTICAL_ALIGNMENT_TOP,t}m.RegisteredTypes["BABYLON.GUI.Line"]=gc;var vc=(Object.defineProperty(yc.prototype,"x",{get:function(){return this._x.toString(this._multiLine._host)},set:function(e){this._x.toString(this._multiLine._host)!==e&&this._x.fromString(e)&&this._multiLine._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(yc.prototype,"y",{get:function(){return this._y.toString(this._multiLine._host)},set:function(e){this._y.toString(this._multiLine._host)!==e&&this._y.fromString(e)&&this._multiLine._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(yc.prototype,"control",{get:function(){return this._control},set:function(e){this._control!==e&&(this._control&&this._controlObserver&&(this._control.onDirtyObservable.remove(this._controlObserver),this._controlObserver=null),this._control=e,this._control&&(this._controlObserver=this._control.onDirtyObservable.add(this._multiLine.onPointUpdate)),this._multiLine._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(yc.prototype,"mesh",{get:function(){return this._mesh},set:function(e){this._mesh!==e&&(this._mesh&&this._meshObserver&&this._mesh.getScene().onAfterCameraRenderObservable.remove(this._meshObserver),this._mesh=e,this._mesh&&(this._meshObserver=this._mesh.getScene().onAfterCameraRenderObservable.add(this._multiLine.onPointUpdate)),this._multiLine._markAsDirty())},enumerable:!0,configurable:!0}),yc.prototype.resetLinks=function(){this.control=null,this.mesh=null},yc.prototype.translate=function(){return this._point=this._translatePoint(),this._point},yc.prototype._translatePoint=function(){if(null!=this._mesh)return this._multiLine._host.getProjectedPosition(this._mesh.getBoundingInfo().boundingSphere.center,this._mesh.getWorldMatrix());if(null!=this._control)return new H(this._control.centerX,this._control.centerY);var e=this._multiLine._host,t=this._x.getValueInPixel(e,Number(e._canvas.width)),i=this._y.getValueInPixel(e,Number(e._canvas.height));return new H(t,i)},yc.prototype.dispose=function(){this.resetLinks()},yc);function yc(e){this._multiLine=e,this._x=new du(0),this._y=new du(0),this._point=new H(0,0)}var bc,Tc=(n(xc,bc=Mu),Object.defineProperty(xc.prototype,"dash",{get:function(){return this._dash},set:function(e){this._dash!==e&&(this._dash=e,this._markAsDirty())},enumerable:!0,configurable:!0}),xc.prototype.getAt=function(e){return this._points[e]||(this._points[e]=new vc(this)),this._points[e]},xc.prototype.add=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return e.map(function(e){return t.push(e)})},xc.prototype.push=function(e){var t=this.getAt(this._points.length);return null==e||(e instanceof Zi?t.mesh=e:e instanceof Mu?t.control=e:null!=e.x&&null!=e.y&&(t.x=e.x,t.y=e.y)),t},xc.prototype.remove=function(e){var t;if(e instanceof vc){if(-1===(t=this._points.indexOf(e)))return}else t=e;var i=this._points[t];i&&(i.dispose(),this._points.splice(t,1))},xc.prototype.reset=function(){for(;0<this._points.length;)this.remove(this._points.length-1)},xc.prototype.resetLinks=function(){this._points.forEach(function(e){null!=e&&e.resetLinks()})},Object.defineProperty(xc.prototype,"lineWidth",{get:function(){return this._lineWidth},set:function(e){this._lineWidth!==e&&(this._lineWidth=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(xc.prototype,"horizontalAlignment",{set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(xc.prototype,"verticalAlignment",{set:function(e){},enumerable:!0,configurable:!0}),xc.prototype._getTypeName=function(){return"MultiLine"},xc.prototype._draw=function(t,e){t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),this._applyStates(t),t.strokeStyle=this.color,t.lineWidth=this._lineWidth,t.setLineDash(this._dash),t.beginPath();var i=!0;this._points.forEach(function(e){e&&(i?(t.moveTo(e._point.x,e._point.y),i=!1):t.lineTo(e._point.x,e._point.y))}),t.stroke(),t.restore()},xc.prototype._additionalProcessing=function(e,t){var i=this;this._minX=null,this._minY=null,this._maxX=null,this._maxY=null,this._points.forEach(function(e,t){e&&(e.translate(),(null==i._minX||e._point.x<i._minX)&&(i._minX=e._point.x),(null==i._minY||e._point.y<i._minY)&&(i._minY=e._point.y),(null==i._maxX||e._point.x>i._maxX)&&(i._maxX=e._point.x),(null==i._maxY||e._point.y>i._maxY)&&(i._maxY=e._point.y))}),null==this._minX&&(this._minX=0),null==this._minY&&(this._minY=0),null==this._maxX&&(this._maxX=0),null==this._maxY&&(this._maxY=0)},xc.prototype._measure=function(){null!=this._minX&&null!=this._maxX&&null!=this._minY&&null!=this._maxY&&(this._currentMeasure.width=Math.abs(this._maxX-this._minX)+this._lineWidth,this._currentMeasure.height=Math.abs(this._maxY-this._minY)+this._lineWidth)},xc.prototype._computeAlignment=function(e,t){null!=this._minX&&null!=this._minY&&(this._currentMeasure.left=this._minX-this._lineWidth/2,this._currentMeasure.top=this._minY-this._lineWidth/2)},xc.prototype.dispose=function(){this.reset(),bc.prototype.dispose.call(this)},xc);function xc(e){var t=bc.call(this,e)||this;return t.name=e,t._lineWidth=1,t.onPointUpdate=function(){t._markAsDirty()},t._automaticSize=!0,t.isHitTestVisible=!1,t._horizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_LEFT,t._verticalAlignment=Mu.VERTICAL_ALIGNMENT_TOP,t._dash=[],t._points=[],t}m.RegisteredTypes["BABYLON.GUI.MultiLine"]=Tc;var Ec,Ac=(n(Mc,Ec=Mu),Object.defineProperty(Mc.prototype,"thickness",{get:function(){return this._thickness},set:function(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Mc.prototype,"checkSizeRatio",{get:function(){return this._checkSizeRatio},set:function(e){e=Math.max(Math.min(1,e),0),this._checkSizeRatio!==e&&(this._checkSizeRatio=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Mc.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Mc.prototype,"isChecked",{get:function(){return this._isChecked},set:function(e){var t=this;this._isChecked!==e&&(this._isChecked=e,this._markAsDirty(),this.onIsCheckedChangedObservable.notifyObservers(e),this._isChecked&&this._host&&this._host.executeOnAllControls(function(e){e!==t&&void 0!==e.group&&e.group===t.group&&(e.isChecked=!1)}))},enumerable:!0,configurable:!0}),Mc.prototype._getTypeName=function(){return"RadioButton"},Mc.prototype._draw=function(e){e.save(),this._applyStates(e);var t,i,r=this._currentMeasure.width-this._thickness,n=this._currentMeasure.height-this._thickness;(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),Mu.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._thickness/2,this._currentMeasure.height/2-this._thickness/2,e),e.fillStyle=this._isEnabled?this._background:this._disabledColor,e.fill(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.strokeStyle=this.color,e.lineWidth=this._thickness,e.stroke(),this._isChecked&&(e.fillStyle=this._isEnabled?this.color:this._disabledColor,t=r*this._checkSizeRatio,i=n*this._checkSizeRatio,Mu.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,t/2-this._thickness/2,i/2-this._thickness/2,e),e.fill()),e.restore()},Mc.prototype._onPointerDown=function(e,t,i,r){return!!Ec.prototype._onPointerDown.call(this,e,t,i,r)&&(this.isChecked||(this.isChecked=!0),!0)},Mc.AddRadioButtonWithHeader=function(e,t,i,r){var n=new Hu;n.isVertical=!1,n.height="30px";var o=new Mc;o.width="20px",o.height="20px",o.isChecked=i,o.color="green",o.group=t,o.onIsCheckedChangedObservable.add(function(e){return r(o,e)}),n.addControl(o);var s=new Nu;return s.text=e,s.width="180px",s.paddingLeft="5px",s.textHorizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_LEFT,s.color="white",n.addControl(s),n},Mc);function Mc(e){var t=Ec.call(this,e)||this;return t.name=e,t._isChecked=!1,t._background="black",t._checkSizeRatio=.8,t._thickness=1,t.group="",t.onIsCheckedChangedObservable=new le,t.isPointerBlocker=!0,t}m.RegisteredTypes["BABYLON.GUI.RadioButton"]=Ac;var Cc,Pc=(n(Oc,Cc=Mu),Object.defineProperty(Oc.prototype,"displayThumb",{get:function(){return this._displayThumb},set:function(e){this._displayThumb!==e&&(this._displayThumb=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Oc.prototype,"step",{get:function(){return this._step},set:function(e){this._step!==e&&(this._step=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Oc.prototype,"barOffset",{get:function(){return this._barOffset.toString(this._host)},set:function(e){this._barOffset.toString(this._host)!==e&&this._barOffset.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(Oc.prototype,"barOffsetInPixels",{get:function(){return this._barOffset.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!0,configurable:!0}),Object.defineProperty(Oc.prototype,"thumbWidth",{get:function(){return this._thumbWidth.toString(this._host)},set:function(e){this._thumbWidth.toString(this._host)!==e&&this._thumbWidth.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(Oc.prototype,"thumbWidthInPixels",{get:function(){return this._thumbWidth.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!0,configurable:!0}),Object.defineProperty(Oc.prototype,"minimum",{get:function(){return this._minimum},set:function(e){this._minimum!==e&&(this._minimum=e,this._markAsDirty(),this.value=Math.max(Math.min(this.value,this._maximum),this._minimum))},enumerable:!0,configurable:!0}),Object.defineProperty(Oc.prototype,"maximum",{get:function(){return this._maximum},set:function(e){this._maximum!==e&&(this._maximum=e,this._markAsDirty(),this.value=Math.max(Math.min(this.value,this._maximum),this._minimum))},enumerable:!0,configurable:!0}),Object.defineProperty(Oc.prototype,"value",{get:function(){return this._value},set:function(e){e=Math.max(Math.min(e,this._maximum),this._minimum),this._value!==e&&(this._value=e,this._markAsDirty(),this.onValueChangedObservable.notifyObservers(this._value))},enumerable:!0,configurable:!0}),Object.defineProperty(Oc.prototype,"isVertical",{get:function(){return this._isVertical},set:function(e){this._isVertical!==e&&(this._isVertical=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Oc.prototype,"isThumbClamped",{get:function(){return this._isThumbClamped},set:function(e){this._isThumbClamped!==e&&(this._isThumbClamped=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Oc.prototype._getTypeName=function(){return"BaseSlider"},Oc.prototype._getThumbPosition=function(){return this.isVertical?(this.maximum-this.value)/(this.maximum-this.minimum)*this._backgroundBoxLength:(this.value-this.minimum)/(this.maximum-this.minimum)*this._backgroundBoxLength},Oc.prototype._getThumbThickness=function(e){var t=0;switch(e){case"circle":t=this._thumbWidth.isPixel?Math.max(this._thumbWidth.getValue(this._host),this._backgroundBoxThickness):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host);break;case"rectangle":t=this._thumbWidth.isPixel?Math.min(this._thumbWidth.getValue(this._host),this._backgroundBoxThickness):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host)}return t},Oc.prototype._prepareRenderingData=function(e){this._effectiveBarOffset=0,this._renderLeft=this._currentMeasure.left,this._renderTop=this._currentMeasure.top,this._renderWidth=this._currentMeasure.width,this._renderHeight=this._currentMeasure.height,this._backgroundBoxLength=Math.max(this._currentMeasure.width,this._currentMeasure.height),this._backgroundBoxThickness=Math.min(this._currentMeasure.width,this._currentMeasure.height),this._effectiveThumbThickness=this._getThumbThickness(e),this.displayThumb&&(this._backgroundBoxLength-=this._effectiveThumbThickness),this.isVertical&&this._currentMeasure.height<this._currentMeasure.width?console.error("Height should be greater than width"):(this._barOffset.isPixel?this._effectiveBarOffset=Math.min(this._barOffset.getValue(this._host),this._backgroundBoxThickness):this._effectiveBarOffset=this._backgroundBoxThickness*this._barOffset.getValue(this._host),this._backgroundBoxThickness-=2*this._effectiveBarOffset,this.isVertical?(this._renderLeft+=this._effectiveBarOffset,!this.isThumbClamped&&this.displayThumb&&(this._renderTop+=this._effectiveThumbThickness/2),this._renderHeight=this._backgroundBoxLength,this._renderWidth=this._backgroundBoxThickness):(this._renderTop+=this._effectiveBarOffset,!this.isThumbClamped&&this.displayThumb&&(this._renderLeft+=this._effectiveThumbThickness/2),this._renderHeight=this._backgroundBoxThickness,this._renderWidth=this._backgroundBoxLength))},Oc.prototype._updateValueFromPointer=function(e,t){var i;0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y),i=this._isVertical?this._minimum+(1-(t-this._currentMeasure.top)/this._currentMeasure.height)*(this._maximum-this._minimum):this._minimum+(e-this._currentMeasure.left)/this._currentMeasure.width*(this._maximum-this._minimum);var r=1/this._step|0;this.value=this._step?(i*r|0)/r:i},Oc.prototype._onPointerDown=function(e,t,i,r){return!!Cc.prototype._onPointerDown.call(this,e,t,i,r)&&(this._pointerIsDown=!0,this._updateValueFromPointer(t.x,t.y),(this._host._capturingControl[i]=this)._lastPointerDownID=i,!0)},Oc.prototype._onPointerMove=function(e,t,i){i==this._lastPointerDownID&&(this._pointerIsDown&&this._updateValueFromPointer(t.x,t.y),Cc.prototype._onPointerMove.call(this,e,t,i))},Oc.prototype._onPointerUp=function(e,t,i,r,n){this._pointerIsDown=!1,delete this._host._capturingControl[i],Cc.prototype._onPointerUp.call(this,e,t,i,r,n)},Oc);function Oc(e){var t=Cc.call(this,e)||this;return t.name=e,t._thumbWidth=new du(20,du.UNITMODE_PIXEL,!1),t._minimum=0,t._maximum=100,t._value=50,t._isVertical=!1,t._barOffset=new du(5,du.UNITMODE_PIXEL,!1),t._isThumbClamped=!1,t._displayThumb=!0,t._step=0,t._lastPointerDownID=-1,t._effectiveBarOffset=0,t.onValueChangedObservable=new le,t._pointerIsDown=!1,t.isPointerBlocker=!0,t}var Sc,Ic=(n(Rc,Sc=Pc),Object.defineProperty(Rc.prototype,"displayValueBar",{get:function(){return this._displayValueBar},set:function(e){this._displayValueBar!==e&&(this._displayValueBar=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Rc.prototype,"borderColor",{get:function(){return this._borderColor},set:function(e){this._borderColor!==e&&(this._borderColor=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Rc.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Rc.prototype,"isThumbCircle",{get:function(){return this._isThumbCircle},set:function(e){this._isThumbCircle!==e&&(this._isThumbCircle=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Rc.prototype._getTypeName=function(){return"Slider"},Rc.prototype._draw=function(e,t){e.save(),this._applyStates(e),this._prepareRenderingData(this.isThumbCircle?"circle":"rectangle");var i=this._renderLeft,r=this._renderTop,n=this._renderWidth,o=this._renderHeight,s=0,s=this.isThumbClamped&&this.isThumbCircle?(this.isVertical?r+=this._effectiveThumbThickness/2:i+=this._effectiveThumbThickness/2,this._backgroundBoxThickness/2):(this._effectiveThumbThickness-this._effectiveBarOffset)/2;(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY);var a=this._getThumbPosition();e.fillStyle=this._background,this.isVertical?this.isThumbClamped?this.isThumbCircle?(e.beginPath(),e.arc(i+this._backgroundBoxThickness/2,r,s,Math.PI,2*Math.PI),e.fill(),e.fillRect(i,r,n,o)):e.fillRect(i,r,n,o+this._effectiveThumbThickness):e.fillRect(i,r,n,o):this.isThumbClamped?this.isThumbCircle?(e.beginPath(),e.arc(i+this._backgroundBoxLength,r+this._backgroundBoxThickness/2,s,0,2*Math.PI),e.fill(),e.fillRect(i,r,n,o)):e.fillRect(i,r,n+this._effectiveThumbThickness,o):e.fillRect(i,r,n,o),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.fillStyle=this.color,this._displayValueBar&&(this.isVertical?this.isThumbClamped?this.isThumbCircle?(e.beginPath(),e.arc(i+this._backgroundBoxThickness/2,r+this._backgroundBoxLength,s,0,2*Math.PI),e.fill(),e.fillRect(i,r+a,n,o-a)):e.fillRect(i,r+a,n,o-a+this._effectiveThumbThickness):e.fillRect(i,r+a,n,o-a):(this.isThumbClamped&&this.isThumbCircle&&(e.beginPath(),e.arc(i,r+this._backgroundBoxThickness/2,s,0,2*Math.PI),e.fill()),e.fillRect(i,r,a,o))),this.displayThumb&&((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._isThumbCircle?(e.beginPath(),this.isVertical?e.arc(i+this._backgroundBoxThickness/2,r+a,s,0,2*Math.PI):e.arc(i+a,r+this._backgroundBoxThickness/2,s,0,2*Math.PI),e.fill(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.strokeStyle=this._borderColor,e.stroke()):(this.isVertical?e.fillRect(i-this._effectiveBarOffset,this._currentMeasure.top+a,this._currentMeasure.width,this._effectiveThumbThickness):e.fillRect(this._currentMeasure.left+a,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.strokeStyle=this._borderColor,this.isVertical?e.strokeRect(i-this._effectiveBarOffset,this._currentMeasure.top+a,this._currentMeasure.width,this._effectiveThumbThickness):e.strokeRect(this._currentMeasure.left+a,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height))),e.restore()},Rc);function Rc(e){var t=Sc.call(this,e)||this;return t.name=e,t._background="black",t._borderColor="white",t._isThumbCircle=!1,t._displayValueBar=!0,t}m.RegisteredTypes["BABYLON.GUI.Slider"]=Ic;var Dc=(Object.defineProperty(wc.prototype,"groupPanel",{get:function(){return this._groupPanel},enumerable:!0,configurable:!0}),Object.defineProperty(wc.prototype,"selectors",{get:function(){return this._selectors},enumerable:!0,configurable:!0}),Object.defineProperty(wc.prototype,"header",{get:function(){return this._groupHeader.text},set:function(e){"label"!==this._groupHeader.text&&(this._groupHeader.text=e)},enumerable:!0,configurable:!0}),wc.prototype._addGroupHeader=function(e){var t=new Nu("groupHead",e);return t.width=.9,t.height="30px",t.textWrapping=!0,t.color="black",t.horizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_LEFT,t.textHorizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_LEFT,t.left="2px",this._groupPanel.addControl(t),t},wc.prototype._getSelector=function(e){if(!(e<0||e>=this._selectors.length))return this._selectors[e]},wc.prototype.removeSelector=function(e){e<0||e>=this._selectors.length||(this._groupPanel.removeControl(this._selectors[e]),this._selectors.splice(e,1))},wc);function wc(e){this.name=e,this._groupPanel=new Hu,this._selectors=new Array,this._groupPanel.verticalAlignment=Mu.VERTICAL_ALIGNMENT_TOP,this._groupPanel.horizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_LEFT,this._groupHeader=this._addGroupHeader(e)}var Lc;n(Fc,Lc=Dc),Fc.prototype.addCheckbox=function(e,t,i){void 0===t&&(t=function(e){}),void 0===i&&(i=!1);var i=i||!1,r=new Yu;r.width="20px",r.height="20px",r.color="#364249",r.background="#CCCCCC",r.horizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_LEFT,r.onIsCheckedChangedObservable.add(function(e){t(e)});var n=Mu.AddHeader(r,e,"200px",{isHorizontal:!0,controlFirst:!0});n.height="30px",n.horizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_LEFT,n.left="4px",this.groupPanel.addControl(n),this.selectors.push(n),r.isChecked=i,this.groupPanel.parent&&this.groupPanel.parent.parent&&(r.color=this.groupPanel.parent.parent.buttonColor,r.background=this.groupPanel.parent.parent.buttonBackground)},Fc.prototype._setSelectorLabel=function(e,t){this.selectors[e].children[1].text=t},Fc.prototype._setSelectorLabelColor=function(e,t){this.selectors[e].children[1].color=t},Fc.prototype._setSelectorButtonColor=function(e,t){this.selectors[e].children[0].color=t},Fc.prototype._setSelectorButtonBackground=function(e,t){this.selectors[e].children[0].background=t};function Fc(){return null!==Lc&&Lc.apply(this,arguments)||this}var Nc;n(Bc,Nc=Dc),Bc.prototype.addRadio=function(e,t,i){void 0===t&&(t=function(e){}),void 0===i&&(i=!1);var r=this._selectNb++,n=new Ac;n.name=e,n.width="20px",n.height="20px",n.color="#364249",n.background="#CCCCCC",n.group=this.name,n.horizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_LEFT,n.onIsCheckedChangedObservable.add(function(e){e&&t(r)});var o=Mu.AddHeader(n,e,"200px",{isHorizontal:!0,controlFirst:!0});o.height="30px",o.horizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_LEFT,o.left="4px",this.groupPanel.addControl(o),this.selectors.push(o),n.isChecked=i,this.groupPanel.parent&&this.groupPanel.parent.parent&&(n.color=this.groupPanel.parent.parent.buttonColor,n.background=this.groupPanel.parent.parent.buttonBackground)},Bc.prototype._setSelectorLabel=function(e,t){this.selectors[e].children[1].text=t},Bc.prototype._setSelectorLabelColor=function(e,t){this.selectors[e].children[1].color=t},Bc.prototype._setSelectorButtonColor=function(e,t){this.selectors[e].children[0].color=t},Bc.prototype._setSelectorButtonBackground=function(e,t){this.selectors[e].children[0].background=t};function Bc(){var e=null!==Nc&&Nc.apply(this,arguments)||this;return e._selectNb=0,e}var kc;n(Uc,kc=Dc),Uc.prototype.addSlider=function(e,t,i,r,n,o,s){void 0===t&&(t=function(e){}),void 0===i&&(i="Units"),void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=function(e){return 0|e});var a=new Ic;a.name=i,a.value=o,a.minimum=r,a.maximum=n,a.width=.9,a.height="20px",a.color="#364249",a.background="#CCCCCC",a.borderColor="black",a.horizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_LEFT,a.left="4px",a.paddingBottom="4px",a.onValueChangedObservable.add(function(e){a.parent.children[0].text=a.parent.children[0].name+": "+s(e)+" "+a.name,t(e)});var h=Mu.AddHeader(a,e+": "+s(o)+" "+i,"30px",{isHorizontal:!1,controlFirst:!1});h.height="60px",h.horizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_LEFT,h.left="4px",h.children[0].name=e,this.groupPanel.addControl(h),this.selectors.push(h),this.groupPanel.parent&&this.groupPanel.parent.parent&&(a.color=this.groupPanel.parent.parent.buttonColor,a.background=this.groupPanel.parent.parent.buttonBackground)},Uc.prototype._setSelectorLabel=function(e,t){this.selectors[e].children[0].name=t,this.selectors[e].children[0].text=t+": "+this.selectors[e].children[1].value+" "+this.selectors[e].children[1].name},Uc.prototype._setSelectorLabelColor=function(e,t){this.selectors[e].children[0].color=t},Uc.prototype._setSelectorButtonColor=function(e,t){this.selectors[e].children[1].color=t},Uc.prototype._setSelectorButtonBackground=function(e,t){this.selectors[e].children[1].background=t};function Uc(){return null!==kc&&kc.apply(this,arguments)||this}var Vc;n(zc,Vc=wu),zc.prototype._getTypeName=function(){return"SelectionPanel"},Object.defineProperty(zc.prototype,"headerColor",{get:function(){return this._headerColor},set:function(e){this._headerColor!==e&&(this._headerColor=e,this._setHeaderColor())},enumerable:!0,configurable:!0}),zc.prototype._setHeaderColor=function(){for(var e=0;e<this._groups.length;e++)this._groups[e].groupPanel.children[0].color=this._headerColor},Object.defineProperty(zc.prototype,"buttonColor",{get:function(){return this._buttonColor},set:function(e){this._buttonColor!==e&&(this._buttonColor=e,this._setbuttonColor())},enumerable:!0,configurable:!0}),zc.prototype._setbuttonColor=function(){for(var e=0;e<this._groups.length;e++)for(var t=0;t<this._groups[e].selectors.length;t++)this._groups[e]._setSelectorButtonColor(t,this._buttonColor)},Object.defineProperty(zc.prototype,"labelColor",{get:function(){return this._labelColor},set:function(e){this._labelColor!==e&&(this._labelColor=e,this._setLabelColor())},enumerable:!0,configurable:!0}),zc.prototype._setLabelColor=function(){for(var e=0;e<this._groups.length;e++)for(var t=0;t<this._groups[e].selectors.length;t++)this._groups[e]._setSelectorLabelColor(t,this._labelColor)},Object.defineProperty(zc.prototype,"buttonBackground",{get:function(){return this._buttonBackground},set:function(e){this._buttonBackground!==e&&(this._buttonBackground=e,this._setButtonBackground())},enumerable:!0,configurable:!0}),zc.prototype._setButtonBackground=function(){for(var e=0;e<this._groups.length;e++)for(var t=0;t<this._groups[e].selectors.length;t++)this._groups[e]._setSelectorButtonBackground(t,this._buttonBackground)},Object.defineProperty(zc.prototype,"barColor",{get:function(){return this._barColor},set:function(e){this._barColor!==e&&(this._barColor=e,this._setBarColor())},enumerable:!0,configurable:!0}),zc.prototype._setBarColor=function(){for(var e=0;e<this._bars.length;e++)this._bars[e].children[0].background=this._barColor},Object.defineProperty(zc.prototype,"barHeight",{get:function(){return this._barHeight},set:function(e){this._barHeight!==e&&(this._barHeight=e,this._setBarHeight())},enumerable:!0,configurable:!0}),zc.prototype._setBarHeight=function(){for(var e=0;e<this._bars.length;e++)this._bars[e].children[0].height=this._barHeight},Object.defineProperty(zc.prototype,"spacerHeight",{get:function(){return this._spacerHeight},set:function(e){this._spacerHeight!==e&&(this._spacerHeight=e,this._setSpacerHeight())},enumerable:!0,configurable:!0}),zc.prototype._setSpacerHeight=function(){for(var e=0;e<this._bars.length;e++)this._bars[e].height=this._spacerHeight},zc.prototype._addSpacer=function(){var e=new Ou;e.width=1,e.height=this._spacerHeight,e.horizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_LEFT;var t=new wu;t.width=1,t.height=this._barHeight,t.horizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_LEFT,t.verticalAlignment=Mu.VERTICAL_ALIGNMENT_CENTER,t.background=this._barColor,t.color="transparent",e.addControl(t),this._panel.addControl(e),this._bars.push(e)},zc.prototype.addGroup=function(e){0<this._groups.length&&this._addSpacer(),this._panel.addControl(e.groupPanel),this._groups.push(e),e.groupPanel.children[0].color=this._headerColor;for(var t=0;t<e.selectors.length;t++)e._setSelectorButtonColor(t,this._buttonColor),e._setSelectorButtonBackground(t,this._buttonBackground)},zc.prototype.removeGroup=function(e){var t;e<0||e>=this._groups.length||(t=this._groups[e],this._panel.removeControl(t.groupPanel),this._groups.splice(e,1),e<this._bars.length&&(this._panel.removeControl(this._bars[e]),this._bars.splice(e,1)))},zc.prototype.setHeaderName=function(e,t){t<0||t>=this._groups.length||(this._groups[t].groupPanel.children[0].text=e)},zc.prototype.relabel=function(e,t,i){var r;t<0||t>=this._groups.length||(r=this._groups[t],i<0||i>=r.selectors.length||r._setSelectorLabel(i,e))},zc.prototype.removeFromGroupSelector=function(e,t){var i;e<0||e>=this._groups.length||(i=this._groups[e],t<0||t>=i.selectors.length||i.removeSelector(t))},zc.prototype.addToGroupCheckbox=function(e,t,i,r){void 0===i&&(i=function(){}),void 0===r&&(r=!1),e<0||e>=this._groups.length||this._groups[e].addCheckbox(t,i,r)},zc.prototype.addToGroupRadio=function(e,t,i,r){void 0===i&&(i=function(){}),void 0===r&&(r=!1),e<0||e>=this._groups.length||this._groups[e].addRadio(t,i,r)},zc.prototype.addToGroupSlider=function(e,t,i,r,n,o,s,a){void 0===i&&(i=function(){}),void 0===r&&(r="Units"),void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=function(e){return 0|e}),e<0||e>=this._groups.length||this._groups[e].addSlider(t,i,r,n,o,s,a)};function zc(e,t){void 0===t&&(t=[]);var i=Vc.call(this,e)||this;if(i.name=e,i.groups=t,i._buttonColor="#364249",i._buttonBackground="#CCCCCC",i._headerColor="black",i._barColor="white",i._barHeight="2px",i._spacerHeight="20px",i._bars=new Array,i._groups=t,i.thickness=2,i._panel=new Hu,i._panel.verticalAlignment=Mu.VERTICAL_ALIGNMENT_TOP,i._panel.horizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_LEFT,i._panel.top=5,i._panel.left=5,i._panel.width=.95,0<t.length){for(var r=0;r<t.length-1;r++)i._panel.addControl(t[r].groupPanel),i._addSpacer();i._panel.addControl(t[t.length-1].groupPanel)}return i.addControl(i._panel),i}var Wc,Gc=(n(Xc,Wc=Ou),Object.defineProperty(Xc.prototype,"freezeControls",{get:function(){return this._freezeControls},set:function(e){var t,i,r,n,o;this._freezeControls!==e&&(this._freezeControls=!1,i=(t=this.host.getSize()).width,r=t.height,n=this.host.getContext(),o=new vu(0,0,i,r),this.host._numLayoutCalls=0,this.host._rootContainer._layout(o,n),e&&(this._updateMeasures(),this._useBuckets()&&this._makeBuckets()),this._freezeControls=e,this.host.markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Xc.prototype,"bucketWidth",{get:function(){return this._bucketWidth},enumerable:!0,configurable:!0}),Object.defineProperty(Xc.prototype,"bucketHeight",{get:function(){return this._bucketHeight},enumerable:!0,configurable:!0}),Xc.prototype.setBucketSizes=function(e,t){this._bucketWidth=e,this._bucketHeight=t,this._useBuckets()?this._freezeControls&&this._makeBuckets():this._buckets={}},Xc.prototype._useBuckets=function(){return 0<this._bucketWidth&&0<this._bucketHeight},Xc.prototype._makeBuckets=function(){this._buckets={},this._bucketLen=Math.ceil(this.widthInPixels/this._bucketWidth),this._dispatchInBuckets(this._children)},Xc.prototype._dispatchInBuckets=function(e){for(var t=0;t<e.length;++t){for(var i=e[t],r=Math.max(0,Math.floor((i._currentMeasure.left-this._currentMeasure.left)/this._bucketWidth)),n=Math.floor((i._currentMeasure.left-this._currentMeasure.left+i._currentMeasure.width-1)/this._bucketWidth),o=Math.max(0,Math.floor((i._currentMeasure.top-this._currentMeasure.top)/this._bucketHeight)),s=Math.floor((i._currentMeasure.top-this._currentMeasure.top+i._currentMeasure.height-1)/this._bucketHeight);o<=s;){for(var a=r;a<=n;++a){var h=o*this._bucketLen+a,l=this._buckets[h];l||(l=[],this._buckets[h]=l),l.push(i)}o++}i instanceof Ou&&0<i._children.length&&this._dispatchInBuckets(i._children)}},Xc.prototype._updateMeasures=function(){var e=0|this.leftInPixels,t=0|this.topInPixels;this._measureForChildren.left-=e,this._measureForChildren.top-=t,this._currentMeasure.left-=e,this._currentMeasure.top-=t,this._updateChildrenMeasures(this._children,e,t)},Xc.prototype._updateChildrenMeasures=function(e,t,i){for(var r=0;r<e.length;++r){var n=e[r];n._currentMeasure.left-=t,n._currentMeasure.top-=i,n._customData._origLeft=n._currentMeasure.left,n._customData._origTop=n._currentMeasure.top,n instanceof Ou&&0<n._children.length&&this._updateChildrenMeasures(n._children,t,i)}},Xc.prototype._getTypeName=function(){return"ScrollViewerWindow"},Xc.prototype._additionalProcessing=function(e,t){Wc.prototype._additionalProcessing.call(this,e,t),this._parentMeasure=e,this._measureForChildren.left=this._currentMeasure.left,this._measureForChildren.top=this._currentMeasure.top,this._measureForChildren.width=e.width,this._measureForChildren.height=e.height},Xc.prototype._layout=function(e,t){return this._freezeControls?(this.invalidateRect(),!1):Wc.prototype._layout.call(this,e,t)},Xc.prototype._scrollChildren=function(e,t,i){for(var r=0;r<e.length;++r){var n=e[r];n._currentMeasure.left=n._customData._origLeft+t,n._currentMeasure.top=n._customData._origTop+i,n._isClipped=!1,n instanceof Ou&&0<n._children.length&&this._scrollChildren(n._children,t,i)}},Xc.prototype._scrollChildrenWithBuckets=function(e,t,i,r){for(var n=Math.max(0,Math.floor(-e/this._bucketWidth)),o=Math.floor((-e+this._parentMeasure.width-1)/this._bucketWidth),s=Math.max(0,Math.floor(-t/this._bucketHeight)),a=Math.floor((-t+this._parentMeasure.height-1)/this._bucketHeight);s<=a;){for(var h=n;h<=o;++h){var l=s*this._bucketLen+h,u=this._buckets[l];if(u)for(var c=0;c<u.length;++c){var d=u[c];d._currentMeasure.left=d._customData._origLeft+i,d._currentMeasure.top=d._customData._origTop+r,d._isClipped=!1}}s++}},Xc.prototype._draw=function(e,t){if(this._freezeControls){this._localDraw(e),this.clipChildren&&this._clipForChildren(e);var i=this.leftInPixels,r=this.topInPixels;this._useBuckets()?(this._scrollChildrenWithBuckets(this._oldLeft,this._oldTop,i,r),this._scrollChildrenWithBuckets(i,r,i,r)):this._scrollChildren(this._children,i,r),this._oldLeft=i,this._oldTop=r;for(var n=0,o=this._children;n<o.length;n++){var s=o[n];s._intersectsRect(this._parentMeasure)&&s._render(e,this._parentMeasure)}}else Wc.prototype._draw.call(this,e,t)},Xc.prototype._postMeasure=function(){if(this._freezeControls)Wc.prototype._postMeasure.call(this);else{for(var e=this.parentClientWidth,t=this.parentClientHeight,i=0,r=this.children;i<r.length;i++){var n=r[i];n.isVisible&&!n.notRenderable&&(n.horizontalAlignment===Mu.HORIZONTAL_ALIGNMENT_CENTER&&n._offsetLeft(this._currentMeasure.left-n._currentMeasure.left),n.verticalAlignment===Mu.VERTICAL_ALIGNMENT_CENTER&&n._offsetTop(this._currentMeasure.top-n._currentMeasure.top),e=Math.max(e,n._currentMeasure.left-this._currentMeasure.left+n._currentMeasure.width),t=Math.max(t,n._currentMeasure.top-this._currentMeasure.top+n._currentMeasure.height))}this._currentMeasure.width!==e&&(this._width.updateInPlace(e,du.UNITMODE_PIXEL),this._currentMeasure.width=e,this._rebuildLayout=!0,this._isDirty=!0),this._currentMeasure.height!==t&&(this._height.updateInPlace(t,du.UNITMODE_PIXEL),this._currentMeasure.height=t,this._rebuildLayout=!0,this._isDirty=!0),Wc.prototype._postMeasure.call(this)}},Xc);function Xc(e){var t=Wc.call(this,e)||this;return t._freezeControls=!1,t._bucketWidth=0,t._bucketHeight=0,t._buckets={},t}var Hc,jc=(n(Kc,Hc=Pc),Object.defineProperty(Kc.prototype,"borderColor",{get:function(){return this._borderColor},set:function(e){this._borderColor!==e&&(this._borderColor=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Kc.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Kc.prototype._getTypeName=function(){return"Scrollbar"},Kc.prototype._getThumbThickness=function(){return this._thumbWidth.isPixel?this._thumbWidth.getValue(this._host):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host)},Kc.prototype._draw=function(e){e.save(),this._applyStates(e),this._prepareRenderingData("rectangle");var t=this._renderLeft,i=this._getThumbPosition();e.fillStyle=this._background,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height),e.fillStyle=this.color,this.isVertical?(this._tempMeasure.left=t-this._effectiveBarOffset,this._tempMeasure.top=this._currentMeasure.top+i,this._tempMeasure.width=this._currentMeasure.width,this._tempMeasure.height=this._effectiveThumbThickness):(this._tempMeasure.left=this._currentMeasure.left+i,this._tempMeasure.top=this._currentMeasure.top,this._tempMeasure.width=this._effectiveThumbThickness,this._tempMeasure.height=this._currentMeasure.height),e.fillRect(this._tempMeasure.left,this._tempMeasure.top,this._tempMeasure.width,this._tempMeasure.height),e.restore()},Kc.prototype._updateValueFromPointer=function(e,t){0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y),this._first&&(this._first=!1,this._originX=e,this._originY=t,(e<this._tempMeasure.left||e>this._tempMeasure.left+this._tempMeasure.width||t<this._tempMeasure.top||t>this._tempMeasure.top+this._tempMeasure.height)&&(this.isVertical?this.value=this.minimum+(1-(t-this._currentMeasure.top)/this._currentMeasure.height)*(this.maximum-this.minimum):this.value=this.minimum+(e-this._currentMeasure.left)/this._currentMeasure.width*(this.maximum-this.minimum)));var i=0,i=this.isVertical?-((t-this._originY)/(this._currentMeasure.height-this._effectiveThumbThickness)):(e-this._originX)/(this._currentMeasure.width-this._effectiveThumbThickness);this.value+=i*(this.maximum-this.minimum),this._originX=e,this._originY=t},Kc.prototype._onPointerDown=function(e,t,i,r){return this._first=!0,Hc.prototype._onPointerDown.call(this,e,t,i,r)},Kc);function Kc(e){var t=Hc.call(this,e)||this;return t.name=e,t._background="black",t._borderColor="white",t._tempMeasure=new vu(0,0,0,0),t}var Yc,qc=(n(Zc,Yc=Pc),Object.defineProperty(Zc.prototype,"backgroundImage",{get:function(){return this._backgroundBaseImage},set:function(t){var i=this;this._backgroundBaseImage!==t&&(this._backgroundBaseImage=t,this.isVertical&&0!==this.num90RotationInVerticalMode?t.isLoaded?(this._backgroundImage=t._rotate90(this.num90RotationInVerticalMode,!0),this._markAsDirty()):t.onImageLoadedObservable.addOnce(function(){var e=t._rotate90(i.num90RotationInVerticalMode,!0);(i._backgroundImage=e).isLoaded||e.onImageLoadedObservable.addOnce(function(){i._markAsDirty()}),i._markAsDirty()}):((this._backgroundImage=t)&&!t.isLoaded&&t.onImageLoadedObservable.addOnce(function(){i._markAsDirty()}),this._markAsDirty()))},enumerable:!0,configurable:!0}),Object.defineProperty(Zc.prototype,"thumbImage",{get:function(){return this._thumbBaseImage},set:function(t){var i=this;this._thumbBaseImage!==t&&(this._thumbBaseImage=t,this.isVertical&&0!==this.num90RotationInVerticalMode?t.isLoaded?(this._thumbImage=t._rotate90(-this.num90RotationInVerticalMode,!0),this._markAsDirty()):t.onImageLoadedObservable.addOnce(function(){var e=t._rotate90(-i.num90RotationInVerticalMode,!0);(i._thumbImage=e).isLoaded||e.onImageLoadedObservable.addOnce(function(){i._markAsDirty()}),i._markAsDirty()}):((this._thumbImage=t)&&!t.isLoaded&&t.onImageLoadedObservable.addOnce(function(){i._markAsDirty()}),this._markAsDirty()))},enumerable:!0,configurable:!0}),Object.defineProperty(Zc.prototype,"thumbLength",{get:function(){return this._thumbLength},set:function(e){this._thumbLength!==e&&(this._thumbLength=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Zc.prototype,"thumbHeight",{get:function(){return this._thumbHeight},set:function(e){this._thumbLength!==e&&(this._thumbHeight=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Zc.prototype,"barImageHeight",{get:function(){return this._barImageHeight},set:function(e){this._barImageHeight!==e&&(this._barImageHeight=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Zc.prototype._getTypeName=function(){return"ImageScrollBar"},Zc.prototype._getThumbThickness=function(){return this._thumbWidth.isPixel?this._thumbWidth.getValue(this._host):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host)},Zc.prototype._draw=function(e){e.save(),this._applyStates(e),this._prepareRenderingData("rectangle");var t=this._getThumbPosition(),i=this._renderLeft,r=this._renderTop,n=this._renderWidth,o=this._renderHeight;this._backgroundImage&&(this._tempMeasure.copyFromFloats(i,r,n,o),this.isVertical?(this._tempMeasure.copyFromFloats(i+n*(1-this._barImageHeight)*.5,this._currentMeasure.top,n*this._barImageHeight,o),this._tempMeasure.height+=this._effectiveThumbThickness):(this._tempMeasure.copyFromFloats(this._currentMeasure.left,r+o*(1-this._barImageHeight)*.5,n,o*this._barImageHeight),this._tempMeasure.width+=this._effectiveThumbThickness),this._backgroundImage._currentMeasure.copyFrom(this._tempMeasure),this._backgroundImage._draw(e)),this.isVertical?this._tempMeasure.copyFromFloats(i-this._effectiveBarOffset+this._currentMeasure.width*(1-this._thumbHeight)*.5,this._currentMeasure.top+t,this._currentMeasure.width*this._thumbHeight,this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(this._currentMeasure.left+t,this._currentMeasure.top+this._currentMeasure.height*(1-this._thumbHeight)*.5,this._effectiveThumbThickness,this._currentMeasure.height*this._thumbHeight),this._thumbImage&&(this._thumbImage._currentMeasure.copyFrom(this._tempMeasure),this._thumbImage._draw(e)),e.restore()},Zc.prototype._updateValueFromPointer=function(e,t){0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y),this._first&&(this._first=!1,this._originX=e,this._originY=t,(e<this._tempMeasure.left||e>this._tempMeasure.left+this._tempMeasure.width||t<this._tempMeasure.top||t>this._tempMeasure.top+this._tempMeasure.height)&&(this.isVertical?this.value=this.minimum+(1-(t-this._currentMeasure.top)/this._currentMeasure.height)*(this.maximum-this.minimum):this.value=this.minimum+(e-this._currentMeasure.left)/this._currentMeasure.width*(this.maximum-this.minimum)));var i=0,i=this.isVertical?-((t-this._originY)/(this._currentMeasure.height-this._effectiveThumbThickness)):(e-this._originX)/(this._currentMeasure.width-this._effectiveThumbThickness);this.value+=i*(this.maximum-this.minimum),this._originX=e,this._originY=t},Zc.prototype._onPointerDown=function(e,t,i,r){return this._first=!0,Yc.prototype._onPointerDown.call(this,e,t,i,r)},Zc);function Zc(e){var t=Yc.call(this,e)||this;return t.name=e,t._thumbLength=.5,t._thumbHeight=1,t._barImageHeight=1,t._tempMeasure=new vu(0,0,0,0),t.num90RotationInVerticalMode=1,t}var Qc,Jc=(n($c,Qc=wu),Object.defineProperty($c.prototype,"horizontalBar",{get:function(){return this._horizontalBar},enumerable:!0,configurable:!0}),Object.defineProperty($c.prototype,"verticalBar",{get:function(){return this._verticalBar},enumerable:!0,configurable:!0}),$c.prototype.addControl=function(e){return e&&this._window.addControl(e),this},$c.prototype.removeControl=function(e){return this._window.removeControl(e),this},Object.defineProperty($c.prototype,"children",{get:function(){return this._window.children},enumerable:!0,configurable:!0}),$c.prototype._flagDescendantsAsMatrixDirty=function(){for(var e=0,t=this._children;e<t.length;e++)t[e]._markMatrixAsDirty()},Object.defineProperty($c.prototype,"freezeControls",{get:function(){return this._window.freezeControls},set:function(e){this._window.freezeControls=e},enumerable:!0,configurable:!0}),Object.defineProperty($c.prototype,"bucketWidth",{get:function(){return this._window.bucketWidth},enumerable:!0,configurable:!0}),Object.defineProperty($c.prototype,"bucketHeight",{get:function(){return this._window.bucketHeight},enumerable:!0,configurable:!0}),$c.prototype.setBucketSizes=function(e,t){this._window.setBucketSizes(e,t)},Object.defineProperty($c.prototype,"forceHorizontalBar",{get:function(){return this._forceHorizontalBar},set:function(e){this._grid.setRowDefinition(1,e?this._barSize:0,!0),this._horizontalBar.isVisible=e,this._forceHorizontalBar=e},enumerable:!0,configurable:!0}),Object.defineProperty($c.prototype,"forceVerticalBar",{get:function(){return this._forceVerticalBar},set:function(e){this._grid.setColumnDefinition(1,e?this._barSize:0,!0),this._verticalBar.isVisible=e,this._forceVerticalBar=e},enumerable:!0,configurable:!0}),$c.prototype.resetWindow=function(){this._window.width="100%",this._window.height="100%"},$c.prototype._getTypeName=function(){return"ScrollViewer"},$c.prototype._buildClientSizes=function(){var e=this.host.idealRatio;this._window.parentClientWidth=this._currentMeasure.width-(this._verticalBar.isVisible||this.forceVerticalBar?this._barSize*e:0)-2*this.thickness,this._window.parentClientHeight=this._currentMeasure.height-(this._horizontalBar.isVisible||this.forceHorizontalBar?this._barSize*e:0)-2*this.thickness,this._clientWidth=this._window.parentClientWidth,this._clientHeight=this._window.parentClientHeight},$c.prototype._additionalProcessing=function(e,t){Qc.prototype._additionalProcessing.call(this,e,t),this._buildClientSizes()},$c.prototype._postMeasure=function(){Qc.prototype._postMeasure.call(this),this._updateScroller()},Object.defineProperty($c.prototype,"wheelPrecision",{get:function(){return this._wheelPrecision},set:function(e){this._wheelPrecision!==e&&(e<0&&(e=0),1<e&&(e=1),this._wheelPrecision=e)},enumerable:!0,configurable:!0}),Object.defineProperty($c.prototype,"scrollBackground",{get:function(){return this._horizontalBarSpace.background},set:function(e){this._horizontalBarSpace.background!==e&&(this._horizontalBarSpace.background=e,this._verticalBarSpace.background=e)},enumerable:!0,configurable:!0}),Object.defineProperty($c.prototype,"barColor",{get:function(){return this._barColor},set:function(e){this._barColor!==e&&(this._barColor=e,this._horizontalBar.color=e,this._verticalBar.color=e)},enumerable:!0,configurable:!0}),Object.defineProperty($c.prototype,"thumbImage",{get:function(){return this._barImage},set:function(e){var t,i;this._barImage!==e&&(this._barImage=e,t=this._horizontalBar,i=this._verticalBar,t.thumbImage=e,i.thumbImage=e)},enumerable:!0,configurable:!0}),Object.defineProperty($c.prototype,"horizontalThumbImage",{get:function(){return this._horizontalBarImage},set:function(e){this._horizontalBarImage!==e&&(this._horizontalBarImage=e,this._horizontalBar.thumbImage=e)},enumerable:!0,configurable:!0}),Object.defineProperty($c.prototype,"verticalThumbImage",{get:function(){return this._verticalBarImage},set:function(e){this._verticalBarImage!==e&&(this._verticalBarImage=e,this._verticalBar.thumbImage=e)},enumerable:!0,configurable:!0}),Object.defineProperty($c.prototype,"barSize",{get:function(){return this._barSize},set:function(e){this._barSize!==e&&(this._barSize=e,this._markAsDirty(),this._horizontalBar.isVisible&&this._grid.setRowDefinition(1,this._barSize,!0),this._verticalBar.isVisible&&this._grid.setColumnDefinition(1,this._barSize,!0))},enumerable:!0,configurable:!0}),Object.defineProperty($c.prototype,"thumbLength",{get:function(){return this._thumbLength},set:function(e){var t,i;this._thumbLength!==e&&(e<=0&&(e=.1),1<e&&(e=1),this._thumbLength=e,t=this._horizontalBar,i=this._verticalBar,t.thumbLength=e,i.thumbLength=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty($c.prototype,"thumbHeight",{get:function(){return this._thumbHeight},set:function(e){var t,i;this._thumbHeight!==e&&(e<=0&&(e=.1),1<e&&(e=1),this._thumbHeight=e,t=this._horizontalBar,i=this._verticalBar,t.thumbHeight=e,i.thumbHeight=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty($c.prototype,"barImageHeight",{get:function(){return this._barImageHeight},set:function(e){var t,i;this._barImageHeight!==e&&(e<=0&&(e=.1),1<e&&(e=1),this._barImageHeight=e,t=this._horizontalBar,i=this._verticalBar,t.barImageHeight=e,i.barImageHeight=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty($c.prototype,"horizontalBarImageHeight",{get:function(){return this._horizontalBarImageHeight},set:function(e){this._horizontalBarImageHeight!==e&&(e<=0&&(e=.1),1<e&&(e=1),this._horizontalBarImageHeight=e,this._horizontalBar.barImageHeight=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty($c.prototype,"verticalBarImageHeight",{get:function(){return this._verticalBarImageHeight},set:function(e){this._verticalBarImageHeight!==e&&(e<=0&&(e=.1),1<e&&(e=1),this._verticalBarImageHeight=e,this._verticalBar.barImageHeight=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty($c.prototype,"barBackground",{get:function(){return this._barBackground},set:function(e){var t,i;this._barBackground!==e&&(this._barBackground=e,t=this._horizontalBar,i=this._verticalBar,t.background=e,i.background=e,this._dragSpace.background=e)},enumerable:!0,configurable:!0}),Object.defineProperty($c.prototype,"barImage",{get:function(){return this._barBackgroundImage},set:function(e){this._barBackgroundImage,this._barBackgroundImage=e;var t=this._horizontalBar,i=this._verticalBar;t.backgroundImage=e,i.backgroundImage=e},enumerable:!0,configurable:!0}),Object.defineProperty($c.prototype,"horizontalBarImage",{get:function(){return this._horizontalBarBackgroundImage},set:function(e){this._horizontalBarBackgroundImage,this._horizontalBarBackgroundImage=e,this._horizontalBar.backgroundImage=e},enumerable:!0,configurable:!0}),Object.defineProperty($c.prototype,"verticalBarImage",{get:function(){return this._verticalBarBackgroundImage},set:function(e){this._verticalBarBackgroundImage,this._verticalBarBackgroundImage=e,this._verticalBar.backgroundImage=e},enumerable:!0,configurable:!0}),$c.prototype._setWindowPosition=function(){var e=this.host.idealRatio,t=this._window._currentMeasure.width,i=this._window._currentMeasure.height,r=this._clientWidth-t,n=this._clientHeight-i,o=this._horizontalBar.value/e*r+"px",s=this._verticalBar.value/e*n+"px";o!==this._window.left&&(this._window.left=o,this.freezeControls||(this._rebuildLayout=!0)),s!==this._window.top&&(this._window.top=s,this.freezeControls||(this._rebuildLayout=!0))},$c.prototype._updateScroller=function(){var e=this._window._currentMeasure.width,t=this._window._currentMeasure.height;this._horizontalBar.isVisible&&e<=this._clientWidth&&!this.forceHorizontalBar?(this._grid.setRowDefinition(1,0,!0),this._horizontalBar.isVisible=!1,this._horizontalBar.value=0,this._rebuildLayout=!0):!this._horizontalBar.isVisible&&(e>this._clientWidth||this.forceHorizontalBar)&&(this._grid.setRowDefinition(1,this._barSize,!0),this._horizontalBar.isVisible=!0,this._rebuildLayout=!0),this._verticalBar.isVisible&&t<=this._clientHeight&&!this.forceVerticalBar?(this._grid.setColumnDefinition(1,0,!0),this._verticalBar.isVisible=!1,this._verticalBar.value=0,this._rebuildLayout=!0):!this._verticalBar.isVisible&&(t>this._clientHeight||this.forceVerticalBar)&&(this._grid.setColumnDefinition(1,this._barSize,!0),this._verticalBar.isVisible=!0,this._rebuildLayout=!0),this._buildClientSizes();var i=this.host.idealRatio;this._horizontalBar.thumbWidth=.9*this._thumbLength*(this._clientWidth/i)+"px",this._verticalBar.thumbWidth=.9*this._thumbLength*(this._clientHeight/i)+"px"},$c.prototype._link=function(e){Qc.prototype._link.call(this,e),this._attachWheel()},$c.prototype._addBar=function(e,t,i,r){var n=this;e.paddingLeft=0,e.width="100%",e.height="100%",e.barOffset=0,e.value=0,e.maximum=1,e.horizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_CENTER,e.verticalAlignment=Mu.VERTICAL_ALIGNMENT_CENTER,e.isVertical=i,e.rotation=r,e.isVisible=!1,t.addControl(e),e.onValueChangedObservable.add(function(e){n._setWindowPosition()})},$c.prototype._attachWheel=function(){var t=this;this._host&&!this._onWheelObserver&&(this._onWheelObserver=this.onWheelObservable.add(function(e){t._pointerIsOver&&(1==t._verticalBar.isVisible&&(e.y<0&&0<t._verticalBar.value?t._verticalBar.value-=t._wheelPrecision:0<e.y&&t._verticalBar.value<t._verticalBar.maximum&&(t._verticalBar.value+=t._wheelPrecision)),1==t._horizontalBar.isVisible&&(e.x<0&&t._horizontalBar.value<t._horizontalBar.maximum?t._horizontalBar.value+=t._wheelPrecision:0<e.x&&0<t._horizontalBar.value&&(t._horizontalBar.value-=t._wheelPrecision)))}))},$c.prototype._renderHighlightSpecific=function(e){this.isHighlighted&&(Qc.prototype._renderHighlightSpecific.call(this,e),this._grid._renderHighlightSpecific(e),e.restore())},$c.prototype.dispose=function(){this.onWheelObservable.remove(this._onWheelObserver),this._onWheelObserver=null,Qc.prototype.dispose.call(this)},$c);function $c(e,t){var i=Qc.call(this,e)||this;return i._barSize=20,i._pointerIsOver=!1,i._wheelPrecision=.05,i._thumbLength=.5,i._thumbHeight=1,i._barImageHeight=1,i._horizontalBarImageHeight=1,i._verticalBarImageHeight=1,i._forceHorizontalBar=!1,i._forceVerticalBar=!1,i._useImageBar=t||!1,i.onDirtyObservable.add(function(){i._horizontalBarSpace.color=i.color,i._verticalBarSpace.color=i.color,i._dragSpace.color=i.color}),i.onPointerEnterObservable.add(function(){i._pointerIsOver=!0}),i.onPointerOutObservable.add(function(){i._pointerIsOver=!1}),i._grid=new nc,i._useImageBar?(i._horizontalBar=new qc,i._verticalBar=new qc):(i._horizontalBar=new jc,i._verticalBar=new jc),i._window=new Gc("scrollViewer_window"),i._window.horizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_LEFT,i._window.verticalAlignment=Mu.VERTICAL_ALIGNMENT_TOP,i._grid.addColumnDefinition(1),i._grid.addColumnDefinition(0,!0),i._grid.addRowDefinition(1),i._grid.addRowDefinition(0,!0),Qc.prototype.addControl.call(i,i._grid),i._grid.addControl(i._window,0,0),i._verticalBarSpace=new wu,i._verticalBarSpace.horizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_LEFT,i._verticalBarSpace.verticalAlignment=Mu.VERTICAL_ALIGNMENT_TOP,i._verticalBarSpace.thickness=1,i._grid.addControl(i._verticalBarSpace,0,1),i._addBar(i._verticalBar,i._verticalBarSpace,!0,Math.PI),i._horizontalBarSpace=new wu,i._horizontalBarSpace.horizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_LEFT,i._horizontalBarSpace.verticalAlignment=Mu.VERTICAL_ALIGNMENT_TOP,i._horizontalBarSpace.thickness=1,i._grid.addControl(i._horizontalBarSpace,1,0),i._addBar(i._horizontalBar,i._horizontalBarSpace,!1,0),i._dragSpace=new wu,i._dragSpace.thickness=1,i._grid.addControl(i._dragSpace,1,1),i._useImageBar||(i.barColor="grey",i.barBackground="transparent"),i}m.RegisteredTypes["BABYLON.GUI.ScrollViewer"]=Jc;var ed,td=(n(id,ed=Hu),id.prototype._getTypeName=function(){return"VirtualKeyboard"},id.prototype._createKey=function(e,t){var i=this,r=Wu.CreateSimpleButton(e,e);return r.width=t&&t.width?t.width:this.defaultButtonWidth,r.height=t&&t.height?t.height:this.defaultButtonHeight,r.color=t&&t.color?t.color:this.defaultButtonColor,r.background=t&&t.background?t.background:this.defaultButtonBackground,r.paddingLeft=t&&t.paddingLeft?t.paddingLeft:this.defaultButtonPaddingLeft,r.paddingRight=t&&t.paddingRight?t.paddingRight:this.defaultButtonPaddingRight,r.paddingTop=t&&t.paddingTop?t.paddingTop:this.defaultButtonPaddingTop,r.paddingBottom=t&&t.paddingBottom?t.paddingBottom:this.defaultButtonPaddingBottom,r.thickness=0,r.isFocusInvisible=!0,r.shadowColor=this.shadowColor,r.shadowBlur=this.shadowBlur,r.shadowOffsetX=this.shadowOffsetX,r.shadowOffsetY=this.shadowOffsetY,r.onPointerUpObservable.add(function(){i.onKeyPressObservable.notifyObservers(e)}),r},id.prototype.addKeysRow=function(e,t){var i=new Hu;i.isVertical=!1,i.isFocusInvisible=!0;for(var r=null,n=0;n<e.length;n++){var o=null;t&&t.length===e.length&&(o=t[n]);var s=this._createKey(e[n],o);(!r||s.heightInPixels>r.heightInPixels)&&(r=s),i.addControl(s)}i.height=r?r.height:this.defaultButtonHeight,this.addControl(i)},id.prototype.applyShiftState=function(e){if(this.children)for(var t=0;t<this.children.length;t++){var i=this.children[t];if(i&&i.children)for(var r=i,n=0;n<r.children.length;n++){var o,s=r.children[n];s&&s.children[0]&&(""===(o=s.children[0]).text&&(s.color=e?this.shiftButtonColor:this.defaultButtonColor,s.thickness=1<e?this.selectedShiftThickness:0),o.text=0<e?o.text.toUpperCase():o.text.toLowerCase())}}},Object.defineProperty(id.prototype,"connectedInputText",{get:function(){return this._currentlyConnectedInputText},enumerable:!0,configurable:!0}),id.prototype.connect=function(t){var e,i,r=this;this._connectedInputTexts.some(function(e){return e.input===t})||(null===this._onKeyPressObserver&&(this._onKeyPressObserver=this.onKeyPressObservable.add(function(e){if(r._currentlyConnectedInputText){switch(r._currentlyConnectedInputText._host.focusedControl=r._currentlyConnectedInputText,e){case"":return r.shiftState++,2<r.shiftState&&(r.shiftState=0),void r.applyShiftState(r.shiftState);case"":return void r._currentlyConnectedInputText.processKey(8);case"":return void r._currentlyConnectedInputText.processKey(13)}r._currentlyConnectedInputText.processKey(-1,r.shiftState?e.toUpperCase():e),1===r.shiftState&&(r.shiftState=0,r.applyShiftState(r.shiftState))}})),this.isVisible=!1,(this._currentlyConnectedInputText=t)._connectedVirtualKeyboard=this,e=t.onFocusObservable.add(function(){((r._currentlyConnectedInputText=t)._connectedVirtualKeyboard=r).isVisible=!0}),i=t.onBlurObservable.add(function(){t._connectedVirtualKeyboard=null,r._currentlyConnectedInputText=null,r.isVisible=!1}),this._connectedInputTexts.push({input:t,onBlurObserver:i,onFocusObserver:e}))},id.prototype.disconnect=function(t){var e,i=this;t?1===(e=this._connectedInputTexts.filter(function(e){return e.input===t})).length&&(this._removeConnectedInputObservables(e[0]),this._connectedInputTexts=this._connectedInputTexts.filter(function(e){return e.input!==t}),this._currentlyConnectedInputText===t&&(this._currentlyConnectedInputText=null)):(this._connectedInputTexts.forEach(function(e){i._removeConnectedInputObservables(e)}),this._connectedInputTexts=[]),0===this._connectedInputTexts.length&&(this._currentlyConnectedInputText=null,this.onKeyPressObservable.remove(this._onKeyPressObserver),this._onKeyPressObserver=null)},id.prototype._removeConnectedInputObservables=function(e){e.input._connectedVirtualKeyboard=null,e.input.onFocusObservable.remove(e.onFocusObserver),e.input.onBlurObservable.remove(e.onBlurObserver)},id.prototype.dispose=function(){ed.prototype.dispose.call(this),this.disconnect()},id.CreateDefaultLayout=function(e){var t=new id(e);return t.addKeysRow(["1","2","3","4","5","6","7","8","9","0",""]),t.addKeysRow(["q","w","e","r","t","y","u","i","o","p"]),t.addKeysRow(["a","s","d","f","g","h","j","k","l",";","'",""]),t.addKeysRow(["","z","x","c","v","b","n","m",",",".","/"]),t.addKeysRow([" "],[{width:"200px"}]),t},id);function id(){var e=null!==ed&&ed.apply(this,arguments)||this;return e.onKeyPressObservable=new le,e.defaultButtonWidth="40px",e.defaultButtonHeight="40px",e.defaultButtonPaddingLeft="2px",e.defaultButtonPaddingRight="2px",e.defaultButtonPaddingTop="2px",e.defaultButtonPaddingBottom="2px",e.defaultButtonColor="#DDD",e.defaultButtonBackground="#070707",e.shiftButtonColor="#7799FF",e.selectedShiftThickness=1,e.shiftState=0,e._currentlyConnectedInputText=null,e._connectedInputTexts=[],e._onKeyPressObserver=null,e}m.RegisteredTypes["BABYLON.GUI.VirtualKeyboard"]=td;var rd,nd=(n(od,rd=Mu),Object.defineProperty(od.prototype,"displayMinorLines",{get:function(){return this._displayMinorLines},set:function(e){this._displayMinorLines!==e&&(this._displayMinorLines=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(od.prototype,"displayMajorLines",{get:function(){return this._displayMajorLines},set:function(e){this._displayMajorLines!==e&&(this._displayMajorLines=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(od.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(od.prototype,"cellWidth",{get:function(){return this._cellWidth},set:function(e){this._cellWidth=e,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(od.prototype,"cellHeight",{get:function(){return this._cellHeight},set:function(e){this._cellHeight=e,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(od.prototype,"minorLineTickness",{get:function(){return this._minorLineTickness},set:function(e){this._minorLineTickness=e,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(od.prototype,"minorLineColor",{get:function(){return this._minorLineColor},set:function(e){this._minorLineColor=e,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(od.prototype,"majorLineTickness",{get:function(){return this._majorLineTickness},set:function(e){this._majorLineTickness=e,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(od.prototype,"majorLineColor",{get:function(){return this._majorLineColor},set:function(e){this._majorLineColor=e,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(od.prototype,"majorLineFrequency",{get:function(){return this._majorLineFrequency},set:function(e){this._majorLineFrequency=e,this._markAsDirty()},enumerable:!0,configurable:!0}),od.prototype._draw=function(e,t){if(e.save(),this._applyStates(e),this._isEnabled){this._background&&(e.fillStyle=this._background,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height));var i=this._currentMeasure.width/this._cellWidth,r=this._currentMeasure.height/this._cellHeight,n=this._currentMeasure.left+this._currentMeasure.width/2,o=this._currentMeasure.top+this._currentMeasure.height/2;if(this._displayMinorLines){e.strokeStyle=this._minorLineColor,e.lineWidth=this._minorLineTickness;for(var s=-i/2;s<i/2;s++){var a=n+s*this.cellWidth;e.beginPath(),e.moveTo(a,this._currentMeasure.top),e.lineTo(a,this._currentMeasure.top+this._currentMeasure.height),e.stroke()}for(var h=-r/2;h<r/2;h++){var l=o+h*this.cellHeight;e.beginPath(),e.moveTo(this._currentMeasure.left,l),e.lineTo(this._currentMeasure.left+this._currentMeasure.width,l),e.stroke()}}if(this._displayMajorLines){for(e.strokeStyle=this._majorLineColor,e.lineWidth=this._majorLineTickness,s=-i/2+this._majorLineFrequency;s<i/2;s+=this._majorLineFrequency)a=n+s*this.cellWidth,e.beginPath(),e.moveTo(a,this._currentMeasure.top),e.lineTo(a,this._currentMeasure.top+this._currentMeasure.height),e.stroke();for(h=-r/2+this._majorLineFrequency;h<r/2;h+=this._majorLineFrequency)l=o+h*this.cellHeight,e.moveTo(this._currentMeasure.left,l),e.lineTo(this._currentMeasure.left+this._currentMeasure.width,l),e.closePath(),e.stroke()}}e.restore()},od.prototype._getTypeName=function(){return"DisplayGrid"},od);function od(e){var t=rd.call(this,e)||this;return t.name=e,t._cellWidth=20,t._cellHeight=20,t._minorLineTickness=1,t._minorLineColor="DarkGray",t._majorLineTickness=2,t._majorLineColor="White",t._majorLineFrequency=5,t._background="Black",t._displayMajorLines=!0,t._displayMinorLines=!0,t}m.RegisteredTypes["BABYLON.GUI.DisplayGrid"]=nd;var sd,ad=(n(hd,sd=Pc),Object.defineProperty(hd.prototype,"displayThumb",{get:function(){return this._displayThumb&&null!=this.thumbImage},set:function(e){this._displayThumb!==e&&(this._displayThumb=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(hd.prototype,"backgroundImage",{get:function(){return this._backgroundImage},set:function(e){var t=this;this._backgroundImage!==e&&((this._backgroundImage=e)&&!e.isLoaded&&e.onImageLoadedObservable.addOnce(function(){return t._markAsDirty()}),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(hd.prototype,"valueBarImage",{get:function(){return this._valueBarImage},set:function(e){var t=this;this._valueBarImage!==e&&((this._valueBarImage=e)&&!e.isLoaded&&e.onImageLoadedObservable.addOnce(function(){return t._markAsDirty()}),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(hd.prototype,"thumbImage",{get:function(){return this._thumbImage},set:function(e){var t=this;this._thumbImage!==e&&((this._thumbImage=e)&&!e.isLoaded&&e.onImageLoadedObservable.addOnce(function(){return t._markAsDirty()}),this._markAsDirty())},enumerable:!0,configurable:!0}),hd.prototype._getTypeName=function(){return"ImageBasedSlider"},hd.prototype._draw=function(e,t){e.save(),this._applyStates(e),this._prepareRenderingData("rectangle");var i=this._getThumbPosition(),r=this._renderLeft,n=this._renderTop,o=this._renderWidth,s=this._renderHeight;this._backgroundImage&&(this._tempMeasure.copyFromFloats(r,n,o,s),this.isThumbClamped&&this.displayThumb&&(this.isVertical?this._tempMeasure.height+=this._effectiveThumbThickness:this._tempMeasure.width+=this._effectiveThumbThickness),this._backgroundImage._currentMeasure.copyFrom(this._tempMeasure),this._backgroundImage._draw(e)),this._valueBarImage&&(this.isVertical?this.isThumbClamped&&this.displayThumb?this._tempMeasure.copyFromFloats(r,n+i,o,s-i+this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(r,n+i,o,s-i):this.isThumbClamped&&this.displayThumb?this._tempMeasure.copyFromFloats(r,n,i+this._effectiveThumbThickness/2,s):this._tempMeasure.copyFromFloats(r,n,i,s),this._valueBarImage._currentMeasure.copyFrom(this._tempMeasure),this._valueBarImage._draw(e)),this.displayThumb&&(this.isVertical?this._tempMeasure.copyFromFloats(r-this._effectiveBarOffset,this._currentMeasure.top+i,this._currentMeasure.width,this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(this._currentMeasure.left+i,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height),this._thumbImage._currentMeasure.copyFrom(this._tempMeasure),this._thumbImage._draw(e)),e.restore()},hd);function hd(e){var t=sd.call(this,e)||this;return t.name=e,t._tempMeasure=new vu(0,0,0,0),t}m.RegisteredTypes["BABYLON.GUI.ImageBasedSlider"]=ad;Mu.AddHeader=function(e,t,i,r){var n=new Hu("panel"),o=!r||r.isHorizontal,s=!r||r.controlFirst;n.isVertical=!o;var a=new Nu("header");return a.text=t,a.textHorizontalAlignment=Mu.HORIZONTAL_ALIGNMENT_LEFT,o?a.width=i:a.height=i,s?(n.addControl(e),n.addControl(a),a.paddingLeft="5px"):(n.addControl(a),n.addControl(e),a.paddingRight="5px"),a.shadowBlur=e.shadowBlur,a.shadowColor=e.shadowColor,a.shadowOffsetX=e.shadowOffsetX,a.shadowOffsetY=e.shadowOffsetY,n},Rt.prototype.createDynamicTexture=function(e,t,i,r){var n=new mt(this,pt.Dynamic);return n.baseWidth=e,n.baseHeight=t,i&&(e=this.needPOTTextures?Rt.GetExponentOfTwo(e,this._caps.maxTextureSize):e,t=this.needPOTTextures?Rt.GetExponentOfTwo(t,this._caps.maxTextureSize):t),n.width=e,n.height=t,n.isReady=!1,n.generateMipMaps=i,n.samplingMode=r,this.updateTextureSamplingMode(r,n),this._internalTexturesCache.push(n),n},Rt.prototype.updateDynamicTexture=function(e,t,i,r,n,o){var s;void 0===r&&(r=!1),void 0===o&&(o=!1),e&&(this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0,o),this._unpackFlipY(i),r&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),s=n?this._getInternalFormat(n):this._gl.RGBA,this._gl.texImage2D(this._gl.TEXTURE_2D,0,s,s,this._gl.UNSIGNED_BYTE,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),r&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),e.isReady=!0)};var ld,ud=(n(cd,ld=Pn),cd.prototype.getClassName=function(){return"DynamicTexture"},Object.defineProperty(cd.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),cd.prototype._recreate=function(e){this._canvas.width=e.width,this._canvas.height=e.height,this.releaseInternalTexture(),this._texture=this._engine.createDynamicTexture(e.width,e.height,this._generateMipMaps,this.samplingMode)},cd.prototype.scale=function(e){var t=this.getSize();t.width*=e,t.height*=e,this._recreate(t)},cd.prototype.scaleTo=function(e,t){var i=this.getSize();i.width=e,i.height=t,this._recreate(i)},cd.prototype.getContext=function(){return this._context},cd.prototype.clear=function(){var e=this.getSize();this._context.fillRect(0,0,e.width,e.height)},cd.prototype.update=function(e,t){void 0===t&&(t=!1),this._engine.updateDynamicTexture(this._texture,this._canvas,void 0===e||e,t,this._format||void 0)},cd.prototype.drawText=function(e,t,i,r,n,o,s,a){void 0===a&&(a=!0);var h,l,u=this.getSize();o&&(this._context.fillStyle=o,this._context.fillRect(0,0,u.width,u.height)),this._context.font=r,null==t&&(h=this._context.measureText(e),t=(u.width-h.width)/2),null==i&&(l=parseInt(r.replace(/\D/g,"")),i=u.height/2+l/3.65),this._context.fillStyle=n,this._context.fillText(e,t,i),a&&this.update(s)},cd.prototype.clone=function(){var e=this.getScene();if(!e)return this;var t=this.getSize(),i=new cd(this.name,t,e,this._generateMipMaps);return i.hasAlpha=this.hasAlpha,i.level=this.level,i.wrapU=this.wrapU,i.wrapV=this.wrapV,i},cd.prototype.serialize=function(){var e=this.getScene();e&&!e.isReady()&&fe.Warn("The scene must be ready before serializing the dynamic texture");var t=ld.prototype.serialize.call(this);return this._canvas.toDataURL&&(t.base64String=this._canvas.toDataURL()),t.invertY=this._invertY,t.samplingMode=this.samplingMode,t},cd.prototype._rebuild=function(){this.update()},cd);function cd(e,t,i,r,n,o){void 0===i&&(i=null),void 0===n&&(n=3),void 0===o&&(o=5);var s=ld.call(this,null,i,!r,void 0,n,void 0,void 0,void 0,void 0,o)||this;s.name=e,s._engine=s.getScene().getEngine(),s.wrapU=Pn.CLAMP_ADDRESSMODE,s.wrapV=Pn.CLAMP_ADDRESSMODE,s._generateMipMaps=r,t.getContext?(s._canvas=t,s._texture=s._engine.createDynamicTexture(t.width,t.height,r,n)):(s._canvas=Ot.CreateCanvas(1,1),t.width||0===t.width?s._texture=s._engine.createDynamicTexture(t.width,t.height,r,n):s._texture=s._engine.createDynamicTexture(t,t,r,n));var a=s.getSize();return s._canvas.width=a.width,s._canvas.height=a.height,s._context=s._canvas.getContext("2d"),s}var dd=(fd.prototype.register=function(){this.scene._beforeCameraDrawStage.registerStep(Ur.STEP_BEFORECAMERADRAW_LAYER,this,this._drawCameraBackground),this.scene._afterCameraDrawStage.registerStep(Ur.STEP_AFTERCAMERADRAW_LAYER,this,this._drawCameraForeground),this.scene._beforeRenderTargetDrawStage.registerStep(Ur.STEP_BEFORERENDERTARGETDRAW_LAYER,this,this._drawRenderTargetBackground),this.scene._afterRenderTargetDrawStage.registerStep(Ur.STEP_AFTERRENDERTARGETDRAW_LAYER,this,this._drawRenderTargetForeground)},fd.prototype.rebuild=function(){for(var e=0,t=this.scene.layers;e<t.length;e++)t[e]._rebuild()},fd.prototype.dispose=function(){for(var e=this.scene.layers;e.length;)e[0].dispose()},fd.prototype._draw=function(e){var t=this.scene.layers;if(t.length){this._engine.setDepthBuffer(!1);for(var i=0,r=t;i<r.length;i++){var n=r[i];e(n)&&n.render()}this._engine.setDepthBuffer(!0)}},fd.prototype._drawCameraPredicate=function(e,t,i){return!e.renderOnlyInRenderTargetTextures&&e.isBackground===t&&0!=(e.layerMask&i)},fd.prototype._drawCameraBackground=function(t){var i=this;this._draw(function(e){return i._drawCameraPredicate(e,!0,t.layerMask)})},fd.prototype._drawCameraForeground=function(t){var i=this;this._draw(function(e){return i._drawCameraPredicate(e,!1,t.layerMask)})},fd.prototype._drawRenderTargetPredicate=function(e,t,i,r){return 0<e.renderTargetTextures.length&&e.isBackground===t&&-1<e.renderTargetTextures.indexOf(r)&&0!=(e.layerMask&i)},fd.prototype._drawRenderTargetBackground=function(t){var i=this;this._draw(function(e){return i._drawRenderTargetPredicate(e,!0,i.scene.activeCamera.layerMask,t)})},fd.prototype._drawRenderTargetForeground=function(t){var i=this;this._draw(function(e){return i._drawRenderTargetPredicate(e,!1,i.scene.activeCamera.layerMask,t)})},fd.prototype.addFromContainer=function(e){var t=this;e.layers&&e.layers.forEach(function(e){t.scene.layers.push(e)})},fd.prototype.removeFromContainer=function(e,i){var r=this;void 0===i&&(i=!1),e.layers&&e.layers.forEach(function(e){var t=r.scene.layers.indexOf(e);-1!==t&&r.scene.layers.splice(t,1),i&&e.dispose()})},fd);function fd(e){this.name=Ur.NAME_LAYER,this.scene=e,this._engine=e.getEngine(),e.layers=new Array}var pd="layerPixelShader",_d="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\n\n#include<helperFunctions>\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\n#ifdef LINEAR\nbaseColor.rgb=toGammaSpace(baseColor.rgb);\n#endif\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=baseColor*color;\n}",gd=(st.ShadersStore[pd]=_d,"layerVertexShader"),md="\nattribute vec2 position;\n\nuniform vec2 scale;\nuniform vec2 offset;\nuniform mat4 textureMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvec2 shiftedPosition=position*scale+offset;\nvUV=vec2(textureMatrix*vec4(shiftedPosition*madd+madd,1.0,0.0));\ngl_Position=vec4(shiftedPosition,0.0,1.0);\n}",vd=(st.ShadersStore[gd]=md,Object.defineProperty(yd.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(yd.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(yd.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!0,configurable:!0}),yd.prototype._createIndexBuffer=function(){var e=this._scene.getEngine(),t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=e.createIndexBuffer(t)},yd.prototype._rebuild=function(){var e=this._vertexBuffers[Si.PositionKind];e&&e._rebuild(),this._createIndexBuffer()},yd.prototype.render=function(){var e=this._scene.getEngine(),t="";this.alphaTest&&(t="#define ALPHATEST"),this.texture&&!this.texture.gammaSpace&&(t+="\r\n#define LINEAR"),this._previousDefines!==t&&(this._previousDefines=t,this._effect=e.createEffect("layer",[Si.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],t));var i=this._effect;i&&i.isReady()&&this.texture&&this.texture.isReady()&&(e=this._scene.getEngine(),this.onBeforeRenderObservable.notifyObservers(this),e.enableEffect(i),e.setState(!1),i.setTexture("textureSampler",this.texture),i.setMatrix("textureMatrix",this.texture.getTextureMatrix()),i.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a),i.setVector2("offset",this.offset),i.setVector2("scale",this.scale),e.bindBuffers(this._vertexBuffers,this._indexBuffer,i),this.alphaTest?e.drawElementsType(Ir.TriangleFillMode,0,6):(e.setAlphaMode(this.alphaBlendingMode),e.drawElementsType(Ir.TriangleFillMode,0,6),e.setAlphaMode(0)),this.onAfterRenderObservable.notifyObservers(this))},yd.prototype.dispose=function(){var e=this._vertexBuffers[Si.PositionKind];e&&(e.dispose(),this._vertexBuffers[Si.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.texture&&(this.texture.dispose(),this.texture=null),this.renderTargetTextures=[];var t=this._scene.layers.indexOf(this);this._scene.layers.splice(t,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderObservable.clear()},yd);function yd(e,t,i,r,n){this.name=e,this.scale=new H(1,1),this.offset=new H(0,0),this.alphaBlendingMode=2,this.layerMask=268435455,this.renderTargetTextures=[],this.renderOnlyInRenderTargetTextures=!1,this._vertexBuffers={},this.onDisposeObservable=new le,this.onBeforeRenderObservable=new le,this.onAfterRenderObservable=new le,this.texture=t?new Pn(t,i,!0):null,this.isBackground=void 0===r||r,this.color=void 0===n?new K(1,1,1,1):n,this._scene=i||Ae.LastCreatedScene;var o=this._scene._getComponent(Ur.NAME_LAYER);o||(o=new dd(this._scene),this._scene._addComponent(o)),this._scene.layers.push(this);var s=this._scene.getEngine(),a=[];a.push(1,1),a.push(-1,1),a.push(-1,-1),a.push(1,-1);var h=new Si(s,a,Si.PositionKind,!1,!1,2);this._vertexBuffers[Si.PositionKind]=h,this._createIndexBuffer()}var bd=(Object.defineProperty(Td.prototype,"fontSize",{get:function(){return this._fontSize.toString(this._host)},set:function(e){this._fontSize.toString(this._host)!==e&&this._fontSize.fromString(e)&&this.onChangedObservable.notifyObservers(this)},enumerable:!0,configurable:!0}),Object.defineProperty(Td.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(e){this._fontFamily!==e&&(this._fontFamily=e,this.onChangedObservable.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(Td.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(e){this._fontStyle!==e&&(this._fontStyle=e,this.onChangedObservable.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(Td.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(e){this._fontWeight!==e&&(this._fontWeight=e,this.onChangedObservable.notifyObservers(this))},enumerable:!0,configurable:!0}),Td.prototype.dispose=function(){this.onChangedObservable.clear()},Td);function Td(e){this._fontFamily="Arial",this._fontStyle="",this._fontWeight="",this._fontSize=new du(18,du.UNITMODE_PIXEL,!1),this.onChangedObservable=new le,this._host=e}var xd=(Ed.ALPHA_DISABLE=0,Ed.ALPHA_ADD=1,Ed.ALPHA_COMBINE=2,Ed.ALPHA_SUBTRACT=3,Ed.ALPHA_MULTIPLY=4,Ed.ALPHA_MAXIMIZED=5,Ed.ALPHA_ONEONE=6,Ed.ALPHA_PREMULTIPLIED=7,Ed.ALPHA_PREMULTIPLIED_PORTERDUFF=8,Ed.ALPHA_INTERPOLATE=9,Ed.ALPHA_SCREENMODE=10,Ed.ALPHA_ONEONE_ONEONE=11,Ed.ALPHA_ALPHATOCOLOR=12,Ed.ALPHA_REVERSEONEMINUS=13,Ed.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,Ed.ALPHA_ONEONE_ONEZERO=15,Ed.ALPHA_EXCLUSION=16,Ed.ALPHA_EQUATION_ADD=0,Ed.ALPHA_EQUATION_SUBSTRACT=1,Ed.ALPHA_EQUATION_REVERSE_SUBTRACT=2,Ed.ALPHA_EQUATION_MAX=3,Ed.ALPHA_EQUATION_MIN=4,Ed.ALPHA_EQUATION_DARKEN=5,Ed.DELAYLOADSTATE_NONE=0,Ed.DELAYLOADSTATE_LOADED=1,Ed.DELAYLOADSTATE_LOADING=2,Ed.DELAYLOADSTATE_NOTLOADED=4,Ed.NEVER=512,Ed.ALWAYS=519,Ed.LESS=513,Ed.EQUAL=514,Ed.LEQUAL=515,Ed.GREATER=516,Ed.GEQUAL=518,Ed.NOTEQUAL=517,Ed.KEEP=7680,Ed.REPLACE=7681,Ed.INCR=7682,Ed.DECR=7683,Ed.INVERT=5386,Ed.INCR_WRAP=34055,Ed.DECR_WRAP=34056,Ed.TEXTURE_CLAMP_ADDRESSMODE=0,Ed.TEXTURE_WRAP_ADDRESSMODE=1,Ed.TEXTURE_MIRROR_ADDRESSMODE=2,Ed.TEXTUREFORMAT_ALPHA=0,Ed.TEXTUREFORMAT_LUMINANCE=1,Ed.TEXTUREFORMAT_LUMINANCE_ALPHA=2,Ed.TEXTUREFORMAT_RGB=4,Ed.TEXTUREFORMAT_RGBA=5,Ed.TEXTUREFORMAT_RED=6,Ed.TEXTUREFORMAT_R=6,Ed.TEXTUREFORMAT_RG=7,Ed.TEXTUREFORMAT_RED_INTEGER=8,Ed.TEXTUREFORMAT_R_INTEGER=8,Ed.TEXTUREFORMAT_RG_INTEGER=9,Ed.TEXTUREFORMAT_RGB_INTEGER=10,Ed.TEXTUREFORMAT_RGBA_INTEGER=11,Ed.TEXTURETYPE_UNSIGNED_BYTE=0,Ed.TEXTURETYPE_UNSIGNED_INT=0,Ed.TEXTURETYPE_FLOAT=1,Ed.TEXTURETYPE_HALF_FLOAT=2,Ed.TEXTURETYPE_BYTE=3,Ed.TEXTURETYPE_SHORT=4,Ed.TEXTURETYPE_UNSIGNED_SHORT=5,Ed.TEXTURETYPE_INT=6,Ed.TEXTURETYPE_UNSIGNED_INTEGER=7,Ed.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,Ed.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,Ed.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,Ed.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,Ed.TEXTURETYPE_UNSIGNED_INT_24_8=12,Ed.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,Ed.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,Ed.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,Ed.TEXTURE_NEAREST_SAMPLINGMODE=1,Ed.TEXTURE_NEAREST_NEAREST=1,Ed.TEXTURE_BILINEAR_SAMPLINGMODE=2,Ed.TEXTURE_LINEAR_LINEAR=2,Ed.TEXTURE_TRILINEAR_SAMPLINGMODE=3,Ed.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,Ed.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,Ed.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,Ed.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,Ed.TEXTURE_NEAREST_LINEAR=7,Ed.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,Ed.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,Ed.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,Ed.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,Ed.TEXTURE_LINEAR_NEAREST=12,Ed.TEXTURE_EXPLICIT_MODE=0,Ed.TEXTURE_SPHERICAL_MODE=1,Ed.TEXTURE_PLANAR_MODE=2,Ed.TEXTURE_CUBIC_MODE=3,Ed.TEXTURE_PROJECTION_MODE=4,Ed.TEXTURE_SKYBOX_MODE=5,Ed.TEXTURE_INVCUBIC_MODE=6,Ed.TEXTURE_EQUIRECTANGULAR_MODE=7,Ed.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,Ed.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,Ed.SCALEMODE_FLOOR=1,Ed.SCALEMODE_NEAREST=2,Ed.SCALEMODE_CEILING=3,Ed.MATERIAL_TextureDirtyFlag=1,Ed.MATERIAL_LightDirtyFlag=2,Ed.MATERIAL_FresnelDirtyFlag=4,Ed.MATERIAL_AttributesDirtyFlag=8,Ed.MATERIAL_MiscDirtyFlag=16,Ed.MATERIAL_AllDirtyFlag=31,Ed.MATERIAL_TriangleFillMode=0,Ed.MATERIAL_WireFrameFillMode=1,Ed.MATERIAL_PointFillMode=2,Ed.MATERIAL_PointListDrawMode=3,Ed.MATERIAL_LineListDrawMode=4,Ed.MATERIAL_LineLoopDrawMode=5,Ed.MATERIAL_LineStripDrawMode=6,Ed.MATERIAL_TriangleStripDrawMode=7,Ed.MATERIAL_TriangleFanDrawMode=8,Ed.MATERIAL_ClockWiseSideOrientation=0,Ed.MATERIAL_CounterClockWiseSideOrientation=1,Ed.ACTION_NothingTrigger=0,Ed.ACTION_OnPickTrigger=1,Ed.ACTION_OnLeftPickTrigger=2,Ed.ACTION_OnRightPickTrigger=3,Ed.ACTION_OnCenterPickTrigger=4,Ed.ACTION_OnPickDownTrigger=5,Ed.ACTION_OnDoublePickTrigger=6,Ed.ACTION_OnPickUpTrigger=7,Ed.ACTION_OnPickOutTrigger=16,Ed.ACTION_OnLongPressTrigger=8,Ed.ACTION_OnPointerOverTrigger=9,Ed.ACTION_OnPointerOutTrigger=10,Ed.ACTION_OnEveryFrameTrigger=11,Ed.ACTION_OnIntersectionEnterTrigger=12,Ed.ACTION_OnIntersectionExitTrigger=13,Ed.ACTION_OnKeyDownTrigger=14,Ed.ACTION_OnKeyUpTrigger=15,Ed.PARTICLES_BILLBOARDMODE_Y=2,Ed.PARTICLES_BILLBOARDMODE_ALL=7,Ed.PARTICLES_BILLBOARDMODE_STRETCHED=8,Ed.MESHES_CULLINGSTRATEGY_STANDARD=0,Ed.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,Ed.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,Ed.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,Ed.SCENELOADER_NO_LOGGING=0,Ed.SCENELOADER_MINIMAL_LOGGING=1,Ed.SCENELOADER_SUMMARY_LOGGING=2,Ed.SCENELOADER_DETAILED_LOGGING=3,Ed);function Ed(){}var Ad,Md=(n(Cd,Ad=ud),Object.defineProperty(Cd.prototype,"numLayoutCalls",{get:function(){return this._numLayoutCalls},enumerable:!0,configurable:!0}),Object.defineProperty(Cd.prototype,"numRenderCalls",{get:function(){return this._numRenderCalls},enumerable:!0,configurable:!0}),Object.defineProperty(Cd.prototype,"renderScale",{get:function(){return this._renderScale},set:function(e){e!==this._renderScale&&(this._renderScale=e,this._onResize())},enumerable:!0,configurable:!0}),Object.defineProperty(Cd.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this.markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Cd.prototype,"idealWidth",{get:function(){return this._idealWidth},set:function(e){this._idealWidth!==e&&(this._idealWidth=e,this.markAsDirty(),this._rootContainer._markAllAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Cd.prototype,"idealHeight",{get:function(){return this._idealHeight},set:function(e){this._idealHeight!==e&&(this._idealHeight=e,this.markAsDirty(),this._rootContainer._markAllAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Cd.prototype,"useSmallestIdeal",{get:function(){return this._useSmallestIdeal},set:function(e){this._useSmallestIdeal!==e&&(this._useSmallestIdeal=e,this.markAsDirty(),this._rootContainer._markAllAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Cd.prototype,"renderAtIdealSize",{get:function(){return this._renderAtIdealSize},set:function(e){this._renderAtIdealSize!==e&&(this._renderAtIdealSize=e,this._onResize())},enumerable:!0,configurable:!0}),Object.defineProperty(Cd.prototype,"idealRatio",{get:function(){var e=0,t=0;return this._idealWidth&&(e=this.getSize().width/this._idealWidth),this._idealHeight&&(t=this.getSize().height/this._idealHeight),this._useSmallestIdeal&&this._idealWidth&&this._idealHeight?window.innerWidth<window.innerHeight?e:t:this._idealWidth?e:this._idealHeight?t:1},enumerable:!0,configurable:!0}),Object.defineProperty(Cd.prototype,"layer",{get:function(){return this._layerToDispose},enumerable:!0,configurable:!0}),Object.defineProperty(Cd.prototype,"rootContainer",{get:function(){return this._rootContainer},enumerable:!0,configurable:!0}),Cd.prototype.getChildren=function(){return[this._rootContainer]},Cd.prototype.getDescendants=function(e,t){return this._rootContainer.getDescendants(e,t)},Object.defineProperty(Cd.prototype,"focusedControl",{get:function(){return this._focusedControl},set:function(e){this._focusedControl!=e&&(this._focusedControl&&this._focusedControl.onBlur(),e&&e.onFocus(),this._focusedControl=e)},enumerable:!0,configurable:!0}),Object.defineProperty(Cd.prototype,"isForeground",{get:function(){return!this.layer||!this.layer.isBackground},set:function(e){this.layer&&this.layer.isBackground!==!e&&(this.layer.isBackground=!e)},enumerable:!0,configurable:!0}),Object.defineProperty(Cd.prototype,"clipboardData",{get:function(){return this._clipboardData},set:function(e){this._clipboardData=e},enumerable:!0,configurable:!0}),Cd.prototype.getClassName=function(){return"AdvancedDynamicTexture"},Cd.prototype.executeOnAllControls=function(e,t){e(t=t||this._rootContainer);for(var i=0,r=t.children;i<r.length;i++){var n=r[i];n.children?this.executeOnAllControls(e,n):e(n)}},Object.defineProperty(Cd.prototype,"useInvalidateRectOptimization",{get:function(){return this._useInvalidateRectOptimization},set:function(e){this._useInvalidateRectOptimization=e},enumerable:!0,configurable:!0}),Cd.prototype.invalidateRect=function(e,t,i,r){var n,o;this._useInvalidateRectOptimization&&(this._invalidatedRectangle?(n=Math.ceil(Math.max(this._invalidatedRectangle.left+this._invalidatedRectangle.width-1,i)),o=Math.ceil(Math.max(this._invalidatedRectangle.top+this._invalidatedRectangle.height-1,r)),this._invalidatedRectangle.left=Math.floor(Math.min(this._invalidatedRectangle.left,e)),this._invalidatedRectangle.top=Math.floor(Math.min(this._invalidatedRectangle.top,t)),this._invalidatedRectangle.width=n-this._invalidatedRectangle.left+1,this._invalidatedRectangle.height=o-this._invalidatedRectangle.top+1):this._invalidatedRectangle=new vu(e,t,i-e+1,r-t+1))},Cd.prototype.markAsDirty=function(){this._isDirty=!0},Cd.prototype.createStyle=function(){return new bd(this)},Cd.prototype.addControl=function(e){return this._rootContainer.addControl(e),this},Cd.prototype.removeControl=function(e){return this._rootContainer.removeControl(e),this},Cd.prototype.dispose=function(){var e=this.getScene();e&&(this._rootElement=null,e.onBeforeCameraRenderObservable.remove(this._renderObserver),this._resizeObserver&&e.getEngine().onResizeObservable.remove(this._resizeObserver),this._pointerMoveObserver&&e.onPrePointerObservable.remove(this._pointerMoveObserver),this._pointerObserver&&e.onPointerObservable.remove(this._pointerObserver),this._preKeyboardObserver&&e.onPreKeyboardObservable.remove(this._preKeyboardObserver),this._canvasPointerOutObserver&&e.getEngine().onCanvasPointerOutObservable.remove(this._canvasPointerOutObserver),this._layerToDispose&&(this._layerToDispose.texture=null,this._layerToDispose.dispose(),this._layerToDispose=null),this._rootContainer.dispose(),this.onClipboardObservable.clear(),this.onControlPickedObservable.clear(),this.onBeginRenderObservable.clear(),this.onEndRenderObservable.clear(),this.onBeginLayoutObservable.clear(),this.onEndLayoutObservable.clear(),Ad.prototype.dispose.call(this))},Cd.prototype._onResize=function(){var e,t,i,r,n=this.getScene();n&&(e=n.getEngine(),t=this.getSize(),i=e.getRenderWidth()*this._renderScale,r=e.getRenderHeight()*this._renderScale,this._renderAtIdealSize&&(this._idealWidth?(r=r*this._idealWidth/i,i=this._idealWidth):this._idealHeight&&(i=i*this._idealHeight/r,r=this._idealHeight)),t.width===i&&t.height===r||(this.scaleTo(i,r),this.markAsDirty(),(this._idealWidth||this._idealHeight)&&this._rootContainer._markAllAsDirty()),this.invalidateRect(0,0,t.width-1,t.height-1))},Cd.prototype._getGlobalViewport=function(e){var t=e.getEngine();return this._fullscreenViewport.toGlobal(t.getRenderWidth(),t.getRenderHeight())},Cd.prototype.getProjectedPosition=function(e,t){var i=this.getScene();if(!i)return H.Zero();var r=this._getGlobalViewport(i),n=te.Project(e,t,i.getTransformMatrix(),r);return n.scaleInPlace(this.renderScale),new H(n.x,n.y)},Cd.prototype._checkUpdate=function(e){if(!this._layerToDispose||0!=(e.layerMask&this._layerToDispose.layerMask)){if(this._isFullscreen&&this._linkedControls.length){var t=this.getScene();if(!t)return;for(var i=this._getGlobalViewport(t),r=0,n=this._linkedControls;r<n.length;r++){var o,s,a,h=n[r];h.isVisible&&((o=h._linkedMesh)&&!o.isDisposed()?(s=o.getBoundingInfo?o.getBoundingInfo().boundingSphere.center:te.ZeroReadOnly,(a=te.Project(s,o.getWorldMatrix(),t.getTransformMatrix(),i)).z<0||1<a.z?h.notRenderable=!0:(h.notRenderable=!1,a.scaleInPlace(this.renderScale),h._moveToProjectedPosition(a))):ri.SetImmediate(function(){h.linkWithMesh(null)}))}}(this._isDirty||this._rootContainer.isDirty)&&(this._isDirty=!1,this._render(),this.update(!0,this.premulAlpha))}},Cd.prototype._render=function(){var e=this.getSize(),t=e.width,i=e.height,r=this.getContext();r.font="18px Arial",r.strokeStyle="white",this.onBeginLayoutObservable.notifyObservers(this);var n=new vu(0,0,t,i);this._numLayoutCalls=0,this._rootContainer._layout(n,r),this.onEndLayoutObservable.notifyObservers(this),this._isDirty=!1,this._invalidatedRectangle?this._clearMeasure.copyFrom(this._invalidatedRectangle):this._clearMeasure.copyFromFloats(0,0,t,i),r.clearRect(this._clearMeasure.left,this._clearMeasure.top,this._clearMeasure.width,this._clearMeasure.height),this._background&&(r.save(),r.fillStyle=this._background,r.fillRect(this._clearMeasure.left,this._clearMeasure.top,this._clearMeasure.width,this._clearMeasure.height),r.restore()),this.onBeginRenderObservable.notifyObservers(this),this._numRenderCalls=0,this._rootContainer._render(r,this._invalidatedRectangle),this.onEndRenderObservable.notifyObservers(this),this._invalidatedRectangle=null},Cd.prototype._changeCursor=function(e){this._rootElement&&(this._rootElement.style.cursor=e,this._cursorChanged=!0)},Cd.prototype._registerLastControlDown=function(e,t){this._lastControlDown[t]=e,this.onControlPickedObservable.notifyObservers(e)},Cd.prototype._doPicking=function(e,t,i,r,n,o,s){var a,h,l,u=this.getScene();u&&(a=u.getEngine(),h=this.getSize(),this._isFullscreen&&(l=(u.cameraToUseForPointers||u.activeCamera).viewport,e*=h.width/(a.getRenderWidth()*l.width),t*=h.height/(a.getRenderHeight()*l.height)),this._capturingControl[r]?this._capturingControl[r]._processObservables(i,e,t,r,n):(this._cursorChanged=!1,this._rootContainer._processPicking(e,t,i,r,n,o,s)||(this._changeCursor(""),i===Xr.POINTERMOVE&&this._lastControlOver[r]&&(this._lastControlOver[r]._onPointerOut(this._lastControlOver[r]),delete this._lastControlOver[r])),this._cursorChanged||this._changeCursor(""),this._manageFocus()))},Cd.prototype._cleanControlAfterRemovalFromList=function(e,t){for(var i in e)e.hasOwnProperty(i)&&e[i]===t&&delete e[i]},Cd.prototype._cleanControlAfterRemoval=function(e){this._cleanControlAfterRemovalFromList(this._lastControlDown,e),this._cleanControlAfterRemovalFromList(this._lastControlOver,e)},Cd.prototype.attach=function(){var a,h=this,l=this.getScene();l&&(a=new Ji(0,0,0,0),this._pointerMoveObserver=l.onPrePointerObservable.add(function(e,t){var i,r,n,o,s;l.isPointerCaptured(e.event.pointerId)||e.type!==Xr.POINTERMOVE&&e.type!==Xr.POINTERUP&&e.type!==Xr.POINTERDOWN&&e.type!==Xr.POINTERWHEEL||l&&(e.type===Xr.POINTERMOVE&&e.event.pointerId&&(h._defaultMousePointerId=e.event.pointerId),i=l.cameraToUseForPointers||l.activeCamera,r=l.getEngine(),i?i.viewport.toGlobalToRef(r.getRenderWidth(),r.getRenderHeight(),a):(a.x=0,a.y=0,a.width=r.getRenderWidth(),a.height=r.getRenderHeight()),n=l.pointerX/r.getHardwareScalingLevel()-a.x,o=l.pointerY/r.getHardwareScalingLevel()-(r.getRenderHeight()-a.y-a.height),h._shouldBlockPointer=!1,s=e.event.pointerId||h._defaultMousePointerId,h._doPicking(n,o,e.type,s,e.event.button,e.event.deltaX,e.event.deltaY),h._shouldBlockPointer&&(e.skipOnPointerObservable=h._shouldBlockPointer))}),this._attachToOnPointerOut(l))},Cd.prototype.registerClipboardEvents=function(){self.addEventListener("copy",this.onClipboardCopy,!1),self.addEventListener("cut",this.onClipboardCut,!1),self.addEventListener("paste",this.onClipboardPaste,!1)},Cd.prototype.unRegisterClipboardEvents=function(){self.removeEventListener("copy",this.onClipboardCopy),self.removeEventListener("cut",this.onClipboardCut),self.removeEventListener("paste",this.onClipboardPaste)},Cd.prototype.attachToMesh=function(c,e){var d=this;void 0===e&&(e=!0);var t=this.getScene();t&&(this._pointerObserver=t.onPointerObservable.add(function(e,t){if(e.type===Xr.POINTERMOVE||e.type===Xr.POINTERUP||e.type===Xr.POINTERDOWN){var i=e.event.pointerId||d._defaultMousePointerId;if(e.pickInfo&&e.pickInfo.hit&&e.pickInfo.pickedMesh===c){var r,n=e.pickInfo.getTextureCoordinates();n&&(r=d.getSize(),d._doPicking(n.x*r.width,(1-n.y)*r.height,e.type,i,e.event.button))}else if(e.type===Xr.POINTERUP){if(d._lastControlDown[i]&&d._lastControlDown[i]._forcePointerUp(i),delete d._lastControlDown[i],d.focusedControl){var o=d.focusedControl.keepsFocusWith(),s=!0;if(o)for(var a=0,h=o;a<h.length;a++){var l=h[a];if(d!==l._host){var u=l._host;if(u._lastControlOver[i]&&u._lastControlOver[i].isAscendant(l)){s=!1;break}}}s&&(d.focusedControl=null)}}else e.type===Xr.POINTERMOVE&&(d._lastControlOver[i]&&d._lastControlOver[i]._onPointerOut(d._lastControlOver[i],!0),delete d._lastControlOver[i])}}),c.enablePointerMoveEvents=e,this._attachToOnPointerOut(t))},Cd.prototype.moveFocusToControl=function(e){this.focusedControl=e,this._lastPickedControl=e,this._blockNextFocusCheck=!0},Cd.prototype._manageFocus=function(){if(this._blockNextFocusCheck)return this._blockNextFocusCheck=!1,void(this._lastPickedControl=this._focusedControl);if(this._focusedControl&&this._focusedControl!==this._lastPickedControl){if(this._lastPickedControl.isFocusInvisible)return;this.focusedControl=null}},Cd.prototype._attachToOnPointerOut=function(e){var t=this;this._canvasPointerOutObserver=e.getEngine().onCanvasPointerOutObservable.add(function(e){t._lastControlOver[e.pointerId]&&t._lastControlOver[e.pointerId]._onPointerOut(t._lastControlOver[e.pointerId]),delete t._lastControlOver[e.pointerId],t._lastControlDown[e.pointerId]&&t._lastControlDown[e.pointerId]!==t._capturingControl[e.pointerId]&&(t._lastControlDown[e.pointerId]._forcePointerUp(),delete t._lastControlDown[e.pointerId])})},Cd.CreateForMesh=function(e,t,i,r,n){void 0===t&&(t=1024),void 0===i&&(i=1024),void 0===r&&(r=!0),void 0===n&&(n=!1);var o=new Cd(e.name+" AdvancedDynamicTexture",t,i,e.getScene(),!0,Pn.TRILINEAR_SAMPLINGMODE),s=new ds("AdvancedDynamicTextureMaterial",e.getScene());return s.backFaceCulling=!1,s.diffuseColor=Ne.Black(),s.specularColor=Ne.Black(),n?(s.diffuseTexture=o,(s.emissiveTexture=o).hasAlpha=!0):(s.emissiveTexture=o,s.opacityTexture=o),e.material=s,o.attachToMesh(e,r),o},Cd.CreateFullscreenUI=function(e,t,i,r){void 0===t&&(t=!0),void 0===i&&(i=null),void 0===r&&(r=Pn.BILINEAR_SAMPLINGMODE);var n=new Cd(e,0,0,i,!1,r),o=new vd(e+"_layer",null,i,!t);return(o.texture=n)._layerToDispose=o,n._isFullscreen=!0,n.attach(),n},Cd);function Cd(e,t,i,r,n,o){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=!1),void 0===o&&(o=Pn.NEAREST_SAMPLINGMODE);var s=Ad.call(this,e,{width:t,height:i},r,n,o,xd.TEXTUREFORMAT_RGBA)||this;return s._isDirty=!1,s._rootContainer=new Ou("root"),s._lastControlOver={},s._lastControlDown={},s._capturingControl={},s._linkedControls=new Array,s._isFullscreen=!1,s._fullscreenViewport=new Ji(0,0,1,1),s._idealWidth=0,s._idealHeight=0,s._useSmallestIdeal=!1,s._renderAtIdealSize=!1,s._blockNextFocusCheck=!1,s._renderScale=1,s._cursorChanged=!1,s._defaultMousePointerId=0,s._numLayoutCalls=0,s._numRenderCalls=0,s._clipboardData="",s.onClipboardObservable=new le,s.onControlPickedObservable=new le,s.onBeginLayoutObservable=new le,s.onEndLayoutObservable=new le,s.onBeginRenderObservable=new le,s.onEndRenderObservable=new le,s.premulAlpha=!1,s._useInvalidateRectOptimization=!0,s._invalidatedRectangle=null,s._clearMeasure=new vu(0,0,0,0),s.onClipboardCopy=function(e){var t=e,i=new Ju(Zu.COPY,t);s.onClipboardObservable.notifyObservers(i),t.preventDefault()},s.onClipboardCut=function(e){var t=e,i=new Ju(Zu.CUT,t);s.onClipboardObservable.notifyObservers(i),t.preventDefault()},s.onClipboardPaste=function(e){var t=e,i=new Ju(Zu.PASTE,t);s.onClipboardObservable.notifyObservers(i),t.preventDefault()},(r=s.getScene())&&s._texture&&(s._rootElement=r.getEngine().getInputElement(),s._renderObserver=r.onBeforeCameraRenderObservable.add(function(e){return s._checkUpdate(e)}),s._preKeyboardObserver=r.onPreKeyboardObservable.add(function(e){s._focusedControl&&(e.type===tn.KEYDOWN&&s._focusedControl.processKeyboard(e.event),e.skipOnPointerObservable=!0)}),s._rootContainer._link(s),s.hasAlpha=!0,t&&i||(s._resizeObserver=r.getEngine().onResizeObservable.add(function(){return s._onResize()}),s._onResize()),s._texture.isReady=!0),s}Object.defineProperty(Pd.prototype,"renderTimeCounter",{get:function(){return this._renderTime},enumerable:!0,configurable:!0}),Object.defineProperty(Pd.prototype,"layoutTimeCounter",{get:function(){return this._layoutTime},enumerable:!0,configurable:!0}),Object.defineProperty(Pd.prototype,"captureRenderTime",{get:function(){return this._captureRenderTime},set:function(e){var t=this;e!==this._captureRenderTime&&((this._captureRenderTime=e)?(this._onBeginRenderObserver=this.texture.onBeginRenderObservable.add(function(){t._renderTime.beginMonitoring()}),this._onEndRenderObserver=this.texture.onEndRenderObservable.add(function(){t._renderTime.endMonitoring(!0)})):(this.texture.onBeginRenderObservable.remove(this._onBeginRenderObserver),this._onBeginRenderObserver=null,this.texture.onEndRenderObservable.remove(this._onEndRenderObserver),this._onEndRenderObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(Pd.prototype,"captureLayoutTime",{get:function(){return this._captureLayoutTime},set:function(e){var t=this;e!==this._captureLayoutTime&&((this._captureLayoutTime=e)?(this._onBeginLayoutObserver=this.texture.onBeginLayoutObservable.add(function(){t._layoutTime.beginMonitoring()}),this._onEndLayoutObserver=this.texture.onEndLayoutObservable.add(function(){t._layoutTime.endMonitoring(!0)})):(this.texture.onBeginLayoutObservable.remove(this._onBeginLayoutObserver),this._onBeginLayoutObserver=null,this.texture.onEndLayoutObservable.remove(this._onEndLayoutObserver),this._onEndLayoutObserver=null))},enumerable:!0,configurable:!0}),Pd.prototype.dispose=function(){this.texture.onBeginRenderObservable.remove(this._onBeginRenderObserver),this._onBeginRenderObserver=null,this.texture.onEndRenderObservable.remove(this._onEndRenderObserver),this._onEndRenderObserver=null,this.texture.onBeginLayoutObservable.remove(this._onBeginLayoutObserver),this._onBeginLayoutObserver=null,this.texture.onEndLayoutObservable.remove(this._onEndLayoutObserver),this._onEndLayoutObserver=null,this.texture=null};function Pd(e){this.texture=e,this._captureRenderTime=!1,this._renderTime=new xi,this._captureLayoutTime=!1,this._layoutTime=new xi,this._onBeginRenderObserver=null,this._onEndRenderObserver=null,this._onBeginLayoutObserver=null,this._onEndLayoutObserver=null}Od.prototype._getChainElement=function(e){var t=window;this._parentClass&&(t=this._parentClass);for(var i=(i=e).split("."),r=0;r<i.length;r++)t=t[i[r]];return t},Od.prototype._getClassAttribute=function(e){var t=e.split(".");return m.GetClass("BABYLON.GUI."+t[0])[t[1]]},Od.prototype._createGuiElement=function(t,e,i){void 0===i&&(i=!0);try{var r=new(m.GetClass("BABYLON.GUI."+t.nodeName));e&&i&&e.addControl(r);for(var n,o=0;o<t.attributes.length;o++)t.attributes[o].name.toLowerCase().includes("datasource")||(t.attributes[o].name.toLowerCase().includes("observable")?(n=this._getChainElement(t.attributes[o].value),r[t.attributes[o].name].add(n)):"linkWithMesh"==t.attributes[o].name?this._parentClass?r.linkWithMesh(this._parentClass[t.attributes[o].value]):r.linkWithMesh(window[t.attributes[o].value]):t.attributes[o].value.startsWith("{{")&&t.attributes[o].value.endsWith("}}")?(n=this._getChainElement(t.attributes[o].value.substring(2,t.attributes[o].value.length-2)),r[t.attributes[o].name]=n):this._objectAttributes[t.attributes[o].name]?r[t.attributes[o].name]=this._getClassAttribute(t.attributes[o].value):"true"==t.attributes[o].value||"false"==t.attributes[o].value?r[t.attributes[o].name]="true"==t.attributes[o].value:r[t.attributes[o].name]=isNaN(Number(t.attributes[o].value))?t.attributes[o].value:Number(t.attributes[o].value));if(!t.attributes.getNamedItem("id"))return this._nodes[t.nodeName+Object.keys(this._nodes).length+"_gen"]=r;var s=t.attributes.getNamedItem("id").value;if(s.startsWith("{{")&&s.endsWith("}}")&&(s=this._getChainElement(s.substring(2,s.length-2))),this._nodes[s])throw"XmlLoader Exception : Duplicate ID, every element should have an unique ID attribute";return this._nodes[s]=r}catch(e){throw"XmlLoader Exception : Error parsing Control "+t.nodeName+","+e+"."}},Od.prototype._parseGrid=function(e,t,i){for(var r,n,o,s,a,h,l=e.children,u=-1,c=-1,d=0,f=0;f<l.length;f++)if(l[f].nodeType==this._nodeTypes.element){if("Row"!=l[f].nodeName)throw"XmlLoader Exception : Expecting Row node, received "+l[f].nodeName;if(u+=1,o=l[f].children,!l[f].attributes.getNamedItem("height"))throw"XmlLoader Exception : Height must be defined for grid rows";n=Number(l[f].attributes.getNamedItem("height").nodeValue),a=!!l[f].attributes.getNamedItem("isPixel")&&JSON.parse(l[f].attributes.getNamedItem("isPixel").nodeValue),t.addRowDefinition(n,a);for(var p=0;p<o.length;p++)if(o[p].nodeType==this._nodeTypes.element){if("Column"!=o[p].nodeName)throw"XmlLoader Exception : Expecting Column node, received "+o[p].nodeName;if(c+=1,0<u&&d<c)throw"XmlLoader Exception : In the Grid element, the number of columns is defined in the first row, do not add more columns in the subsequent rows.";if(0==u){if(!o[p].attributes.getNamedItem("width"))throw"XmlLoader Exception : Width must be defined for all the grid columns in the first row";r=Number(o[p].attributes.getNamedItem("width").nodeValue),a=!!o[p].attributes.getNamedItem("isPixel")&&JSON.parse(o[p].attributes.getNamedItem("isPixel").nodeValue),t.addColumnDefinition(r,a)}s=o[p].children;for(var _=0;_<s.length;_++)s[_].nodeType==this._nodeTypes.element&&(h=this._createGuiElement(s[_],t,!1),t.addControl(h,u,c),s[_].firstChild&&this._parseXml(s[_].firstChild,h))}0==u&&(d=c),c=-1}e.nextSibling&&this._parseXml(e.nextSibling,i)},Od.prototype._parseElement=function(e,t,i){e.firstChild&&this._parseXml(e.firstChild,t),e.nextSibling&&this._parseXml(e.nextSibling,i)},Od.prototype._prepareSourceElement=function(e,t,i,r,n){this._parentClass?this._parentClass[i]=r[n]:window[i]=r[n],e.firstChild&&this._parseXml(e.firstChild,t,!0)},Od.prototype._parseElementsFromSource=function(e,t,i){var r=e.attributes.getNamedItem("dataSource").value;if(!r.includes(" in "))throw"XmlLoader Exception : Malformed XML, Data Source must include an in";var n=!0,o=r.split(" in ");if(o.length<2)throw"XmlLoader Exception : Malformed XML, Data Source must an iterator and a source";var s=o[1];if(s.startsWith("{")&&s.endsWith("}")&&(n=!1),(!n||s.startsWith("[")&&s.endsWith("]"))&&(s=s.substring(1,s.length-1)),s=this._parentClass?this._parentClass[s]:window[s],n)for(var a=0;a<s.length;a++)this._prepareSourceElement(e,t,o[0],s,a);else for(var a in s)this._prepareSourceElement(e,t,o[0],s,a);e.nextSibling&&this._parseXml(e.nextSibling,i)},Od.prototype._parseXml=function(e,t,i){var r;void 0===i&&(i=!1),e.nodeType==this._nodeTypes.element?(i&&e.setAttribute("id",t.id+(t._children.length+1)),r=this._createGuiElement(e,t),"Grid"==e.nodeName?this._parseGrid(e,r,t):e.attributes.getNamedItem("dataSource")?this._parseElementsFromSource(e,r,t):this._parseElement(e,r,t)):e.nextSibling&&this._parseXml(e.nextSibling,t,i)},Od.prototype.isLoaded=function(){return this._isLoaded},Od.prototype.getNodeById=function(e){return this._nodes[e]},Od.prototype.getNodes=function(){return this._nodes},Od.prototype.loadLayout=function(e,t,i){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){if(!r.responseXML)throw"XmlLoader Exception : XML file is malformed or corrupted.";var e=r.responseXML.documentElement;this._parseXml(e.firstChild,t),this._isLoaded=!0,i&&i()}}.bind(this),r.open("GET",e,!0),r.send()};function Od(e){void 0===e&&(e=null),this._nodes={},this._nodeTypes={element:1,attribute:2,text:3},this._isLoaded=!1,this._objectAttributes={textHorizontalAlignment:1,textVerticalAlignment:2,horizontalAlignment:3,verticalAlignment:4,stretch:5},e&&(this._parentClass=e)}var Sd=document.getElementById("renderCanvas"),Id=new Mi(Sd,!0),Rd=document.getElementById("fps"),Dd=function(){var e=new _n(Id),t=new nh("camera1",-Math.PI/3,5*Math.PI/12,50,new te(0,5,0),e);t.wheelPrecision=8,t.setTarget(te.Zero()),t.attachControl(Sd,!1);new ah("light1",new te(0,1,0),e);kl.CreateSphere("sphere",{segments:64,diameter:2},e).position.y=1;kl.CreateGround("ground1",{height:6,width:6,subdivisions:2},e);return e}(),wd=Md.CreateFullscreenUI("UI"),Ld=Wu.CreateSimpleButton("but1","Click Me");Ld.width="150px",Ld.height="30px",Ld.color="white",Ld.cornerRadius=10,Ld.background="black",Ld.onPointerUpObservable.add(function(){alert("you did it!")}),wd.addControl(Ld),Ld.horizontalAlignment=Mu.HORIZONTAL_ALIGNMEN_RIGHT,Id.runRenderLoop(function(){Rd.innerHTML=Id.getFps().toFixed()+" fps",Dd.render()}),window.addEventListener("resize",function(){Id.resize()})}]);